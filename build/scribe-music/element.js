/* Scribe 
   0.4.36
   By stephband */

var qi=Object.defineProperty;var Pi=(t,e)=>{for(var r in e)qi(t,r,{get:e[r],enumerable:!0})};var L,dt;function Ii(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function gr(t){let e=0;for(;t[--e];)t[e].stop&&t[e].stop(),t[e]=void 0}function Lt(t,e){let r=0;for(;e[--r]&&e[r]!==t;);for(e[r]=t,r=-1;t[++r]&&t[r]!==e;);t[r]=e}function At(t){let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.invalidate(t)}function wr(t,e){let r=0;for(;t[--r];)if(t[r]===e)return!0}var A=class t{static isSignal(e){return e instanceof t}static of(e){return new lr(e)}static from(e,r){if(e.then){let o=t.of();return e.then(n=>o.value=n),o}return e.pipe?e.pipe(new hr):new le(e,r)}static compute(e,r){return new le(e,r)}static fromProperty(e,r){return new fr(e,r)}static frame(e){return new me(e)}static tick(e){return new fe(e)}static temporal(e,r){return new mr(e,r)}static evaluate(e,r,o=e){let n=L;L=e,n||(dt=!1);let i=r.apply(o);return L=n,i}static get hasInvalidDependency(){return dt}static get evaluating(){return L}constructor(e){e&&(this.name=e)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},lr=class extends A{#t;constructor(e){super(),this.#t=e}get value(){return L&&Lt(this,L),this.#t}set value(e){this.#t!==e&&(this.#t=e,At(this))}},hr=class extends A{#t;constructor(e){super(),this.#t=e}get value(){return L&&Lt(this,L),this.#t}push(e){this.#t!==e&&(this.#t=e,At(this))}},fr=class extends A{#t;#e;constructor(e,r){super(e),this.object=r}evaluate(){return this.object[this.name]}get value(){return L&&Lt(this,L),this.#t?this.#e:(this.#e=A.evaluate(this,this.evaluate,this),dt||(this.#t=!0),this.#e)}set value(e){if(this.#e===e)return;let{object:r,name:o}=this;r[o]=e,e=r[o],this.#e!==e&&(this.#e=e,At(this))}invalidate(e){this.#t&&(e&&!wr(this,e)||(this.#t=!1,gr(this),At(this)))}},le=class extends A{#t;#e;#r;#o;constructor(e,r){super(),this.#t=e,this.#e=r}get value(){return L&&Lt(this,L),this.#r?this.#o:(this.#o=A.evaluate(this,this.#t,this.#e),dt||(this.#r=!0),this.#o)}invalidate(e){this.#r&&(e&&!wr(this,e)||(this.#r=!1,gr(this),At(this)))}},mr=class extends A{#t=0;constructor(e,r){super(e),this.object=r}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return A.evaluating&&(Lt(this,L),this.getTime()<this.#t&&(dt=!0)),this.evaluate()}set value(e){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==e&&(this.object[this.name]=e,invalidateUntil(this.getTime()))}invalidateUntil(e){let o=this.getTime()>=this.#t;this.#t=e,o&&At(this)}},he=class extends A{constructor(e){if(super(),L){let r=0;for(;L[--r]&&L[r]!==this;);L[r]=this}e&&(this.evaluate=e,(A.evaluate(this,this.evaluate)||dt)&&this.cue())}invalidate(e){this.constructor.observers.indexOf(this)===-1&&(e&&!wr(this,e)||(gr(this),this.cue()))}stop(){let e=0,r;for(;r=this[--e];){let i=-1;this[e]=void 0,r.stop?r.stop():Ii(r,this)}let o=this.constructor.observers,n=o.indexOf(this);if(n!==-1){if(o===dr)throw new Error("Attempt to remove observer while observers is rendering");o.splice(n,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},dr;function Oo(t){let e=-1,r;for(dr=t;r=t[++e];)!A.evaluate(r,r.evaluate)&&!dt&&t.splice(e--,1);return dr=void 0,t}var Uo=Promise.resolve();function Lo(){Oo(fe.observers).length&&Uo.then(Lo)}var fe=class extends he{static observers=[];cue(){let e=this.constructor.observers;e.length||Uo.then(Lo),e.push(this)}};function qo(){Oo(me.observers).length&&requestAnimationFrame(qo)}var me=class extends he{static observers=[];cue(){let e=this.constructor.observers;e.length||window.requestAnimationFrame(qo),e.push(this)}};function Hi(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function gt(t){return t===window?Hi():t.getClientRects()[0]||t.getBoundingClientRect()}function M(t){return t}function N(t,e){return function(){let o=t.apply(this,arguments),n=e[o]||e.default;if(!n)throw new Error('overload() no function defined for key "'+o+'"');return n.apply(this,arguments)}}var Po=globalThis||window,Io;function nt(t){var e=new Map;return function(o){if(Po.DEBUG&&!Io&&o===void 0&&(Io=!0,console.warn("cache() called with undefined. Not illegal, but potentially bad.")),Po.DEBUG&&arguments.length>1&&console.warn("cache() called with "+arguments.length+" arguments. Accepts exactly 1."),e.has(o))return e.get(o);var n=t(o);return e.set(o,n),n}}var Ho=globalThis||window,zi=Array.prototype;function ji(t,e){return typeof t=="function"?t.apply(null,e):t}function de(t,e,r){r=r||t.length;var o=r===1?e?t:nt(t):nt(function(n){return de(function(){var i=[n];return i.push.apply(i,arguments),t.apply(null,i)},e,r-1)});return function n(i){return arguments.length===0?n:arguments.length===1?o(i):arguments.length>=r?t.apply(null,arguments):ji(o(i),zi.slice.call(arguments,1))}}if(typeof Ho<"u"&&Ho.DEBUG){let t=de,e=function(){var o=function(){};try{Object.defineProperty(o,"length",{value:2})}catch{return!1}return o.length===2}(),r=function(n,i,a,u){return u.toString=function(){return/function\s*[\w\d]*\s*\([,\w\d\s]*\)/.exec(a.toString())+" { ["+n+"] }"},e&&Object.defineProperty(u,"length",{value:i}),u};de=function(n,i,a){return a=a||n.length,r("curried",a,n,t(n,i,a))}}var X=de;function U(){}var Wi=N(M,{is:U,tag:U,data:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},dataset:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},html:function(t,e,r){e.innerHTML=r},text:function(t,e,r){e.textContent=r},style:N((t,e,r)=>typeof r,{string:(t,e,r)=>e.style=r,object:(t,e,r)=>Object.assign(e.style,r)}),children:function(t,e,r){e.innerHTML="",e.append.apply(e,r)},href:function(t,e,r){e instanceof SVGElement?e.setAttribute("href",r):e.href=r},points:J,cx:J,cy:J,r:J,x:J,y:J,dx:J,dy:J,transform:J,preserveAspectRatio:J,viewBox:J,default:function(t,e,r){t in e?e[t]=r:e.setAttribute(t,r)}});function J(t,e,r){e.setAttribute(t,r)}function Ki(t,e){for(var r=Object.keys(e),o=r.length;o--;)e[r[o]]!==void 0&&Wi(r[o],t,e[r[o]]);return t}var ge=X(Ki,!0);var xr="http://www.w3.org/2000/svg",zo=document.createElement("template"),yr=(t,e)=>e&&typeof e;function jo(t,e=""){let r=document.createRange();return r.selectNode(t),r.createContextualFragment(e)}var H=N(yr,{string:function(t,e){let r=document.createElementNS(xr,t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElementNS(xr,t);return typeof e.length=="number"?r.append.apply(r,e):ge(r,e),r},default:t=>document.createElementNS(xr,t)}),Vi=N(yr,{string:function(t,e){let r=document.createElement(t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElement(t);return typeof e.length=="number"?r.append.apply(r,e):ge(r,e),r},default:t=>document.createElement(t)}),Xi=N(M,{comment:function(t,e){return document.createComment(e||"")},fragment:N(yr,{string:function(t,e,r){return r?jo(r,e):(zo.innerHTML=e,zo.content.cloneNode(!0))},object:function(t,e,r){let o=r?jo(r):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):ge(o,e),o},default:()=>document.createDocumentFragment()}),circle:H,ellipse:H,g:H,glyph:H,image:H,line:H,rect:H,use:H,path:H,pattern:H,polygon:H,polyline:H,svg:H,tspan:H,text:H,default:Vi}),v=Xi;function Er(t,e,r){let o;typeof r!="string"&&r.input!==void 0&&r.index!==void 0&&(o=r,r=o.input.slice(r.index+r[0].length+(r.consumed||0)));let n=t.exec(r);if(!n)return;let i=e(n);return o&&(o.consumed=(o.consumed||0)+n.index+n[0].length+(n.consumed||0)),i}var Yp=X(Er,!0);function Yi(t,e,r){throw r.input!==void 0&&r.index!==void 0&&(r=r.input),new Error('Cannot parse string "'+(r.length>128?r.length.slice(0,128)+"â€¦":r)+'"')}function Zi(t,e,r){let o=-1;for(;++o<r.length;)e=r[o]!==void 0&&t[o]?t[o](e,r):e;return t.done?t.done(e,r):t.close?t.close(e,r):e}function Ji(t,e,r,o){let n=Er(t,i=>Zi(e,r,i),o);return n===void 0?e.catch?e.catch(r,o):Yi(t,e,o):n}var Wo=X(Ji,!0);var Ko=Symbol("internals");function br(t,e,r){return e[Ko]=e.attachInternals&&!e.getAttribute("is")?e.attachInternals():{shadowRoot:r}}function b(t){return t[Ko]}var Vo=Object.defineProperties;var vr={},Qi={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return b(this).form}},labels:{get:function(){return b(this).labels}},validity:{get:function(){return b(this).validity}},validationMessage:{get:function(){return b(this).validationMessage}},willValidate:{get:function(){return b(this).willValidate}},checkValidity:{value:function(){return b(this).checkValidity()}},reportValidity:{value:function(){return b(this).reportValidity()}}},Rr=!1,_i=Wo(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() â€“ name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null),Xo={once:!0};function ts(t){return t.sheet?Promise.resolve({target:t}):new Promise((e,r)=>{t.addEventListener("load",e,Xo),t.addEventListener("error",r,Xo)})}function es(t){t.stop()}function rs(t){if(vr[t])return vr[t];let e=document.createElement(t).constructor;if(e===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+t+"> is HTMLUnknownElement");return vr[t]=e}function os(t,e){if(t.hasOwnProperty(e)){let r=t[e];delete t[e],t[e]=r}return t}function Yo(t,e){let r=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(e.stylesheet){let o=v("link",{rel:"stylesheet",href:e.stylesheet});r.append(o)}return r}function ns(t,e){return typeof e=="string"?e[0]==="#"?t.appendChild(document.getElementById(e.slice(1)).content.clone(!0)):t.innerHTML=e:t.appendChild(e.content.clone(!0)),t}function is(t){let e=t.isUpgraded;return t.isUpgraded=!0,!e}function Zo(t,e){return Array.from(t.querySelectorAll('[is="'+e+'"]')).filter(is)}var ss=N((t,e)=>typeof e,{object:(t,e)=>e,function:(t,e)=>({value:e}),default:(t,e)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof e)}});function Sr(t,e={},r={},o=""){let{name:n,tag:i}=_i(t),a=typeof i=="string"?rs(i):HTMLElement,u=[],s={},c,l;for(c in r)l=ss(c,r[c]),l.attribute&&u.push(c),(l.set||l.get||"value"in l)&&(s[c]=l),r[c]=l;function h(){let p=Reflect.construct(a,arguments,h),f=e.mode||typeof e.shadow=="string"?Yo(p,e):void 0;e.shadow&&ns(f,e.shadow);let d=br(h,p,f);return i&&(Rr=!0),e.construct&&e.construct.call(p,f,d),Object.keys(s).reduce(os,p),p}if(h.prototype=Object.create(a.prototype,s),r.value&&(h.formAssociated=!0,Vo(h.prototype,Qi),(e.enable||e.disable)&&(h.prototype.formDisabledCallback=function(p){let f=b(this);return p?e.disable&&e.disable.call(this,f.shadowRoot,f):e.enable&&e.enable.call(this,f.shadowRoot,f)}),e.reset&&(h.prototype.formResetCallback=function(){let p=b(this);return e.reset.call(this,p.shadowRoot,p)}),e.restore&&(h.prototype.formStateRestoreCallback=function(){let p=b(this);return e.restore.call(this,p.shadowRoot,p)})),u.length&&(h.observedAttributes=u,h.prototype.attributeChangedCallback=function(p,f,d){return r[p].attribute.call(this,d)}),e.connect&&(h.prototype.connectedCallback=function(){let p=b(this),f=p.shadowRoot;if(p.stopable=e.connect.call(this,f,p),!f)return;let d=f.querySelectorAll('link[rel="stylesheet"]');if(d.length){let m=v("style","*:not(slot), slot:not([name]) { display: none !important; }");f.prepend(m);let g;p.loadPromise?g=p.loadPromise.then(()=>new Promise(requestAnimationFrame)):g=p.loadPromise=Promise.all(Array.from(d,ts)),g.finally(()=>{m.remove(),e.load&&e.load.call(this,f,p)})}else e.load&&e.load.call(this,f,p)}),h.prototype.disconnectedCallback=function(){let p=b(this);p.stopable&&(p.stopable.stop?p.stopable.stop():p.stopable.forEach(es)),e.disconnect&&e.disconnect.call(this,p.shadowRoot,p)},window.console&&window.console.log("%c<"+(i?i+" is="+n:n)+">%c "+o,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(n,h,i&&{extends:i}),i&&!Rr){let p=document.createElement("div");if(p.style.position="fixed",p.style.left="-1000px",p.style.top="-1000px",p.innerHTML="<"+i+' is="'+n+'"></'+i+">",document.body.append(p),p.remove(),Rr)h.polyfillByRoot=U;else{let f=function(m){let g={};Object.keys(s).forEach(T=>{m[T]!==void 0&&(g[T]=m[T])}),Vo(m,s);let y=e.mode||e.shadow?Yo(m,e):void 0,E=br(h,m,y);e.construct&&e.construct.call(m,y,E),Object.assign(m,g);let x=-1,O;for(;O=u[++x];){let T=m.attributes[O];T&&r[O].attribute.call(m,T.value)}e.connect&&e.connect.call(m,y,E)},d=function(m){Zo(m,n).forEach(f),new MutationObserver(()=>Zo(m,n).forEach(f)).observe(m,{childList:!0,subtree:!0})};h.polyfillByRoot=d,d(document)}}else h.polyfillByRoot=U;return h}var Nt=t=>typeof t;var as=Object.defineProperties,Jo=N(Nt,{function:t=>t(),object:t=>t.stop()}),wt=class extends M{#t;stop(){if(this.status==="done")return this;this.status="done";let e=this.#t;return this.#t=void 0,e&&e.forEach(Jo),this}done(e){return this.status==="done"?(Jo(listener),this):((this.#t||(this.#t=[])).push(e),this)}};as(wt.prototype,{status:{writable:!0}});function cs(t){throw new TypeError("Stream cannot be created .from() "+typeof t)}function z(t,e){if(e===void 0)return;let r=-1;for(;t[++r];)t[r].push(e);return t}function us(t){wt.prototype.stop.apply(t);let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.stop&&(Br(r,t),r[-1]||r.stop());return t}function Br(t,e){let r=0;for(;t[--r]&&t[r]!==e;);for(;t[r--];)t[r+1]=t[r]}function Qo(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function ps(t,e){Br(e,t),Qo(t,e)}var qt=class extends wt{stop(){if(this.status==="done")return this;let e;for(;e=this[-1];){let r=-1;for(;this[r--];)this[r+1]=this[r];Qo(e,this),e.stop&&!e[0]&&e.stop(e)}return super.stop()}},we=class extends qt{constructor(e){super(),this.push=e}},xe=class extends qt{constructor(e,r){super(),this.fn=e,this.value=r,this.i=0}push(e){let r=this.fn;this.value=r(this.value,e,this.i++,this)}},I=class extends qt{start(){if(this.status)return this;let e=0,r;t:for(;r=this[--e];){let o=-1;for(;r[++o];)if(r[o]===this)continue t;r[o]=this,o===0&&r.start&&r.start()}return this}stop(){if(this.status==="done")return this;super.stop();let e=-1,r;for(;r=this[++e];)this[e]=void 0,r.stop&&(Br(r,this),r[-1]||r.stop());return this}pipe(e){if(e.stop){let o=0;for(;e[--o]&&e[o]!==this;);e[o]=this}if(e.start&&!(e[0]||e.status==="running"))return e;let r=-1;for(;this[++r]&&this[r]!==e;);return this[r]=e,r||this.start(),e}each(e){return this.pipe(new we(e))}buffer(...e){return this.pipe(new Dt(e))}filter(e){return this.pipe(new Nr(e))}flatMap(e){return this.pipe(new Dr(e))}map(e){return this.pipe(new Ee(e))}reduce(e,r){return this.pipe(new xe(e,r)).value}scan(e,r){return this.pipe(new Tr(e,r))}slice(e,r){return this.pipe(new Cr(e,r))}split(e){return this.pipe(new kr(e))}[Symbol.asyncIterator]=async function*(){let e=[],r=n=>e.push(n);function o(n,i){r=n}for(this.each(n=>r(n)).done(()=>r=U);r!==U;)yield e.length?e.shift():await new Promise(o)};static from=N(Nt,{function:e=>new Ee(e),object:e=>typeof e.pipe=="function"?e:typeof e.then=="function"?new Ar(e):typeof e.length=="number"?new Dt(Array.from(e)):cs(e)});static of(...e){return e.length<2?new ye(e[0]):new Dt(e)}static buffer(e){return new Dt(e)}static value(e){return new ye(e)}static merge(...e){return new Fr(e)}static push=z;static stop=us;static unpipe=ps;static each(e){return new we(e)}static reduce(e,r){return new xe(e,r)}},Ar=class extends I{constructor(e){super(),this.promise=e}start(){return this.promise.then(e=>z(this,e)).finally(()=>this.stop()),this}},ye=class extends I{constructor(e){super(),this.value=e}start(){return this.value!==void 0&&(z(this,this.value),this.status==="done")?this:super.start()}push(e){return this.value=e,z(this,e)}},Dt=class extends I{constructor(e){super(),this.values=e||[]}start(){let e=this.values;if(!e)return super.start();let r=-1;for(;r++<e.length;)if(z(this,e[r]),this.status==="done")return this;return this.values=void 0,super.start()}push(e){return this.value=e,this.values?this.values.push(this.value):z(this,this.value)}},Nr=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn;return r(e)&&z(this,e)}},Dr=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);if(o!==void 0)if(isIterable(o))for(let n of o)z(this,n);else o.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(o.each(n=>z(this,n)))):o.then&&o.then(n=>z(this,n))}},Ee=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);return o!==void 0&&z(this,o)}},Fr=class extends I{constructor(e){super(),this.inputs=e}push(e){return z(this,e)}pipe(e){let r=-1,o;for(;o=this.inputs[++r];)I.from(o).pipe(this);return I.prototype.pipe.call(this,e)}},Tr=class extends I{constructor(e,r){super(),this.fn=e,this.value=r}push(e){let r=this.fn;this.value=r(this.value,e),z(this,this.value)}},Cr=class extends I{constructor(e,r=1/0){super(),this.index=-e,this.indexEnd=r-e}push(e){++this.index>0&&z(this,e),this.index===this.indexEnd&&this.stop()}},kr=class extends I{constructor(e){super(),this.chunk=[],typeof e=="number"?this.n=e:this.fn=e}fn(){return this.chunk.length===this.n}push(e){let r=this.chunk;this.fn(e)?(z(this,r),this.chunk=[]):r.push(e)}};var Rl={fullscreenchange:nt(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},ls=0;window.addEventListener("click",t=>ls=t.timeStamp);function $r(t){return function(){return arguments[t]}}function Mr(t){return t}function xt(){}function Q(){return this}var _o=Object.create,hs=Object.freeze,tn=hs(_o(_o(Object.prototype,{at:{value:xt},shift:{value:xt},push:{value:xt},forEach:{value:xt},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:Q},find:{value:xt},findIndex:{value:function(){return-1}},flat:{value:Q},flatMap:{value:Q},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:Q},reduce:{value:$r(1)},sort:{value:Q},each:{value:Q},pipe:{value:Mr},start:{value:Q},stop:{value:Q},done:{value:Q},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Gr(t,e){return(e%t+t)%t}function be(t){if(typeof t=="number"&&(t=t+""),typeof t=="string")return t.trim().toLowerCase().normalize("NFKC").replace(/[\/\?#\[\]@!$&'()*+,;=\\\s\._]+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var en=t=>Gr(12,t);var fs=/^([A-G][â™­â™¯#b]?)(-?\d)$/,ms=/^[A-G][â™­â™¯#b]?/,ds=/-?\d$/,gs=/[Hh]z$/,Pt={C:0,"Câ™¯":1,"C#":1,"Dâ™­":1,Db:1,D:2,"Dâ™¯":3,"D#":3,"Eâ™­":3,Eb:3,E:4,F:5,"Fâ™¯":6,"F#":6,"Gâ™­":6,Gb:6,G:7,"Gâ™¯":8,"G#":8,"Aâ™­":8,Ab:8,A:9,"Aâ™¯":10,"A#":10,"Bâ™­":10,Bb:10,B:11},Or={27:"High Q",28:"Slap",29:"Scratch push",30:"Scratch pull",31:"Sticks",32:"Square click",33:"Metronome click",34:"Metronome bell",35:"Low bass drum",36:"High bass drum",37:"Side stick",38:"Snare drum 1",39:"Hand clap",40:"Snare drum 2",41:"Low floor tom",42:"Closed hi-hat",43:"High floor tom",44:"Pedal hi-hat",45:"Low tom",46:"Open hi-hat",47:"Low mid tom",48:"High mid tom",49:"Crash cymbal 1",50:"High tom",51:"Ride cymbal 1",52:"Chinese cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash cymbal",56:"Cowbell",57:"Crash cymbal 2",58:"Vibra Slap",59:"Ride cymbal 2",60:"High bongo",61:"Low bongo",62:"Mute high conga",63:"Open high conga",64:"Low conga",65:"High timbale",66:"Low timbale",67:"High agogo",68:"Low agogo",69:"Cabasa",70:"Maracas",71:"Short whistle",72:"Long whistle",73:"Short guiro",74:"Long guiro",75:"Claves",76:"High wood block",77:"Low wood block",78:"Mute cuica",79:"Open cuica",80:"Mute triangle",81:"Open triangle",82:"Shaker",83:"Jingle bell",84:"Belltree",85:"Castanets",86:"Mute surdo",87:"Open surdo"};for(let t in Or)Pt[be(Or[t])]=parseInt(t,10);var ws=69;function xs(t,e=440){var r=ws+12*Math.log(t/e)/Math.log(2);return Math.fround(r)}function R(t){if(typeof t=="number")return t;if(gs.test(t))return xs(parseFloat(t));let e=fs.exec(t);return e?(parseInt(e[2],10)+1)*12+Pt[e[1]]:Pt[be(t)]}function W(t){return typeof t=="number"?en(t):Pt[ms.exec(t)[0]]}var ve=["C","Câ™¯","D","Eâ™­","E","F","Fâ™¯","G","Gâ™¯","A","Bâ™­","B"];function it(t){return pt(t)+Re(t)}function pt(t){return ve[en(t)]}function Re(t){return typeof t=="number"?Math.floor(t/12)-1:Pt[(ds.exec(name)||tn)[0]]}function rn(t){let e=R(t);return Or[e]||""}function Y(t){return Math.pow(10,t/20)}var ys=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function yt(t){return function(r){if(typeof r=="number")return r;var o=ys.exec(r);if(!o){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(r)}if(!t[o[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(parseFloat(o[1]),o[2])}return t[o[2]||""](parseFloat(o[1]))}}var on={fff:Y(-4.5),ff:Y(-9),f:Y(-13.5),mf:Y(-18),mp:Y(-22.5),p:Y(-27),pp:Y(-31.5),ppp:Y(-36)},lt=yt({"":parseFloat,db:Y,dB:Y,catch:t=>{if(!on[t])throw new Error('Sequence: dynamic "'+t+'" not recognised');return on[t]}});function ht(t,e){return(e%t+t)%t}function Se(t){return ht(12,t)}var Ae=/b{1,2}|#{1,2}/g,Es={b:"â™­","#":"â™¯",bb:"ğ„«","##":"ğ„ª"};function Ne(t){return Es[t]}function bs(t,[e,r]){return t[r]=e,t}function _(t){return Object.entries(t).reduce(bs,{})}var j={sequence:1,note:2,param:3,rate:4,key:5,meter:6,chord:7,text:8,start:9,stop:10,clef:11},nn=_(j),Ur={2:16,5:1,6:4,7:18,9:8,10:8,11:1};function sn(t){if(typeof t=="string")return t;if(t in nn)return nn[t];throw new Error(`Type ${t} not recognised`)}var k={step:0,linear:1,exponential:2,target:3,curve:4,hold:5,cancel:6},an=_(k),cn={0:4,1:4,2:4,3:12,5:0,6:0};function Lr(t){return typeof t=="number"?an[t]||"step":t}function vs(t,e){return e[t]}var tt=X(vs,!0);var Rs=globalThis.DEBUG,{floor:ln,log:un}=Math,Ft=36,pn=Ft-1,Ss=ln(un(Number.MAX_SAFE_INTEGER)/un(Ft))+1;function qr(t){if(t.length<2)return t.length?0:-1;if(t.length>Ss)throw new Error("Cannot generate harmonic id, more than 11 notes "+t);let e=0,r=0,o=1;for(;++r<t.length;){let n=t[r]-t[r-1];if(n<1||n>pn)throw new Error(`Cannot generate harmonic id, interval out of range 1-${pn} `+t);e+=n*o,o*=Ft}return e}function w(){return qr(arguments)}var Pr=nt(t=>{if(Rs&&typeof t!="number")throw new Error(`hsidToNumbers() takes number, called with ${typeof t}`);if(t===-1)return Uint8Array.of();if(t===0)return Uint8Array.of(0);let e=2;for(;t>=Ft**(e-1);)++e;let r=new Uint8Array(e);r[0]=0;let o=1;for(;t>0;){let n=t%Ft;r[o]=r[o-1]+n,t=ln(t/Ft),++o}return r});var lh=globalThis.DEBUG,hn=[["",w(0,2,4,7)],["+",w(0,2,4,8)],["sus",w(0,2,5,7)],["susâ™­9",w(0,1,5,7)],["-",w(0,2,3,7)],["Â°",w(0,2,3,6)],["/{4}",w(0,3,8,10)],["/{7}",w(0,5,7,9)],["/{8}",w(0,4,8,11)],["-/{3}",w(0,4,9,11)],["-/{7}",w(0,5,7,8)],["/{11}",w(0,1,5,8)],["/{1}",w(0,3,6,11)],["7/{4}",w(0,3,6,8)],["Ã¸",w(0,3,6,10)],["âˆ†6",w(0,4,7,9)],["âˆ†",w(0,2,4,7,9,11)],["âˆ†6/9",w(0,2,4,7,9)],["âˆ†â™¯11",w(0,2,4,6,7,9,11)],["7sus",w(0,2,5,7,10)],["7",w(0,2,4,7,10)],["7susâ™­9",w(0,1,5,7,10)],["13",w(0,2,4,7,9,10)],["13sus",w(0,2,5,7,9,10)],["-6",w(0,2,3,5,7,9)],["-7",w(0,2,3,5,7,9,10)],["-11",w(0,2,3,5,10)],["7â™¯11",w(0,2,4,6,7,9,10)],["-âˆ†",w(0,2,3,5,7,9,11)],["7â™­13",w(0,2,4,5,7,8,10)],["13susâ™­9",w(0,1,3,5,7,9,10)],["+7",w(0,2,4,6,8,10)],["Â°7",w(0,2,3,5,6,8,9,11)],["7â™¯9",w(0,3,4,6,7,9,10)],["7alt",w(0,1,3,4,6,8,10)],["7â™­9",w(0,1,3,4,6,7,10)],["13â™­9",w(0,1,3,4,6,7,9,10)],["7â™­9â™­13",w(0,1,4,5,7,8,10)],["-â™­6",w(0,2,3,5,7,8,10)],["-â™­9",w(0,1,3,5,7,8,10)],["Ã¸9",w(0,2,3,5,6,8,10)],["âˆ†â™¯4â™¯5",w(0,2,4,6,8,9,11)],["-âˆ†â™­6",w(0,2,3,5,7,8,11)],["âˆ†â™¯5",w(0,2,4,8,11)],["âˆ†â™­6",w(0,2,4,5,7,8,11)]],De=Object.fromEntries(hn),As=_(De),Ns=/[()]/g;function Ir(t){return typeof t=="string"?De[t.replaceAll(Ns,"").replaceAll(Ae,Ne)]:typeof t=="object"?qr(t):t}function Fe(t){let e=Ir(t);return As[e]||""}var hh=hn.map(tt(1));var Hr={0:"bank",1:"modulation",2:"breath",4:"foot",5:"portamento",7:"volume",8:"balance",10:"pan",11:"expression",64:"sustain",65:"portamento",66:"sostenuto",67:"soft",68:"legato",69:"hold",71:"harmonics",72:"release",73:"attack",74:"brightness",91:"reverb",92:"tremolo",93:"chorus",94:"detune",95:"phaser",120:"sound-off",121:"reset",122:"local",123:"notes-off",124:"omni-off",125:"omni-on",126:"monophonic",127:"polyphonic"},mh=Object.entries(Hr).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});var Ds=Object.assign,zr=Ds({},Hr,{3:"mute",6:"gain",9:"angle",12:"distance",13:"azimuth",14:"mix",15:"phase",16:"frequency",17:"Q",18:"depth",19:"cutoff",20:"type",21:"delay",22:"feedback",128:"stop",129:"start",130:"record",131:"pitch",132:"rate",133:"meter",134:"key",135:"touch"}),fn=Object.entries(zr).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});function mn(t){return typeof t=="number"&&zr[t]||t}var Te={"Fğ„«":-15,"Cğ„«":-14,"Gğ„«":-13,"Dğ„«":-12,"Ağ„«":-11,"Eğ„«":-10,"Bğ„«":-9,"Fâ™­":-8,"Câ™­":-7,"Gâ™­":-6,"Dâ™­":-5,"Aâ™­":-4,"Eâ™­":-3,"Bâ™­":-2,F:-1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6,"Câ™¯":7,"Gâ™¯":8,"Dâ™¯":9,"Aâ™¯":10,"Eâ™¯":11,"Bâ™¯":12,"Fğ„ª":13,"Cğ„ª":14,"Gğ„ª":15,"Dğ„ª":16,"Ağ„ª":17,"Eğ„ª":18,"Bğ„ª":19},jr=_(Te);function Tt(t){if(typeof t=="number"){if(t in jr)return jr[t];throw new Error(`Key ${t} not recognised`)}return jr[st(t)]}function st(t){if(typeof t=="number")return t;let e=t.replaceAll(Ae,Ne);if(e in Te)return Te[e];throw new Error(`Key "${t}" not recognised`)}function It(t){let e=st(t);return ht(12,e*7)}function Ce(t){let e=pt(t);return Te[e]}var q={displace:1,rate:2,gain:3,quantize:4,transpose:5},Fs=_(q),dn={1:9,2:5,3:5,4:5,5:2},Ht={1:1,2:1,3:1,4:1,5:1};function gn(t){return typeof t=="number"&&Fs[t]||t}var wn=globalThis.DEBUG,ke=Object.defineProperty,Be={writable:!0};function Ts(t){let e=[],r=-1;for(;t[++r]!==void 0;)e.push(t[r]);return e}function Ct(t){return t.toFixed(4).replace(/\.?0+$/,"")}function xn(t){let e;for(;e=t.event;)t=e;return t}var S=class t{constructor(e,r){switch(this[0]=e,this[1]=sn(r),this[1]){case"chord":this[2]=W(arguments[2]),this[3]=Ir(arguments[3]),this[4]=arguments[4]||0,arguments[5]&&(this[5]=arguments[5]||0);break;case"text":this[2]=arguments[2],this[3]=arguments[3];break;case"key":this[2]=st(arguments[2]);break;case"note":this[2]=R(arguments[2]),this[3]=lt(arguments[3]),this[4]=arguments[4]||0;break;case"rate":this[2]=arguments[2],this[3]=Lr(arguments[3]),(this[3]==="target"||this[3]==="curve")&&(this[4]=arguments[4]||0);break;case"param":this[2]=mn(arguments[2]),this[3]=arguments[3],this[4]=Lr(arguments[4]),(this[4]==="target"||this[4]==="curve")&&(this[5]=arguments[5]||0);break;case"sequence":this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4]||0;let o=5;for(;arguments[o]!==void 0;){this[o]=gn(arguments[o]);let n=q[this[o]],i=o+Ht[n];for(;o++<i;)this[o]=arguments[o]||0}break;case"start":case"stop":this[2]=R(arguments[2]),this[3]=lt(arguments[3]);break;default:this[2]=arguments[2],this[3]=arguments[3]}ke(this,"event",Be),ke(this,"events",Be),ke(this,"index",Be),ke(this,"target",Be)}move(e){let r=xn(this);return r[0]=this[0]=this[0]+e,this}transpose(e){let r=xn(this);switch(this[1]){case"chord":case"key":r[2]=this[2]=Se(this[2]+e);break;case"note":case"start":case"stop":r[2]=this[2]=this[2]+e;break;case"sequence":console.log("TODO: transpose sequence");break}return this}*[Symbol.iterator](){let e=-1;for(;this[++e]!==void 0;)yield this[e]}toJSON(){return Ts(this)}toString(){let e=Ct(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+pt(this[2])+" "+Fe(this[3])+" "+Ct(this[4]);break;case"key":e+=" "+Tt(this[2]);break;case"note":e+=" "+it(this[2])+" "+this[3]+" "+Ct(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+Ct(this[4])+" "+this[5];break;case"rate":e+=" "+Ct(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+Ct(this[4]);break;case"start":case"stop":e+=" "+it(this[2])+" "+this[3];break;default:let r=1;for(;this[++r]!==void 0;)e+=this[r]}return e}static of(...e){return new t(...e)}static from(e,r,o){if(wn&&r!==void 0&&typeof r!="number")throw new Error("Event() cannot create event with index "+r);if(wn&&o!==void 0&&typeof o!="object")throw new Error("Event() cannot create event with events "+o);let n=new t(...e);return n.event=e,n.events=o,n.index=r,n}static isChord=Wr;static isNote=$e;static isSequence=Kr};function Wr(t){return t[1]==="chord"}function $e(t){return t[1]==="note"}function Kr(t){return t[1]==="sequence"}function Cs(t,e){let r;for(r in t)if(t[r]!==e[r])return!1;return!0}var zt=X(Cs,!0);var yn=N((t,e)=>e[1],{note:(t,e)=>(e[2]=R(e[2])+t,e),chord:(t,e)=>(e[2]=W(W(e[2])+t),e[5]!==void 0&&(e[5]=W(W(e[2])+t)),e),key:(t,e)=>(e[2]=Ce(It(e[2])+t),e),default:M});var ks={displace:(t,e,r)=>(r[0]-=t[++e],e),rate:(t,e,r)=>{switch(r[0]/=t[++e],r[1]){case"chord":case"note":case"sequence":r[4]/=t[e];break;case"text":r[3]/=t[e];break}return e},gain:(t,e,r)=>{switch(++e,r[1]){case"note":r[3]*=lt(t[e]);break}return e},quantize:(t,e,r)=>{},transpose:(t,e,r)=>(yn(t[e+1],r),e+1)};function jt(t,e){let r=-1,o;for(;o=t[++r];)r=ks[o](t,r,e);return e}var En=Object.assign,bn=[],Bs={done:!0,value:void 0},vn={key:2,meter:1,default:0},$s={};function Rn(t){return vn[t[1]]||vn.default}function Sn(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:Rn(e)-Rn(t)}function An(t,e){let r=-1;for(;t[++r]&&Sn(t[r],e)<1;);return t.splice(r,0,e),r}function Ms(t,e){let r=[],o=t-1;for(;e[++o]!==void 0;)r.push(e[o]);return r}function Gs(t,e){return t.find(r=>r.id===e)}var Et=class t{constructor(e,r=bn,o=bn){e.sort(Sn),this.events=e,this.sequences=r,this.transforms=o;let n=-1,i;for(;(i=e[++n])&&jt(o,En($s,i))[0]<0;);this.n=n-1}next(){let{events:e,sequences:r,transforms:o,n}=this,i=e[n+1],a=i&&jt(o,S.from(i,n+1,e)),u,s=-1,c=0,l=a?a[0]:1/0,h;for(;u=this[++s];){let p=u.value;p||((p=u.next().value)&&(jt(this.transforms,p),p[0]+=u.startBeat,p.target=(p.target||0)+u.target),(u.done||p[0]>=u.stopBeat)&&++c),p&&p[0]<u.stopBeat&&p[0]<l&&(h=u,l=p[0]),c&&(this[s]=this[s+c])}if(h)return this.value=h.value,h.value=void 0,this;if(!a)return En(this,Bs);if(this.n+=1,this.value=a,Kr(i)){let p=this.sequences,f=Gs(p,i[2]);if(!f)throw new Error('Sequence id "'+i[2]+'" not found');let d=new t(f.events,f.sequences?f.sequences.concat(p):p,Ms(5,i));d.startBeat=a[0],d.stopBeat=a[0]+a[4],d.target=a[3];let m=-1;for(;this[++m];);this[m]=d}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};var Os=Object.assign;var Z=class t{constructor(e,r){this.events=e.map(S.from),r&&(this.sequences=r.map(t.from))}create(){let e=new S(...arguments);return An(this.events,e),e}delete(e,r){r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2]));let o=this.events.findIndex(zt(arguments));return o>-1&&this.events.splice(o,1),this}find(e,r){return r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2])),this.events.find(zt(arguments))}get(e){return this.sequences&&this.sequences.find(zt({id:e}))}select(e,r){return this.events.filter(zt({0:e,1:r}))}static of(...e){return new t(e)}static from(e){let{events:r,sequences:o,...n}=e;return e.length?new t(e):Os(new t(r,o),n)}[Symbol.iterator](){return new Et(this.events,this.sequences)}};var Us=2,Ls=10,Nn=4,gf=(1<<Us)-1,qs=(1<<Ls)-1,Ps=(1<<Nn)-1;function Me(t,e,r){return t<<14|e<<4|r}function Dn(t){return t>>14}function Fn(t){return t>>Nn&qs}function Ge(t){return t&Ps}function Vr(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[],o=0;for(;o<t.length;){let n=e.getFloat64(o,!0);o+=8;let i=e.getUint16(o,!0);o+=2;let a=Dn(i),u=Fn(i);switch(a){case 0:switch(u){case j.note:r.push(S.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0),e.getFloat64(o+8,!0))),o+=16;break;case j.meter:r.push(S.of(n,u,e.getFloat16(o,!0),e.getFloat16(o+2,!0))),o+=4;break;case j.chord:r.push(S.of(n,u,t[o],e.getFloat64(o+1,!0),e.getFloat64(o+9,!0),t[o+17])),o+=18;break;case j.key:r.push(S.of(n,u,e.getInt8(o))),o+=1;break;case j.clef:r.push(S.of(n,u,t[o])),o+=1;break;case j.sequence:{let s=e.getUint16(o,!0),c=e.getUint16(o+2,!0),l=e.getFloat64(o+4,!0),h=t[o+12],p=[n,u,s,c,l];o+=13;let f=0;for(;f<h;){let d=t[o+f];switch(f+=1,p.push(d),d){case q.displace:p.push(e.getFloat64(o+f,!0)),f+=8;break;case q.rate:case q.gain:case q.quantize:p.push(e.getFloat32(o+f,!0)),f+=4;break;case q.transpose:p.push(e.getInt8(o+f)),f+=1;break;default:throw new Error(`Unknown transform number: ${d}`)}}r.push(S.from(p)),o+=h;break}case j.text:{let s=e.getFloat64(o,!0),c=t[o+8];o+=9;let l=t.subarray(o,o+c);r.push(S.of(n,u,new TextDecoder().decode(l),s)),o+=c;break}case j.start:case j.stop:r.push(S.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0))),o+=8;break;default:{let s=Ge(i);switch(s){case k.step:case k.linear:case k.exponential:r.push(S.of(n,u,e.getFloat32(o,!0),s)),o+=4;break;case k.target:r.push(S.of(n,u,e.getFloat32(o,!0),s,e.getFloat64(o+4,!0))),o+=12;break;case k.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(S.of(n,u,p,s,c));break;default:r.push(S.of(n,u,void 0,s));break}break}}break;case 1:{let s=Ge(i);switch(s){case k.step:case k.linear:case k.exponential:r.push(S.of(n,"param",u,e.getFloat32(o,!0),s)),o+=4;break;case k.target:r.push(S.of(n,"param",u,e.getFloat32(o,!0),s,e.getFloat64(o+4,!0))),o+=12;break;case k.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(S.of(n,"param",u,p,s,c));break;default:r.push(S.of(n,"param",u,void 0,s));break}break}default:throw new Error(`Cannot deserialise unknown address ${a}.${u}.${Ge(i)}`)}}return r}var Tn=255;function Cn(t,e){if(t.length<=e)return t;let r=e;for(;r>0&&(t[r]&192)===128;)r--;return t.slice(0,r)}function Is(t){let e=t[1],r=j[e],o=10;if(r in Ur)return o+Ur[r];let n;switch(e){case"text":{let i=new TextEncoder().encode(t[2]),a=Cn(i,Tn);return o+8+1+a.length}case"sequence":{for(o+=13,n=4;t[++n]!==void 0;){let i=q[t[n]];o+=dn[i],n+=Ht[i]}return o}case"param":n=4;case"rate":n===void 0&&(n=3);default:{let i=typeof t[n]=="string"?k[t[n]]||0:t[n]||0;return i===k.curve?o+8+2+t[n-1].length*4:o+cn[i]}}}function Hs(t){let e=t[1];switch(e){case"param":{let r=typeof t[2]=="string"?fn[t[2]]||0:t[2],o=typeof t[4]=="string"?k[t[4]]||0:t[4];return Me(1,r,o)}case"rate":{let r=j[e],o=typeof t[3]=="string"?k[t[3]]||0:t[3]||0;return Me(0,r,o)}default:{let r=j[e];if(r===void 0)throw new Error(`Event type ${e} not recognised`);return Me(0,r,0)}}}function Xr(t){let e=0;for(let u of t)e+=Is(u);let r=new Uint8Array(e),o=new DataView(r.buffer),n=-1,i,a=0;for(;i=t[++n];){i instanceof S||(i=S.from(i)),o.setFloat64(a,i[0],!0),a+=8;let u=Hs(i);switch(o.setUint16(a,u,!0),a+=2,i[1]){case"note":o.setFloat32(a,i[2],!0),o.setFloat32(a+4,i[3],!0),o.setFloat64(a+8,i[4],!0),a+=16;break;case"param":case"rate":{let c=i[1]==="rate"?2:3;switch(typeof i[c+1]=="string"?k[i[c+1]]||0:i[c+1]||0){case k.step:case k.linear:case k.exponential:o.setFloat32(a,i[c],!0),a+=4;break;case k.target:o.setFloat32(a,i[c],!0),o.setFloat64(a+4,i[c+2]||0,!0),a+=12;break;case k.curve:o.setFloat64(a,i[c+2]||0,!0),a+=8;let h=i[c],p=h.length*4;o.setUint16(a,p,!0),a+=2;let f=-1;for(;h[++f]!==void 0;)o.setFloat32(a+f*4,h[f],!0);a+=p;break}break}case"meter":o.setFloat16(a,i[2],!0),o.setFloat16(a+2,i[3],!0),a+=4;break;case"chord":{let c=typeof i[2]=="number"?i[2]:0;r[a]=c;let l=typeof i[3]=="string"?De[i[3]]||0:i[3];o.setFloat64(a+1,l,!0),o.setFloat64(a+9,i[4],!0);let h=typeof i[5]=="number"?i[5]:0;r[a+17]=h,a+=18;break}case"key":{o.setInt8(a,st(i[2])),a+=1;break}case"sequence":{o.setUint16(a,i[2],!0),o.setUint16(a+2,i[3],!0),o.setFloat64(a+4,i[4],!0),a+=12;let c=a;a+=1;let l=4;for(;i[++l]!==void 0;){let h=i[l],p=typeof h=="string"?q[h]:h;if(p===void 0)throw new Error(`Transform name "${h}" not recognised`);switch(r[a]=p,a+=1,p){case q.displace:o.setFloat64(a,i[l+1],!0),a+=8;break;case q.rate:case q.gain:case q.quantize:o.setFloat32(a,i[l+1],!0),a+=4;break;case q.transpose:o.setInt8(a,i[l+1]),a+=1;break;default:throw new Error(`Transform number ${p} not recognised`)}l+=Ht[p]}r[c]=a-c-1;break}case"text":{let c=new TextEncoder().encode(i[2]),l=Cn(c,Tn);o.setFloat64(a,i[3],!0),r[a+8]=l.length,r.set(l,a+9),a+=9+l.length;break}case"start":case"stop":o.setFloat32(a,i[2],!0),o.setFloat32(a+4,i[3],!0),a+=8;break;case"clef":let s=typeof i[2]=="number"?i[2]:0;r[a]=s,a+=1;break}}return r}var kn={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.sequence",defs:{main:{type:"record",description:"A sequence of timed events. Full documentation at https://github.com/soundio/sequence/.",key:"any",record:{type:"object",required:["events"],properties:{id:{type:"integer",description:'Identifies this sequence for playback by a "sequence" event.',maximum:65535},url:{type:"string",format:"uri",description:"Canonical location of this sequence. May be an `at://` URI or an `https://` URL to a JSON endpoint."},name:{type:"string",description:"Name of the sequence",maxLength:1280,maxGraphemes:640},version:{type:"integer",description:"Version number for the byte array encoding of the events field."},events:{type:"bytes",description:"Serialised and binary encoded array of events of the form `[beat, type, data...]`, where `data` parameters depend on `type` and the byte layout of the serialised data conforms to the Sequence spec at https://github.com/soundio/sequence.",maxLength:524288},sequences:{type:"array",description:'A collection of sequences that may be played back by "sequence" events.',items:{type:"ref",ref:"io.sound.sequence"}},credits:{type:"array",description:"Attribution for composers, arrangers, etc",maxLength:60,items:{type:"ref",ref:"io.sound.credit"}},bskyPostRef:{type:"ref",ref:"com.atproto.repo.strongRef",description:"Strong reference to a Bluesky post. Useful to keep track of comments off-platform."},publishedAt:{type:"string",format:"datetime",description:"Timestamp of the time of publication."},updatedAt:{type:"string",format:"datetime",description:"Timestamp of the time of last edit."},tags:{type:"array",description:"Array of strings used to tag the sequence.",items:{type:"string",maxLength:1280,maxGraphemes:128}}}}}}};var Bn={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.credit",defs:{main:{type:"object",description:"Attribution for a creative work",required:["name","role"],properties:{name:{type:"string",description:"Name of the credited person",maxLength:640,maxGraphemes:320},role:{type:"string",description:"Role: composer, lyricist, arranger, etc",maxLength:64,maxGraphemes:32,knownValues:["composer","arranger","lyricist","transcriber","orchestrator","adapter","artist","producer"]},url:{type:"string",format:"uri",description:"URL to credited person's profile or website"}}}}};var $n=Object.assign,Mn=kn.defs.main.record,Ws=Bn.defs.main,Ks=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$/,Vs=/^at:\/\/[^/\s]+(\/([\w.-]+)(\/[\w.-]+)?)?$/,Xs=/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/,Ys=/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/,Zs=["alt","arpa","example","internal","invalid","local","localhost","onion"],Js=new Intl.Segmenter(void 0,{granularity:"grapheme"});function Oe(t){return[...Js.segment(t)].length}var Qs=new TextEncoder;function kt(t){return Qs.encode(t).byteLength}var _s=N(M,{datetime:(t,e,r)=>{if(!Ks.test(r))throw new Error(`Record "${e}" invalid datetime format "${r}"`);if(r.includes("t")||r.endsWith("z")&&!r.endsWith("Z"))throw new Error(`Record "${e}" datetime must use uppercase T and Z`)},uri:(t,e,r)=>{if(kt(r)>8192)throw new Error(`Record "${e}" URI exceeds 8KB maximum`);try{new URL(r)}catch(o){throw new Error(`Record "${e}" ${o.message}`)}},"at-uri":(t,e,r)=>{if(kt(r)>8192)throw new Error(`Record "${e}" AT URI exceeds 8KB maximum`);if(!r.startsWith("at://"))throw new Error(`Record "${e}" AT URI must start with at://`);if(!Vs.test(r))throw new Error(`Record "${e}" invalid AT URI format`)},handle:(t,e,r)=>{if(r.length>253)throw new Error(`Record "${e}" handle exceeds 253 characters`);if(!Xs.test(r))throw new Error(`Record "${e}" invalid handle format`);let o=r.split(".").pop().toLowerCase();if(Zs.includes(o))throw new Error(`Record "${e}" handle has disallowed TLD "${o}"`)},nsid:(t,e,r)=>{if(r.length>317)throw new Error(`Record "${e}" NSID "${r}" exceeds 317 characters`);if(!Ys.test(r))throw new Error(`Record "${e}" Invalid NSID format "${r}"`)}}),Gn=N(tt("type"),{boolean:(t,e,r)=>{if(typeof r!="boolean")throw new Error(`Record "${e}" not of type "boolean"`);if(t.const!==void 0&&r!==t.const)throw new Error(`Record "${e}" must be ${t.const}`)},integer:(t,e,r)=>{if(!Number.isInteger(r))throw new Error(`Record "${e}" not of type "integer" but type "${typeof r}"`);if(t.minimum!==void 0&&r<t.minimum)throw new Error(`Record "${e}" is ${r}, minimum ${t.minimum}`);if(t.maximum!==void 0&&r>t.maximum)throw new Error(`Record "${e}" is ${r}, maximum ${t.maximum}`);if(t.enum&&!t.enum.includes(r))throw new Error(`Record "${e}" must be one of [${t.enum.join(", ")}]`)},string:(t,e,r)=>{if(typeof r!="string")throw new Error(`Record "${e}" not of type "string"`);if(t.minLength&&kt(r)<t.minLength)throw new Error(`Record "${e}" has ${kt(r)} bytes, minimum ${t.minLength}`);if(t.maxLength&&kt(r)>t.maxLength)throw new Error(`Record "${e}" has ${kt(r)} bytes, maximum ${t.maxLength}`);if(t.minGraphemes&&Oe(r)<t.minGraphemes)throw new Error(`Record "${e}" has ${Oe(r)} graphemes, minimum ${t.minGraphemes}`);if(t.maxGraphemes&&Oe(r)>t.maxGraphemes)throw new Error(`Record "${e}" has ${Oe(r)} graphemes, maximum ${t.maxGraphemes}`);t.format&&_s(t.format,e,r)},bytes:(t,e,r)=>{if(!(r&&typeof r=="object"&&"$bytes"in r))throw new Error(`Record "${e}" not of type "bytes"`);if(typeof r.$bytes!="string")throw new Error(`Record "${e}".$bytes must be a string`);let o=r.$bytes.length*.75;if(t.minLength&&o<t.minLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, minimum ${t.minLength}`);if(t.maxLength&&o>t.maxLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, maximum ${t.maxLength}`)},array:(t,e,r)=>{if(!Array.isArray(r))throw new Error(`Record "${e}" not of type "array"`);if(t.minLength&&r.length<t.minLength)throw new Error(`Record "${e}" has ${r.length} items, minimum ${t.minLength}`);if(t.maxLength&&r.length>t.maxLength)throw new Error(`Record "${e}" has ${r.length} items, maximum ${t.maxLength}`);t.items&&r.forEach((o,n)=>{Gn(t.items,`${e}[${n}]`,o)})},object:(t,e,r)=>{if(typeof r!="object"||r===null||Array.isArray(r))throw new Error(`Record "${e}" not of type "object"`);Ue(t,r)},ref:(t,e,r)=>{switch(t.ref){case"io.sound.sequence":Ue(Mn,r);break;case"io.sound.credit":Ue(Ws,r);break;default:console.log(`External schema ref ${t.ref} not validated`)}}});function ta(t=[],e){let r;for(r of t)if(!(r in e))throw new Error(`Record missing required "${r}" property`)}function Ue(t,e){let{type:r,required:o,properties:n}=t;if(r!=="object")throw new Error(`Attempting to validate object with schema of type "${r}"`);ta(o,e);let i,a;for(i in e)i in n&&(a=n[i],Gn(a,i,e[i]))}var Wt=0;function Yr(t){return Ue(Mn,t)}function Le(t){let{events:e,sequences:r,...o}=t;return $n(o,{version:Wt,events:{$bytes:Xr(e).toBase64()}}),Yr(o),r&&(o.sequences=r.map(Le)),o}function Zr(t){let{version:e,events:r,sequences:o,...n}=t;if(e!==Wt)throw new Error(`Cannot decode record version ${e} with decoder version ${Wt}`);let i=Uint8Array.fromBase64(r.$bytes);return $n(new Z(Vr(i),o),n)}var On=Object.assign,ea=Z.from;Z.from=function(e){return e.events&&typeof e.events.$bytes=="string"?Zr(e):ea(e)};On(Z,{version:Wt,toRecord:Le,fromRecord:Zr,validateRecord:Yr});On(Z.prototype,{toRecord:function(){return Le(this)}});function Jr(t){var e={};return function(o){return o in e?e[o]:e[o]=t(o)}}function qe(t){return function(r,...o){var n=t[r]||t.default;return n&&n.apply(this,o)}}var ra={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function Qr(t,e){if(e){var r=ra[t.toLowerCase()]||t,o;try{o=new window.DOMParser().parseFromString(e,r)}catch{return}if(!o||o.getElementsByTagName("parsererror").length)throw new Error("Invalid "+t.toUpperCase()+": "+e);return o}}function Un(t){return Qr("html",t)}function Ln(t){return Qr("svg",t)}var ft=Object.assign,Bt={headers:function(t){return{}},body:M},oa=qe({"application/x-www-form-urlencoded":function(t){return ft(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(t){return ft(t,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(t){return ft(t,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(t){return ft(t,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(t){return ft(t,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(t){return ft(t,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(t){return ft(t,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(t){return ft(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),na=qe({"application/json":function(t){return t instanceof FormData?ia(t):JSON.stringify(t)},"application/x-www-form-urlencoded":function(t){return t instanceof FormData?Pn(t):In(t)},"multipart/form-data":function(t){return t instanceof FormData?t:sa(t)},default:M});function ia(t){return JSON.stringify(Array.from(t.entries()).reduce(function(e,r){return e[r[0]]=r[1],e},{}))}function Pn(t){return new URLSearchParams(t).toString()}function In(t){return Object.keys(t).reduce((e,r)=>(e.append(r,t[r]),e),new URLSearchParams)}function sa(t){throw new Error("TODO: dataToFormData(data)")}function aa(t,e){return e instanceof FormData?t+"?"+Pn(e):t+"?"+In(e)}function ca(t,e,r,o){let n=typeof r=="string"?r:r&&r["Content-Type"]||"application/json",i=oa(n,ft(Bt.headers&&e?Bt.headers(e):{},typeof r=="string"?{}:r)),a={method:t,mode:"cors",headers:i,credentials:"same-origin",signal:o&&o.signal};return t!=="GET"&&(a.body=na(n,Bt.body?Bt.body(e):e)),a}function Pe(t){return t.blob()}function ua(t){return t.json().catch(e=>{throw new Error("Cannot parse JSON "+t.url+". "+e.message)})}function qn(t){return t.formData()}function pa(t){return t.text()}function la(t){return t.text().then(e=>/^\s*<!DOCTYPE html>/.test(e)?Un(e):v("fragment",e))}function ha(t){return t.text().then(e=>/^\s*<\?xml/.test(e)?Ln(e):(console.warn("Untested SVG fragment parsing in request.js!"),v("fragment",e)))}var fa={"text/plain":pa,"text/html":la,"image/svg+xml":ha,"application/json":ua,"multipart/form-data":qn,"application/x-www-form-urlencoded":qn,audio:Pe,"audio/wav":Pe,"audio/m4a":Pe,"application/zip":Pe};function ma(t){if(Bt.onresponse&&(t=Bt.onresponse(t)),!t.ok)throw new Error(t.statusText+"");let e=t.headers.get("Content-Type");if(!e)return;let r=e.replace(/\;.*$/,"");return fa[r](t)}function Hn(t="GET",e,r={},o="application/json"){t=t.toUpperCase(),t==="GET"&&r&&(e=aa(e,r));let n=ca(t,r,o,arguments[4]);return fetch(e,n).then(ma)}function zn(t){return Hn("GET",t)}var da={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},ga=/^[ABCDEFG][bâ™­#â™¯]{0,1}-?\d$/,jn=/^[ABCDEFG][bâ™­#â™¯]{0,1}/;function _r(t){let e=t.trim().split(/\s+/),r=[],o=-1;for(;e[++o]!==void 0;){let n=Number(e[o]),i=e[++o];ga.test(i)?(i="note",--o):jn.test(i)&&(i="chord",--o);let a=[n,i],u=da[i];if(u===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let s=jn.exec(e[++o])[0],c=e[o].slice(s.length)||e[++o],l=Number(e[++o]);a.push(s,c,l)}else for(;u--;){let s=Number(e[++o]);a.push(Number.isNaN(s)?e[o]:s)}r.push(a)}return r}function wa(t){let e=t.files[Object.keys(t.files)[0]];return bt(e.type,e.content)}function xa(t){let e=t.settings.find(matches({id:13324}))||t.settings[0];return bt("abc",e.abc)}function bt(t,e){if(typeof e=="object")return e.files?wa(e):e.settings?xa():Array.isArray(e)?{id:0,events:e}:e;if(t==="sequence"||t==="text/plain")return{events:_r(e)};{let r=JSON.parse(e);return Array.isArray(r)?{id:0,events:r}:r}}var ya=Jr(zn);var Wn=N((t,e)=>typeof e,{string:function(t,e){return ya(e).then(r=>bt(t,r)).catch(r=>console.error(r))},default:function(t,e,r,o){e[t]=o}});var Ea=/^(\d+)\/(\d+)$/;function Kn(t){let e=Ea.exec(t),r=parseInt(e[1],10),o=4/parseInt(e[2],10);return{1:"meter",2:r*o,3:o}}function Vn(t){let e=t[2],r=t[3],o=e/r,n=4/r;return o+"/"+n}var G={};Pi(G,{accentDown:()=>ze,accentUp:()=>He,acciDoubleFlat:()=>Jt,acciDoubleSharp:()=>te,acciFlat:()=>Qt,acciNatural:()=>$t,acciParensLeft:()=>$a,acciParensRight:()=>Ma,acciSharp:()=>_t,augmentationDot:()=>ec,barLine:()=>Fc,barRepeat1:()=>Tc,barRepeat2:()=>Cc,barRepeat4:()=>kc,barRepeatBegin:()=>Gc,barRepeatDots:()=>Lc,barRepeatEnd:()=>Oc,barRepeatEndBegin:()=>Uc,barRepeatLowerDot:()=>Mc,barRepeatSlash:()=>Bc,barRepeatUpperDot:()=>$c,chordAugmented:()=>Jc,chordBassSlash:()=>uo,chordBracketLeft:()=>ru,chordBracketRight:()=>ou,chordDiminished:()=>Yc,chordGlyphs:()=>nu,chordHalfDiminished:()=>Zc,chordMajorSeventh:()=>Qc,chordMinor:()=>_c,chordParensLeftTall:()=>tu,chordParensRightTall:()=>eu,clefAlto:()=>Yt,clefBass:()=>Zt,clefDrum:()=>Ie,clefTreble:()=>Kt,clefTrebleDown:()=>Vt,clefTrebleUp:()=>Xt,coda:()=>co,graceNoteStemDown:()=>mc,graceNoteStemUp:()=>fc,head1:()=>to,head2:()=>eo,head4:()=>ro,headBracketLeft:()=>ee,headBracketRight:()=>re,headCircle:()=>Pa,headCircleX:()=>Ia,headDiamond:()=>Oa,headDiamondWide:()=>Ua,headPlus:()=>qa,headSlashHorizontalEnds:()=>ja,headSlashVerticalEnds:()=>za,headSlashed2:()=>Ga,headTriangleUp:()=>Ha,headX:()=>La,marcatoDown:()=>We,marcatoUp:()=>je,metDot:()=>hc,metNote05Down:()=>lc,metNote05Up:()=>cc,metNote1Down:()=>pc,metNote1Up:()=>ac,metNote2Down:()=>uc,metNote2Up:()=>sc,note0125Down:()=>tc,note0125Up:()=>Ya,note025Down:()=>_a,note025Up:()=>Xa,note05Down:()=>Qa,note05Up:()=>Va,note1Down:()=>Ja,note1Up:()=>Ka,note2Down:()=>Za,note2Up:()=>Wa,rest0125:()=>oo,rest01875:()=>bc,rest025:()=>no,rest0375:()=>vc,rest05:()=>io,rest075:()=>Rc,rest1:()=>so,rest15:()=>Sc,rest2:()=>ao,rest3:()=>Ac,rest4:()=>Nc,rest6:()=>Dc,staccatoDown:()=>oc,staccatoUp:()=>rc,tailDown0125:()=>Ec,tailDown025:()=>xc,tailDown05:()=>gc,tailUp0125:()=>yc,tailUp025:()=>wc,tailUp05:()=>dc,tenutoDown:()=>ic,tenutoUp:()=>nc,textBeam16Long:()=>mu,textBeam16Short:()=>fu,textBeam8Long:()=>hu,textBeam8Short:()=>lu,textDot:()=>du,textNote16Long:()=>pu,textNote16Short:()=>uu,textNote8Long:()=>cu,textNote8Short:()=>au,textNoteLong:()=>su,textNoteShort:()=>iu,textTie:()=>gu,textTuplet3Long:()=>bu,textTuplet3Short:()=>xu,textTupletBeginLong:()=>Eu,textTupletBeginShort:()=>wu,textTupletEndLong:()=>vu,textTupletEndShort:()=>yu,timeSig0:()=>ba,timeSig1:()=>va,timeSig2:()=>Ra,timeSig3:()=>Sa,timeSig4:()=>Aa,timeSig5:()=>Na,timeSig6:()=>Da,timeSig7:()=>Fa,timeSig8:()=>Ta,timeSig9:()=>Ca,timeSigCommon:()=>ka,timeSigCutCommon:()=>Ba,tuplet0:()=>qc,tuplet1:()=>Pc,tuplet2:()=>Ic,tuplet3:()=>Hc,tuplet4:()=>zc,tuplet5:()=>jc,tuplet6:()=>Wc,tuplet7:()=>Kc,tuplet8:()=>Vc,tuplet9:()=>Xc});var Kt="&#xE050;",Vt="&#xE052;",Xt="&#xE053;",Yt="&#xE05C;",Zt="&#xE062;",Ie="&#xE069;",ba="&#xE080;",va="&#xE081;",Ra="&#xE082;",Sa="&#xE083;",Aa="&#xE084;",Na="&#xE085;",Da="&#xE086;",Fa="&#xE087;",Ta="&#xE088;",Ca="&#xE089;",ka="&#xE08A;",Ba="&#xE08B;",Jt="&#xE264;",Qt="&#xE260;",$t="&#xE261;",_t="&#xE262;",te="&#xE263;",$a="&#xE26A;",Ma="&#xE26B;",to="&#xE0A4;",eo="&#xE0A3;",ro="&#xE0A2;",ee="&#xE0F5;",re="&#xE0F6;",Ga="&#xE0D0;",Oa="&#xE0DB;",Ua="&#xE0DC;",La="&#xE0A9;",qa="&#xE0AF;",Pa="&#xE0E8;",Ia="&#xE0B3;",Ha="&#xE0BE;",za="&#xE100;",ja="&#xE101;",Wa="&#xE1D3;",Ka="&#xE1D5;",Va="&#xE1D7;",Xa="&#xE1D9;",Ya="&#xE1DB;",Za="&#xE1D4;",Ja="&#xE1D6;",Qa="&#xE1D8;",_a="&#xE1DA;",tc="&#xE1DC;",ec="&#xE1E7;",He="&#xE4A0;",ze="&#xE4A1;",rc="&#xE4A2;",oc="&#xE4A3;",nc="&#xE4A4;",ic="&#xE4A5;",je="&#xE4AC;",We="&#xE4AD;",sc="&#xECA3;",ac="&#xECA5;",cc="&#xECA7;",uc="&#xECA4;",pc="&#xECA6;",lc="&#xECA8;",hc="&#xECB7;",fc="&#xE560;",mc="&#xE561;",dc="&#xE240;",gc="&#xE241;",wc="&#xE242;",xc="&#xE243;",yc="&#xE244;",Ec="&#xE245;",oo="&#xE4E8;",bc="&#xE4E8;&#xE1E7;",no="&#xE4E7;",vc="&#xE4E7;&#xE1E7;",io="&#xE4E6;",Rc="&#xE4E6;&#xE1E7;",so="&#xE4E5;",Sc="&#xE4E5;&#x200A;&#xE1E7;",ao="&#xE4E4;",Ac="&#xE4E4;&#x200A;&#xE1E7;",Nc="&#xE4E3;",Dc="&#xE4E3;&#x200A;&#xE1E7;",Fc="&#xE030",Tc="&#xE500;",Cc="&#xE501;",kc="&#xE502;",Bc="&#xE504;",$c="&#xE503;",Mc="&#xE505;",Gc="&#xE040",Oc="&#xE041",Uc="&#xE042",Lc="&#xE043",co="&#xE048",qc="&#xE880;",Pc="&#xE881;",Ic="&#xE882;",Hc="&#xE883;",zc="&#xE884;",jc="&#xE885;",Wc="&#xE886;",Kc="&#xE887;",Vc="&#xE888;",Xc="&#xE889;",Yc="&#xE870;",Zc="&#xE871;",Jc="&#xE872;",Qc="&#xE873;",_c="&#xE874;",tu="&#xE875;",eu="&#xE876;",ru="(",ou=")",uo="&#xE87B;",nu={"âˆ†â™¯11":"î¡³îµ¢11","âˆ†":"î¡³",7:"7","-7":"î¡´7","-â™­6":"î¡´îµ 6","7susâ™­9":"7susîµ¢",Ã¸:"î¡±","7â™¯11":"7îµ¢11","-âˆ†":"î¡´î¡³","âˆ†â™­6":"î¡³îµ 6","-â™­9":"î¡´îµ 9",Ã¸7:"î¡±7","âˆ†â™¯5":"î¡³îµ¢5","7alt":"7alt","Â°":"î¡°",dim:"î¡°","7â™­9":"7îµ ","+7":"î¡²7"},iu="&#xE1F0;",su="&#xE1F1;",au="&#xE1F2;",cu="&#xE1F3;",uu="&#xE1F4;",pu="&#xE1F5;",lu="&#xE1F7;",hu="&#xE1F8;",fu="&#xE1F9;",mu="&#xE1FA;",du="&#xE1FC;",gu="&#xE1FD;",wu="&#xE1FE",xu="&#xE1FF",yu="&#xE200",Eu="&#xE201",bu="&#xE202",vu="&#xE203";function po(t){return function(){return arguments[t]}}function et(){return this}var Xn=Object.create,Ru=Object.freeze,Ke=Ru(Xn(Xn(Object.prototype,{at:{value:U},shift:{value:U},push:{value:U},forEach:{value:U},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:et},find:{value:U},findIndex:{value:function(){return-1}},flat:{value:et},flatMap:{value:et},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:et},reduce:{value:po(1)},sort:{value:et},each:{value:et},pipe:{value:M},start:{value:et},stop:{value:et},done:{value:et},valueOf:{value:function(){return null}}}),{length:{value:0}}));function rt(t){return ht(12,t)}var Yn=N(tt(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function B(t){return t[0]+Yn(t)}var at=Uint8Array.of(0,2,4,5,7,9,11);var{abs:Hm}=Math,Su=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),Au=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],zm={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]},Xe=nt(t=>{let e=It(t);return at.map(r=>rt(r+e)).sort()});function ho(t){let e=new Float32Array(12),r=W(t+2),o=7;for(;o--;)r=W(r+5),e[r]=1;return e}function fo(t,e,r){let o=t.length;for(;o--;)t[o]*=1-r+r*e[o];return t}var lo={note:(t,e,r=1)=>{let o=R(e[2]),n=ho(o);return fo(t,n,r*(1-o/192))},chord:(t,e,r=1)=>{let o=W(e[2]),n=Pr(e[3]),i=n.length,a;for(;i--;)a=ho(o+n[i]),fo(t,a,r/n.length*Su[n[i]]);return t}};function Ye(t,e,r=0){let o=t[e],n=It(r),i=o[0],a=$e(o)?ho(R(o[2])):Wr(o)?lo.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(n!==void 0){let s=Float32Array.from({length:12},(c,l)=>Au[(l+12-n)%12]);fo(a,s,.3)}let u=e;for(;o=t[--u];){let s=lo[o[1]];if(!s)continue;let c=B(o);if(c>i)s(a,o,.5);else if(o[1]==="note"&&i-c<3){if(1-(i-c)/3>1)throw new Error("Influence should never be > 1 "+i+" "+c);s(a,o,.25*(1-(i-o[0])/3))}}for(u=e;(o=t[++u])&&o[0]-i<2;){if(!$e(o))continue;let s=lo[o[1]];if(s){if(1-(o[0]-i)/2>1)throw new Error("Influence should never be > 1 "+i+" "+stopBeat);s(a,o,.3*(1-(o[0]-i)/2))}}return a}var Ve=[0,7,5,2,10,9,3,4,8,11,1,6];function Ze(t){let e=Ve.length,r=0,o;for(;e--;)t[Ve[e]]>r&&(r=t[Ve[e]],o=Ve[e]);return Ce(o)}var Jn=/^([A-G])([b#â™­â™¯ğ„«ğ„ª])?(-?\d)?$/,Qn=/b|â™­/,_n=/#|â™¯/;var Je=/b|â™­|#|â™¯/g;var ti={"-2":"ğ„«","-1":"â™­",0:"",1:"â™¯",2:"ğ„ª"},Zn=["Fâ™¯","Câ™¯","Gâ™¯","Dâ™¯","Aâ™¯","Eâ™¯","Bâ™¯","Bâ™­","Eâ™­","Aâ™­","Dâ™­","Gâ™­","Câ™­","Fâ™­"];function ei(t,e){let r=Zn.indexOf(t.pitch),o=Zn.indexOf(e.pitch);return r>o?1:r<o?-1:0}var P={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,marcatoThreshold:lt("-6dB"),accentThreshold:lt("-12dB"),ghostThreshold:lt("-30dB"),headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var ri={"-2":"ğ„«","-1":"â™­",0:"",1:"â™¯",2:"ğ„ª"};var{floor:oi,round:od}=Math,Nu={"-7":{name:"Câ™­",symbol:"Câ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},"-6":{name:"Gâ™­",symbol:"Gâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},"-5":{name:"Dâ™­",symbol:"Dâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},"-4":{name:"Aâ™­",symbol:"Aâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},"-3":{name:"Eâ™­",symbol:"Eâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},"-2":{name:"Bâ™­",symbol:"Bâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},"-1":{name:"F",symbol:"Fâˆ†",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},0:{name:"C",symbol:"Câˆ†",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},1:{name:"G",symbol:"Gâˆ†",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},2:{name:"D",symbol:"Dâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},3:{name:"A",symbol:"Aâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},4:{name:"E",symbol:"Eâˆ†",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},5:{name:"B",symbol:"Bâˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},6:{name:"Fâ™¯",symbol:"Fâ™¯âˆ†",spellings:[1,1,0,1,2,1,1,0,1,0,1,0]},7:{name:"Câ™¯",symbol:"Câ™¯âˆ†",spellings:[1,1,0,1,2,1,1,0,1,0,1,2]}},F=class{constructor(){}pitched=!0;rows=Ke;getHeadHTML(e,r,o){let n=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${n}">${G[n]}</span>`}getNoteHTML(e,r,o){return r<P.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${ee}</span>
            ${this.getHeadHTML(e,r,o)}
            <span class="post" data-glyph="headBracketRight">${re}</span>`:this.getHeadHTML(e,r,o)}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return oi(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,r){let o=R(this.minPitch),n=R(this.maxPitch),i=R(e)+r;return i>=o&&i<=n?i:void 0}parts=[{name:"main"}];getPart(e){return this.parts[0]}getRow(e,r){let n=(typeof r=="string"?r:it(r)).replace(Je,""),i=this.rows.indexOf(n);return i===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getPitch(e){let r=this.rows[e];return r?r.split(/\s+/)[0]:void 0}getSpelling(e,r,o=!1){let n=Nu[e];if(!o){let l=W(r),h=n.spellings[l];return ve[rt(l-h)]+ri[h]}let i,a,u;if(typeof r=="string"){let[l,h,p,f]=Jn.exec(r)||[r];f&&(i=R(r),a=n.spellings[rt(i)],u=Re(i-a))}else i=r,a=n.spellings[rt(i)],u=Re(i-a);let s=ve[rt(i-a)],c=ri[a];return s+c+u}createKeySymbols(e){let r=Xe(e);return Array.from(r,(o,n)=>o-at[n]&&{type:"acci",pitch:pt(at[n])+ti[o-at[n]],value:o-at[n],part:this.parts[0]}).filter(o=>!!o).sort(ei)}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let r=oi(e*this.pitches.length);return r<0?this.pitches[0]:r>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[r]}};function mo(t){if(t=typeof t=="number"?t+"":t.trim(),typeof t=="string")return t.toLowerCase().replace(/^[\W_]+/,"").replace(/[\W_]+$/,"").replace(/[\W_]+/g,"-")}function D(t){return mo(rn(t))}var vt=class extends F{type="drum";pitched=!1;rows=["","","",D(55)+" "+D(52),D(57),D(49),D(51)+" "+D(53)+" "+D(59),D(42)+" "+D(46),D(50)+" "+D(56),D(48)+" "+D(47),D(38)+" "+D(40),D(45)+" "+D(31)+" "+D(39)+" "+D(54),D(43),D(41),D(35)+" "+D(36),"",D(44),"","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#e={31:!0,35:!0,36:!0,37:!0,38:!0,40:!0,41:!0,42:!0,43:!0,45:!0,47:!0,48:!0,50:!0,56:!0};getNoteHTML(e,r,o){let n=R(e),i=this.#t[n],a=this.#e[n],u=i?`<span class="head" data-glyph="${i}">${G[i]}</span>`:this.getHeadHTML(e,r,o);return a&&r<P.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${ee}</span>
            ${u}
            <span class="post" data-glyph="headBracketRight">${re}</span>
            `:u}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(e){return[35,36,37,38,40,41,43,44,45,47,48,50].includes(R(e))?this.parts[0]:this.parts[1]}getRow(e,r){let o=typeof r=="string"?r:D(r);if(!o)throw new Error("Number not found for pitch "+r);let n=this.rows.findIndex(i=>i.includes(o));return n===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),n>-1?n:void 0}getSpelling(e,r){return D(r)}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let r=floor(e*this.rows.length),o=r<4?4:r>17?17:r;return this.pitches[o]}};var oe=class extends vt{type="percussion";rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var Du=globalThis||window,ni=Object.assign,ne=class extends F{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(e,r,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+r]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+r]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(e,r){r=typeof r=="string"?r:it(r);let o=e.name+"-"+r.replace(Je,""),n=this.rows.findIndex(i=>i.includes(o));if(Du.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by '+this.constructor.name),n>-1?n:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#â™­â™¯ğ„«ğ„ª]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let r=super.createKeySymbols(e),o=[];return o.push.apply(o,r.map(n=>ni({},n,{part:this.parts[1]}))),o.push.apply(o,r.map(n=>ni({},n,{part:this.parts[2]}))),o}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var go=class extends F{type="treble-up";clef=Xt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},wo=class extends F{type="treble";clef=Kt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},xo=class extends F{type="treble-down";clef=Vt;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},yo=class extends F{type="alto";clef=Yt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Eo=class extends F{type="bass";clef=Zt;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};F.treble=new wo;F["treble-up"]=new go;F["treble-down"]=new xo;F.alto=new yo;F.bass=new Eo;F.piano=new ne;F.drum=new vt;F.percussion=new oe;F.create=t=>(console.warn("Deprecated: Stave.create(type). Use Stave[type]."),F[t]);var Qe=F;var ii=t=>t*Math.PI/180;var si=yt({deg:ii,rad:M,turn:t=>t*2*Math.PI,catch:function(t){throw new Error('Cannot parse value "'+t+'"')}});var Fu=/px$/,Tu=/deg$|turn$|rad$/;function Cu(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function _e(t,e){var r=Cu(t,e);return typeof r=="string"?Fu.test(r)?parseFloat(r):Tu.test(r)?si(r):r:r}var tr,er;function ku(){if(!tr){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",tr=_e("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return tr}function Bu(){return er||(er=_e("font-size",document.documentElement)),er}window.addEventListener("resize",()=>{tr=void 0,er=void 0});var $u=N(Nt,{number:M,string:yt({px:M,em:t=>ku()*t,rem:t=>Bu()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),ai=$u;function Mu(t,e,r){let o=t(e),n=t(r);return n===o?0:o>n?1:-1}var ci=X(Mu,!0);var{abs:Gu,EPSILON:Ou}=Math;function rr(t,e){return Math.round(e/t)*t}function ot(t,e,r=Ou){return e!==void 0&&(e===t||Gu(t-e)<r)}function Rt(t,e,r){return ot(t,e,r)||e<t}function Uu(t,e,r){return ot(t,e,r)||e>t}function Mt(t,e,r){return e!==void 0&&t!==void 0&&!Rt(t,e,r)}function or(t,e,r){return e!==void 0&&t!==void 0&&!Uu(t,e,r)}var{pow:Lu}=Math,qu=1/24,Pu=[2,3,4,5,6,7,9],Iu=1/12,ui=.25,pi=.2,bo={},Gt=0;function li(t,e){return Math.cos(2*Math.PI*e/t)}function hi(t,e,r,o,n){let i=t/e,a=0,u=0,s=0,c,l;for(o[n-1]&&Mt(r+.5*i,B(o[n-1]),qu)&&(s=1),--n;o[++n]!==void 0&&o[n][0]-r<i/4;)s=1;for(--n;o[++n]!==void 0&&o[n][0]-r<t-i/4;){if(c=Math.round((o[n][0]-r)/i),l=1<<c,c<e&&l>s){if(e>4&&l>s<<1)return;s+=l}a+=li(i,o[n][0]-r),u+=1,!(o[n][0]+o[n][4]-r>t)&&(a+=pi*li(i,o[n][0]+o[n][4]-r),u+=pi)}if(!(e>4&&c!==e-1)&&u)return bo.score=a/(u+1),bo.rhythm=s,bo}function Hu(t,e,r,o,n,i,a){let u=r[o-1]&&B(r[o-1])>n+.125?n:e*Math.floor((r[o][0]-n)/e)+n,s=i.length;for(;e/i[--s]<Iu;);++s;let c,l;for(;c=i[--s];)l=hi(e,c,u,r,o),l&&l.score>=Gt&&l.score&&(Gt=l.score,t.beat=u,t.duration=e,t.divisor=c,t.rhythm=l.rhythm),r[o][0]>=u+.5*e&&u+1.5*e<a&&(l=hi(e,c,u+.5*e,r,o),l&&l.score>=Gt&&(Gt=l.score,t.beat=u+.5*e,t.duration=e,t.divisor=c,t.rhythm=l.rhythm));return t}function fi(t,e,r){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let n={};Gt=ui;let i=1/8;for(;(i*=2)&&i<=r;)Hu(n,i,t,o,e,Pu,e+r);return Gt>ui&&n}function mi(t,e){return e<Lu(2,t)-1}function vo(t){return 2**Math.ceil(Math.log2(t))}function di(t){return 2**Math.floor(Math.log2(t))}function Ro(t){return t>0&&(t&t-1)===0}function So(t,e,r){if(ot(0,r,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(ot(0,ht(o,r),t/2))return o;return o}function ie(t,e){let r=-1,o=0;for(;t[++r]!==void 0;);for(;arguments[++o]!==void 0;)t[r++]=arguments[o];return t}function Ot(t){let e=-1;for(;t[++e]!==void 0;);return e}function Ao(t){return t[Ot(t)-1]}function No(t,e){let r=[],o=-1;for(;e[++o]!==void 0;)r.push(t(e[o],o));return r}var sr=Object.assign,{abs:Ug,ceil:zu,floor:ir,min:yi,max:Ei,pow:Lg,sqrt:gi,round:qg}=Math,V=1/16,se=1/24,ju=ci(tt("row"));function wi(t,e,r,o){return t+e/o.length}function bi(t,e){return Ei(t,B(e))}function Wu(t,e){return R(t[2])<R(e[2])?1:-1}function vi(t,e,r,o){if(!o.length)return[];let n=[],i=-1,a;for(;a=o[++i];){let d=a.scribeEvents,m=a.scribeIndex,g=Ye(d,m,e),y=Ze(g),E=t.getSpelling(y,a[2],!0),x=t.getRow(r,E);x&&n.push({type:"note",pitch:E,dynamic:a[3],part:r,row:x,stave:t,event:a})}if(n.length===0)return n;n.sort(ju);let u=n[0],s=n[n.length-1];u.top=!0,s.bottom=!0;let c=u.row,l=s.row,h=r.stemup===void 0?Ri(t,r,c,l):r.stemup,p=1+(l-c)/8;u.stemHeight=p,s.stemHeight=p;let f=0;for(i=-1;n[++i];)n[i].stemup=h,i>0&&n[i].row-n[i-1].row===1?n[i].clusterdown=++f:f=0;for(f=0,i=n.length-1;i--;)n[i+1].row-n[i].row===1?n[i].clusterup=++f:f=0;return n}function Ku(t,e,r){let o=-1,n=0,i,a;for(;r[++o];)a=t.getRow(e,r[o]),a!==void 0&&a>n&&(n=a,i=r[o]);return{row:n,pitch:i}}function Vu(t,e,r){let o=-1,n=128,i,a;for(;r[++o];)a=t.getRow(e,r[o]),a!==void 0&&a<n&&(n=a,i=r[o]);return{row:n,pitch:i}}function Ri(t,e,r,o){let n=e.centerRow||t.centerRow,i=r-n;return o-n+i>0}function Si(t,e,r){let{row:o}=Ku(t,e,r),{row:n}=Vu(t,e,r);return Ri(t,e,o,n)}function Xu(t,e,r){let o=[],n=-1,i;for(;i=r[++n];)i.type==="note"&&o.push(i.pitch);return Si(t,e,o)}var xi=0;function mt(t,e,r,o){let n=-1;for(;o[++n]&&o[n].beat===o.beat;);if(!o[n])return t;let i=o[0].beat,u=Ao(o).beat-i,s=r.stemup===void 0?Si(e,r,No(tt("pitch"),o)):r.stemup;if(r.beam){let x;for(n=-1;x=o[++n];)x.stemup=s,x.beam=o;return t.push(sr(o,{duration:u,stemup:s,range:0,id:++xi})),t}let c=[],l;for(n=-1;l=o[++n];){let x=e.getRow(r,l.pitch);if(x===void 0)continue;let O;for(;o[++n]&&ot(o[n].beat,l.beat,se);)O=e.getRow(r,o[n].pitch),O!==void 0&&(s?O<x&&(x=O):O>x&&(x=O,console.log("YEAH")));--n,c.push(x)}let h=c.length-1,p=c.slice(0,ir(.5*c.length)).reduce(wi,0),f=c.slice(zu(.5*c.length)).reduce(wi,0),d=Array.from(c,(x,O)=>(.2+.1*h)*O*(f-p)/h),m=d[d.length-1]-d[0],g=s?-50:50,y;for(n=c.length;n--;)y=d[n]-c[n],g=s?y>g?y:g:y<g?y:g;for(console.log(d,c,g),n=c.length;n--;)d[n]-=g+c[0];let E=-1;for(n=-1;l=o[++n];){++E;let x=(d[E]-c[E]+c[0])/8;for(l.stemup=s,l.beam=o,l.stemHeight=s?1-x:1+x;o[++n]&&ot(o[n].beat,l.beat,V);)o[n].stemup=s,o[n].beam=o,o[n].stemHeight=s?1+(o[n].row-l.row)/8-x:1+(o[n].row-l.row)/8+x;--n}return t.push(sr(o,{pitch:o[0].pitch,y:d[0],duration:u,stemup:s,range:m,id:++xi})),t}function nr(t,e){let r=2*vo(e);for(;(r/=2)>t/2;){if(1.75*r===e)return 1.75*r;if(1.5*r===e)return 1.5*r;if(r<=e)return r}return t}function Yu(t,e,r){r=r||1/0;let o=4*vo(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=r)return o;return t}function Ai(t,e,r,o,n,i){let u=di(e.divisor),s=ir(n/e.divisor)*e.divisor,c=So(.125,u,n-s);if(i<o){if(t.indexOf(i-n)!==-1)return i-n;let h=ir(i/e.divisor)*e.divisor;if(n===s){if(t.indexOf(h-n)!==-1)return h-n;let p=s+e.divisor<i&&s+e.divisor;return p?p-n:nr(.125,i-n)}if(ot(i,h,V)){let p=s+e.divisor<i&&s+e.divisor;return p&&t.indexOf(p-n)!==-1?p-n:c}}let l=ir(o/e.divisor)*e.divisor;if(n===s){if(t.indexOf(o-n)!==-1)return o-n;if(t.indexOf(l-n)!==-1)return l-n;let h=s+e.divisor<o&&s+e.divisor;return h?h-n:Yu(.125,o-n,i-n)}else if(ot(o,l,V)){if(t.indexOf(o-n)!==-1)return o-n;let h=s+e.divisor<o&&s+e.divisor;return h&&t.indexOf(h-n)!==-1?h-n:c}else{let h=4*c;return(n-s)%h/c===1?n+2*c===i?2*c:(n+3*c>=i&&console.log("Next event beat is inside quaduplet"),c<1?o>=n+c*3/2?3*c:o>=n+c?c:nr(.125,o-n):o>=n+c*3?c*3:o>=n+c*2?c*2:o>n+c?c:nr(.125,o-n)):o>n+c?c:nr(.125,o-n)}}function Zu(t,e,r,o,n,i){return{type:"rest",beat:i,duration:Ai(t,e,i,n,i,n),stave:r,part:o}}function Do(t,e,r,o,n,i,a){for(;Mt(i,a,V);){let u=Zu(e,r,o,n,a,i);t.push(u),i+=u.duration}return a}function Ju(t,e,r,o,n,i){let{pitch:a,event:u,row:s}=o,c=_n.test(a)?1:Qn.test(a)?-1:void 0,l=a[0]+a.slice(-1);if(c!==e[l])return e[l]=c,{type:"acci",beat:r,pitch:a,row:s,clump:n,cluster:i,part:t,event:u,value:c||0}}function Qu(t,e,r){let o=-1,n,i=0,a;for(;n=t[++o];)n.type==="acci"&&n.beat===e&&n.row<r&&n.row>i&&(i=n.row,a=o);return t[a]}function Ni(t,e,r,o,n,i){let a=-1,u=0,s,c,l,h=!!i.find(p=>p.stemup?p.clusterup%2===1:p.clusterdown%2===1);for(;s=i[++a];)or(e.beat,s.event[0],V)||(l=Qu(t,n,s.row),u=l&&l.row-s.row<6&&l.cluster===h?l.clump+1:0,c=Ju(r,o,n,s,u,h),c&&t.push(c))}function Di(t,e,r,o,n,i){let a=-1/0,u=-1,s,c;for(;s=n[++u];)s.dynamic>a&&(a=s.dynamic,c=s.event);if(n.length&&a>=i.accentThreshold){let l=n[0].stemup?n[n.length-1]:n[0];t.push({type:"accent",beat:o,pitch:l.pitch,dynamic:a,stemup:l.stemup,stave:e,part:r,event:c})}}function Fi(t,e,r,o,n){let i=n[0].row,a=n[0].pitch,u=i-(r.topRow||e.topRow)+1;u<0&&t.push({type:"ledge",beat:o,pitch:a,part:r,rows:u});let s=n[n.length-1].row,c=n[n.length-1].pitch;u=s-(r.bottomRow||e.bottomRow),u>0&&t.push({type:"ledge",beat:o,pitch:c,part:r,rows:u})}function _u(t,e,r){let{beat:o,duration:n,divisor:i}=r,a=e.stemup===void 0?Xu(t,e,r):e.stemup,u=-1,s;for(;s=r[++u];)s.type==="note"&&!s.beam&&(s.stemup=a);let c=o+.5*n,l=R(t.topPitch)-12,h,p=Ot(r);for(;(s=r[--p])&&s.beat>c;);for(++p;(s=r[--p])&&s.beat+s.duration>c;){let E=R(s.pitch);(!h||E>h)&&(h=E)}let f=l;for(p=-1;(s=r[++p])&&s.beat<o+V;){let E=R(s.pitch);(!f||E>f)&&(f=E)}let d=l;for(p=Ot(r);(s=r[--p])&&s.beat>o+n-n/i-V;){let E=R(s.pitch);(!d||E>d)&&(d=E)}let m=Math.ceil((f+d)/2),g=it(m);m>h&&(h=m),r.pitch=it(h),r.stemup=a;let y=d-f;r.angle=y<0?4*gi(-y):-4*gi(y)}function tp(t,e,r,o,n,i,a,u,s,c,l,h,p,f,d){(u.swingAsStraight8ths&&c===1||u.swingAsStraight16ths&&c===.5)&&l===3&&(h===4||h===5)&&(l=2);let m=c/l,g=s+c,y={type:"tuplet",beat:s,duration:c,divisor:l,rhythm:h,part:i,stave:r},E;for(Ro(l)||t.push(y);or(g,s,se);){for(;(E=f[++d])&&Rt(s+.5*m,E[0]-e.beat,se);)p.push(E);if(--d,!p.length){t.push({type:"rest",beat:s,duration:m,stave:r,part:i}),s+=m;continue}let x=vi(r,o,i,p);x.length&&(Fi(t,r,i,s,x),Ni(t,e,i,n,s,x),Di(t,r,i,s,x,u));let O=yi(p.reduce(bi,0)-e.beat,E?E[0]-e.beat:e.duration,y.beat+y.duration),T=Ei(m,rr(m,O-s)),C=-1;for(;x[++C];)t.push(sr(x[C],{beat:s,duration:T}));for(ie(y,...x),Mt(.5,T,se)?a&&(mt(t,r,i,a),a=void 0):a||(a={type:"beam",beat:s,part:i}),a&&ie(a,...x),C=p.length;C--;){let K=B(p[C])-e.beat;Rt(s+T+.5*m,K,se)?p.splice(C,1):t.push({type:"tie",beat:s,pitch:x[C].pitch,duration:T,stemup:x[C].stemup,part:i,event:p[C]})}s+=T}return a&&mt(t,r,i,a),_u(r,i,y),d}function Fo(t,e,r,o=0,n={},i,a,u=P){let s=[],{headDurations:c,restDurations:l}=u,h=0,p=-1,f,d,m;for(;(f=a[++p])&&Rt(h,f[0]+f[4]-e.beat,V););for(--p;or(e.duration,h,V);){m&&e.divisions.find(K=>ot(h,K,V))&&(mt(t,r,i,m),m=void 0);let g=fi(a,e.beat+h,e.duration-h);if(g&&!Ro(g.divisor)){Mt(h,g.beat-e.beat,V)&&Do(t,u.restDurations,e,r,i,h,g.beat-e.beat),m&&mi(g.divisor,g.rhythm)&&(mt(t,r,i,m),m=void 0),p=tp(t,e,r,o,n,i,m,u,g.beat-e.beat,g.duration,g.divisor,g.rhythm,s,a,p),h=g.beat-e.beat+g.duration;continue}for(;(f=a[++p])&&Rt(h,f[0]-e.beat,V);)s.push(f);if(--p,r.pitched&&s.sort(Wu),!s.length){if(!f){m&&(mt(t,r,i,m),m=void 0),Do(t,u.restDurations,e,r,i,h,e.duration);break}let K=rr(.125,f[0]-e.beat);if(K<=h){console.log(`Problem at bar ${e.count}, moving to next bar ${h} ${K}`),e.error="Stop beat has ended up less than beat";break}m&&(Ti(e.divisions,h,K)||K-h>=.5)&&(mt(t,r,i,m),m=void 0),Do(t,l,e,r,i,h,K),h=K;continue}let y=vi(r,o,i,s);y.length&&(Fi(t,r,i,h,y),Ni(t,e,i,n,h,y),Di(t,r,i,h,y,u));let E=s[0][0]-e.beat,x=yi(e.duration,s.reduce(bi,0)-e.beat),O=f&&rr(.125,f[0])-e.beat,T=Ai(c,e,E,x,h,O),C=-1;for(;y[++C];)t.push(sr(y[C],{beat:h,duration:T}));for(T>=1?m&&(mt(t,r,i,m),m=void 0):m||(m={type:"beam",beat:h,part:i}),m&&ie(m,...y),C=s.length;C--;){let K=B(s[C])-e.beat;Rt(h+T,K,V)||K-(h+T)<.125+1/16*(B(s[C])-s[C][0])?s.splice(C,1):t.push({type:"tie",beat:h,pitch:y[C].pitch,duration:T,stemup:y[C].stemup,part:i,event:s[C]})}h+=T}return m&&mt(t,r,i,m),t}var ep={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]},Ci=/\/\{(\d{1,2})\}$/;function rp(t,e){return ep[t+","+e]||Ke}function Ti(t,e,r){let o=-1;for(;t[++o]&&t[o]<=e;);return r>t[o]?t[o]:void 0}var op=[];function ki(t,e){return Xe(e).reduce((o,n,i)=>{let a=n-at[i];if(a!==0){let u=pt(at[i]),s=10;for(;s--;)o[u+s]=a}return o},t),t}function To(t,e){return e==="Câ™­"&&t.spellChordRootCFlatAsB?"B":e==="Eâ™¯"&&t.spellChordRootESharpAsF?"F":e==="Bâ™¯"&&t.spellChordRootBSharpAsC?"C":e==="Fâ™­"&&t.spellChordRootFFlatAsE?"E":e}function np(t,e,r,o,n,i,a){let u=-1,s;for(;s=i[++u];)switch(s[1]){case"key":{let c=st(s[2]);ki(n,c),e.key=c;break}case"meter":{t.push({type:"timesig",beat:0,numerator:s[3]===1.5?s[2]/.5:s[2]/s[3],denominator:s[3]===1.5?8:4/s[3],stave:r,event:s});break}case"symbol":{t.push({type:"symbol"+s[2],stave:r});break}case"chord":{let c=s[0]-e.beat,l=Ye(i,u,o),h=Ze(l),p=Fe(s[3]),f=Ci.exec(p),d,m,g;if(f){let y=parseInt(f[1],10);d=r.getSpelling(h,rt(s[2]-y)),m=r.getSpelling(h,s[2]),g=To(a,d)+p.replace(Ci,"/"+To(a,m))}else d=r.getSpelling(h,s[2]),g=To(a,d)+p;t.push({type:"chord",beat:c,name:g,duration:s[0]+s[4]>e.beat+e.duration?e.duration-c:s[4],event:s,stave:r});break}case"text":{let c=s[0]-e.beat;t.push({type:"text",beat:c,duration:s[0]+s[3]>e.beat+e.duration?e.duration-c:s[3],value:s[2],event:s,stave:r});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(op.includes(s[1]))return;console.log('Scribe: ignoring event type "'+s[1]+'"')}}return t}function ae(t,e,r,o,n,i,a,u,s,c=P){let l=[];if(s){let g=B(s);g>e&&g<=e+r&&a.push(s)}let h=ki({},i),p={type:"bar",beat:e,duration:r,key:i,divisor:o||4,divisions:rp(r,o),stave:n,count:t,symbols:l};np(l,p,n,i,h,a,P);let f=n.parts.reduce((g,y)=>y.centerRow?g.add(y.centerRow):g,new Set);f.size||f.add(n.centerRow);let d;for(d of n.parts){let g=u[d.name];!g||!g.length||(f.delete(d.centerRow||n.centerRow),Fo(l,p,n,i,h,d,g,c))}let m;for(m of f)Fo(l,p,n,i,h,{centerRow:m},[],c);return p}function ip(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function sp(t){let e=t.symbols.filter(r=>r.type==="chord"||r.type==="note");return JSON.stringify(e,ip)}function St(t,e){t.symbols=t.symbols.filter(r=>r.type==="doublebarline"||r.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function ar(t,e,r){let o=sp(r);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&r.symbols.filter(n=>n.type!=="clef"&&n.type!=="timesig").find(n=>n.type!=="rest")?(St(t[t.length-2],1),St(t[t.length-1],1),St(r,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(St(r,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,St(t[t.length-1],2),St(r,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,St(r,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function Co(t,e,r){let o=r.target?t.parts[r.target]:t.getPart(r[2]),n=e[o.name]||(e[o.name]=[]);e[o.name].push(r)}function ko(t,e,r,o=P){let n=[],i=[],a=[],u=[],s=0,c=[],l={},h=0,p=0,f,d,m,g;for(m of t)if(m.scribeIndex=n.length,m.scribeEvents=n,n.push(m),!e.includes(m[1])){for(;m[0]>=s+f;){let E=ae(i.length+1,s,f,d,r,h,c,l,g,o);ar(i,u,E),i.push(E),h=E.key,s=s+f,c=[],l={};let x=-1;for(;a[++x];)Co(r,l,a[x]),B(a[x])<s+f&&a.splice(x--,1)}switch(m[1]){case"note":{Co(r,l,m),B(m)>s+f&&a.push(m),p<B(m)&&(p=B(m));break}case"sequence":{m.events===t.events&&(g=m),p<B(m)&&(p=B(m));break}case"meter":f=m[2],d=m[3],m[0]!==s&&console.log("TODO");default:c.push(m)}}for(;a.length;){let E=ae(i.length+1,s,f,d,r,h,c,l,g,o);ar(i,u,E),i.push(E),s=s+f,c=[],l={};let x=-1;for(;m=a[++x];)Co(r,l,m),B(m)<s+f&&a.splice(x--,1)}for(;s<p-f;){let E=ae(i.length+1,s,f,d,r,h,c,l,g,o);ar(i,u,E),i.push(E),s=s+f,c=[],l={}}f||(f=n.length?B(n[n.length-1]):1);let y=ae(i.length+1,s,f,d,r,h,c,l,g,o);return ar(i,u,y),i.push(y),i}var Bo=Symbol("scribe-id"),ap={},$o=0;function ct(t){for(;t.event;)t=t.event;return t[Bo]?t[Bo]:(t[Bo]=++$o,ap[$o]=t,$o)}var ut=1.1;function cp(t){return parseFloat(t.dataset.beat)}function up(t){return parseFloat(t.dataset.duration)}function pp(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function Bi(t,e,r,o,n){let i=r[0],a=r.length===1?o%(n*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],u=r.length===1?o%(n*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[r[r.length-1]];return`M${a}, ${-t*a-.5*ut}
        L${u},${-t*u-.5*ut}
        L${u},${-t*u+.5*ut}
        L${a}, ${-t*a+.5*ut}
        Z`}function Mo(t,e,r,o,n,i,a){if(a<.0833)return;let u=n-1,s;for(;r[++u];)r[u]<=a?s?s.push(u):s=[u]:s&&(t.appendChild(v("path",{class:`beam-path-${4/a} beam-path`,d:Bi(i,o,s,e[u-1],a)})),Mo(t,e,r,o,s[0],i,a/2),s=void 0);s&&(t.appendChild(v("path",{class:`beam-path-${4/a} beam-path`,d:Bi(i,o,s,e[u-1],a)})),Mo(t,e,r,o,s[0],i,a/2),s=void 0)}function $i(t){let e=t.dataset.beam,r=t.parentElement,o=Array.from(r.querySelectorAll('.top-note[data-beam="'+e+'"]')),n=o.map(cp),i=o.map(up),a=t.viewBox.baseVal,u=a.y<-.5?a.y+.5:a.height-1,s=o.map(gt),c=s[0].x,l=s[s.length-1].x,h=s.map(p=>(p.x-c)/(l-c));pp(t),Mo(t,n,i,h,0,-u,.25)}var lp=/â™®|(bb|ğ„«)|(##|ğ„ª)|(b|â™­)|(#|â™¯)|(âˆ†)|(-)|(Ã¸)|(Â°)|(\+)|(\d+)/g,hp={0:`<span class="glyph glyph-natural">${$t}</span>`,1:`<span class="glyph glyph-doubleflat">${Jt}</span>`,2:`<span class="glyph glyph-doublesharp">${te}</span>`,3:`<span class="glyph glyph-flat">${Qt}</span>`,4:`<span class="glyph glyph-sharp">${_t}</span>`,5:'<span class="glyph glyph-major">âˆ†</span>',6:'<span class="glyph glyph-minor">-</span>',7:'<span class="glyph glyph-halfdim">Ã¸</span>',8:'<span class="glyph glyph-dim">Â°</span>',9:'<span class="glyph glyph-aug">+</span>'};function fp(){let t=arguments.length-2;if(arguments[--t])return`<span class="glyph glyph-number">${arguments[t]}</span>`;for(;t--;)if(arguments[t])return hp[t];return""}function ce(t){return t.replace(lp,fp)}function $(t,e){return e.toFixed(t).replace(/\.?0+$/,"")}var cr=Math.abs,mp={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},dp={2:te,1:_t,0:$t,"-1":Qt,"-2":Jt},gp={treble:Kt,"treble-down":Vt,"treble-up":Xt,alto:Yt,bass:Zt,drum:Ie,percussion:Ie},wp={"1.33":ao,"0.67":so,"0.33":io,"0.17":no,"0.08":oo},xp=/^([A-G][â™­â™¯]?)([âˆ†\-Ã¸+Â°â™­â™¯\d]*)([a-zA-Z]*)([â™­â™¯]?\d+)?(?:\/([A-G][â™­â™¯]?))?$/;function yp(t){let e=-1,r="";for(;t[++e];)r+=(r?" ":"")+ct(t[e].event);return r}function Ep(t,e,r,o,n,i){return ce(e)+(r||o||n?'<span class="chord-ext">'+(r?ce(r):"")+(o?"<sub>"+o+"</sub>":"")+(n?ce(n):"")+"</span>":"")+(i?'<span class="glyph glyph-slash">'+uo+'</span><span class="chord-bass">'+ce(i)+"</span>":"")}var Go=N(tt("type"),{barrepeat:t=>v("span",{class:"barrepeat",html:G["barRepeat"+t.count],data:{beat:0,duration:t.duration}}),clef:t=>v("span",{class:`${t.clef}-clef clef`,html:gp[t.clef]}),chord:t=>v("abbr",{class:"chord chord-abbr",title:"",html:t.name.replace(xp,Ep),data:{beat:$(4,t.beat),duration:$(4,t.duration),event:ct(t.event)}}),timesig:t=>t.stave.getTimeSigHTML?v("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,ct(t.event))):v("span",{class:"timesig",html:`<sup>${G["timeSig"+t.numerator]}</sup>
                <sub>${G["timeSig"+t.denominator]}</sub>`,data:{event:ct(t.event)}}),symbolcoda:t=>v("p",{html:co,class:"coda"}),barcount:t=>v("span",{html:t.text,class:"barcount"}),text:t=>v("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:$(4,t.beat),duration:$(4,t.duration),event:ct(t.event)}}),acci:t=>v("span",{class:(mp[t.value]||"acci")+(t.clump?" acci-"+t.clump:"")+(t.cluster?" acci-cluster":""),html:dp[t.value]||$t,data:{beat:t.beat&&$(4,t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&ct(t.event)}}),accent:t=>{let e=t.dynamic>=P.marcatoThreshold,r=t.stave.type==="drum"||t.stave.type==="percussion";return v("span",{class:`${t.stemup?"up":"down"}-accent accent${e?" marcato-accent":""}`,html:r?e?t.stemup?je:We:t.stemup?He:ze:e?t.stemup?We:je:t.stemup?ze:He,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name,event:ct(t.event)}})},ledge:t=>v("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${cr(t.rows)}`:`0 -0.5 5 ${cr(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>v("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${R(t.pitch)})`,data:{beat:$(4,t.beat),duration:$(4,t.duration),pitch:t.pitch,part:t.part.name,beam:t.beam&&t.beam.id,event:ct(t.event)}}),beam:(t,e)=>v("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${cr(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${$(4,t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(cr(t.range)+ut)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*ut} L1,${t.range-.5*ut} L1,${t.range+.5*ut} L0,${.5*ut} Z"></path>`,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name,beam:t.id,events:yp(t)}}),tie:t=>v("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name,event:ct(t.event)}}),tuplet:t=>v("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:G["tuplet"+t.divisor],data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>v("span",{class:"rest",html:wp[t.duration.toFixed(2)]||G["rest"+(t.duration+"").replace(".","")]||"",data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});var Mi=globalThis||window,ue={pink:"#FE267E",grey:"#81868f"},bp=Mi.DEBUG&&Mi.DEBUG.scribe!==!1?function(e,r,o="",n=""){console.log("%cScribe %c"+e+" %c"+r+" %c"+o+" %c"+n,"color: "+ue.pink+"; font-weight: 300;","color: "+ue.grey+"; font-weight: 300;","color: "+ue.pink+"; font-weight: 300;","color: "+ue.grey+"; font-weight: 300;","color: "+ue.pink+"; font-weight: 300;")}:U,Gi=bp;var vp=globalThis||window;function Rp(t){return t[0]<=0&&t[1]==="meter"}function Sp(t){return t[0]<=0&&t[1]==="key"}function Ap(t,e){let r=Go(e);return r&&t.push(r),t}function Np(t,e){return t.push(v("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:Tt(e.key),stave:e.stave.type},children:e.symbols.reduce(Ap,[])})),t}function Oi(t,e,r,o,n,i=1/0,a=0,u=0,s=P){let c=t.events;!c.find(Rp)&&n&&c.unshift([0,"meter",n[2],n[3]]),!c.find(Sp)&&o&&c.unshift([0,"key",o]);let p=Qe[r||"treble"],f=[];a&&f.push("transpose",a),u&&f.push("displace",u);let d=new Et(c,t.sequences,f),m=ko(d,e,p,s),g=m.reduce(Np,[]),y=m[0],E=st(y.key),x=p.createSignatureSymbols(E),O=v("div",{class:`${p.type}-stave signature-stave stave`,children:x.map(Go),data:{key:Tt(E)}}),T=v("div",{id:"side",class:"side",data:{key:Tt(E)}}),C=24;for(;C--;)T.appendChild(O.cloneNode(!0));return g.unshift(T),g}var Ut=[v("span",{html:to,style:"width: min-content;"}),v("span",{html:eo,style:"width: min-content;"}),v("span",{html:ro,style:"width: min-content;"})];function Dp(t){t.remove()}function ur(t,e=t){e.append.apply(e,Ut);let r=gt(Ut[0]).width,o=gt(Ut[1]).width,n=gt(Ut[2]).width,i=window.getComputedStyle(Ut[0]),a=ai(i.fontSize);vp.DEBUG&&Gi("post render font-size",a,"heads",`${r}, ${o}, ${n}`),Ut.forEach(Dp);let u=e.querySelector(".side");if(!u)return;let s=u.dataset.key,l={"Gâ™­":6,"Câ™¯":5,"Dâ™­":5,"Gâ™¯":4,"Aâ™­":4,"Dâ™¯":3,"Eâ™­":3,"Bâ™­":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6}[s];return`--head-1-size: ${$(6,r/a)}; --head-2-size: ${$(6,o/a)}; --head-4-size: ${$(6,n/a)}; --signature-width: ${(2.25+l*.625+.625).toFixed(4)}em;`}function pe(t,e=t){e.querySelectorAll(".beam").forEach($i)}var Ui=Object.assign,Fp=Object.defineProperties,Tp=new URL("shadow.css",import.meta.url),pr=A.of(),Li=new ResizeObserver(t=>{for(let e of t)pe(b(e.target).shadowRoot)}),D0=Fp(Sr("scribe-music",{shadow:`
        <link rel="stylesheet" href="${Tp}" />
    `,construct:function(t,e){let r=t.querySelector("link");pr.value&&(r.href=pr.value),e.data=A.of(),e.clef=A.of("treble"),e.key=A.of("C"),e.meter=A.of(),e.beat=A.of(0),e.duration=A.of(1/0),e.transpose=A.of(0),e.excludes=A.of([]),e.swingAsStraight8ths=A.of(!1),e.swingAsStraight16ths=A.of(!1),e.debug=A.of(!1),e.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(t,e){if(e.isSafari&&this.classList.add("safari"),Li.observe(this,{box:"content-box"}),!this.src){let r=this.textContent.trim();e.data.value=bt(this.type,r)}return A.frame(()=>{if(!e.data.value)return;let r=e.data.value&&Oi(Z.from(e.data.value),e.excludes.value,e.clef.value,e.key.value,e.meter.value,e.duration.value,e.transpose.value,e.beat.value,Ui({},P,{swingAsStraight8ths:e.swingAsStraight8ths.value,swingAsStraight16ths:e.swingAsStraight16ths.value}));if(t.querySelectorAll(".side, .bar, style").forEach(n=>n.remove()),t.append.apply(t,r),!r)return;let o=e.style=v("style",`:host { ${ur(this,t)} }`);t.appendChild(o),pe(this,t),setTimeout(()=>{o.textContent=`:host { ${ur(this,t)} }`,pe(this,t)},2e3)})},load:function(t,{style:e}){e.textContent=`:host { ${ur(this,t)} }`,pe(this,t)},disconnect:function(){Li.unobserve(this)}},{clef:{attribute:function(t){this.clef=t},get:function(){return b(this).clef.value},set:function(t){if(!Qe[t]){console.warn('<scribe-music> Attempt to set invalid clef="'+t+'" ignored');return}b(this).clef.value=t}},key:{attribute:function(t){this.key=t===""?"C":t},get:function(){return b(this).key.value},set:function(t){let e=b(this);if(typeof t!="string"||!/^[A-G][#bâ™¯â™­]?$/.test(t)){console.warn('<scribe-music> Attempt to set invalid key="'+t+'" ignored');return}e.key.value=t.replace(/[#b]$/,r=>r==="#"?"â™¯":"â™­")}},meter:{attribute:function(t){this.meter=t===""?"4/4":t},get:function(){return Vn(b(this).meter.value)},set:function(t){b(this).meter.value=Ui([0],Kn(t))}},beat:{attribute:function(t){this.beat=t},get:function(){return b(this).beat.value},set:function(t){b(this).beat.value=typeof t=="number"?t:parseFloat(t)}},duration:{attribute:function(t){this.duration=t},get:function(){return b(this).duration.value},set:function(t){b(this).duration.value=typeof t=="number"?t:parseFloat(t)}},transpose:{attribute:function(t){this.transpose=t},get:function(){return b(this).transpose.value},set:function(t){b(this).transpose.value=typeof t=="number"?Math.round(t):parseInt(t,10)}},type:{attribute:function(t){this.type=t},writable:!0,value:"application/json"},src:{attribute:function(t){this.src=t},get:function(){return b(this).src},set:function(t){let e=b(this);e.src=t;let r=new URL(t,window.location);if(window.location.origin===r.origin&&window.location.pathname===r.pathname){let o=this.getRootNode().getElementById(r.hash.slice(1));if(!o)throw new Error('<scribe-music> src script "'+t+'" not found in document');this.data=JSON.parse(o.textContent)}else Wn(this.type,r.href).then(o=>this.data=o)},default:null},data:{get:function(){return b(this).data.value},set:function(t){b(this).data.value=t},default:null},swing:{attribute:function(t){b(this).swingAsStraight8ths.value=t!==null}},shuffle:{attribute:function(t){b(this).swingAsStraight16ths.value=t!==null}},debug:{attribute:function(t){this.debug=t!==null},get:function(){return b(this).debug.value},set:function(t){b(this).debug.value=!!t}},excludes:{attribute:function(t){return b(this).excludes.value=t.split(/\s+/)}}},"stephband.band/scribe/"),{stylesheet:{set:t=>pr.value=t,get:()=>pr.value}});export{D0 as default};
//# sourceMappingURL=element.js.map
