/* Scribe 
   0.4.36
   By stephband */

var Ii=Object.defineProperty;var Hi=(t,e)=>{for(var r in e)Ii(t,r,{get:e[r],enumerable:!0})};var q,mt;function zi(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function mr(t){let e=0;for(;t[--e];)t[e].stop&&t[e].stop(),t[e]=void 0}function Lt(t,e){let r=0;for(;e[--r]&&e[r]!==t;);for(e[r]=t,r=-1;t[++r]&&t[r]!==e;);t[r]=e}function St(t){let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.invalidate(t)}function dr(t,e){let r=0;for(;t[--r];)if(t[r]===e)return!0}var A=class t{static isSignal(e){return e instanceof t}static of(e){return new ur(e)}static from(e,r){if(e.then){let o=t.of();return e.then(n=>o.value=n),o}return e.pipe?e.pipe(new pr):new pe(e,r)}static compute(e,r){return new pe(e,r)}static fromProperty(e,r){return new lr(e,r)}static frame(e){return new fe(e)}static tick(e){return new he(e)}static temporal(e,r){return new hr(e,r)}static evaluate(e,r,o=e){let n=q;q=e,n||(mt=!1);let i=r.apply(o);return q=n,i}static get hasInvalidDependency(){return mt}static get evaluating(){return q}constructor(e){e&&(this.name=e)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},ur=class extends A{#t;constructor(e){super(),this.#t=e}get value(){return q&&Lt(this,q),this.#t}set value(e){this.#t!==e&&(this.#t=e,St(this))}},pr=class extends A{#t;constructor(e){super(),this.#t=e}get value(){return q&&Lt(this,q),this.#t}push(e){this.#t!==e&&(this.#t=e,St(this))}},lr=class extends A{#t;#e;constructor(e,r){super(e),this.object=r}evaluate(){return this.object[this.name]}get value(){return q&&Lt(this,q),this.#t?this.#e:(this.#e=A.evaluate(this,this.evaluate,this),mt||(this.#t=!0),this.#e)}set value(e){if(this.#e===e)return;let{object:r,name:o}=this;r[o]=e,e=r[o],this.#e!==e&&(this.#e=e,St(this))}invalidate(e){this.#t&&(e&&!dr(this,e)||(this.#t=!1,mr(this),St(this)))}},pe=class extends A{#t;#e;#r;#o;constructor(e,r){super(),this.#t=e,this.#e=r}get value(){return q&&Lt(this,q),this.#r?this.#o:(this.#o=A.evaluate(this,this.#t,this.#e),mt||(this.#r=!0),this.#o)}invalidate(e){this.#r&&(e&&!dr(this,e)||(this.#r=!1,mr(this),St(this)))}},hr=class extends A{#t=0;constructor(e,r){super(e),this.object=r}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return A.evaluating&&(Lt(this,q),this.getTime()<this.#t&&(mt=!0)),this.evaluate()}set value(e){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==e&&(this.object[this.name]=e,invalidateUntil(this.getTime()))}invalidateUntil(e){let o=this.getTime()>=this.#t;this.#t=e,o&&St(this)}},le=class extends A{constructor(e){if(super(),q){let r=0;for(;q[--r]&&q[r]!==this;);q[r]=this}e&&(this.evaluate=e,(A.evaluate(this,this.evaluate)||mt)&&this.cue())}invalidate(e){this.constructor.observers.indexOf(this)===-1&&(e&&!dr(this,e)||(mr(this),this.cue()))}stop(){let e=0,r;for(;r=this[--e];){let i=-1;this[e]=void 0,r.stop?r.stop():zi(r,this)}let o=this.constructor.observers,n=o.indexOf(this);if(n!==-1){if(o===fr)throw new Error("Attempt to remove observer while observers is rendering");o.splice(n,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},fr;function Oo(t){let e=-1,r;for(fr=t;r=t[++e];)!A.evaluate(r,r.evaluate)&&!mt&&t.splice(e--,1);return fr=void 0,t}var Uo=Promise.resolve();function Lo(){Oo(he.observers).length&&Uo.then(Lo)}var he=class extends le{static observers=[];cue(){let e=this.constructor.observers;e.length||Uo.then(Lo),e.push(this)}};function qo(){Oo(fe.observers).length&&requestAnimationFrame(qo)}var fe=class extends le{static observers=[];cue(){let e=this.constructor.observers;e.length||window.requestAnimationFrame(qo),e.push(this)}};function ji(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function dt(t){return t===window?ji():t.getClientRects()[0]||t.getBoundingClientRect()}function M(t){return t}function D(t,e){return function(){let o=t.apply(this,arguments),n=e[o]||e.default;if(!n)throw new Error('overload() no function defined for key "'+o+'"');return n.apply(this,arguments)}}var Po=globalThis||window,Io;function ht(t){var e=new Map;return function(o){if(Po.DEBUG&&!Io&&o===void 0&&(Io=!0,console.warn("cache() called with undefined. Not illegal, but potentially bad.")),Po.DEBUG&&arguments.length>1&&console.warn("cache() called with "+arguments.length+" arguments. Accepts exactly 1."),e.has(o))return e.get(o);var n=t(o);return e.set(o,n),n}}var Ho=globalThis||window,Wi=Array.prototype;function Vi(t,e){return typeof t=="function"?t.apply(null,e):t}function me(t,e,r){r=r||t.length;var o=r===1?e?t:ht(t):ht(function(n){return me(function(){var i=[n];return i.push.apply(i,arguments),t.apply(null,i)},e,r-1)});return function n(i){return arguments.length===0?n:arguments.length===1?o(i):arguments.length>=r?t.apply(null,arguments):Vi(o(i),Wi.slice.call(arguments,1))}}if(typeof Ho<"u"&&Ho.DEBUG){let t=me,e=function(){var o=function(){};try{Object.defineProperty(o,"length",{value:2})}catch{return!1}return o.length===2}(),r=function(n,i,s,u){return u.toString=function(){return/function\s*[\w\d]*\s*\([,\w\d\s]*\)/.exec(s.toString())+" { ["+n+"] }"},e&&Object.defineProperty(u,"length",{value:i}),u};me=function(n,i,s){return s=s||n.length,r("curried",s,n,t(n,i,s))}}var Z=me;function L(){}var Xi=D(M,{is:L,tag:L,data:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},dataset:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},html:function(t,e,r){e.innerHTML=r},text:function(t,e,r){e.textContent=r},style:D((t,e,r)=>typeof r,{string:(t,e,r)=>e.style=r,object:(t,e,r)=>Object.assign(e.style,r)}),children:function(t,e,r){e.innerHTML="",e.append.apply(e,r)},href:function(t,e,r){e instanceof SVGElement?e.setAttribute("href",r):e.href=r},points:_,cx:_,cy:_,r:_,x:_,y:_,dx:_,dy:_,transform:_,preserveAspectRatio:_,viewBox:_,default:function(t,e,r){t in e?e[t]=r:e.setAttribute(t,r)}});function _(t,e,r){e.setAttribute(t,r)}function Ki(t,e){for(var r=Object.keys(e),o=r.length;o--;)e[r[o]]!==void 0&&Xi(r[o],t,e[r[o]]);return t}var de=Z(Ki,!0);var gr="http://www.w3.org/2000/svg",zo=document.createElement("template"),wr=(t,e)=>e&&typeof e;function jo(t,e=""){let r=document.createRange();return r.selectNode(t),r.createContextualFragment(e)}var z=D(wr,{string:function(t,e){let r=document.createElementNS(gr,t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElementNS(gr,t);return typeof e.length=="number"?r.append.apply(r,e):de(r,e),r},default:t=>document.createElementNS(gr,t)}),Yi=D(wr,{string:function(t,e){let r=document.createElement(t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElement(t);return typeof e.length=="number"?r.append.apply(r,e):de(r,e),r},default:t=>document.createElement(t)}),Zi=D(M,{comment:function(t,e){return document.createComment(e||"")},fragment:D(wr,{string:function(t,e,r){return r?jo(r,e):(zo.innerHTML=e,zo.content.cloneNode(!0))},object:function(t,e,r){let o=r?jo(r):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):de(o,e),o},default:()=>document.createDocumentFragment()}),circle:z,ellipse:z,g:z,glyph:z,image:z,line:z,rect:z,use:z,path:z,pattern:z,polygon:z,polyline:z,svg:z,tspan:z,text:z,default:Yi}),v=Zi;function xr(t,e,r){let o;typeof r!="string"&&r.input!==void 0&&r.index!==void 0&&(o=r,r=o.input.slice(r.index+r[0].length+(r.consumed||0)));let n=t.exec(r);if(!n)return;let i=e(n);return o&&(o.consumed=(o.consumed||0)+n.index+n[0].length+(n.consumed||0)),i}var _p=Z(xr,!0);function Ji(t,e,r){throw r.input!==void 0&&r.index!==void 0&&(r=r.input),new Error('Cannot parse string "'+(r.length>128?r.length.slice(0,128)+"â€¦":r)+'"')}function Qi(t,e,r){let o=-1;for(;++o<r.length;)e=r[o]!==void 0&&t[o]?t[o](e,r):e;return t.done?t.done(e,r):t.close?t.close(e,r):e}function _i(t,e,r,o){let n=xr(t,i=>Qi(e,r,i),o);return n===void 0?e.catch?e.catch(r,o):Ji(t,e,o):n}var Wo=Z(_i,!0);var Vo=Symbol("internals");function yr(t,e,r){return e[Vo]=e.attachInternals&&!e.getAttribute("is")?e.attachInternals():{shadowRoot:r}}function y(t){return t[Vo]}var Xo=Object.defineProperties;var Er={},ts={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return y(this).form}},labels:{get:function(){return y(this).labels}},validity:{get:function(){return y(this).validity}},validationMessage:{get:function(){return y(this).validationMessage}},willValidate:{get:function(){return y(this).willValidate}},checkValidity:{value:function(){return y(this).checkValidity()}},reportValidity:{value:function(){return y(this).reportValidity()}}},br=!1,es=Wo(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() â€“ name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null),Ko={once:!0};function rs(t){return t.sheet?Promise.resolve({target:t}):new Promise((e,r)=>{t.addEventListener("load",e,Ko),t.addEventListener("error",r,Ko)})}function os(t){t.stop()}function ns(t){if(Er[t])return Er[t];let e=document.createElement(t).constructor;if(e===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+t+"> is HTMLUnknownElement");return Er[t]=e}function is(t,e){if(t.hasOwnProperty(e)){let r=t[e];delete t[e],t[e]=r}return t}function Yo(t,e){let r=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(e.stylesheet){let o=v("link",{rel:"stylesheet",href:e.stylesheet});r.append(o)}return r}function ss(t,e){return typeof e=="string"?e[0]==="#"?t.appendChild(document.getElementById(e.slice(1)).content.clone(!0)):t.innerHTML=e:t.appendChild(e.content.clone(!0)),t}function as(t){let e=t.isUpgraded;return t.isUpgraded=!0,!e}function Zo(t,e){return Array.from(t.querySelectorAll('[is="'+e+'"]')).filter(as)}var cs=D((t,e)=>typeof e,{object:(t,e)=>e,function:(t,e)=>({value:e}),default:(t,e)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof e)}});function vr(t,e={},r={},o=""){let{name:n,tag:i}=es(t),s=typeof i=="string"?ns(i):HTMLElement,u=[],a={},c,l;for(c in r)l=cs(c,r[c]),l.attribute&&u.push(c),(l.set||l.get||"value"in l)&&(a[c]=l),r[c]=l;function h(){let p=Reflect.construct(s,arguments,h),m=e.mode||typeof e.shadow=="string"?Yo(p,e):void 0;e.shadow&&ss(m,e.shadow);let d=yr(h,p,m);return i&&(br=!0),e.construct&&e.construct.call(p,m,d),Object.keys(a).reduce(is,p),p}if(h.prototype=Object.create(s.prototype,a),r.value&&(h.formAssociated=!0,Xo(h.prototype,ts),(e.enable||e.disable)&&(h.prototype.formDisabledCallback=function(p){let m=y(this);return p?e.disable&&e.disable.call(this,m.shadowRoot,m):e.enable&&e.enable.call(this,m.shadowRoot,m)}),e.reset&&(h.prototype.formResetCallback=function(){let p=y(this);return e.reset.call(this,p.shadowRoot,p)}),e.restore&&(h.prototype.formStateRestoreCallback=function(){let p=y(this);return e.restore.call(this,p.shadowRoot,p)})),u.length&&(h.observedAttributes=u,h.prototype.attributeChangedCallback=function(p,m,d){return r[p].attribute.call(this,d)}),e.connect&&(h.prototype.connectedCallback=function(){let p=y(this),m=p.shadowRoot;if(p.stopable=e.connect.call(this,m,p),!m)return;let d=m.querySelectorAll('link[rel="stylesheet"]');if(d.length){let f=v("style","*:not(slot), slot:not([name]) { display: none !important; }");m.prepend(f);let g;p.loadPromise?g=p.loadPromise.then(()=>new Promise(requestAnimationFrame)):g=p.loadPromise=Promise.all(Array.from(d,rs)),g.finally(()=>{f.remove(),e.load&&e.load.call(this,m,p)})}else e.load&&e.load.call(this,m,p)}),h.prototype.disconnectedCallback=function(){let p=y(this);p.stopable&&(p.stopable.stop?p.stopable.stop():p.stopable.forEach(os)),e.disconnect&&e.disconnect.call(this,p.shadowRoot,p)},window.console&&window.console.log("%c<"+(i?i+" is="+n:n)+">%c "+o,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(n,h,i&&{extends:i}),i&&!br){let p=document.createElement("div");if(p.style.position="fixed",p.style.left="-1000px",p.style.top="-1000px",p.innerHTML="<"+i+' is="'+n+'"></'+i+">",document.body.append(p),p.remove(),br)h.polyfillByRoot=L;else{let m=function(f){let g={};Object.keys(a).forEach(B=>{f[B]!==void 0&&(g[B]=f[B])}),Xo(f,a);let x=e.mode||e.shadow?Yo(f,e):void 0,E=yr(h,f,x);e.construct&&e.construct.call(f,x,E),Object.assign(f,g);let b=-1,U;for(;U=u[++b];){let B=f.attributes[U];B&&r[U].attribute.call(f,B.value)}e.connect&&e.connect.call(f,x,E)},d=function(f){Zo(f,n).forEach(m),new MutationObserver(()=>Zo(f,n).forEach(m)).observe(f,{childList:!0,subtree:!0})};h.polyfillByRoot=d,d(document)}}else h.polyfillByRoot=L;return h}var At=t=>typeof t;var us=Object.defineProperties,Jo=D(At,{function:t=>t(),object:t=>t.stop()}),gt=class extends M{#t;stop(){if(this.status==="done")return this;this.status="done";let e=this.#t;return this.#t=void 0,e&&e.forEach(Jo),this}done(e){return this.status==="done"?(Jo(listener),this):((this.#t||(this.#t=[])).push(e),this)}};us(gt.prototype,{status:{writable:!0}});function ps(t){throw new TypeError("Stream cannot be created .from() "+typeof t)}function j(t,e){if(e===void 0)return;let r=-1;for(;t[++r];)t[r].push(e);return t}function ls(t){gt.prototype.stop.apply(t);let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.stop&&(kr(r,t),r[-1]||r.stop());return t}function kr(t,e){let r=0;for(;t[--r]&&t[r]!==e;);for(;t[r--];)t[r+1]=t[r]}function Qo(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function hs(t,e){kr(e,t),Qo(t,e)}var qt=class extends gt{stop(){if(this.status==="done")return this;let e;for(;e=this[-1];){let r=-1;for(;this[r--];)this[r+1]=this[r];Qo(e,this),e.stop&&!e[0]&&e.stop(e)}return super.stop()}},ge=class extends qt{constructor(e){super(),this.push=e}},we=class extends qt{constructor(e,r){super(),this.fn=e,this.value=r,this.i=0}push(e){let r=this.fn;this.value=r(this.value,e,this.i++,this)}},H=class extends qt{start(){if(this.status)return this;let e=0,r;t:for(;r=this[--e];){let o=-1;for(;r[++o];)if(r[o]===this)continue t;r[o]=this,o===0&&r.start&&r.start()}return this}stop(){if(this.status==="done")return this;super.stop();let e=-1,r;for(;r=this[++e];)this[e]=void 0,r.stop&&(kr(r,this),r[-1]||r.stop());return this}pipe(e){if(e.stop){let o=0;for(;e[--o]&&e[o]!==this;);e[o]=this}if(e.start&&!(e[0]||e.status==="running"))return e;let r=-1;for(;this[++r]&&this[r]!==e;);return this[r]=e,r||this.start(),e}each(e){return this.pipe(new ge(e))}buffer(...e){return this.pipe(new Dt(e))}filter(e){return this.pipe(new Sr(e))}flatMap(e){return this.pipe(new Ar(e))}map(e){return this.pipe(new ye(e))}reduce(e,r){return this.pipe(new we(e,r)).value}scan(e,r){return this.pipe(new Nr(e,r))}slice(e,r){return this.pipe(new Fr(e,r))}split(e){return this.pipe(new Br(e))}[Symbol.asyncIterator]=async function*(){let e=[],r=n=>e.push(n);function o(n,i){r=n}for(this.each(n=>r(n)).done(()=>r=L);r!==L;)yield e.length?e.shift():await new Promise(o)};static from=D(At,{function:e=>new ye(e),object:e=>typeof e.pipe=="function"?e:typeof e.then=="function"?new Rr(e):typeof e.length=="number"?new Dt(Array.from(e)):ps(e)});static of(...e){return e.length<2?new xe(e[0]):new Dt(e)}static buffer(e){return new Dt(e)}static value(e){return new xe(e)}static merge(...e){return new Dr(e)}static push=j;static stop=ls;static unpipe=hs;static each(e){return new ge(e)}static reduce(e,r){return new we(e,r)}},Rr=class extends H{constructor(e){super(),this.promise=e}start(){return this.promise.then(e=>j(this,e)).finally(()=>this.stop()),this}},xe=class extends H{constructor(e){super(),this.value=e}start(){return this.value!==void 0&&(j(this,this.value),this.status==="done")?this:super.start()}push(e){return this.value=e,j(this,e)}},Dt=class extends H{constructor(e){super(),this.values=e||[]}start(){let e=this.values;if(!e)return super.start();let r=-1;for(;r++<e.length;)if(j(this,e[r]),this.status==="done")return this;return this.values=void 0,super.start()}push(e){return this.value=e,this.values?this.values.push(this.value):j(this,this.value)}},Sr=class extends H{constructor(e){super(),this.fn=e}push(e){let r=this.fn;return r(e)&&j(this,e)}},Ar=class extends H{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);if(o!==void 0)if(isIterable(o))for(let n of o)j(this,n);else o.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(o.each(n=>j(this,n)))):o.then&&o.then(n=>j(this,n))}},ye=class extends H{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);return o!==void 0&&j(this,o)}},Dr=class extends H{constructor(e){super(),this.inputs=e}push(e){return j(this,e)}pipe(e){let r=-1,o;for(;o=this.inputs[++r];)H.from(o).pipe(this);return H.prototype.pipe.call(this,e)}},Nr=class extends H{constructor(e,r){super(),this.fn=e,this.value=r}push(e){let r=this.fn;this.value=r(this.value,e),j(this,this.value)}},Fr=class extends H{constructor(e,r=1/0){super(),this.index=-e,this.indexEnd=r-e}push(e){++this.index>0&&j(this,e),this.index===this.indexEnd&&this.stop()}},Br=class extends H{constructor(e){super(),this.chunk=[],typeof e=="number"?this.n=e:this.fn=e}fn(){return this.chunk.length===this.n}push(e){let r=this.chunk;this.fn(e)?(j(this,r),this.chunk=[]):r.push(e)}};var Nl={fullscreenchange:ht(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},fs=0;window.addEventListener("click",t=>fs=t.timeStamp);function Cr(t){return function(){return arguments[t]}}function Tr(t){return t}function wt(){}function tt(){return this}var _o=Object.create,ms=Object.freeze,tn=ms(_o(_o(Object.prototype,{at:{value:wt},shift:{value:wt},push:{value:wt},forEach:{value:wt},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:tt},find:{value:wt},findIndex:{value:function(){return-1}},flat:{value:tt},flatMap:{value:tt},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:tt},reduce:{value:Cr(1)},sort:{value:tt},each:{value:tt},pipe:{value:Tr},start:{value:tt},stop:{value:tt},done:{value:tt},valueOf:{value:function(){return null}}}),{length:{value:0}}));function $r(t,e){return(e%t+t)%t}function Ee(t){if(typeof t=="number"&&(t=t+""),typeof t=="string")return t.trim().toLowerCase().normalize("NFKC").replace(/[\/\?#\[\]@!$&'()*+,;=\\\s\._]+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var en=t=>$r(12,t);var ds=/^([A-G][â™­â™¯#b]?)(-?\d)$/,gs=/^[A-G][â™­â™¯#b]?/,ws=/-?\d$/,xs=/[Hh]z$/,Pt={C:0,"Câ™¯":1,"C#":1,"Dâ™­":1,Db:1,D:2,"Dâ™¯":3,"D#":3,"Eâ™­":3,Eb:3,E:4,F:5,"Fâ™¯":6,"F#":6,"Gâ™­":6,Gb:6,G:7,"Gâ™¯":8,"G#":8,"Aâ™­":8,Ab:8,A:9,"Aâ™¯":10,"A#":10,"Bâ™­":10,Bb:10,B:11},Mr={27:"High Q",28:"Slap",29:"Scratch push",30:"Scratch pull",31:"Sticks",32:"Square click",33:"Metronome click",34:"Metronome bell",35:"Low bass drum",36:"High bass drum",37:"Side stick",38:"Snare drum 1",39:"Hand clap",40:"Snare drum 2",41:"Low floor tom",42:"Closed hi-hat",43:"High floor tom",44:"Pedal hi-hat",45:"Low tom",46:"Open hi-hat",47:"Low mid tom",48:"High mid tom",49:"Crash cymbal 1",50:"High tom",51:"Ride cymbal 1",52:"Chinese cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash cymbal",56:"Cowbell",57:"Crash cymbal 2",58:"Vibra Slap",59:"Ride cymbal 2",60:"High bongo",61:"Low bongo",62:"Mute high conga",63:"Open high conga",64:"Low conga",65:"High timbale",66:"Low timbale",67:"High agogo",68:"Low agogo",69:"Cabasa",70:"Maracas",71:"Short whistle",72:"Long whistle",73:"Short guiro",74:"Long guiro",75:"Claves",76:"High wood block",77:"Low wood block",78:"Mute cuica",79:"Open cuica",80:"Mute triangle",81:"Open triangle",82:"Shaker",83:"Jingle bell",84:"Belltree",85:"Castanets",86:"Mute surdo",87:"Open surdo"};for(let t in Mr)Pt[Ee(Mr[t])]=parseInt(t,10);var ys=69;function Es(t,e=440){var r=ys+12*Math.log(t/e)/Math.log(2);return Math.fround(r)}function R(t){if(typeof t=="number")return t;if(xs.test(t))return Es(parseFloat(t));let e=ds.exec(t);return e?(parseInt(e[2],10)+1)*12+Pt[e[1]]:Pt[Ee(t)]}function G(t){return typeof t=="number"?en(t):Pt[gs.exec(t)[0]]}var be=["C","Câ™¯","D","Eâ™­","E","F","Fâ™¯","G","Gâ™¯","A","Bâ™­","B"];function st(t){return X(t)+ve(t)}function X(t){return be[en(t)]}function ve(t){return typeof t=="number"?Math.floor(t/12)-1:Pt[(ws.exec(name)||tn)[0]]}function rn(t){let e=R(t);return Mr[e]||""}function J(t){return Math.pow(10,t/20)}var bs=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function xt(t){return function(r){if(typeof r=="number")return r;var o=bs.exec(r);if(!o){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(r)}if(!t[o[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(parseFloat(o[1]),o[2])}return t[o[2]||""](parseFloat(o[1]))}}var on={fff:J(-4.5),ff:J(-9),f:J(-13.5),mf:J(-18),mp:J(-22.5),p:J(-27),pp:J(-31.5),ppp:J(-36)},ut=xt({"":parseFloat,db:J,dB:J,catch:t=>{if(!on[t])throw new Error('Sequence: dynamic "'+t+'" not recognised');return on[t]}});function pt(t,e){return(e%t+t)%t}function Re(t){return pt(12,t)}var Se=/b{1,2}|#{1,2}/g,vs={b:"â™­","#":"â™¯",bb:"ğ„«","##":"ğ„ª"};function Ae(t){return vs[t]}function Rs(t,[e,r]){return t[r]=e,t}function et(t){return Object.entries(t).reduce(Rs,{})}var W={sequence:1,note:2,param:3,rate:4,key:5,meter:6,chord:7,text:8,start:9,stop:10,clef:11},nn=et(W),Gr={2:16,5:1,6:4,7:18,9:8,10:8,11:1};function sn(t){if(typeof t=="string")return t;if(t in nn)return nn[t];throw new Error(`Type ${t} not recognised`)}var C={step:0,linear:1,exponential:2,target:3,curve:4,hold:5,cancel:6},an=et(C),cn={0:4,1:4,2:4,3:12,5:0,6:0};function Or(t){return typeof t=="number"?an[t]||"step":t}function Ss(t,e){return e[t]}var rt=Z(Ss,!0);var As=globalThis.DEBUG,{floor:ln,log:un}=Math,Nt=36,pn=Nt-1,Ds=ln(un(Number.MAX_SAFE_INTEGER)/un(Nt))+1;function Ur(t){if(t.length<2)return t.length?0:-1;if(t.length>Ds)throw new Error("Cannot generate harmonic id, more than 11 notes "+t);let e=0,r=0,o=1;for(;++r<t.length;){let n=t[r]-t[r-1];if(n<1||n>pn)throw new Error(`Cannot generate harmonic id, interval out of range 1-${pn} `+t);e+=n*o,o*=Nt}return e}function w(){return Ur(arguments)}var Lr=ht(t=>{if(As&&typeof t!="number")throw new Error(`hsidToNumbers() takes number, called with ${typeof t}`);if(t===-1)return Uint8Array.of();if(t===0)return Uint8Array.of(0);let e=2;for(;t>=Nt**(e-1);)++e;let r=new Uint8Array(e);r[0]=0;let o=1;for(;t>0;){let n=t%Nt;r[o]=r[o-1]+n,t=ln(t/Nt),++o}return r});var dh=globalThis.DEBUG,hn=[["",w(0,2,4,7)],["+",w(0,2,4,8)],["sus",w(0,2,5,7)],["susâ™­9",w(0,1,5,7)],["-",w(0,2,3,7)],["Â°",w(0,2,3,6)],["/{4}",w(0,3,8,10)],["/{7}",w(0,5,7,9)],["/{8}",w(0,4,8,11)],["-/{3}",w(0,4,9,11)],["-/{7}",w(0,5,7,8)],["/{11}",w(0,1,5,8)],["/{1}",w(0,3,6,11)],["7/{4}",w(0,3,6,8)],["Ã¸",w(0,3,6,10)],["âˆ†6",w(0,4,7,9)],["âˆ†",w(0,2,4,7,9,11)],["âˆ†6/9",w(0,2,4,7,9)],["âˆ†â™¯11",w(0,2,4,6,7,9,11)],["7sus",w(0,2,5,7,10)],["7",w(0,2,4,7,10)],["7susâ™­9",w(0,1,5,7,10)],["13",w(0,2,4,7,9,10)],["13sus",w(0,2,5,7,9,10)],["-6",w(0,2,3,5,7,9)],["-7",w(0,2,3,5,7,9,10)],["-11",w(0,2,3,5,10)],["7â™¯11",w(0,2,4,6,7,9,10)],["-âˆ†",w(0,2,3,5,7,9,11)],["7â™­13",w(0,2,4,5,7,8,10)],["13susâ™­9",w(0,1,3,5,7,9,10)],["+7",w(0,2,4,6,8,10)],["Â°7",w(0,2,3,5,6,8,9,11)],["7â™¯9",w(0,3,4,6,7,9,10)],["7alt",w(0,1,3,4,6,8,10)],["7â™­9",w(0,1,3,4,6,7,10)],["13â™­9",w(0,1,3,4,6,7,9,10)],["7â™­9â™­13",w(0,1,4,5,7,8,10)],["-â™­6",w(0,2,3,5,7,8,10)],["-â™­9",w(0,1,3,5,7,8,10)],["Ã¸9",w(0,2,3,5,6,8,10)],["âˆ†â™¯4â™¯5",w(0,2,4,6,8,9,11)],["-âˆ†â™­6",w(0,2,3,5,7,8,11)],["âˆ†â™¯5",w(0,2,4,8,11)],["âˆ†â™­6",w(0,2,4,5,7,8,11)]],De=Object.fromEntries(hn),Ns=et(De),Fs=/[()]/g;function qr(t){return typeof t=="string"?De[t.replaceAll(Fs,"").replaceAll(Se,Ae)]:typeof t=="object"?Ur(t):t}function Ne(t){let e=qr(t);return Ns[e]||""}var gh=hn.map(rt(1));var Pr={0:"bank",1:"modulation",2:"breath",4:"foot",5:"portamento",7:"volume",8:"balance",10:"pan",11:"expression",64:"sustain",65:"portamento",66:"sostenuto",67:"soft",68:"legato",69:"hold",71:"harmonics",72:"release",73:"attack",74:"brightness",91:"reverb",92:"tremolo",93:"chorus",94:"detune",95:"phaser",120:"sound-off",121:"reset",122:"local",123:"notes-off",124:"omni-off",125:"omni-on",126:"monophonic",127:"polyphonic"},xh=Object.entries(Pr).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});var Bs=Object.assign,Ir=Bs({},Pr,{3:"mute",6:"gain",9:"angle",12:"distance",13:"azimuth",14:"mix",15:"phase",16:"frequency",17:"Q",18:"depth",19:"cutoff",20:"type",21:"delay",22:"feedback",128:"stop",129:"start",130:"record",131:"pitch",132:"rate",133:"meter",134:"key",135:"touch"}),fn=Object.entries(Ir).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});function mn(t){return typeof t=="number"&&Ir[t]||t}var zr={"Fğ„«":-15,"Cğ„«":-14,"Gğ„«":-13,"Dğ„«":-12,"Ağ„«":-11,"Eğ„«":-10,"Bğ„«":-9,"Fâ™­":-8,"Câ™­":-7,"Gâ™­":-6,"Dâ™­":-5,"Aâ™­":-4,"Eâ™­":-3,"Bâ™­":-2,F:-1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6,"Câ™¯":7,"Gâ™¯":8,"Dâ™¯":9,"Aâ™¯":10,"Eâ™¯":11,"Bâ™¯":12,"Fğ„ª":13,"Cğ„ª":14,"Gğ„ª":15,"Dğ„ª":16,"Ağ„ª":17,"Eğ„ª":18,"Bğ„ª":19},Hr=et(zr);function dn(t){if(typeof t=="number"){if(t in Hr)return Hr[t];throw new Error(`Key ${t} not recognised`)}return Hr[Ft(t)]}function Ft(t){if(typeof t=="number")return t;let e=t.replaceAll(Se,Ae);if(e in zr)return zr[e];throw new Error(`Key "${t}" not recognised`)}function gn(t){let e=Ft(t);return pt(12,e*7)}var P={displace:1,rate:2,gain:3,quantize:4,transpose:5},ks=et(P),wn={1:9,2:5,3:5,4:5,5:2},It={1:1,2:1,3:1,4:1,5:1};function xn(t){return typeof t=="number"&&ks[t]||t}var yn=globalThis.DEBUG,Fe=Object.defineProperty,Be={writable:!0};function Cs(t){let e=[],r=-1;for(;t[++r]!==void 0;)e.push(t[r]);return e}function Bt(t){return t.toFixed(4).replace(/\.?0+$/,"")}function En(t){let e;for(;e=t.event;)t=e;return t}var S=class t{constructor(e,r){switch(this[0]=e,this[1]=sn(r),this[1]){case"chord":this[2]=G(arguments[2]),this[3]=qr(arguments[3]),this[4]=arguments[4]||0,arguments[5]&&(this[5]=arguments[5]||0);break;case"text":this[2]=arguments[2],this[3]=arguments[3];break;case"key":this[2]=Ft(arguments[2]);break;case"note":this[2]=R(arguments[2]),this[3]=ut(arguments[3]),this[4]=arguments[4]||0;break;case"rate":this[2]=arguments[2],this[3]=Or(arguments[3]),(this[3]==="target"||this[3]==="curve")&&(this[4]=arguments[4]||0);break;case"param":this[2]=mn(arguments[2]),this[3]=arguments[3],this[4]=Or(arguments[4]),(this[4]==="target"||this[4]==="curve")&&(this[5]=arguments[5]||0);break;case"sequence":this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4]||0;let o=5;for(;arguments[o]!==void 0;){this[o]=xn(arguments[o]);let n=P[this[o]],i=o+It[n];for(;o++<i;)this[o]=arguments[o]||0}break;case"start":case"stop":this[2]=R(arguments[2]),this[3]=ut(arguments[3]);break;default:this[2]=arguments[2],this[3]=arguments[3]}Fe(this,"event",Be),Fe(this,"events",Be),Fe(this,"index",Be),Fe(this,"target",Be)}move(e){let r=En(this);return r[0]=this[0]=this[0]+e,this}transpose(e){let r=En(this);switch(this[1]){case"chord":case"key":r[2]=this[2]=Re(this[2]+e);break;case"note":case"start":case"stop":r[2]=this[2]=this[2]+e;break;case"sequence":console.log("TODO: transpose sequence");break}return this}*[Symbol.iterator](){let e=-1;for(;this[++e]!==void 0;)yield this[e]}toJSON(){return Cs(this)}toString(){let e=Bt(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+X(this[2])+" "+Ne(this[3])+" "+Bt(this[4]);break;case"key":e+=" "+dn(this[2]);break;case"note":e+=" "+st(this[2])+" "+this[3]+" "+Bt(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+Bt(this[4])+" "+this[5];break;case"rate":e+=" "+Bt(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+Bt(this[4]);break;case"start":case"stop":e+=" "+st(this[2])+" "+this[3];break;default:let r=1;for(;this[++r]!==void 0;)e+=this[r]}return e}static of(...e){return new t(...e)}static from(e,r,o){if(yn&&r!==void 0&&typeof r!="number")throw new Error("Event() cannot create event with index "+r);if(yn&&o!==void 0&&typeof o!="object")throw new Error("Event() cannot create event with events "+o);let n=new t(...e);return n.event=e,n.events=o,n.index=r,n}static isChord=jr;static isNote=ke;static isSequence=Wr};function jr(t){return t[1]==="chord"}function ke(t){return t[1]==="note"}function Wr(t){return t[1]==="sequence"}function Ts(t,e){let r;for(r in t)if(t[r]!==e[r])return!1;return!0}var Ht=Z(Ts,!0);var bn=D((t,e)=>e[1],{note:(t,e)=>(e[2]=R(e[2])+t,e),chord:(t,e)=>(e[2]=G(G(e[2])+t),e[5]!==void 0&&(e[5]=G(G(e[2])+t)),e),key:(t,e)=>(e[2]=G(G(e[2])+t),e),default:M});var $s={displace:(t,e,r)=>(r[0]-=t[++e],e),rate:(t,e,r)=>{switch(r[0]/=t[++e],r[1]){case"chord":case"note":case"sequence":r[4]/=t[e];break;case"text":r[3]/=t[e];break}return e},gain:(t,e,r)=>{switch(++e,r[1]){case"note":r[3]*=ut(t[e]);break}return e},quantize:(t,e,r)=>{},transpose:(t,e,r)=>(bn(t[e+1],r),e+1)};function zt(t,e){let r=-1,o;for(;o=t[++r];)r=$s[o](t,r,e);return e}var vn=Object.assign,Rn=[],Ms={done:!0,value:void 0},Sn={key:2,meter:1,default:0},Gs={};function An(t){return Sn[t[1]]||Sn.default}function Dn(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:An(e)-An(t)}function Nn(t,e){let r=-1;for(;t[++r]&&Dn(t[r],e)<1;);return t.splice(r,0,e),r}function Os(t,e){let r=[],o=t-1;for(;e[++o]!==void 0;)r.push(e[o]);return r}function Us(t,e){return t.find(r=>r.id===e)}var yt=class t{constructor(e,r=Rn,o=Rn){e.sort(Dn),this.events=e,this.sequences=r,this.transforms=o;let n=-1,i;for(;(i=e[++n])&&zt(o,vn(Gs,i))[0]<0;);this.n=n-1}next(){let{events:e,sequences:r,transforms:o,n}=this,i=e[n+1],s=i&&zt(o,S.from(i,n+1,e)),u,a=-1,c=0,l=s?s[0]:1/0,h;for(;u=this[++a];){let p=u.value;p||((p=u.next().value)&&(zt(this.transforms,p),p[0]+=u.startBeat,p.target=(p.target||0)+u.target),(u.done||p[0]>=u.stopBeat)&&++c),p&&p[0]<u.stopBeat&&p[0]<l&&(h=u,l=p[0]),c&&(this[a]=this[a+c])}if(h)return this.value=h.value,h.value=void 0,this;if(!s)return vn(this,Ms);if(this.n+=1,this.value=s,Wr(i)){let p=this.sequences,m=Us(p,i[2]);if(!m)throw new Error('Sequence id "'+i[2]+'" not found');let d=new t(m.events,m.sequences?m.sequences.concat(p):p,Os(5,i));d.startBeat=s[0],d.stopBeat=s[0]+s[4],d.target=s[3];let f=-1;for(;this[++f];);this[f]=d}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};var Ls=Object.assign;var Q=class t{constructor(e,r){this.events=e.map(S.from),r&&(this.sequences=r.map(t.from))}create(){let e=new S(...arguments);return Nn(this.events,e),e}delete(e,r){r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2]));let o=this.events.findIndex(Ht(arguments));return o>-1&&this.events.splice(o,1),this}find(e,r){return r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2])),this.events.find(Ht(arguments))}get(e){return this.sequences&&this.sequences.find(Ht({id:e}))}select(e,r){return this.events.filter(Ht({0:e,1:r}))}static of(...e){return new t(e)}static from(e){let{events:r,sequences:o,...n}=e;return e.length?new t(e):Ls(new t(r,o),n)}[Symbol.iterator](){return new yt(this.events,this.sequences)}};var qs=2,Ps=10,Fn=4,yf=(1<<qs)-1,Is=(1<<Ps)-1,Hs=(1<<Fn)-1;function Ce(t,e,r){return t<<14|e<<4|r}function Bn(t){return t>>14}function kn(t){return t>>Fn&Is}function Te(t){return t&Hs}function Vr(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[],o=0;for(;o<t.length;){let n=e.getFloat64(o,!0);o+=8;let i=e.getUint16(o,!0);o+=2;let s=Bn(i),u=kn(i);switch(s){case 0:switch(u){case W.note:r.push(S.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0),e.getFloat64(o+8,!0))),o+=16;break;case W.meter:r.push(S.of(n,u,e.getFloat16(o,!0),e.getFloat16(o+2,!0))),o+=4;break;case W.chord:r.push(S.of(n,u,t[o],e.getFloat64(o+1,!0),e.getFloat64(o+9,!0),t[o+17])),o+=18;break;case W.key:r.push(S.of(n,u,e.getInt8(o))),o+=1;break;case W.clef:r.push(S.of(n,u,t[o])),o+=1;break;case W.sequence:{let a=e.getUint16(o,!0),c=e.getUint16(o+2,!0),l=e.getFloat64(o+4,!0),h=t[o+12],p=[n,u,a,c,l];o+=13;let m=0;for(;m<h;){let d=t[o+m];switch(m+=1,p.push(d),d){case P.displace:p.push(e.getFloat64(o+m,!0)),m+=8;break;case P.rate:case P.gain:case P.quantize:p.push(e.getFloat32(o+m,!0)),m+=4;break;case P.transpose:p.push(e.getInt8(o+m)),m+=1;break;default:throw new Error(`Unknown transform number: ${d}`)}}r.push(S.from(p)),o+=h;break}case W.text:{let a=e.getFloat64(o,!0),c=t[o+8];o+=9;let l=t.subarray(o,o+c);r.push(S.of(n,u,new TextDecoder().decode(l),a)),o+=c;break}case W.start:case W.stop:r.push(S.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0))),o+=8;break;default:{let a=Te(i);switch(a){case C.step:case C.linear:case C.exponential:r.push(S.of(n,u,e.getFloat32(o,!0),a)),o+=4;break;case C.target:r.push(S.of(n,u,e.getFloat32(o,!0),a,e.getFloat64(o+4,!0))),o+=12;break;case C.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(S.of(n,u,p,a,c));break;default:r.push(S.of(n,u,void 0,a));break}break}}break;case 1:{let a=Te(i);switch(a){case C.step:case C.linear:case C.exponential:r.push(S.of(n,"param",u,e.getFloat32(o,!0),a)),o+=4;break;case C.target:r.push(S.of(n,"param",u,e.getFloat32(o,!0),a,e.getFloat64(o+4,!0))),o+=12;break;case C.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(S.of(n,"param",u,p,a,c));break;default:r.push(S.of(n,"param",u,void 0,a));break}break}default:throw new Error(`Cannot deserialise unknown address ${s}.${u}.${Te(i)}`)}}return r}var Cn=255;function Tn(t,e){if(t.length<=e)return t;let r=e;for(;r>0&&(t[r]&192)===128;)r--;return t.slice(0,r)}function zs(t){let e=t[1],r=W[e],o=10;if(r in Gr)return o+Gr[r];let n;switch(e){case"text":{let i=new TextEncoder().encode(t[2]),s=Tn(i,Cn);return o+8+1+s.length}case"sequence":{for(o+=13,n=4;t[++n]!==void 0;){let i=P[t[n]];o+=wn[i],n+=It[i]}return o}case"param":n=4;case"rate":n===void 0&&(n=3);default:{let i=typeof t[n]=="string"?C[t[n]]||0:t[n]||0;return i===C.curve?o+8+2+t[n-1].length*4:o+cn[i]}}}function js(t){let e=t[1];switch(e){case"param":{let r=typeof t[2]=="string"?fn[t[2]]||0:t[2],o=typeof t[4]=="string"?C[t[4]]||0:t[4];return Ce(1,r,o)}case"rate":{let r=W[e],o=typeof t[3]=="string"?C[t[3]]||0:t[3]||0;return Ce(0,r,o)}default:{let r=W[e];if(r===void 0)throw new Error(`Event type ${e} not recognised`);return Ce(0,r,0)}}}function Xr(t){let e=0;for(let u of t)e+=zs(u);let r=new Uint8Array(e),o=new DataView(r.buffer),n=-1,i,s=0;for(;i=t[++n];){i instanceof S||(i=S.from(i)),o.setFloat64(s,i[0],!0),s+=8;let u=js(i);switch(o.setUint16(s,u,!0),s+=2,i[1]){case"note":o.setFloat32(s,i[2],!0),o.setFloat32(s+4,i[3],!0),o.setFloat64(s+8,i[4],!0),s+=16;break;case"param":case"rate":{let c=i[1]==="rate"?2:3;switch(typeof i[c+1]=="string"?C[i[c+1]]||0:i[c+1]||0){case C.step:case C.linear:case C.exponential:o.setFloat32(s,i[c],!0),s+=4;break;case C.target:o.setFloat32(s,i[c],!0),o.setFloat64(s+4,i[c+2]||0,!0),s+=12;break;case C.curve:o.setFloat64(s,i[c+2]||0,!0),s+=8;let h=i[c],p=h.length*4;o.setUint16(s,p,!0),s+=2;let m=-1;for(;h[++m]!==void 0;)o.setFloat32(s+m*4,h[m],!0);s+=p;break}break}case"meter":o.setFloat16(s,i[2],!0),o.setFloat16(s+2,i[3],!0),s+=4;break;case"chord":{let c=typeof i[2]=="number"?i[2]:0;r[s]=c;let l=typeof i[3]=="string"?De[i[3]]||0:i[3];o.setFloat64(s+1,l,!0),o.setFloat64(s+9,i[4],!0);let h=typeof i[5]=="number"?i[5]:0;r[s+17]=h,s+=18;break}case"key":{o.setInt8(s,Ft(i[2])),s+=1;break}case"sequence":{o.setUint16(s,i[2],!0),o.setUint16(s+2,i[3],!0),o.setFloat64(s+4,i[4],!0),s+=12;let c=s;s+=1;let l=4;for(;i[++l]!==void 0;){let h=i[l],p=typeof h=="string"?P[h]:h;if(p===void 0)throw new Error(`Transform name "${h}" not recognised`);switch(r[s]=p,s+=1,p){case P.displace:o.setFloat64(s,i[l+1],!0),s+=8;break;case P.rate:case P.gain:case P.quantize:o.setFloat32(s,i[l+1],!0),s+=4;break;case P.transpose:o.setInt8(s,i[l+1]),s+=1;break;default:throw new Error(`Transform number ${p} not recognised`)}l+=It[p]}r[c]=s-c-1;break}case"text":{let c=new TextEncoder().encode(i[2]),l=Tn(c,Cn);o.setFloat64(s,i[3],!0),r[s+8]=l.length,r.set(l,s+9),s+=9+l.length;break}case"start":case"stop":o.setFloat32(s,i[2],!0),o.setFloat32(s+4,i[3],!0),s+=8;break;case"clef":let a=typeof i[2]=="number"?i[2]:0;r[s]=a,s+=1;break}}return r}var $n={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.sequence",defs:{main:{type:"record",description:"A sequence of timed events. Full documentation at https://github.com/soundio/sequence/.",key:"any",record:{type:"object",required:["events"],properties:{id:{type:"integer",description:'Identifies this sequence for playback by a "sequence" event.',maximum:65535},url:{type:"string",format:"uri",description:"Canonical location of this sequence. May be an `at://` URI or an `https://` URL to a JSON endpoint."},name:{type:"string",description:"Name of the sequence",maxLength:1280,maxGraphemes:640},version:{type:"integer",description:"Version number for the byte array encoding of the events field."},events:{type:"bytes",description:"Serialised and binary encoded array of events of the form `[beat, type, data...]`, where `data` parameters depend on `type` and the byte layout of the serialised data conforms to the Sequence spec at https://github.com/soundio/sequence.",maxLength:524288},sequences:{type:"array",description:'A collection of sequences that may be played back by "sequence" events.',items:{type:"ref",ref:"io.sound.sequence"}},credits:{type:"array",description:"Attribution for composers, arrangers, etc",maxLength:60,items:{type:"ref",ref:"io.sound.credit"}},bskyPostRef:{type:"ref",ref:"com.atproto.repo.strongRef",description:"Strong reference to a Bluesky post. Useful to keep track of comments off-platform."},publishedAt:{type:"string",format:"datetime",description:"Timestamp of the time of publication."},updatedAt:{type:"string",format:"datetime",description:"Timestamp of the time of last edit."},tags:{type:"array",description:"Array of strings used to tag the sequence.",items:{type:"string",maxLength:1280,maxGraphemes:128}}}}}}};var Mn={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.credit",defs:{main:{type:"object",description:"Attribution for a creative work",required:["name","role"],properties:{name:{type:"string",description:"Name of the credited person",maxLength:640,maxGraphemes:320},role:{type:"string",description:"Role: composer, lyricist, arranger, etc",maxLength:64,maxGraphemes:32,knownValues:["composer","arranger","lyricist","transcriber","orchestrator","adapter","artist","producer"]},url:{type:"string",format:"uri",description:"URL to credited person's profile or website"}}}}};var Gn=Object.assign,On=$n.defs.main.record,Xs=Mn.defs.main,Ks=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$/,Ys=/^at:\/\/[^/\s]+(\/([\w.-]+)(\/[\w.-]+)?)?$/,Zs=/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/,Js=/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/,Qs=["alt","arpa","example","internal","invalid","local","localhost","onion"],_s=new Intl.Segmenter(void 0,{granularity:"grapheme"});function $e(t){return[..._s.segment(t)].length}var ta=new TextEncoder;function kt(t){return ta.encode(t).byteLength}var ea=D(M,{datetime:(t,e,r)=>{if(!Ks.test(r))throw new Error(`Record "${e}" invalid datetime format "${r}"`);if(r.includes("t")||r.endsWith("z")&&!r.endsWith("Z"))throw new Error(`Record "${e}" datetime must use uppercase T and Z`)},uri:(t,e,r)=>{if(kt(r)>8192)throw new Error(`Record "${e}" URI exceeds 8KB maximum`);try{new URL(r)}catch(o){throw new Error(`Record "${e}" ${o.message}`)}},"at-uri":(t,e,r)=>{if(kt(r)>8192)throw new Error(`Record "${e}" AT URI exceeds 8KB maximum`);if(!r.startsWith("at://"))throw new Error(`Record "${e}" AT URI must start with at://`);if(!Ys.test(r))throw new Error(`Record "${e}" invalid AT URI format`)},handle:(t,e,r)=>{if(r.length>253)throw new Error(`Record "${e}" handle exceeds 253 characters`);if(!Zs.test(r))throw new Error(`Record "${e}" invalid handle format`);let o=r.split(".").pop().toLowerCase();if(Qs.includes(o))throw new Error(`Record "${e}" handle has disallowed TLD "${o}"`)},nsid:(t,e,r)=>{if(r.length>317)throw new Error(`Record "${e}" NSID "${r}" exceeds 317 characters`);if(!Js.test(r))throw new Error(`Record "${e}" Invalid NSID format "${r}"`)}}),Un=D(rt("type"),{boolean:(t,e,r)=>{if(typeof r!="boolean")throw new Error(`Record "${e}" not of type "boolean"`);if(t.const!==void 0&&r!==t.const)throw new Error(`Record "${e}" must be ${t.const}`)},integer:(t,e,r)=>{if(!Number.isInteger(r))throw new Error(`Record "${e}" not of type "integer" but type "${typeof r}"`);if(t.minimum!==void 0&&r<t.minimum)throw new Error(`Record "${e}" is ${r}, minimum ${t.minimum}`);if(t.maximum!==void 0&&r>t.maximum)throw new Error(`Record "${e}" is ${r}, maximum ${t.maximum}`);if(t.enum&&!t.enum.includes(r))throw new Error(`Record "${e}" must be one of [${t.enum.join(", ")}]`)},string:(t,e,r)=>{if(typeof r!="string")throw new Error(`Record "${e}" not of type "string"`);if(t.minLength&&kt(r)<t.minLength)throw new Error(`Record "${e}" has ${kt(r)} bytes, minimum ${t.minLength}`);if(t.maxLength&&kt(r)>t.maxLength)throw new Error(`Record "${e}" has ${kt(r)} bytes, maximum ${t.maxLength}`);if(t.minGraphemes&&$e(r)<t.minGraphemes)throw new Error(`Record "${e}" has ${$e(r)} graphemes, minimum ${t.minGraphemes}`);if(t.maxGraphemes&&$e(r)>t.maxGraphemes)throw new Error(`Record "${e}" has ${$e(r)} graphemes, maximum ${t.maxGraphemes}`);t.format&&ea(t.format,e,r)},bytes:(t,e,r)=>{if(!(r&&typeof r=="object"&&"$bytes"in r))throw new Error(`Record "${e}" not of type "bytes"`);if(typeof r.$bytes!="string")throw new Error(`Record "${e}".$bytes must be a string`);let o=r.$bytes.length*.75;if(t.minLength&&o<t.minLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, minimum ${t.minLength}`);if(t.maxLength&&o>t.maxLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, maximum ${t.maxLength}`)},array:(t,e,r)=>{if(!Array.isArray(r))throw new Error(`Record "${e}" not of type "array"`);if(t.minLength&&r.length<t.minLength)throw new Error(`Record "${e}" has ${r.length} items, minimum ${t.minLength}`);if(t.maxLength&&r.length>t.maxLength)throw new Error(`Record "${e}" has ${r.length} items, maximum ${t.maxLength}`);t.items&&r.forEach((o,n)=>{Un(t.items,`${e}[${n}]`,o)})},object:(t,e,r)=>{if(typeof r!="object"||r===null||Array.isArray(r))throw new Error(`Record "${e}" not of type "object"`);Me(t,r)},ref:(t,e,r)=>{switch(t.ref){case"io.sound.sequence":Me(On,r);break;case"io.sound.credit":Me(Xs,r);break;default:console.log(`External schema ref ${t.ref} not validated`)}}});function ra(t=[],e){let r;for(r of t)if(!(r in e))throw new Error(`Record missing required "${r}" property`)}function Me(t,e){let{type:r,required:o,properties:n}=t;if(r!=="object")throw new Error(`Attempting to validate object with schema of type "${r}"`);ra(o,e);let i,s;for(i in e)i in n&&(s=n[i],Un(s,i,e[i]))}var jt=0;function Kr(t){return Me(On,t)}function Ge(t){let{events:e,sequences:r,...o}=t;return Gn(o,{version:jt,events:{$bytes:Xr(e).toBase64()}}),Kr(o),r&&(o.sequences=r.map(Ge)),o}function Yr(t){let{version:e,events:r,sequences:o,...n}=t;if(e!==jt)throw new Error(`Cannot decode record version ${e} with decoder version ${jt}`);let i=Uint8Array.fromBase64(r.$bytes);return Gn(new Q(Vr(i),o),n)}var Ln=Object.assign,oa=Q.from;Q.from=function(e){return e.events&&typeof e.events.$bytes=="string"?Yr(e):oa(e)};Ln(Q,{version:jt,toRecord:Ge,fromRecord:Yr,validateRecord:Kr});Ln(Q.prototype,{toRecord:function(){return Ge(this)}});function Zr(t){var e={};return function(o){return o in e?e[o]:e[o]=t(o)}}function Oe(t){return function(r,...o){var n=t[r]||t.default;return n&&n.apply(this,o)}}var na={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function Jr(t,e){if(e){var r=na[t.toLowerCase()]||t,o;try{o=new window.DOMParser().parseFromString(e,r)}catch{return}if(!o||o.getElementsByTagName("parsererror").length)throw new Error("Invalid "+t.toUpperCase()+": "+e);return o}}function qn(t){return Jr("html",t)}function Pn(t){return Jr("svg",t)}var lt=Object.assign,Ct={headers:function(t){return{}},body:M},ia=Oe({"application/x-www-form-urlencoded":function(t){return lt(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(t){return lt(t,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(t){return lt(t,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(t){return lt(t,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(t){return lt(t,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(t){return lt(t,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(t){return lt(t,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(t){return lt(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),sa=Oe({"application/json":function(t){return t instanceof FormData?aa(t):JSON.stringify(t)},"application/x-www-form-urlencoded":function(t){return t instanceof FormData?Hn(t):zn(t)},"multipart/form-data":function(t){return t instanceof FormData?t:ca(t)},default:M});function aa(t){return JSON.stringify(Array.from(t.entries()).reduce(function(e,r){return e[r[0]]=r[1],e},{}))}function Hn(t){return new URLSearchParams(t).toString()}function zn(t){return Object.keys(t).reduce((e,r)=>(e.append(r,t[r]),e),new URLSearchParams)}function ca(t){throw new Error("TODO: dataToFormData(data)")}function ua(t,e){return e instanceof FormData?t+"?"+Hn(e):t+"?"+zn(e)}function pa(t,e,r,o){let n=typeof r=="string"?r:r&&r["Content-Type"]||"application/json",i=ia(n,lt(Ct.headers&&e?Ct.headers(e):{},typeof r=="string"?{}:r)),s={method:t,mode:"cors",headers:i,credentials:"same-origin",signal:o&&o.signal};return t!=="GET"&&(s.body=sa(n,Ct.body?Ct.body(e):e)),s}function Ue(t){return t.blob()}function la(t){return t.json().catch(e=>{throw new Error("Cannot parse JSON "+t.url+". "+e.message)})}function In(t){return t.formData()}function ha(t){return t.text()}function fa(t){return t.text().then(e=>/^\s*<!DOCTYPE html>/.test(e)?qn(e):v("fragment",e))}function ma(t){return t.text().then(e=>/^\s*<\?xml/.test(e)?Pn(e):(console.warn("Untested SVG fragment parsing in request.js!"),v("fragment",e)))}var da={"text/plain":ha,"text/html":fa,"image/svg+xml":ma,"application/json":la,"multipart/form-data":In,"application/x-www-form-urlencoded":In,audio:Ue,"audio/wav":Ue,"audio/m4a":Ue,"application/zip":Ue};function ga(t){if(Ct.onresponse&&(t=Ct.onresponse(t)),!t.ok)throw new Error(t.statusText+"");let e=t.headers.get("Content-Type");if(!e)return;let r=e.replace(/\;.*$/,"");return da[r](t)}function jn(t="GET",e,r={},o="application/json"){t=t.toUpperCase(),t==="GET"&&r&&(e=ua(e,r));let n=pa(t,r,o,arguments[4]);return fetch(e,n).then(ga)}function Wn(t){return jn("GET",t)}var wa={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},xa=/^[ABCDEFG][bâ™­#â™¯]{0,1}-?\d$/,Vn=/^[ABCDEFG][bâ™­#â™¯]{0,1}/;function Qr(t){let e=t.trim().split(/\s+/),r=[],o=-1;for(;e[++o]!==void 0;){let n=Number(e[o]),i=e[++o];xa.test(i)?(i="note",--o):Vn.test(i)&&(i="chord",--o);let s=[n,i],u=wa[i];if(u===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let a=Vn.exec(e[++o])[0],c=e[o].slice(a.length)||e[++o],l=Number(e[++o]);s.push(a,c,l)}else for(;u--;){let a=Number(e[++o]);s.push(Number.isNaN(a)?e[o]:a)}r.push(s)}return r}function ya(t){let e=t.files[Object.keys(t.files)[0]];return Et(e.type,e.content)}function Ea(t){let e=t.settings.find(matches({id:13324}))||t.settings[0];return Et("abc",e.abc)}function Et(t,e){if(typeof e=="object")return e.files?ya(e):e.settings?Ea():Array.isArray(e)?{id:0,events:e}:e;if(t==="sequence"||t==="text/plain")return{events:Qr(e)};{let r=JSON.parse(e);return Array.isArray(r)?{id:0,events:r}:r}}var ba=Zr(Wn);var Xn=D((t,e)=>typeof e,{string:function(t,e){return ba(e).then(r=>Et(t,r)).catch(r=>console.error(r))},default:function(t,e,r,o){e[t]=o}});var va=/^(\d+)\/(\d+)$/;function Kn(t){let e=va.exec(t),r=parseInt(e[1],10),o=4/parseInt(e[2],10);return{1:"meter",2:r*o,3:o}}function Yn(t){let e=t[2],r=t[3],o=e/r,n=4/r;return o+"/"+n}var O={};Hi(O,{accentDown:()=>Pe,accentUp:()=>qe,acciDoubleFlat:()=>Zt,acciDoubleSharp:()=>_t,acciFlat:()=>Jt,acciNatural:()=>Tt,acciParensLeft:()=>Ga,acciParensRight:()=>Oa,acciSharp:()=>Qt,augmentationDot:()=>oc,barLine:()=>kc,barRepeat1:()=>Cc,barRepeat2:()=>Tc,barRepeat4:()=>$c,barRepeatBegin:()=>Uc,barRepeatDots:()=>Pc,barRepeatEnd:()=>Lc,barRepeatEndBegin:()=>qc,barRepeatLowerDot:()=>Oc,barRepeatSlash:()=>Mc,barRepeatUpperDot:()=>Gc,chordAugmented:()=>_c,chordBassSlash:()=>co,chordBracketLeft:()=>nu,chordBracketRight:()=>iu,chordDiminished:()=>Jc,chordGlyphs:()=>su,chordHalfDiminished:()=>Qc,chordMajorSeventh:()=>tu,chordMinor:()=>eu,chordParensLeftTall:()=>ru,chordParensRightTall:()=>ou,clefAlto:()=>Kt,clefBass:()=>Yt,clefDrum:()=>Le,clefTreble:()=>Wt,clefTrebleDown:()=>Vt,clefTrebleUp:()=>Xt,coda:()=>ao,graceNoteStemDown:()=>gc,graceNoteStemUp:()=>dc,head1:()=>_r,head2:()=>to,head4:()=>eo,headBracketLeft:()=>te,headBracketRight:()=>ee,headCircle:()=>Ha,headCircleX:()=>za,headDiamond:()=>La,headDiamondWide:()=>qa,headPlus:()=>Ia,headSlashHorizontalEnds:()=>Va,headSlashVerticalEnds:()=>Wa,headSlashed2:()=>Ua,headTriangleUp:()=>ja,headX:()=>Pa,marcatoDown:()=>He,marcatoUp:()=>Ie,metDot:()=>mc,metNote05Down:()=>fc,metNote05Up:()=>pc,metNote1Down:()=>hc,metNote1Up:()=>uc,metNote2Down:()=>lc,metNote2Up:()=>cc,note0125Down:()=>rc,note0125Up:()=>Ja,note025Down:()=>ec,note025Up:()=>Za,note05Down:()=>tc,note05Up:()=>Ya,note1Down:()=>_a,note1Up:()=>Ka,note2Down:()=>Qa,note2Up:()=>Xa,rest0125:()=>ro,rest01875:()=>Rc,rest025:()=>oo,rest0375:()=>Sc,rest05:()=>no,rest075:()=>Ac,rest1:()=>io,rest15:()=>Dc,rest2:()=>so,rest3:()=>Nc,rest4:()=>Fc,rest6:()=>Bc,staccatoDown:()=>ic,staccatoUp:()=>nc,tailDown0125:()=>vc,tailDown025:()=>Ec,tailDown05:()=>xc,tailUp0125:()=>bc,tailUp025:()=>yc,tailUp05:()=>wc,tenutoDown:()=>ac,tenutoUp:()=>sc,textBeam16Long:()=>gu,textBeam16Short:()=>du,textBeam8Long:()=>mu,textBeam8Short:()=>fu,textDot:()=>wu,textNote16Long:()=>hu,textNote16Short:()=>lu,textNote8Long:()=>pu,textNote8Short:()=>uu,textNoteLong:()=>cu,textNoteShort:()=>au,textTie:()=>xu,textTuplet3Long:()=>Ru,textTuplet3Short:()=>Eu,textTupletBeginLong:()=>vu,textTupletBeginShort:()=>yu,textTupletEndLong:()=>Su,textTupletEndShort:()=>bu,timeSig0:()=>Ra,timeSig1:()=>Sa,timeSig2:()=>Aa,timeSig3:()=>Da,timeSig4:()=>Na,timeSig5:()=>Fa,timeSig6:()=>Ba,timeSig7:()=>ka,timeSig8:()=>Ca,timeSig9:()=>Ta,timeSigCommon:()=>$a,timeSigCutCommon:()=>Ma,tuplet0:()=>Ic,tuplet1:()=>Hc,tuplet2:()=>zc,tuplet3:()=>jc,tuplet4:()=>Wc,tuplet5:()=>Vc,tuplet6:()=>Xc,tuplet7:()=>Kc,tuplet8:()=>Yc,tuplet9:()=>Zc});var Wt="&#xE050;",Vt="&#xE052;",Xt="&#xE053;",Kt="&#xE05C;",Yt="&#xE062;",Le="&#xE069;",Ra="&#xE080;",Sa="&#xE081;",Aa="&#xE082;",Da="&#xE083;",Na="&#xE084;",Fa="&#xE085;",Ba="&#xE086;",ka="&#xE087;",Ca="&#xE088;",Ta="&#xE089;",$a="&#xE08A;",Ma="&#xE08B;",Zt="&#xE264;",Jt="&#xE260;",Tt="&#xE261;",Qt="&#xE262;",_t="&#xE263;",Ga="&#xE26A;",Oa="&#xE26B;",_r="&#xE0A4;",to="&#xE0A3;",eo="&#xE0A2;",te="&#xE0F5;",ee="&#xE0F6;",Ua="&#xE0D0;",La="&#xE0DB;",qa="&#xE0DC;",Pa="&#xE0A9;",Ia="&#xE0AF;",Ha="&#xE0E8;",za="&#xE0B3;",ja="&#xE0BE;",Wa="&#xE100;",Va="&#xE101;",Xa="&#xE1D3;",Ka="&#xE1D5;",Ya="&#xE1D7;",Za="&#xE1D9;",Ja="&#xE1DB;",Qa="&#xE1D4;",_a="&#xE1D6;",tc="&#xE1D8;",ec="&#xE1DA;",rc="&#xE1DC;",oc="&#xE1E7;",qe="&#xE4A0;",Pe="&#xE4A1;",nc="&#xE4A2;",ic="&#xE4A3;",sc="&#xE4A4;",ac="&#xE4A5;",Ie="&#xE4AC;",He="&#xE4AD;",cc="&#xECA3;",uc="&#xECA5;",pc="&#xECA7;",lc="&#xECA4;",hc="&#xECA6;",fc="&#xECA8;",mc="&#xECB7;",dc="&#xE560;",gc="&#xE561;",wc="&#xE240;",xc="&#xE241;",yc="&#xE242;",Ec="&#xE243;",bc="&#xE244;",vc="&#xE245;",ro="&#xE4E8;",Rc="&#xE4E8;&#xE1E7;",oo="&#xE4E7;",Sc="&#xE4E7;&#xE1E7;",no="&#xE4E6;",Ac="&#xE4E6;&#xE1E7;",io="&#xE4E5;",Dc="&#xE4E5;&#x200A;&#xE1E7;",so="&#xE4E4;",Nc="&#xE4E4;&#x200A;&#xE1E7;",Fc="&#xE4E3;",Bc="&#xE4E3;&#x200A;&#xE1E7;",kc="&#xE030",Cc="&#xE500;",Tc="&#xE501;",$c="&#xE502;",Mc="&#xE504;",Gc="&#xE503;",Oc="&#xE505;",Uc="&#xE040",Lc="&#xE041",qc="&#xE042",Pc="&#xE043",ao="&#xE048",Ic="&#xE880;",Hc="&#xE881;",zc="&#xE882;",jc="&#xE883;",Wc="&#xE884;",Vc="&#xE885;",Xc="&#xE886;",Kc="&#xE887;",Yc="&#xE888;",Zc="&#xE889;",Jc="&#xE870;",Qc="&#xE871;",_c="&#xE872;",tu="&#xE873;",eu="&#xE874;",ru="&#xE875;",ou="&#xE876;",nu="(",iu=")",co="&#xE87B;",su={"âˆ†â™¯11":"î¡³îµ¢11","âˆ†":"î¡³",7:"7","-7":"î¡´7","-â™­6":"î¡´îµ 6","7susâ™­9":"7susîµ¢",Ã¸:"î¡±","7â™¯11":"7îµ¢11","-âˆ†":"î¡´î¡³","âˆ†â™­6":"î¡³îµ 6","-â™­9":"î¡´îµ 9",Ã¸7:"î¡±7","âˆ†â™¯5":"î¡³îµ¢5","7alt":"7alt","Â°":"î¡°",dim:"î¡°","7â™­9":"7îµ ","+7":"î¡²7"},au="&#xE1F0;",cu="&#xE1F1;",uu="&#xE1F2;",pu="&#xE1F3;",lu="&#xE1F4;",hu="&#xE1F5;",fu="&#xE1F7;",mu="&#xE1F8;",du="&#xE1F9;",gu="&#xE1FA;",wu="&#xE1FC;",xu="&#xE1FD;",yu="&#xE1FE",Eu="&#xE1FF",bu="&#xE200",vu="&#xE201",Ru="&#xE202",Su="&#xE203";function uo(t){return function(){return arguments[t]}}function ot(){return this}var Zn=Object.create,Au=Object.freeze,ze=Au(Zn(Zn(Object.prototype,{at:{value:L},shift:{value:L},push:{value:L},forEach:{value:L},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:ot},find:{value:L},findIndex:{value:function(){return-1}},flat:{value:ot},flatMap:{value:ot},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:ot},reduce:{value:uo(1)},sort:{value:ot},each:{value:ot},pipe:{value:M},start:{value:ot},stop:{value:ot},done:{value:ot},valueOf:{value:function(){return null}}}),{length:{value:0}}));function nt(t){return pt(12,t)}var Jn=D(rt(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function T(t){return t[0]+Jn(t)}function Qn(t,e){return t>e?1:t<e?-1:0}var V=[0,2,4,5,7,9,11];function Du(t,e,r){return r.indexOf(t)===e}function _n(t,e){return t.map(r=>nt(r+e)).filter(Du).sort(Qn)}var fo=[{name:"C",symbol:"Câˆ†",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Dâ™­",symbol:"Dâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"Dâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"Eâ™­",symbol:"Eâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"Eâˆ†",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"Fâˆ†",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Fâ™¯",symbol:"Fâ™¯âˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"Gâˆ†",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"Aâ™­",symbol:"Aâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"Aâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"Bâ™­",symbol:"Bâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"Bâˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function $t(t){return _n(V,t)}var{abs:Wm}=Math,Nu=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),Fu=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],Vm={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function lo(t){let e=new Float32Array(12),r=G(t+2),o=7;for(;o--;)r=G(r+5),e[r]=1;return e}function ho(t,e,r){let o=t.length;for(;o--;)t[o]*=1-r+r*e[o];return t}var po={note:(t,e,r=1)=>{let o=R(e[2]),n=lo(o);return ho(t,n,r*(1-o/192))},chord:(t,e,r=1)=>{let o=G(e[2]),n=Lr(e[3]),i=n.length,s;for(;i--;)s=lo(o+n[i]),ho(t,s,r/n.length*Nu[n[i]]);return t}};function We(t,e,r){let o=t[e],n=o[0],i=ke(o)?lo(R(o[2])):jr(o)?po.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(r!==void 0){let u=Float32Array.from({length:12},(a,c)=>Fu[(c+12-r)%12]);ho(i,u,.3)}let s=e;for(;o=t[--s];){let u=po[o[1]];if(!u)continue;let a=T(o);if(a>n)u(i,o,.5);else if(o[1]==="note"&&n-a<3){if(1-(n-a)/3>1)throw new Error("Influence should never be > 1 "+n+" "+a);u(i,o,.25*(1-(n-o[0])/3))}}for(s=e;(o=t[++s])&&o[0]-n<2;){if(!ke(o))continue;let u=po[o[1]];if(u){if(1-(o[0]-n)/2>1)throw new Error("Influence should never be > 1 "+n+" "+stopBeat);u(i,o,.3*(1-(o[0]-n)/2))}}return i}var je=[0,7,5,2,10,9,3,4,8,11,1,6];function Ve(t){let e=je.length,r=0,o;for(;e--;)t[je[e]]>r&&(r=t[je[e]],o=je[e]);return o}var ei=/^([A-G])([b#â™­â™¯ğ„«ğ„ª])?(-?\d)?$/,ri=/b|â™­/,oi=/#|â™¯/;var Xe=/b|â™­|#|â™¯/g;var Ke={"-2":"ğ„«","-1":"â™­",0:"",1:"â™¯",2:"ğ„ª"},ti=["Fâ™¯","Câ™¯","Gâ™¯","Dâ™¯","Aâ™¯","Eâ™¯","Bâ™¯","Bâ™­","Eâ™­","Aâ™­","Dâ™­","Gâ™­","Câ™­","Fâ™­"];function Ye(t,e){let r=ti.indexOf(t.pitch),o=ti.indexOf(e.pitch);return r>o?1:r<o?-1:0}var I={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,marcatoThreshold:ut("-6dB"),accentThreshold:ut("-12dB"),ghostThreshold:ut("-30dB"),headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var ni={"-2":"ğ„«","-1":"â™­",0:"",1:"â™¯",2:"ğ„ª"},Bu=globalThis||window;var{floor:ii,round:nd}=Math,F=class{constructor(){}pitched=!0;rows=ze;getHeadHTML(e,r,o){let n=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${n}">${O[n]}</span>`}getNoteHTML(e,r,o){return r<I.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${te}</span>
            ${this.getHeadHTML(e,r,o)}
            <span class="post" data-glyph="headBracketRight">${ee}</span>`:this.getHeadHTML(e,r,o)}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return ii(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,r){let o=R(this.minPitch),n=R(this.maxPitch),i=R(e)+r;return i>=o&&i<=n?i:void 0}parts=[{name:"main"}];getPart(e){return this.parts[0]}getRow(e,r){let n=(typeof r=="string"?r:st(r)).replace(Xe,""),i=this.rows.indexOf(n);if(Bu.DEBUG&&i===-1)throw new Error('Pitch "'+r+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getPitch(e){let r=this.rows[e];return r?r.split(/\s+/)[0]:void 0}getSpelling(e,r,o=!1){if(!o){let l=fo[e],h=G(r),p=l.spellings[h];return be[nt(h-p)]+ni[p]}let n=fo[e],i,s,u;if(typeof r=="string"){let[l,h,p,m]=ei.exec(r)||[r];m&&(i=R(r),s=n.spellings[nt(i)],u=ve(i-s))}else i=r,s=n.spellings[nt(i)],u=ve(i-s);let a=be[nt(i-s)],c=ni[s];return a+c+u}createKeySymbols(e){let r=[],o=G(e),n=$t(o);return r.push.apply(r,n.map((i,s)=>i-V[s]&&{type:"acci",pitch:X(V[s])+Ke[i-V[s]],value:i-V[s],part:this.parts[0]}).filter(i=>!!i).sort(Ye)),r}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let r=ii(e*this.pitches.length);return r<0?this.pitches[0]:r>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[r]}};function mo(t){if(t=typeof t=="number"?t+"":t.trim(),typeof t=="string")return t.toLowerCase().replace(/^[\W_]+/,"").replace(/[\W_]+$/,"").replace(/[\W_]+/g,"-")}var ku=globalThis||window;function N(t){return mo(rn(t))}var bt=class extends F{type="drum";pitched=!1;rows=["","","",N(55)+" "+N(52),N(57),N(49),N(51)+" "+N(53)+" "+N(59),N(42)+" "+N(46),N(50)+" "+N(56),N(48)+" "+N(47),N(38)+" "+N(40),N(45)+" "+N(31)+" "+N(39)+" "+N(54),N(43),N(41),N(35)+" "+N(36),"",N(44),"","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#e={31:!0,35:!0,36:!0,37:!0,38:!0,40:!0,41:!0,42:!0,43:!0,45:!0,47:!0,48:!0,50:!0,56:!0};getNoteHTML(e,r,o){let n=R(e),i=this.#t[n],s=this.#e[n],u=i?`<span class="head" data-glyph="${i}">${O[i]}</span>`:this.getHeadHTML(e,r,o);return s&&r<I.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${te}</span>
            ${u}
            <span class="post" data-glyph="headBracketRight">${ee}</span>
            `:u}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(e){return[35,36,37,38,40,41,43,44,45,47,48,50].includes(R(e))?this.parts[0]:this.parts[1]}getRow(e,r){let o=typeof r=="string"?r:N(r);if(!o)throw new Error("Number not found for pitch "+r);let n=this.rows.findIndex(i=>i.includes(o));if(ku.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),n>-1?n:void 0}getSpelling(e,r){return N(r)}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let r=floor(e*this.rows.length),o=r<4?4:r>17?17:r;return this.pitches[o]}};var re=class extends bt{type="percussion";rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var Cu=globalThis||window,si=Object.assign,oe=class extends F{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(e,r,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${O["timeSig"+e]}</sup>
            <sub>${O["timeSig"+r]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${O["timeSig"+e]}</sup>
            <sub>${O["timeSig"+r]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(e,r){r=typeof r=="string"?r:st(r);let o=e.name+"-"+r.replace(Xe,""),n=this.rows.findIndex(i=>i.includes(o));if(Cu.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by '+this.constructor.name),n>-1?n:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#â™­â™¯ğ„«ğ„ª]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let r=[],o=G(e),i=$t(o).map((s,u)=>s-V[u]&&{type:"acci",pitch:X(V[u])+Ke[s-V[u]],value:s-V[u]}).filter(s=>!!s).sort(Ye);return r.push.apply(r,i.map(s=>si({part:this.parts[1]},s))),r.push.apply(r,i.map(s=>si({part:this.parts[2]},s))),r}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var go=class extends F{type="treble-up";clef=Xt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},wo=class extends F{type="treble";clef=Wt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},xo=class extends F{type="treble-down";clef=Vt;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},yo=class extends F{type="alto";clef=Kt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Eo=class extends F{type="bass";clef=Yt;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};F.treble=new wo;F["treble-up"]=new go;F["treble-down"]=new xo;F.alto=new yo;F.bass=new Eo;F.piano=new oe;F.drum=new bt;F.percussion=new re;F.create=t=>(console.warn("Deprecated: Stave.create(type). Use Stave[type]."),F[t]);var Ze=F;var ai=t=>t*Math.PI/180;var ci=xt({deg:ai,rad:M,turn:t=>t*2*Math.PI,catch:function(t){throw new Error('Cannot parse value "'+t+'"')}});var Tu=/px$/,$u=/deg$|turn$|rad$/;function Mu(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function Je(t,e){var r=Mu(t,e);return typeof r=="string"?Tu.test(r)?parseFloat(r):$u.test(r)?ci(r):r:r}var Qe,_e;function Gu(){if(!Qe){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",Qe=Je("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return Qe}function Ou(){return _e||(_e=Je("font-size",document.documentElement)),_e}window.addEventListener("resize",()=>{Qe=void 0,_e=void 0});var Uu=D(At,{number:M,string:xt({px:M,em:t=>Gu()*t,rem:t=>Ou()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),ui=Uu;function Lu(t,e,r){let o=t(e),n=t(r);return n===o?0:o>n?1:-1}var pi=Z(Lu,!0);var{abs:qu,EPSILON:Pu}=Math;function tr(t,e){return Math.round(e/t)*t}function it(t,e,r=Pu){return e!==void 0&&(e===t||qu(t-e)<r)}function vt(t,e,r){return it(t,e,r)||e<t}function Iu(t,e,r){return it(t,e,r)||e>t}function Mt(t,e,r){return e!==void 0&&t!==void 0&&!vt(t,e,r)}function er(t,e,r){return e!==void 0&&t!==void 0&&!Iu(t,e,r)}var{pow:Hu}=Math,zu=1/24,ju=[2,3,4,5,6,7,9],Wu=1/12,li=.25,hi=.2,bo={},Gt=0;function fi(t,e){return Math.cos(2*Math.PI*e/t)}function mi(t,e,r,o,n){let i=t/e,s=0,u=0,a=0,c,l;for(o[n-1]&&Mt(r+.5*i,T(o[n-1]),zu)&&(a=1),--n;o[++n]!==void 0&&o[n][0]-r<i/4;)a=1;for(--n;o[++n]!==void 0&&o[n][0]-r<t-i/4;){if(c=Math.round((o[n][0]-r)/i),l=1<<c,c<e&&l>a){if(e>4&&l>a<<1)return;a+=l}s+=fi(i,o[n][0]-r),u+=1,!(o[n][0]+o[n][4]-r>t)&&(s+=hi*fi(i,o[n][0]+o[n][4]-r),u+=hi)}if(!(e>4&&c!==e-1)&&u)return bo.score=s/(u+1),bo.rhythm=a,bo}function Vu(t,e,r,o,n,i,s){let u=r[o-1]&&T(r[o-1])>n+.125?n:e*Math.floor((r[o][0]-n)/e)+n,a=i.length;for(;e/i[--a]<Wu;);++a;let c,l;for(;c=i[--a];)l=mi(e,c,u,r,o),l&&l.score>=Gt&&l.score&&(Gt=l.score,t.beat=u,t.duration=e,t.divisor=c,t.rhythm=l.rhythm),r[o][0]>=u+.5*e&&u+1.5*e<s&&(l=mi(e,c,u+.5*e,r,o),l&&l.score>=Gt&&(Gt=l.score,t.beat=u+.5*e,t.duration=e,t.divisor=c,t.rhythm=l.rhythm));return t}function di(t,e,r){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let n={};Gt=li;let i=1/8;for(;(i*=2)&&i<=r;)Vu(n,i,t,o,e,ju,e+r);return Gt>li&&n}function gi(t,e){return e<Hu(2,t)-1}function vo(t){return 2**Math.ceil(Math.log2(t))}function wi(t){return 2**Math.floor(Math.log2(t))}function Ro(t){return t>0&&(t&t-1)===0}function So(t,e,r){if(it(0,r,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(it(0,pt(o,r),t/2))return o;return o}function ne(t,e){let r=-1,o=0;for(;t[++r]!==void 0;);for(;arguments[++o]!==void 0;)t[r++]=arguments[o];return t}function Ot(t){let e=-1;for(;t[++e]!==void 0;);return e}function Ao(t){return t[Ot(t)-1]}function Do(t,e){let r=[],o=-1;for(;e[++o]!==void 0;)r.push(t(e[o],o));return r}var nr=Object.assign,{abs:kg,ceil:Xu,floor:or,min:bi,max:vi,pow:Cg,sqrt:xi,round:Tg}=Math,Y=1/16,ie=1/24,Ku=pi(rt("row"));function yi(t,e,r,o){return t+e/o.length}function Ri(t,e){return vi(t,T(e))}function Yu(t,e){return R(t[2])<R(e[2])?1:-1}function Si(t,e,r,o){if(!o.length)return[];let n=[],i=-1,s;for(;s=o[++i];){let h=s.scribeEvents,p=s.scribeIndex,m=We(h,p,e),d=Ve(m),f=t.getSpelling(d,s[2],!0),g=t.getRow(r,f);n.push({type:"note",pitch:f,dynamic:s[3],part:r,row:g,stave:t,event:s})}n.sort(Ku),n[0].top=!0,n[n.length-1].bottom=!0;let u=n[0].row,a=n[n.length-1].row,c=r.stemup===void 0?Ai(t,r,u,a):r.stemup,l=0;for(i=-1;n[++i];)n[i].stemup=c,i>0&&n[i].row-n[i-1].row===1?n[i].clusterdown=++l:l=0;for(l=0,i=n.length-1;i--;)n[i+1].row-n[i].row===1?n[i].clusterup=++l:l=0;return n}function Zu(t,e,r){let o=-1,n=0,i,s;for(;r[++o];)s=t.getRow(e,r[o]),s!==void 0&&s>n&&(n=s,i=r[o]);return{row:n,pitch:i}}function Ju(t,e,r){let o=-1,n=128,i,s;for(;r[++o];)s=t.getRow(e,r[o]),s!==void 0&&s<n&&(n=s,i=r[o]);return{row:n,pitch:i}}function Ai(t,e,r,o){let n=e.centerRow||t.centerRow,i=r-n;return o-n+i>0}function Di(t,e,r){let{row:o}=Zu(t,e,r),{row:n}=Ju(t,e,r);return Ai(t,e,o,n)}function Qu(t,e,r){let o=[],n=-1,i;for(;i=r[++n];)i.type==="note"&&o.push(i.pitch);return Di(t,e,o)}var Ei=0;function ft(t,e,r,o){let n=-1;for(;o[++n]&&o[n].beat===o.beat;);if(!o[n])return t;let i=o[0].beat,u=Ao(o).beat-i,a=r.stemup===void 0?Di(e,r,Do(rt("pitch"),o)):r.stemup;if(r.beam){let b;for(n=-1;b=o[++n];)b.stemup=a,b.beam=o;return t.push(nr(o,{duration:u,stemup:a,range:0,id:++Ei})),t}let c=[],l;for(n=-1;l=o[++n];){let b=e.getRow(r,l.pitch);if(b===void 0)continue;let U;for(;o[++n]&&it(o[n].beat,l.beat,ie);)U=e.getRow(r,o[n].pitch),U!==void 0&&(a?U<b&&(b=U):U>b&&(b=U));--n,c.push(b)}let h=c.length-1,p=c.slice(0,or(.5*c.length)).reduce(yi,0),m=c.slice(Xu(.5*c.length)).reduce(yi,0),d=Array.from(c,(b,U)=>(.2+.1*h)*U*(m-p)/h),f=d[d.length-1]-d[0],g=a?-50:50,x;for(n=c.length;n--;)x=d[n]-c[n],g=a?x>g?x:g:x<g?x:g;for(n=c.length;n--;)d[n]-=g+c[0];let E=-1;for(n=-1;l=o[++n];){for(++E,l.stemup=a,l.beam=o,l.stemHeight=a?1-.125*(d[n]-c[n]+c[0]):1+.125*(d[n]-c[n]+c[0]);o[++n]&&it(o[n].beat,l.beat,Y);)o[n].stemup=a,o[n].beam=o,o[n].stemHeight=l.stemHeight;--n}return t.push(nr(o,{pitch:o[0].pitch,y:d[0],duration:u,stemup:a,range:f,id:++Ei})),t}function rr(t,e){let r=2*vo(e);for(;(r/=2)>t/2;){if(1.75*r===e)return 1.75*r;if(1.5*r===e)return 1.5*r;if(r<=e)return r}return t}function _u(t,e,r){r=r||1/0;let o=4*vo(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=r)return o;return t}function Ni(t,e,r,o,n,i){let u=wi(e.divisor),a=or(n/e.divisor)*e.divisor,c=So(.125,u,n-a);if(i<o){if(t.indexOf(i-n)!==-1)return i-n;let h=or(i/e.divisor)*e.divisor;if(n===a){if(t.indexOf(h-n)!==-1)return h-n;let p=a+e.divisor<i&&a+e.divisor;return p?p-n:rr(.125,i-n)}if(it(i,h,Y)){let p=a+e.divisor<i&&a+e.divisor;return p&&t.indexOf(p-n)!==-1?p-n:c}}let l=or(o/e.divisor)*e.divisor;if(n===a){if(t.indexOf(o-n)!==-1)return o-n;if(t.indexOf(l-n)!==-1)return l-n;let h=a+e.divisor<o&&a+e.divisor;return h?h-n:_u(.125,o-n,i-n)}else if(it(o,l,Y)){if(t.indexOf(o-n)!==-1)return o-n;let h=a+e.divisor<o&&a+e.divisor;return h&&t.indexOf(h-n)!==-1?h-n:c}else{let h=4*c;return(n-a)%h/c===1?n+2*c===i?2*c:(n+3*c>=i&&console.log("Next event beat is inside quaduplet"),c<1?o>=n+c*3/2?3*c:o>=n+c?c:rr(.125,o-n):o>=n+c*3?c*3:o>=n+c*2?c*2:o>n+c?c:rr(.125,o-n)):o>n+c?c:rr(.125,o-n)}}function tp(t,e,r,o,n,i){return{type:"rest",beat:i,duration:Ni(t,e,i,n,i,n),stave:r,part:o}}function No(t,e,r,o,n,i,s){for(;Mt(i,s,Y);){let u=tp(e,r,o,n,s,i);t.push(u),i+=u.duration}return s}function ep(t,e,r,o,n,i){let{pitch:s,event:u,row:a}=o,c=oi.test(s)?1:ri.test(s)?-1:void 0,l=s[0]+s.slice(-1);if(c!==e[l])return e[l]=c,{type:"acci",beat:r,pitch:s,row:a,clump:n,cluster:i,part:t,event:u,value:c||0}}function rp(t,e,r){let o=-1,n,i=0,s;for(;n=t[++o];)n.type==="acci"&&n.beat===e&&n.row<r&&n.row>i&&(i=n.row,s=o);return t[s]}function Fi(t,e,r,o,n,i){let s=-1,u=0,a,c,l,h=!!i.find(p=>p.stemup?p.clusterup%2===1:p.clusterdown%2===1);for(;a=i[++s];)er(e.beat,a.event[0],Y)||(l=rp(t,n,a.row),u=l&&l.row-a.row<6&&l.cluster===h?l.clump+1:0,c=ep(r,o,n,a,u,h),c&&t.push(c))}function Bi(t,e,r,o,n,i){let s=-1/0,u=-1,a,c;for(;a=n[++u];)a.dynamic>s&&(s=a.dynamic,c=a.event);if(n.length&&s>=i.accentThreshold){let l=n[0].stemup?n[n.length-1]:n[0];t.push({type:"accent",beat:o,pitch:l.pitch,dynamic:s,stemup:l.stemup,stave:e,part:r,event:c})}}function ki(t,e,r,o,n){let i=n[0].row,s=n[0].pitch,u=i-(r.topRow||e.topRow)+1;u<0&&t.push({type:"ledge",beat:o,pitch:s,part:r,rows:u});let a=n[n.length-1].row,c=n[n.length-1].pitch;u=a-(r.bottomRow||e.bottomRow),u>0&&t.push({type:"ledge",beat:o,pitch:c,part:r,rows:u})}function op(t,e,r){let{beat:o,duration:n,divisor:i}=r,s=e.stemup===void 0?Qu(t,e,r):e.stemup,u=-1,a;for(;a=r[++u];)a.type==="note"&&!a.beam&&(a.stemup=s);let c=o+.5*n,l=R(t.topPitch)-12,h,p=Ot(r);for(;(a=r[--p])&&a.beat>c;);for(++p;(a=r[--p])&&a.beat+a.duration>c;){let E=R(a.pitch);(!h||E>h)&&(h=E)}let m=l;for(p=-1;(a=r[++p])&&a.beat<o+Y;){let E=R(a.pitch);(!m||E>m)&&(m=E)}let d=l;for(p=Ot(r);(a=r[--p])&&a.beat>o+n-n/i-Y;){let E=R(a.pitch);(!d||E>d)&&(d=E)}let f=Math.ceil((m+d)/2),g=st(f);f>h&&(h=f),r.pitch=st(h),r.stemup=s;let x=d-m;r.angle=x<0?4*xi(-x):-4*xi(x)}function np(t,e,r,o,n,i,s,u,a,c,l,h,p,m,d){(u.swingAsStraight8ths&&c===1||u.swingAsStraight16ths&&c===.5)&&l===3&&(h===4||h===5)&&(l=2);let f=c/l,g=a+c,x={type:"tuplet",beat:a,duration:c,divisor:l,rhythm:h,part:i,stave:r},E;for(Ro(l)||t.push(x);er(g,a,ie);){for(;(E=m[++d])&&vt(a+.5*f,E[0]-e.beat,ie);)p.push(E);if(--d,!p.length){t.push({type:"rest",beat:a,duration:f,stave:r,part:i}),a+=f;continue}let b=Si(r,o,i,p);ki(t,r,i,a,b),Fi(t,e,i,n,a,b),Bi(t,r,i,a,b,u);let U=bi(p.reduce(Ri,0)-e.beat,E?E[0]-e.beat:e.duration,x.beat+x.duration),B=vi(f,tr(f,U-a)),k=-1;for(;b[++k];)t.push(nr(b[k],{beat:a,duration:B}));for(ne(x,...b),Mt(.5,B,ie)?s&&(ft(t,r,i,s),s=void 0):s||(s={type:"beam",beat:a,part:i}),s&&ne(s,...b),k=p.length;k--;){let K=T(p[k])-e.beat;vt(a+B+.5*f,K,ie)?p.splice(k,1):t.push({type:"tie",beat:a,pitch:b[k].pitch,duration:B,stemup:b[k].stemup,part:i,event:p[k]})}a+=B}return s&&ft(t,r,i,s),op(r,i,x),d}function Fo(t,e,r,o=0,n={},i,s,u=I){let a=[],{headDurations:c,restDurations:l}=u,h=0,p=-1,m,d,f;for(;(m=s[++p])&&vt(h,m[0]+m[4]-e.beat,Y););for(--p;er(e.duration,h,Y);){f&&e.divisions.find(K=>it(h,K,Y))&&(ft(t,r,i,f),f=void 0);let g=di(s,e.beat+h,e.duration-h);if(g&&!Ro(g.divisor)){Mt(h,g.beat-e.beat,Y)&&No(t,u.restDurations,e,r,i,h,g.beat-e.beat),f&&gi(g.divisor,g.rhythm)&&(ft(t,r,i,f),f=void 0),p=np(t,e,r,o,n,i,f,u,g.beat-e.beat,g.duration,g.divisor,g.rhythm,a,s,p),h=g.beat-e.beat+g.duration;continue}for(;(m=s[++p])&&vt(h,m[0]-e.beat,Y);)a.push(m);if(--p,r.pitched&&a.sort(Yu),!a.length){if(!m){f&&(ft(t,r,i,f),f=void 0),No(t,u.restDurations,e,r,i,h,e.duration);break}let K=tr(.125,m[0]-e.beat);if(K<=h){console.log(`Problem at bar ${e.count}, moving to next bar ${h} ${K}`),e.error="Stop beat has ended up less than beat";break}f&&(Ci(e.divisions,h,K)||K-h>=.5)&&(ft(t,r,i,f),f=void 0),No(t,l,e,r,i,h,K),h=K;continue}let x=Si(r,o,i,a);ki(t,r,i,h,x),Fi(t,e,i,n,h,x),Bi(t,r,i,h,x,u);let E=a[0][0]-e.beat,b=bi(e.duration,a.reduce(Ri,0)-e.beat),U=m&&tr(.125,m[0])-e.beat,B=Ni(c,e,E,b,h,U),k=-1;for(;x[++k];)t.push(nr(x[k],{beat:h,duration:B}));for(B>=1?f&&(ft(t,r,i,f),f=void 0):f||(f={type:"beam",beat:h,part:i}),f&&ne(f,...x),k=a.length;k--;){let K=T(a[k])-e.beat;vt(h+B,K,Y)||K-(h+B)<.125+1/16*(T(a[k])-a[k][0])?a.splice(k,1):t.push({type:"tie",beat:h,pitch:x[k].pitch,duration:B,stemup:x[k].stemup,part:i,event:a[k]})}h+=B}return f&&ft(t,r,i,f),t}var ip={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]},Ti=/\/\{(\d{1,2})\}$/;function sp(t,e){return ip[t+","+e]||ze}function Ci(t,e,r){let o=-1;for(;t[++o]&&t[o]<=e;);return r>t[o]?t[o]:void 0}var ap=[];function $i(t,e){return $t(e).reduce((o,n,i)=>{let s=n-V[i];if(s!==0){let u=X(V[i]),a=10;for(;a--;)o[u+a]=s}return o},t),t}function Bo(t,e){return e==="Câ™­"&&t.spellChordRootCFlatAsB?"B":e==="Eâ™¯"&&t.spellChordRootESharpAsF?"F":e==="Bâ™¯"&&t.spellChordRootBSharpAsC?"C":e==="Fâ™­"&&t.spellChordRootFFlatAsE?"E":e}function cp(t,e,r,o,n,i,s){let u=-1,a;for(;a=i[++u];)switch(a[1]){case"key":{let c=gn(a[2]);console.log("KEY",c),$i(n,c),e.key=c;break}case"meter":{t.push({type:"timesig",beat:0,numerator:a[3]===1.5?a[2]/.5:a[2]/a[3],denominator:a[3]===1.5?8:4/a[3],stave:r,event:a});break}case"symbol":{t.push({type:"symbol"+a[2],stave:r});break}case"chord":{let c=a[0]-e.beat,l=We(i,u,o),h=Ve(l),p=Ne(a[3]),m=Ti.exec(p),d,f,g;if(m){let x=parseInt(m[1],10);d=r.getSpelling(h,nt(a[2]-x)),f=r.getSpelling(h,a[2]),g=Bo(s,d)+p.replace(Ti,"/"+Bo(s,f))}else d=r.getSpelling(h,a[2]),g=Bo(s,d)+p;t.push({type:"chord",beat:c,name:g,duration:a[0]+a[4]>e.beat+e.duration?e.duration-c:a[4],event:a,stave:r});break}case"text":{let c=a[0]-e.beat;t.push({type:"text",beat:c,duration:a[0]+a[3]>e.beat+e.duration?e.duration-c:a[3],value:a[2],event:a,stave:r});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(ap.includes(a[1]))return;console.log('Scribe: ignoring event type "'+a[1]+'"')}}return t}function se(t,e,r,o,n,i,s,u,a,c=I){let l=[];if(a){let g=T(a);g>e&&g<=e+r&&s.push(a)}let h=$i({},i),p={type:"bar",beat:e,duration:r,key:i,divisor:o||4,divisions:sp(r,o),stave:n,count:t,symbols:l};cp(l,p,n,i,h,s,I);let m=n.parts.reduce((g,x)=>x.centerRow?g.add(x.centerRow):g,new Set);m.size||m.add(n.centerRow);let d;for(d of n.parts){let g=u[d.name];!g||!g.length||(m.delete(d.centerRow||n.centerRow),Fo(l,p,n,i,h,d,g,c))}let f;for(f of m)Fo(l,p,n,i,h,{centerRow:f},[],c);return p}function up(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function pp(t){let e=t.symbols.filter(r=>r.type==="chord"||r.type==="note");return JSON.stringify(e,up)}function Rt(t,e){t.symbols=t.symbols.filter(r=>r.type==="doublebarline"||r.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function ir(t,e,r){let o=pp(r);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&r.symbols.filter(n=>n.type!=="clef"&&n.type!=="timesig").find(n=>n.type!=="rest")?(Rt(t[t.length-2],1),Rt(t[t.length-1],1),Rt(r,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(Rt(r,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,Rt(t[t.length-1],2),Rt(r,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,Rt(r,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function ko(t,e,r){let o=r.target?t.parts[r.target]:t.getPart(r[2]),n=e[o.name]||(e[o.name]=[]);e[o.name].push(r)}function Co(t,e,r,o=I){let n=[],i=[],s=[],u=[],a=0,c=[],l={},h=0,p=0,m,d,f,g;for(f of t)if(f.scribeIndex=n.length,f.scribeEvents=n,n.push(f),!e.includes(f[1])){for(;f[0]>=a+m;){let E=se(i.length+1,a,m,d,r,h,c,l,g,o);ir(i,u,E),i.push(E),h=E.key,a=a+m,c=[],l={};let b=-1;for(;s[++b];)ko(r,l,s[b]),T(s[b])<a+m&&s.splice(b--,1)}switch(f[1]){case"note":{ko(r,l,f),T(f)>a+m&&s.push(f),p<T(f)&&(p=T(f));break}case"sequence":{f.events===t.events&&(g=f),p<T(f)&&(p=T(f));break}case"meter":m=f[2],d=f[3],f[0]!==a&&console.log("TODO");default:c.push(f)}}for(;s.length;){let E=se(i.length+1,a,m,d,r,h,c,l,g,o);ir(i,u,E),i.push(E),a=a+m,c=[],l={};let b=-1;for(;f=s[++b];)ko(r,l,f),T(f)<a+m&&s.splice(b--,1)}for(;a<p-m;){let E=se(i.length+1,a,m,d,r,h,c,l,g,o);ir(i,u,E),i.push(E),a=a+m,c=[],l={}}m||(m=n.length?T(n[n.length-1]):1);let x=se(i.length+1,a,m,d,r,h,c,l,g,o);return ir(i,u,x),i.push(x),i}var To=Symbol("scribe-id"),lp={},$o=0;function at(t){for(;t.event;)t=t.event;return t[To]?t[To]:(t[To]=++$o,lp[$o]=t,$o)}var ct=1.1;function hp(t){return parseFloat(t.dataset.beat)}function fp(t){return parseFloat(t.dataset.duration)}function mp(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function Mi(t,e,r,o,n){let i=r[0],s=r.length===1?o%(n*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],u=r.length===1?o%(n*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[r[r.length-1]];return`M${s}, ${-t*s-.5*ct}
        L${u},${-t*u-.5*ct}
        L${u},${-t*u+.5*ct}
        L${s}, ${-t*s+.5*ct}
        Z`}function Mo(t,e,r,o,n,i,s){if(s<.0833)return;let u=n-1,a;for(;r[++u];)r[u]<=s?a?a.push(u):a=[u]:a&&(t.appendChild(v("path",{class:`beam-path-${4/s} beam-path`,d:Mi(i,o,a,e[u-1],s)})),Mo(t,e,r,o,a[0],i,s/2),a=void 0);a&&(t.appendChild(v("path",{class:`beam-path-${4/s} beam-path`,d:Mi(i,o,a,e[u-1],s)})),Mo(t,e,r,o,a[0],i,s/2),a=void 0)}function Gi(t){let e=t.dataset.beam,r=t.parentElement,o=Array.from(r.querySelectorAll('.top-note[data-beam="'+e+'"]')),n=o.map(hp),i=o.map(fp),s=t.viewBox.baseVal,u=s.y<-.5?s.y+.5:s.height-1,a=o.map(dt),c=a[0].x,l=a[a.length-1].x,h=a.map(p=>(p.x-c)/(l-c));mp(t),Mo(t,n,i,h,0,-u,.25)}var dp=/â™®|(bb|ğ„«)|(##|ğ„ª)|(b|â™­)|(#|â™¯)|(âˆ†)|(-)|(Ã¸)|(Â°)|(\+)|(\d+)/g,gp={0:`<span class="glyph glyph-natural">${Tt}</span>`,1:`<span class="glyph glyph-doubleflat">${Zt}</span>`,2:`<span class="glyph glyph-doublesharp">${_t}</span>`,3:`<span class="glyph glyph-flat">${Jt}</span>`,4:`<span class="glyph glyph-sharp">${Qt}</span>`,5:'<span class="glyph glyph-major">âˆ†</span>',6:'<span class="glyph glyph-minor">-</span>',7:'<span class="glyph glyph-halfdim">Ã¸</span>',8:'<span class="glyph glyph-dim">Â°</span>',9:'<span class="glyph glyph-aug">+</span>'};function wp(){let t=arguments.length-2;if(arguments[--t])return`<span class="glyph glyph-number">${arguments[t]}</span>`;for(;t--;)if(arguments[t])return gp[t];return""}function ae(t){return t.replace(dp,wp)}function $(t,e){return e.toFixed(t).replace(/\.?0+$/,"")}var sr=Math.abs,xp={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},yp={2:_t,1:Qt,0:Tt,"-1":Jt,"-2":Zt},Ep={treble:Wt,"treble-down":Vt,"treble-up":Xt,alto:Kt,bass:Yt,drum:Le,percussion:Le},bp={"1.33":so,"0.67":io,"0.33":no,"0.17":oo,"0.08":ro},vp=/^([A-G][â™­â™¯]?)([âˆ†\-Ã¸+Â°â™­â™¯\d]*)([a-zA-Z]*)([â™­â™¯]?\d+)?(?:\/([A-G][â™­â™¯]?))?$/;function Rp(t){let e=-1,r="";for(;t[++e];)r+=(r?" ":"")+at(t[e].event);return r}function Sp(t,e,r,o,n,i){return'<span class="chord-root">'+ae(e)+"</span>"+(r||o||n?'<span class="chord-ext">'+(r?ae(r):"")+(o?"<sub>"+o+"</sub>":"")+(n?ae(n):"")+"</span>":"")+(i?co+'<span class="chord-bass">'+ae(i)+"</span>":"")}var Go=D(rt("type"),{barrepeat:t=>v("span",{class:"barrepeat",html:O["barRepeat"+t.count],data:{beat:0,duration:t.duration}}),clef:t=>v("span",{class:`${t.clef}-clef clef`,html:Ep[t.clef]}),chord:t=>v("abbr",{class:"chord chord-abbr",title:"",html:t.name.replace(vp,Sp),data:{beat:$(4,t.beat),duration:$(4,t.duration),event:at(t.event)}}),timesig:t=>t.stave.getTimeSigHTML?v("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,at(t.event))):v("span",{class:"timesig",html:`<sup>${O["timeSig"+t.numerator]}</sup>
                <sub>${O["timeSig"+t.denominator]}</sub>`,data:{event:at(t.event)}}),symbolcoda:t=>v("p",{html:ao,class:"coda"}),barcount:t=>v("span",{html:t.text,class:"barcount"}),text:t=>v("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:$(4,t.beat),duration:$(4,t.duration),event:at(t.event)}}),acci:t=>v("span",{class:(xp[t.value]||"acci")+(t.clump?" acci-"+t.clump:"")+(t.cluster?" acci-cluster":""),html:yp[t.value]||Tt,data:{beat:t.beat&&$(4,t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&at(t.event)}}),accent:t=>{let e=t.dynamic>=I.marcatoThreshold,r=t.stave.type==="drum"||t.stave.type==="percussion";return v("span",{class:`${t.stemup?"up":"down"}-accent accent${e?" marcato-accent":""}`,html:r?e?t.stemup?Ie:He:t.stemup?qe:Pe:e?t.stemup?He:Ie:t.stemup?Pe:qe,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name,event:at(t.event)}})},ledge:t=>v("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${sr(t.rows)}`:`0 -0.5 5 ${sr(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>v("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${R(t.pitch)})`,data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name,beam:t.beam&&t.beam.id,event:at(t.event)}}),beam:(t,e)=>v("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${sr(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${$(4,t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(sr(t.range)+ct)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*ct} L1,${t.range-.5*ct} L1,${t.range+.5*ct} L0,${.5*ct} Z"></path>`,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name,beam:t.id,events:Rp(t)}}),tie:t=>v("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name,event:at(t.event)}}),tuplet:t=>v("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:O["tuplet"+t.divisor],data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>v("span",{class:"rest",html:bp[t.duration.toFixed(2)]||O["rest"+(t.duration+"").replace(".","")]||"",data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});var Oi=globalThis||window,ce={pink:"#FE267E",grey:"#81868f"},Ap=Oi.DEBUG&&Oi.DEBUG.scribe!==!1?function(e,r,o="",n=""){console.log("%cScribe %c"+e+" %c"+r+" %c"+o+" %c"+n,"color: "+ce.pink+"; font-weight: 300;","color: "+ce.grey+"; font-weight: 300;","color: "+ce.pink+"; font-weight: 300;","color: "+ce.grey+"; font-weight: 300;","color: "+ce.pink+"; font-weight: 300;")}:L,Ui=Ap;var Dp=globalThis||window;function Np(t){return t[0]<=0&&t[1]==="meter"}function Fp(t){return t[0]<=0&&t[1]==="key"}function Bp(t,e){let r=Go(e);return r&&t.push(r),t}function kp(t,e){return t.push(v("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:X(e.key),stave:e.stave.type},children:e.symbols.reduce(Bp,[])})),t}function Li(t,e,r,o,n,i=1/0,s=0,u=0,a=I){let c=t.events;!c.find(Np)&&n&&c.unshift([0,"meter",n[2],n[3]]),!c.find(Fp)&&o&&c.unshift([0,"key",o]);let p=Ze[r||"treble"],m=[];s&&m.push("transpose",s),u&&m.push("displace",u);let d=new yt(c,t.sequences,m),f=Co(d,e,p,a),g=f.reduce(kp,[]),E=f[0].key,b=p.createSignatureSymbols(E),U=v("div",{class:`${p.type}-stave signature-stave stave`,children:b.map(Go),data:{key:X(E)}}),B=v("div",{id:"side",class:"side",data:{key:X(E)}}),k=24;for(;k--;)B.appendChild(U.cloneNode(!0));return g.unshift(B),g}var Ut=[v("span",{html:_r,style:"width: min-content;"}),v("span",{html:to,style:"width: min-content;"}),v("span",{html:eo,style:"width: min-content;"})];function Cp(t){t.remove()}function ar(t,e=t){e.append.apply(e,Ut);let r=dt(Ut[0]).width,o=dt(Ut[1]).width,n=dt(Ut[2]).width,i=window.getComputedStyle(Ut[0]),s=ui(i.fontSize);Dp.DEBUG&&Ui("post render font-size",s,"heads",`${r}, ${o}, ${n}`),Ut.forEach(Cp);let u=e.querySelector(".side");if(!u)return;let a=u.dataset.key,l={"Gâ™­":6,"Câ™¯":5,"Dâ™­":5,"Gâ™¯":4,"Aâ™­":4,"Dâ™¯":3,"Eâ™­":3,"Bâ™­":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6}[a];return`--head-1-size: ${$(6,r/s)}; --head-2-size: ${$(6,o/s)}; --head-4-size: ${$(6,n/s)}; --signature-width: ${(2.25+l*.625+.625).toFixed(4)}em;`}function ue(t,e=t){e.querySelectorAll(".beam").forEach(Gi)}var qi=Object.assign,Tp=Object.defineProperties,$p=new URL("shadow.css",import.meta.url),cr=A.of(),Pi=new ResizeObserver(t=>{for(let e of t)ue(y(e.target).shadowRoot)}),ww=Tp(vr("scribe-music",{shadow:`
        <link rel="stylesheet" href="${$p}" />
    `,construct:function(t,e){let r=t.querySelector("link");cr.value&&(r.href=cr.value),e.data=A.of(),e.clef=A.of("treble"),e.key=A.of("C"),e.meter=A.of(),e.beat=A.of(0),e.duration=A.of(1/0),e.transpose=A.of(0),e.excludes=A.of([]),e.swingAsStraight8ths=A.of(!1),e.swingAsStraight16ths=A.of(!1),e.debug=A.of(!1),e.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(t,e){if(e.isSafari&&this.classList.add("safari"),Pi.observe(this,{box:"content-box"}),!this.src){let r=this.textContent.trim();e.data.value=Et(this.type,r)}return A.frame(()=>{if(!e.data.value)return;let r=e.data.value&&Li(Q.from(e.data.value),e.excludes.value,e.clef.value,e.key.value,e.meter.value,e.duration.value,e.transpose.value,e.beat.value,qi({},I,{swingAsStraight8ths:e.swingAsStraight8ths.value,swingAsStraight16ths:e.swingAsStraight16ths.value}));if(t.querySelectorAll(".side, .bar, style").forEach(n=>n.remove()),t.append.apply(t,r),!r)return;let o=e.style=v("style",`:host { ${ar(this,t)} }`);t.appendChild(o),ue(this,t),setTimeout(()=>{o.textContent=`:host { ${ar(this,t)} }`,ue(this,t)},2e3)})},load:function(t,{style:e}){e.textContent=`:host { ${ar(this,t)} }`,ue(this,t)},disconnect:function(){Pi.unobserve(this)}},{clef:{attribute:function(t){this.clef=t},get:function(){return y(this).clef.value},set:function(t){if(!Ze[t]){console.warn('<scribe-music> Attempt to set invalid clef="'+t+'" ignored');return}y(this).clef.value=t}},key:{attribute:function(t){this.key=t===""?"C":t},get:function(){return y(this).key.value},set:function(t){let e=y(this);if(typeof t!="string"||!/^[A-G][#bâ™¯â™­]?$/.test(t)){console.warn('<scribe-music> Attempt to set invalid key="'+t+'" ignored');return}e.key.value=t.replace(/[#b]$/,r=>r==="#"?"â™¯":"â™­")}},meter:{attribute:function(t){this.meter=t===""?"4/4":t},get:function(){return Yn(y(this).meter.value)},set:function(t){y(this).meter.value=qi([0],Kn(t))}},beat:{attribute:function(t){this.beat=t},get:function(){return y(this).beat.value},set:function(t){y(this).beat.value=typeof t=="number"?t:parseFloat(t)}},duration:{attribute:function(t){this.duration=t},get:function(){return y(this).duration.value},set:function(t){y(this).duration.value=typeof t=="number"?t:parseFloat(t)}},transpose:{attribute:function(t){this.transpose=t},get:function(){return y(this).transpose.value},set:function(t){y(this).transpose.value=typeof t=="number"?Math.round(t):parseInt(t,10)}},type:{attribute:function(t){this.type=t},writable:!0,value:"application/json"},src:{attribute:function(t){this.src=t},get:function(){return y(this).src},set:function(t){let e=y(this);e.src=t;let r=new URL(t,window.location);if(window.location.origin===r.origin&&window.location.pathname===r.pathname){let o=this.getRootNode().getElementById(r.hash.slice(1));if(!o)throw new Error('<scribe-music> src script "'+t+'" not found in document');this.data=JSON.parse(o.textContent)}else Xn(this.type,r.href).then(o=>this.data=o)},default:null},data:{get:function(){return y(this).data.value},set:function(t){y(this).data.value=t},default:null},swing:{attribute:function(t){y(this).swingAsStraight8ths.value=t!==null}},shuffle:{attribute:function(t){y(this).swingAsStraight16ths.value=t!==null}},debug:{attribute:function(t){this.debug=t!==null},get:function(){return y(this).debug.value},set:function(t){y(this).debug.value=!!t}},excludes:{attribute:function(t){return y(this).excludes.value=t.split(/\s+/)}}},"stephband.band/scribe/"),{stylesheet:{set:t=>cr.value=t,get:()=>cr.value}});export{ww as default};
//# sourceMappingURL=element.js.map
