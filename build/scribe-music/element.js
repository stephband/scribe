/* Scribe 
   0.4.18
   By stephband */

var io=Object.defineProperty;var so=(e,t)=>{for(var n in t)io(e,n,{get:t[n],enumerable:!0})};var k,et;function ao(e,t){let n=-1;for(;e[++n]&&e[n]!==t;);for(;e[n++];)e[n-1]=e[n]}function Be(e){let t=0;for(;e[--t];)e[t].stop&&e[t].stop(),e[t]=void 0}function bt(e,t){let n=0;for(;t[--n]&&t[n]!==e;);for(t[n]=e,n=-1;e[++n]&&e[n]!==t;);e[n]=t}function lt(e){let t=-1,n;for(;n=e[++t];)e[t]=void 0,n.invalidate(e)}function Fe(e,t){let n=0;for(;e[--n];)if(e[n]===t)return!0}var v=class e{static isSignal(t){return t instanceof e}static of(t){return new De(t)}static from(t,n){if(t.then){let r=e.of();return t.then(o=>r.value=o),r}return t.pipe?t.pipe(new Se):new qt(t,n)}static compute(t,n){return new qt(t,n)}static fromProperty(t,n){return new Ce(t,n)}static frame(t){return new Ut(t)}static tick(t){return new Ht(t)}static temporal(t,n){return new Ae(t,n)}static evaluate(t,n,r=t){let o=k;k=t,o||(et=!1);let i=n.apply(r);return k=o,i}static get hasInvalidDependency(){return et}static get evaluating(){return k}constructor(t){t&&(this.name=t)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},De=class extends v{#t;constructor(t){super(),this.#t=t}get value(){return k&&bt(this,k),this.#t}set value(t){this.#t!==t&&(this.#t=t,lt(this))}},Se=class extends v{#t;constructor(t){super(),this.#t=t}get value(){return k&&bt(this,k),this.#t}push(t){this.#t!==t&&(this.#t=t,lt(this))}},Ce=class extends v{#t;#e;constructor(t,n){super(t),this.object=n}evaluate(){return this.object[this.name]}get value(){return k&&bt(this,k),this.#t?this.#e:(this.#e=v.evaluate(this,this.evaluate,this),et||(this.#t=!0),this.#e)}set value(t){if(this.#e===t)return;let{object:n,name:r}=this;n[r]=t,t=n[r],this.#e!==t&&(this.#e=t,lt(this))}invalidate(t){this.#t&&(t&&!Fe(this,t)||(this.#t=!1,Be(this),lt(this)))}},qt=class extends v{#t;#e;#n;#r;constructor(t,n){super(),this.#t=t,this.#e=n}get value(){return k&&bt(this,k),this.#n?this.#r:(this.#r=v.evaluate(this,this.#t,this.#e),et||(this.#n=!0),this.#r)}invalidate(t){this.#n&&(t&&!Fe(this,t)||(this.#n=!1,Be(this),lt(this)))}},Ae=class extends v{#t=0;constructor(t,n){super(t),this.object=n}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return v.evaluating&&(bt(this,k),this.getTime()<this.#t&&(et=!0)),this.evaluate()}set value(t){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==t&&(this.object[this.name]=t,invalidateUntil(this.getTime()))}invalidateUntil(t){let r=this.getTime()>=this.#t;this.#t=t,r&&lt(this)}},$t=class extends v{constructor(t){if(super(),k){let n=0;for(;k[--n]&&k[n]!==this;);k[n]=this}t&&(this.evaluate=t,(v.evaluate(this,this.evaluate)||et)&&this.cue())}invalidate(t){this.constructor.observers.indexOf(this)===-1&&(t&&!Fe(this,t)||(Be(this),this.cue()))}stop(){let t=0,n;for(;n=this[--t];){let i=-1;this[t]=void 0,n.stop?n.stop():ao(n,this)}let r=this.constructor.observers,o=r.indexOf(this);if(o!==-1){if(r===Re)throw new Error("Attempt to remove observer while observers is rendering");r.splice(o,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},Re;function qn(e){let t=-1,n;for(Re=e;n=e[++t];)!v.evaluate(n,n.evaluate)&&!et&&e.splice(t--,1);return Re=void 0,e}var $n=Promise.resolve();function Hn(){qn(Ht.observers).length&&$n.then(Hn)}var Ht=class extends $t{static observers=[];cue(){let t=this.constructor.observers;t.length||$n.then(Hn),t.push(this)}};function Un(){qn(Ut.observers).length&&requestAnimationFrame(Un)}var Ut=class extends $t{static observers=[];cue(){let t=this.constructor.observers;t.length||window.requestAnimationFrame(Un),t.push(this)}};function co(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Ne(e){return e===window?co():e.getClientRects()[0]||e.getBoundingClientRect()}function $(e){return e}function R(e,t){return function(){let r=e.apply(this,arguments),o=t[r]||t.default;if(!o)throw new Error('overload() no function defined for key "'+r+'"');return o.apply(this,arguments)}}function pt(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var o=e(r);return t.set(r,o),o}}var uo=Array.prototype;function lo(e,t){return typeof e=="function"?e.apply(null,t):e}function In(e,t,n){n=n||e.length;var r=n===1?t?e:pt(e):pt(function(o){return In(function(){var i=[o];return i.push.apply(i,arguments),e.apply(null,i)},t,n-1)});return function o(i){return arguments.length===0?o:arguments.length===1?r(i):arguments.length>=n?e.apply(null,arguments):lo(r(i),uo.slice.call(arguments,1))}}var X=In;function G(){}var po=R($,{is:G,tag:G,data:function(e,t,n){for(e in n)n[e]===void 0&&delete n[e];Object.assign(t.dataset,n)},dataset:function(e,t,n){for(e in n)n[e]===void 0&&delete n[e];Object.assign(t.dataset,n)},html:function(e,t,n){t.innerHTML=n},text:function(e,t,n){t.textContent=n},style:R((e,t,n)=>typeof n,{string:(e,t,n)=>t.style=n,object:(e,t,n)=>Object.assign(t.style,n)}),children:function(e,t,n){t.innerHTML="",t.append.apply(t,n)},href:function(e,t,n){t instanceof SVGElement?t.setAttribute("href",n):t.href=n},points:j,cx:j,cy:j,r:j,x:j,y:j,dx:j,dy:j,transform:j,preserveAspectRatio:j,viewBox:j,default:function(e,t,n){e in t?t[e]=n:t.setAttribute(e,n)}});function j(e,t,n){t.setAttribute(e,n)}function fo(e,t){for(var n=Object.keys(t),r=n.length;r--;)t[n[r]]!==void 0&&po(n[r],e,t[n[r]]);return e}var It=X(fo,!0);var Te="http://www.w3.org/2000/svg",Xn=document.createElement("template"),ke=(e,t)=>t&&typeof t;function Wn(e,t=""){let n=document.createRange();return n.selectNode(e),n.createContextualFragment(t)}var M=R(ke,{string:function(e,t){let n=document.createElementNS(Te,e);return n.innerHTML=t,n},object:function(e,t){let n=document.createElementNS(Te,e);return typeof t.length=="number"?n.append.apply(n,t):It(n,t),n},default:e=>document.createElementNS(Te,e)}),ho=R(ke,{string:function(e,t){let n=document.createElement(e);return n.innerHTML=t,n},object:function(e,t){let n=document.createElement(e);return typeof t.length=="number"?n.append.apply(n,t):It(n,t),n},default:e=>document.createElement(e)}),mo=R($,{comment:function(e,t){return document.createComment(t||"")},fragment:R(ke,{string:function(e,t,n){return n?Wn(n,t):(Xn.innerHTML=t,Xn.content.cloneNode(!0))},object:function(e,t,n){let r=n?Wn(n):document.createDocumentFragment();return typeof t.length=="number"?r.append.apply(r,t):It(r,t),r},default:()=>document.createDocumentFragment()}),circle:M,ellipse:M,g:M,glyph:M,image:M,line:M,rect:M,use:M,path:M,pattern:M,polygon:M,polyline:M,svg:M,tspan:M,text:M,default:ho}),b=mo;function Ge(e,t,n){let r;typeof n!="string"&&n.input!==void 0&&n.index!==void 0&&(r=n,n=r.input.slice(n.index+n[0].length+(n.consumed||0)));let o=e.exec(n);if(!o)return;let i=t(o);return r&&(r.consumed=(r.consumed||0)+o.index+o[0].length+(o.consumed||0)),i}var Mc=X(Ge,!0);function go(e,t,n){throw n.input!==void 0&&n.index!==void 0&&(n=n.input),new Error('Cannot parse string "'+(n.length>128?n.length.slice(0,128)+"…":n)+'"')}function xo(e,t,n){let r=-1;for(;++r<n.length;)t=n[r]!==void 0&&e[r]?e[r](t,n):t;return e.done?e.done(t,n):e.close?e.close(t,n):t}function wo(e,t,n,r){let o=Ge(e,i=>xo(t,n,i),r);return o===void 0?t.catch?t.catch(n,r):go(e,t,r):o}var jn=X(wo,!0);var zn=Symbol("internals");function Pe(e,t,n){return t[zn]=t.attachInternals&&!t.getAttribute("is")?t.attachInternals():{shadowRoot:n}}function x(e){return e[zn]}var Vn=Object.defineProperties;var Oe={},Eo={name:{set:function(e){return this.setAttribute("name",e)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return x(this).form}},labels:{get:function(){return x(this).labels}},validity:{get:function(){return x(this).validity}},validationMessage:{get:function(){return x(this).validationMessage}},willValidate:{get:function(){return x(this).willValidate}},checkValidity:{value:function(){return x(this).checkValidity()}},reportValidity:{value:function(){return x(this).reportValidity()}}},Me=!1,yo=jn(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(e,t)=>({name:t[1]}),2:(e,t)=>({name:t[3],tag:t[2]}),catch:function(e,t){throw new SyntaxError(`dom element() – name must be of the form 'element-name' or 'tag is="element-name"' (`+t+")")}},null),Kn={once:!0};function bo(e){return e.sheet?Promise.resolve({target:e}):new Promise((t,n)=>{e.addEventListener("load",t,Kn),e.addEventListener("error",n,Kn)})}function vo(e){e.stop()}function Do(e){if(Oe[e])return Oe[e];let t=document.createElement(e).constructor;if(t===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+e+"> is HTMLUnknownElement");return Oe[e]=t}function So(e,t){if(e.hasOwnProperty(t)){let n=e[t];delete e[t],e[t]=n}return e}function Jn(e,t){let n=e.attachShadow({mode:t.mode||"closed",delegatesFocus:t.focusable||!1});if(t.stylesheet){let r=b("link",{rel:"stylesheet",href:t.stylesheet});n.append(r)}return n}function Co(e,t){return typeof t=="string"?t[0]==="#"?e.appendChild(document.getElementById(t.slice(1)).content.clone(!0)):e.innerHTML=t:e.appendChild(t.content.clone(!0)),e}function Ao(e){let t=e.isUpgraded;return e.isUpgraded=!0,!t}function Qn(e,t){return Array.from(e.querySelectorAll('[is="'+t+'"]')).filter(Ao)}var Ro=R((e,t)=>typeof t,{object:(e,t)=>t,function:(e,t)=>({value:t}),default:(e,t)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof t)}});function Le(e,t={},n={},r=""){let{name:o,tag:i}=yo(e),a=typeof i=="string"?Do(i):HTMLElement,l=[],s={},u,f;for(u in n)f=Ro(u,n[u]),f.attribute&&l.push(u),(f.set||f.get||"value"in f)&&(s[u]=f),n[u]=f;function p(){let c=Reflect.construct(a,arguments,p),d=t.mode||typeof t.shadow=="string"?Jn(c,t):void 0;t.shadow&&Co(d,t.shadow);let g=Pe(p,c,d);return i&&(Me=!0),t.construct&&t.construct.call(c,d,g),Object.keys(s).reduce(So,c),c}if(p.prototype=Object.create(a.prototype,s),n.value&&(p.formAssociated=!0,Vn(p.prototype,Eo),(t.enable||t.disable)&&(p.prototype.formDisabledCallback=function(c){let d=x(this);return c?t.disable&&t.disable.call(this,d.shadowRoot,d):t.enable&&t.enable.call(this,d.shadowRoot,d)}),t.reset&&(p.prototype.formResetCallback=function(){let c=x(this);return t.reset.call(this,c.shadowRoot,c)}),t.restore&&(p.prototype.formStateRestoreCallback=function(){let c=x(this);return t.restore.call(this,c.shadowRoot,c)})),l.length&&(p.observedAttributes=l,p.prototype.attributeChangedCallback=function(c,d,g){return n[c].attribute.call(this,g)}),t.connect&&(p.prototype.connectedCallback=function(){let c=x(this),d=c.shadowRoot;if(c.stopable=t.connect.call(this,d,c),!d)return;let g=d.querySelectorAll('link[rel="stylesheet"]');if(g.length){let h=b("style","*:not(slot), slot:not([name]) { display: none !important; }");d.prepend(h);let m;c.loadPromise?m=c.loadPromise.then(()=>new Promise(requestAnimationFrame)):m=c.loadPromise=Promise.all(Array.from(g,bo)),m.finally(()=>{h.remove(),t.load&&t.load.call(this,d,c)})}else t.load&&t.load.call(this,d,c)}),p.prototype.disconnectedCallback=function(){let c=x(this);c.stopable&&(c.stopable.stop?c.stopable.stop():c.stopable.forEach(vo)),t.disconnect&&t.disconnect.call(this,c.shadowRoot,c)},window.console&&window.console.log("%c<"+(i?i+" is="+o:o)+">%c "+r,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(o,p,i&&{extends:i}),i&&!Me){let c=document.createElement("div");if(c.style.position="fixed",c.style.left="-1000px",c.style.top="-1000px",c.innerHTML="<"+i+' is="'+o+'"></'+i+">",document.body.append(c),c.remove(),Me)p.polyfillByRoot=G;else{let d=function(h){let m={};Object.keys(s).forEach(C=>{h[C]!==void 0&&(m[C]=h[C])}),Vn(h,s);let w=t.mode||t.shadow?Jn(h,t):void 0,E=Pe(p,h,w);t.construct&&t.construct.call(h,w,E),Object.assign(h,m);let y=-1,T;for(;T=l[++y];){let C=h.attributes[T];C&&n[T].attribute.call(h,C.value)}t.connect&&t.connect.call(h,w,E)},g=function(h){Qn(h,o).forEach(d),new MutationObserver(()=>Qn(h,o).forEach(d)).observe(h,{childList:!0,subtree:!0})};p.polyfillByRoot=g,g(document)}}else p.polyfillByRoot=G;return p}var Xt=e=>typeof e;var Bo=Object.defineProperties,Zn=R(Xt,{function:e=>e(),object:e=>e.stop()}),nt=class extends ${#t;stop(){if(this.status==="done")return this;this.status="done";let t=this.#t;return this.#t=void 0,t&&t.forEach(Zn),this}done(t){return this.status==="done"?(Zn(listener),this):((this.#t||(this.#t=[])).push(t),this)}};Bo(nt.prototype,{status:{writable:!0}});function Fo(e){throw new TypeError("Stream cannot be created .from() "+typeof e)}function L(e,t){if(t===void 0)return;let n=-1;for(;e[++n];)e[n].push(t);return e}function No(e){nt.prototype.stop.apply(e);let t=-1,n;for(;n=e[++t];)e[t]=void 0,n.stop&&(je(n,e),n[-1]||n.stop());return e}function je(e,t){let n=0;for(;e[--n]&&e[n]!==t;);for(;e[n--];)e[n+1]=e[n]}function Yn(e,t){let n=-1;for(;e[++n]&&e[n]!==t;);for(;e[n++];)e[n-1]=e[n]}function To(e,t){je(t,e),Yn(e,t)}var vt=class extends nt{stop(){if(this.status==="done")return this;let t;for(;t=this[-1];){let n=-1;for(;this[n--];)this[n+1]=this[n];Yn(t,this),t.stop&&!t[0]&&t.stop(t)}return super.stop()}},Wt=class extends vt{constructor(t){super(),this.push=t}},jt=class extends vt{constructor(t,n){super(),this.fn=t,this.value=n,this.i=0}push(t){let n=this.fn;this.value=n(this.value,t,this.i++,this)}},P=class extends vt{start(){if(this.status)return this;let t=0,n;t:for(;n=this[--t];){let r=-1;for(;n[++r];)if(n[r]===this)continue t;n[r]=this,r===0&&n.start&&n.start()}return this}stop(){if(this.status==="done")return this;super.stop();let t=-1,n;for(;n=this[++t];)this[t]=void 0,n.stop&&(je(n,this),n[-1]||n.stop());return this}pipe(t){if(t.stop){let r=0;for(;t[--r]&&t[r]!==this;);t[r]=this}if(t.start&&!(t[0]||t.status==="running"))return t;let n=-1;for(;this[++n]&&this[n]!==t;);return this[n]=t,n||this.start(),t}each(t){return this.pipe(new Wt(t))}buffer(...t){return this.pipe(new ft(t))}filter(t){return this.pipe(new $e(t))}flatMap(t){return this.pipe(new He(t))}map(t){return this.pipe(new Vt(t))}reduce(t,n){return this.pipe(new jt(t,n)).value}scan(t,n){return this.pipe(new Ie(t,n))}slice(t,n){return this.pipe(new Xe(t,n))}split(t){return this.pipe(new We(t))}[Symbol.asyncIterator]=async function*(){let t=[],n=o=>t.push(o);function r(o,i){n=o}for(this.each(o=>n(o)).done(()=>n=G);n!==G;)yield t.length?t.shift():await new Promise(r)};static from=R(Xt,{function:t=>new Vt(t),object:t=>typeof t.pipe=="function"?t:typeof t.then=="function"?new qe(t):typeof t.length=="number"?new ft(Array.from(t)):Fo(t)});static of(...t){return t.length<2?new zt(t[0]):new ft(t)}static buffer(t){return new ft(t)}static value(t){return new zt(t)}static merge(...t){return new Ue(t)}static push=L;static stop=No;static unpipe=To;static each(t){return new Wt(t)}static reduce(t,n){return new jt(t,n)}},qe=class extends P{constructor(t){super(),this.promise=t}start(){return this.promise.then(t=>L(this,t)).finally(()=>this.stop()),this}},zt=class extends P{constructor(t){super(),this.value=t}start(){return this.value!==void 0&&(L(this,this.value),this.status==="done")?this:super.start()}push(t){return this.value=t,L(this,t)}},ft=class extends P{constructor(t){super(),this.values=t||[]}start(){let t=this.values;if(!t)return super.start();let n=-1;for(;n++<t.length;)if(L(this,t[n]),this.status==="done")return this;return this.values=void 0,super.start()}push(t){return this.value=t,this.values?this.values.push(this.value):L(this,this.value)}},$e=class extends P{constructor(t){super(),this.fn=t}push(t){let n=this.fn;return n(t)&&L(this,t)}},He=class extends P{constructor(t){super(),this.fn=t}push(t){let n=this.fn,r=n(t);if(r!==void 0)if(isIterable(r))for(let o of r)L(this,o);else r.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(r.each(o=>L(this,o)))):r.then&&r.then(o=>L(this,o))}},Vt=class extends P{constructor(t){super(),this.fn=t}push(t){let n=this.fn,r=n(t);return r!==void 0&&L(this,r)}},Ue=class extends P{constructor(t){super(),this.inputs=t}push(t){return L(this,t)}pipe(t){let n=-1,r;for(;r=this.inputs[++n];)P.from(r).pipe(this);return P.prototype.pipe.call(this,t)}},Ie=class extends P{constructor(t,n){super(),this.fn=t,this.value=n}push(t){let n=this.fn;this.value=n(this.value,t),L(this,this.value)}},Xe=class extends P{constructor(t,n=1/0){super(),this.index=-t,this.indexEnd=n-t}push(t){++this.index>0&&L(this,t),this.index===this.indexEnd&&this.stop()}},We=class extends P{constructor(t){super(),this.chunk=[],typeof t=="number"?this.n=t:this.fn=t}fn(){return this.chunk.length===this.n}push(t){let n=this.chunk;this.fn(t)?(L(this,n),this.chunk=[]):n.push(t)}};var lu={fullscreenchange:pt(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},ko=0;window.addEventListener("click",e=>ko=e.timeStamp);function ze(e){return function(){return arguments[e]}}function Ve(e){return e}function rt(){}function z(){return this}var _n=Object.create,Go=Object.freeze,tr=Go(_n(_n(Object.prototype,{at:{value:rt},shift:{value:rt},push:{value:rt},forEach:{value:rt},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:z},find:{value:rt},findIndex:{value:function(){return-1}},flat:{value:z},flatMap:{value:z},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:z},reduce:{value:ze(1)},sort:{value:z},each:{value:z},pipe:{value:Ve},start:{value:z},stop:{value:z},done:{value:z},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Ke(e,t){return(t%e+e)%e}var er=e=>Ke(12,e);var Po=/^([A-G][♭♯#b]?)(-?\d)$/,Oo=/^[A-G][♭♯#b]?/,Mo=/-?\d$/,Lo=/[Hh]z$/,Dt={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},Je={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Low Bass Drum",36:"High Bass Drum",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Floor Tom",42:"Closed Hi-hat",43:"High Floor Tom",44:"Pedal Hi-hat",45:"Low Tom",46:"Open Hi-hat",47:"Low Mid Tom",48:"High Mid Tom",49:"Crash Cymbal 1",50:"High Tom",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function nr(e){return e.toLowerCase().replace(/\s+/g,"-")}for(let e in Je)Dt[nr(Je[e])]=parseInt(e,10);var qo=69;function $o(e,t=440){var n=qo+12*Math.log(e/t)/Math.log(2);return Math.fround(n)}function D(e){if(typeof e=="number")return e;if(Lo.test(e))return $o(parseFloat(e));let t=Po.exec(e);return t?(parseInt(t[2],10)+1)*12+Dt[t[1]]:Dt[nr(e)]}function B(e){return typeof e=="number"?er(e):Dt[Oo.exec(e)[0]]}var Kt=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function Q(e){return H(e)+Jt(e)}function H(e){return Kt[er(e)]}function Jt(e){return typeof e=="number"?Math.floor(e/12)-1:Number(Dt[(Mo.exec(name)||tr)[0]])}function rr(e){let t=D(e);return Je[t]||""}function Qe(e){var t={};return function(r){return r in t?t[r]:t[r]=e(r)}}function Qt(e){return function(n,...r){var o=e[n]||e.default;return o&&o.apply(this,r)}}var Ho={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function Ze(e,t){if(t){var n=Ho[e.toLowerCase()]||e,r;try{r=new window.DOMParser().parseFromString(t,n)}catch{return}if(!r||r.getElementsByTagName("parsererror").length)throw new Error("Invalid "+e.toUpperCase()+": "+t);return r}}function or(e){return Ze("html",e)}function ir(e){return Ze("svg",e)}var Y=Object.assign,ht={headers:function(e){return{}},body:$},Uo=Qt({"application/x-www-form-urlencoded":function(e){return Y(e,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(e){return Y(e,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(e){return Y(e,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(e){return Y(e,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(e){return Y(e,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(e){return Y(e,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(e){return Y(e,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(e){return Y(e,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),Io=Qt({"application/json":function(e){return e instanceof FormData?Xo(e):JSON.stringify(e)},"application/x-www-form-urlencoded":function(e){return e instanceof FormData?ar(e):cr(e)},"multipart/form-data":function(e){return e instanceof FormData?e:Wo(e)},default:$});function Xo(e){return JSON.stringify(Array.from(e.entries()).reduce(function(t,n){return t[n[0]]=n[1],t},{}))}function ar(e){return new URLSearchParams(e).toString()}function cr(e){return Object.keys(e).reduce((t,n)=>(t.append(n,e[n]),t),new URLSearchParams)}function Wo(e){throw new Error("TODO: dataToFormData(data)")}function jo(e,t){return t instanceof FormData?e+"?"+ar(t):e+"?"+cr(t)}function zo(e,t,n,r){let o=typeof n=="string"?n:n&&n["Content-Type"]||"application/json",i=Uo(o,Y(ht.headers&&t?ht.headers(t):{},typeof n=="string"?{}:n)),a={method:e,mode:"cors",headers:i,credentials:"same-origin",signal:r&&r.signal};return e!=="GET"&&(a.body=Io(o,ht.body?ht.body(t):t)),a}function Zt(e){return e.blob()}function Vo(e){return e.json().catch(t=>{throw new Error("Cannot parse JSON "+e.url+". "+t.message)})}function sr(e){return e.formData()}function Ko(e){return e.text()}function Jo(e){return e.text().then(t=>/^\s*<!DOCTYPE html>/.test(t)?or(t):b("fragment",t))}function Qo(e){return e.text().then(t=>/^\s*<\?xml/.test(t)?ir(t):(console.warn("Untested SVG fragment parsing in request.js!"),b("fragment",t)))}var Zo={"text/plain":Ko,"text/html":Jo,"image/svg+xml":Qo,"application/json":Vo,"multipart/form-data":sr,"application/x-www-form-urlencoded":sr,audio:Zt,"audio/wav":Zt,"audio/m4a":Zt,"application/zip":Zt};function Yo(e){if(ht.onresponse&&(e=ht.onresponse(e)),!e.ok)throw new Error(e.statusText+"");let t=e.headers.get("Content-Type");if(!t)return;let n=t.replace(/\;.*$/,"");return Zo[n](e)}function ur(e="GET",t,n={},r="application/json"){e=e.toUpperCase(),e==="GET"&&n&&(t=jo(t,n));let o=zo(e,n,r,arguments[4]);return fetch(t,o).then(Yo)}function lr(e){return ur("GET",e)}var _o={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},ti=/^[ABCDEFG][b♭#♯]{0,1}-?\d$/,pr=/^[ABCDEFG][b♭#♯]{0,1}/;function Ye(e){let t=e.trim().split(/\s+/),n=[],r=-1;for(;t[++r]!==void 0;){let o=Number(t[r]),i=t[++r];ti.test(i)?(i="note",--r):pr.test(i)&&(i="chord",--r);let a=[o,i],l=_o[i];if(l===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let s=pr.exec(t[++r])[0],u=t[r].slice(s.length)||t[++r],f=Number(t[++r]);a.push(s,u,f)}else for(;l--;){let s=Number(t[++r]);a.push(Number.isNaN(s)?t[r]:s)}n.push(a)}return n}function ei(e){let t=e.files[Object.keys(e.files)[0]];return ot(t.type,t.content)}function ni(e){let t=e.settings.find(matches({id:13324}))||e.settings[0];return ot("abc",t.abc)}function ot(e,t){if(typeof t=="object")return t.files?ei(t):t.settings?ni():Array.isArray(t)?{id:0,events:t}:t;if(e==="sequence"||e==="text/plain")return{events:Ye(t)};{let n=JSON.parse(t);return Array.isArray(n)?{id:0,events:n}:n}}var ri=Qe(lr);var fr=R((e,t)=>typeof t,{string:function(e,t){return ri(t).then(n=>ot(e,n)).catch(n=>console.error(n))},default:function(e,t,n,r){t[e]=r}});var oi=/^(\d+)\/(\d+)$/;function hr(e){let t=oi.exec(e),n=parseInt(t[1],10),r=4/parseInt(t[2],10);return{1:"meter",2:n*r,3:r}}function dr(e){let t=e[2],n=e[3],r=t/n,o=4/n;return r+"/"+o}var N={};so(N,{acciDoubleFlat:()=>_e,acciDoubleSharp:()=>tn,acciFlat:()=>_t,acciNatural:()=>te,acciParensLeft:()=>xi,acciParensRight:()=>wi,acciSharp:()=>ee,augmentationDot:()=>Ii,barLine:()=>ps,barRepeat1:()=>fs,barRepeat2:()=>hs,barRepeat4:()=>ds,barRepeatBegin:()=>ws,barRepeatDots:()=>bs,barRepeatEnd:()=>Es,barRepeatEndBegin:()=>ys,barRepeatLowerDot:()=>xs,barRepeatSlash:()=>ms,barRepeatUpperDot:()=>gs,chordAugmented:()=>Ps,chordBassSlash:()=>ln,chordBracketLeft:()=>$s,chordBracketRight:()=>Hs,chordDiminished:()=>ks,chordGlyphs:()=>Us,chordHalfDiminished:()=>Gs,chordMajorSeventh:()=>Os,chordMinor:()=>Ms,chordParensLeftTall:()=>Ls,chordParensRightTall:()=>qs,clefAlto:()=>Rt,clefBass:()=>Bt,clefDrum:()=>Yt,clefTreble:()=>St,clefTrebleDown:()=>Ct,clefTrebleUp:()=>At,coda:()=>un,graceNoteStemDown:()=>Zi,graceNoteStemUp:()=>Qi,head1:()=>Ei,head2:()=>yi,head4:()=>bi,headBracketLeft:()=>en,headBracketRight:()=>nn,headCircle:()=>Ri,headCircleX:()=>Bi,headDiamond:()=>Di,headDiamondWide:()=>Si,headPlus:()=>Ai,headSlashHorizontalEnds:()=>Ti,headSlashVerticalEnds:()=>Ni,headSlashed2:()=>vi,headTriangleUp:()=>Fi,headX:()=>Ci,metDot:()=>Ji,metNote05Down:()=>Ki,metNote05Up:()=>ji,metNote1Down:()=>Vi,metNote1Up:()=>Wi,metNote2Down:()=>zi,metNote2Up:()=>Xi,note0125Down:()=>Ui,note0125Up:()=>Mi,note025Down:()=>Hi,note025Up:()=>Oi,note05Down:()=>$i,note05Up:()=>Pi,note1Down:()=>qi,note1Up:()=>Gi,note2Down:()=>Li,note2Up:()=>ki,rest0125:()=>rn,rest01875:()=>os,rest025:()=>on,rest0375:()=>is,rest05:()=>sn,rest075:()=>ss,rest1:()=>an,rest15:()=>as,rest2:()=>cn,rest3:()=>cs,rest4:()=>us,rest6:()=>ls,tailDown0125:()=>rs,tailDown025:()=>es,tailDown05:()=>_i,tailUp0125:()=>ns,tailUp025:()=>ts,tailUp05:()=>Yi,textBeam16Long:()=>Zs,textBeam16Short:()=>Qs,textBeam8Long:()=>Js,textBeam8Short:()=>Ks,textDot:()=>Ys,textNote16Long:()=>Vs,textNote16Short:()=>zs,textNote8Long:()=>js,textNote8Short:()=>Ws,textNoteLong:()=>Xs,textNoteShort:()=>Is,textTie:()=>_s,textTuplet3Long:()=>oa,textTuplet3Short:()=>ea,textTupletBeginLong:()=>ra,textTupletBeginShort:()=>ta,textTupletEndLong:()=>ia,textTupletEndShort:()=>na,timeSig0:()=>ii,timeSig1:()=>si,timeSig2:()=>ai,timeSig3:()=>ci,timeSig4:()=>ui,timeSig5:()=>li,timeSig6:()=>pi,timeSig7:()=>fi,timeSig8:()=>hi,timeSig9:()=>di,timeSigCommon:()=>mi,timeSigCutCommon:()=>gi,tuplet0:()=>vs,tuplet1:()=>Ds,tuplet2:()=>Ss,tuplet3:()=>Cs,tuplet4:()=>As,tuplet5:()=>Rs,tuplet6:()=>Bs,tuplet7:()=>Fs,tuplet8:()=>Ns,tuplet9:()=>Ts});var St="&#xE050;",Ct="&#xE052;",At="&#xE053;",Rt="&#xE05C;",Bt="&#xE062;",Yt="&#xE069;",ii="&#xE080;",si="&#xE081;",ai="&#xE082;",ci="&#xE083;",ui="&#xE084;",li="&#xE085;",pi="&#xE086;",fi="&#xE087;",hi="&#xE088;",di="&#xE089;",mi="&#xE08A;",gi="&#xE08B;",_e="&#xE264;",_t="&#xE260;",te="&#xE261;",ee="&#xE262;",tn="&#xE263;",xi="&#xE26A;",wi="&#xE26B;",Ei="&#xE0A4;",yi="&#xE0A3;",bi="&#xE0A2;",en="&#xE0F5;",nn="&#xE0F6;",vi="&#xE0D0;",Di="&#xE0DB;",Si="&#xE0DC;",Ci="&#xE0A9;",Ai="&#xE0AF;",Ri="&#xE0E8;",Bi="&#xE0B3;",Fi="&#xE0BE;",Ni="&#xE100;",Ti="&#xE101;",ki="&#xE1D3;",Gi="&#xE1D5;",Pi="&#xE1D7;",Oi="&#xE1D9;",Mi="&#xE1DB;",Li="&#xE1D4;",qi="&#xE1D6;",$i="&#xE1D8;",Hi="&#xE1DA;",Ui="&#xE1DC;",Ii="&#xE1E7;",Xi="&#xECA3;",Wi="&#xECA5;",ji="&#xECA7;",zi="&#xECA4;",Vi="&#xECA6;",Ki="&#xECA8;",Ji="&#xECB7;",Qi="&#xE560;",Zi="&#xE561;",Yi="&#xE240;",_i="&#xE241;",ts="&#xE242;",es="&#xE243;",ns="&#xE244;",rs="&#xE245;",rn="&#xE4E8;",os="&#xE4E8;&#xE1E7;",on="&#xE4E7;",is="&#xE4E7;&#xE1E7;",sn="&#xE4E6;",ss="&#xE4E6;&#xE1E7;",an="&#xE4E5;",as="&#xE4E5;&#x200A;&#xE1E7;",cn="&#xE4E4;",cs="&#xE4E4;&#x200A;&#xE1E7;",us="&#xE4E3;",ls="&#xE4E3;&#x200A;&#xE1E7;",ps="&#xE030",fs="&#xE500;",hs="&#xE501;",ds="&#xE502;",ms="&#xE504;",gs="&#xE503;",xs="&#xE505;",ws="&#xE040",Es="&#xE041",ys="&#xE042",bs="&#xE043",un="&#xE048",vs="&#xE880;",Ds="&#xE881;",Ss="&#xE882;",Cs="&#xE883;",As="&#xE884;",Rs="&#xE885;",Bs="&#xE886;",Fs="&#xE887;",Ns="&#xE888;",Ts="&#xE889;",ks="&#xE870;",Gs="&#xE871;",Ps="&#xE872;",Os="&#xE873;",Ms="&#xE874;",Ls="&#xE875;",qs="&#xE876;",$s="(",Hs=")",ln="&#xE87B;",Us={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},Is="&#xE1F0;",Xs="&#xE1F1;",Ws="&#xE1F2;",js="&#xE1F3;",zs="&#xE1F4;",Vs="&#xE1F5;",Ks="&#xE1F7;",Js="&#xE1F8;",Qs="&#xE1F9;",Zs="&#xE1FA;",Ys="&#xE1FC;",_s="&#xE1FD;",ta="&#xE1FE",ea="&#xE1FF",na="&#xE200",ra="&#xE201",oa="&#xE202",ia="&#xE203";function pn(e){return function(){return arguments[e]}}function V(){return this}var mr=Object.create,sa=Object.freeze,ne=sa(mr(mr(Object.prototype,{at:{value:G},shift:{value:G},push:{value:G},forEach:{value:G},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:V},find:{value:G},findIndex:{value:function(){return-1}},flat:{value:V},flatMap:{value:V},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:V},reduce:{value:pn(1)},sort:{value:V},each:{value:V},pipe:{value:$},start:{value:V},stop:{value:V},done:{value:V},valueOf:{value:function(){return null}}}),{length:{value:0}}));function W(e){return Math.pow(10,e/20)}var aa=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function fn(e){return function(n){if(typeof n=="number")return n;var r=aa.exec(n);if(!r||!e[r[2]||""]){if(!e.catch)throw new Error('Cannot parse value "'+n+'" (accepted units '+Object.keys(e).join(", ")+")");return r?e.catch(parseFloat(r[1]),r[2]):e.catch(parseFloat(n))}return e[r[2]||""](parseFloat(r[1]))}}var gr={fff:W(-5),ff:W(-10),f:W(-15),mf:W(-20),mp:W(-25),p:W(-30),pp:W(-35),ppp:W(-40)},xr=fn({"":parseFloat,db:W,dB:W,catch:e=>{if(!gr[e])throw new Error('Sequence: dynamic "'+e+'" not recognised');return gr[e]}});var ca=/b|#/g,ua={b:"♭","#":"♯"};function la(e){return ua[e]}function hn(e){switch(e[1]){case"chord":e[2]=B(e[2]),e[3]=e[3].replaceAll(ca,la);break;case"lyric":console.warn('Old data contains "lyric" event, should be "text"'),e[1]="text";break;case"key":e[2]=B(e[2]);break;case"note":e[2]=D(e[2]),e[3]=xr(e[3]);break}return e}var pa=Object.assign,re=Object.defineProperty,oe={writable:!0};function fa(e){let t=[],n=-1;for(;e[++n]!==void 0;)t.push(e[n]);return t}function dt(e){return e.toFixed(4).replace(/\.?0+$/,"")}var mt=class e{constructor(){pa(this,hn(arguments)),re(this,"event",oe),re(this,"events",oe),re(this,"index",oe),re(this,"target",oe)}toJSON(){return fa(this)}toString(){let t=dt(this[0])+" "+this[1];switch(this[1]){case"chord":t+=" "+H(this[2])+" "+this[3]+" "+dt(this[4]);break;case"key":t+=" "+H(this[2]);break;case"note":t+=" "+Q(this[2])+" "+this[3]+" "+dt(this[4]);break;case"param":t+=" "+this[2]+" "+this[3]+" "+dt(this[4])+" "+this[5];break;case"rate":t+=" "+dt(this[2]);break;case"sequence":t+=" "+this[2]+" "+this[3]+" "+dt(this[4]);break;case"start":case"stop":t+=" "+Q(this[2])+" "+this[3];break;default:let n=1;for(;this[++n]!==void 0;)t+=this[n]}return t}static of(...t){return new e(...t)}static from(t,n,r){let o=new e(...t);return o.event=t,o.events=n,o.index=r,o}static isChordEvent=dn;static isNoteEvent=ie;static isSequenceEvent=ha};function dn(e){return e[1]==="chord"}function ie(e){return e[1]==="note"}function ha(e){return e[1]==="sequence"}function da(e,t){return t[e]}var it=X(da,!0);var wr=R(it(1),{chord:e=>e[4],lyric:e=>e[3],note:e=>e[4],sequence:e=>e[4],default:e=>0});function F(e){return e[0]+wr(e)}function gt(e,t){return(t%e+e)%e}function _(e){return gt(12,e)}function Er(e,t){return e>t?1:e<t?-1:0}var q=[0,2,4,5,7,9,11];function ma(e,t,n){return n.indexOf(e)===t}function yr(e,t){return e.map(n=>_(n+t)).filter(ma).sort(Er)}var wn=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function xt(e){return yr(q,e)}var{abs:Nl}=Math,ga={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-6":[0,3,7,9],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"13♭9":[0,1,4,7,9],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},xa=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),wa=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],Tl={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function gn(e){let t=new Float32Array(12),n=B(e+2),r=7;for(;r--;)n=B(n+5),t[n]=1;return t}function xn(e,t,n){let r=e.length;for(;r--;)e[r]*=1-n+n*t[r];return e}var mn={note:(e,t,n=1)=>{let r=D(t[2]),o=gn(r);return xn(e,o,n*(1-r/192))},chord:(e,t,n=1)=>{let r=B(t[2]),o=ga[t[3].replace(/\(|\)/g,"")];if(!o)return console.warn('No scale for chord extension "'+t[3]+'"'),e;let i=o.map(s=>B(r+s)),a=i.length,l;for(;a--;)l=gn(i[a]),xn(e,l,n/i.length*xa[o[a]]);return e}};function ae(e,t,n){let r=e[t],o=r[0],i=ie(r)?gn(D(r[2])):dn(r)?mn.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),r):0;if(n!==void 0){let l=Float32Array.from({length:12},(s,u)=>wa[(u+12-n)%12]);xn(i,l,.3)}let a=t;for(;r=e[--a];){let l=mn[r[1]];if(!l)continue;let s=F(r);if(s>o)l(i,r,.5);else if(r[1]==="note"&&o-s<3){if(1-(o-s)/3>1)throw new Error("Influence should never be > 1 "+o+" "+s);l(i,r,.25*(1-(o-r[0])/3))}}for(a=t;(r=e[++a])&&r[0]-o<2;){if(!ie(r))continue;let l=mn[r[1]];if(l){if(1-(r[0]-o)/2>1)throw new Error("Influence should never be > 1 "+o+" "+stopBeat);l(i,r,.3*(1-(r[0]-o)/2))}}return i}var se=[0,7,5,2,10,9,3,4,8,11,1,6];function ce(e){let t=se.length,n=0,r;for(;t--;)e[se[t]]>n&&(n=e[se[t]],r=se[t]);return r}var vr=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,Ft=/b|♭/,Nt=/#|♯/;var ue=/b|♭|#|♯/g,le={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},br=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function pe(e,t){let n=br.indexOf(e.pitch),r=br.indexOf(t.pitch);return n>r?1:n<r?-1:0}var Dr={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function Sr(e,t){let n=wn[e],r=B(t),o=n.spellings[_(r)];return Kt[_(r-o)]+Dr[o]}function Cr(e,t){let n=wn[e],r,o,i;if(typeof t=="string"){let[s,u,f,p]=vr.exec(t)||[t];p&&(r=D(t),o=n.spellings[_(r)],i=Jt(r-o))}else r=t,o=n.spellings[_(r)],i=Jt(r-o);let a=Kt[_(r-o)],l=Dr[o];return a+l+i}var Ea=globalThis||window;var{floor:Ar,round:Vl}=Math,S=class{constructor(){}clef="";pitched=!0;rows=ne;getNoteHTML(t,n,r){let o=r>=4||Math.fround(r)===Math.fround(2.666666667)?"head4":r>=2||Math.fround(r)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${o}">${N[o]}</span>`}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return Ar(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(t,n){let r=D(this.minPitch),o=D(this.maxPitch),i=D(t)+n;return i>=r&&i<=o?i:void 0}parts=[{name:"main"}];getPart(t){return this.parts[0]}getRow(t,n){let o=(typeof n=="string"?n:Q(n)).replace(ue,""),i=this.rows.indexOf(o);if(Ea.DEBUG&&i===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+n+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getSpelling(t,n){return n[1]==="chord"?Sr(t,n[2]):Cr(t,n[2])}createKeySymbols(t){let n=[],r=B(t),o=xt(r);return n.push.apply(n,o.map((i,a)=>i-q[a]&&{type:"acci",pitch:H(q[a])+le[i-q[a]],value:i-q[a],part:this.parts[0]}).filter(i=>!!i).sort(pe)),n}createSignatureSymbols(t){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(t))}yRatioToPitch(t){let n=Ar(t*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};var ya=globalThis||window;function Rr(e){return rr(e).toLowerCase().replace(/\s+/g,"-").replace(/-drum|-cymbal/,"")}var st=class extends S{type="drum";pitched=!1;rows=["","","","","splash chinese","crash-2","crash-1","ride-1 ride-2 ride-bell","closed-hi-hat open-hi-hat","high-tom cowbell","low-mid-tom high-mid-tom","snare-1 snare2 side-stick","low-tom sticks hand-clap tambourine","high-floor-tom","low-floor-tom","low-bass high-bass","","pedal-hi-hat","","","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};getNoteHTML(t,n,r){let o=D(t),i=this.#t[o],a=N[i],l=i?`<span class="head" data-glyph="${i}">${a}</span>`:super.getNoteHTML(t,n,r);return n<.02?en+l+nn:l}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(t){return[35,36,37,38,40,41,43,44,45,47,50].includes(D(t))?this.parts[0]:this.parts[1]}getRow(t,n){let r=typeof n=="string"?n:Rr(n);if(!r)throw new Error("Drum name not found for pitch "+n);let o=this.rows.findIndex(i=>i.includes(r));if(ya.DEBUG&&o===-1)throw new Error('Pitch "'+r+'" is not supported by stave '+this.constructor.name);return o===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),o>-1?o:void 0}getSpelling(t,n){return n[1]==="note"?Rr(D(n[2])):super.getSpelliing(t,n[2])}createSignatureSymbols(t){return[{type:"clef",clef:this.type}]}yRatioToPitch(t){let n=floor(t*this.rows.length),r=n<4?4:n>17?17:n;return this.pitches[r]}};var Tt=class extends st{type="percussion";clef=void 0;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var ba=globalThis||window,Br=Object.assign,kt=class extends S{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(t,n,r){return`<span class="timesig" data-event="${r}" data-part="rh">
            <sup>${N["timeSig"+t]}</sup>
            <sub>${N["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${r}" data-part="lh">
            <sup>${N["timeSig"+t]}</sup>
            <sub>${N["timeSig"+n]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(t,n){n=typeof n=="string"?n:Q(n);let r=t.name+"-"+n.replace(ue,""),o=this.rows.findIndex(i=>i.includes(r));if(ba.DEBUG&&o===-1)throw new Error('Pitch "'+r+'" is not supported by '+this.constructor.name);return o===-1&&console.warn('Pitch "'+r+'" is not supported by '+this.constructor.name),o>-1?o:void 0}getPart(t){return typeof t=="number"?t<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(t)?this.parts[1]:this.parts[2]}createKeySymbols(t){let n=[],r=B(t),i=xt(r).map((a,l)=>a-q[l]&&{type:"acci",pitch:H(q[l])+le[a-q[l]],value:a-q[l]}).filter(a=>!!a).sort(pe);return n.push.apply(n,i.map(a=>Br({part:this.parts[1]},a))),n.push.apply(n,i.map(a=>Br({part:this.parts[2]},a))),n}createSignatureSymbols(t){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(t))}};var En=class extends S{type="treble-up";clef=At;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},yn=class extends S{type="treble";clef=St;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},bn=class extends S{type="treble-down";clef=Ct;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},vn=class extends S{type="alto";clef=Rt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Dn=class extends S{type="bass";clef=Bt;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};S.treble=yn;S["treble-up"]=En;S["treble-down"]=bn;S.alto=vn;S.bass=Dn;S.piano=kt;S.drum=st;S.percussion=Tt;S.create=e=>new S[e];var fe=S;var Z=1.1;function va(e){return parseFloat(e.dataset.beat)}function Da(e){return parseFloat(e.dataset.duration)}function Sa(e){let t=e.childNodes;for(;t.length>1;)e.removeChild(e.lastChild)}function Fr(e,t,n,r,o){let i=n[0],a=n.length===1?r%(o*2)===0?t[i]:t[i]-.4*(t[i]-t[i-1]):t[i],l=n.length===1?r%(o*2)===0?t[i]+.5*(t[i+1]-t[i]):t[i]:t[n[n.length-1]];return`M${a}, ${-e*a-.5*Z}
        L${l},${-e*l-.5*Z}
        L${l},${-e*l+.5*Z}
        L${a}, ${-e*a+.5*Z}
        Z`}function Sn(e,t,n,r,o,i,a){if(a<.0833)return;let l=o-1,s;for(;n[++l];)n[l]<=a?s?s.push(l):s=[l]:s&&(e.appendChild(b("path",{class:`beam-path-${4/a} beam-path`,d:Fr(i,r,s,t[l-1],a)})),Sn(e,t,n,r,s[0],i,a/2),s=void 0);s&&(e.appendChild(b("path",{class:`beam-path-${4/a} beam-path`,d:Fr(i,r,s,t[l-1],a)})),Sn(e,t,n,r,s[0],i,a/2),s=void 0)}function Cn(e){let t=e.dataset.beam,n=e.parentElement,r=Array.from(n.querySelectorAll('.top-note[data-beam="'+t+'"]')),o=r.map(va),i=r.map(Da),a=e.viewBox.baseVal,l=a.y<-.5?a.y+.5:a.height-1,s=r.map(Ne),u=s[0].x,f=s[s.length-1].x,p=s.map(c=>(c.x-u)/(f-u));Sa(e),Sn(e,o,i,p,0,-l,.25)}var Nr=R((e,t)=>t[1],{note:(e,t)=>(t[2]=D(t[2])+e,t),chord:(e,t)=>(t[2]=B(B(t[2])+e),t[5]!==void 0&&(t[5]=B(B(t[2])+e)),t),key:(e,t)=>(t[2]=B(B(t[2])+e),t),default:$});var Ca={displace:(e,t,n)=>(n[0]-=e[++t],t),rate:(e,t,n)=>{switch(n[0]/=e[++t],n[1]){case"chord":case"note":case"sequence":n[4]/=e[t];break;case"text":n[3]/=e[t];break}return t},quantize:(e,t,n)=>{},transpose:(e,t,n)=>(Nr(e[t+1],n),t+1)};function Gt(e,t){let n=-1,r;for(;r=e[++n];)n=Ca[r](e,n,t);return t}var Tr=Object.assign,kr=[],Aa={done:!0,value:void 0},Gr={key:2,meter:1,default:0},Ra={};function Pr(e){return Gr[e[1]]||Gr.default}function Ba(e,t){return t[0]<e[0]?1:t[0]>e[0]?-1:Pr(t)-Pr(e)}function Fa(e,t){return e.find(n=>n.id===t)}var Pt=class e{constructor(t,n=kr,r=kr){t.sort(Ba),this.events=t,this.sequences=n,this.transforms=r;let o=-1,i;for(;(i=t[++o])&&Gt(r,Tr(Ra,i))[0]<0;);this.n=o-1}next(){let{events:t,sequences:n,transforms:r,n:o}=this,i=t[o+1],a=i&&Gt(r,mt.from(i,t,o+1)),l,s=-1,u=0,f=a?a[0]:1/0,p;for(;l=this[++s];){let c=l.value;c||((c=l.next().value)&&(Gt(this.transforms,c),c[0]+=l.startBeat,c.target=(c.target||0)+l.target),(l.done||c[0]>=l.stopBeat)&&++u),c&&c[0]<l.stopBeat&&c[0]<f&&(p=l,f=c[0]),u&&(this[s]=this[s+u])}if(p)return this.value=p.value,p.value=void 0,this;if(!a)return Tr(this,Aa);if(this.n+=1,this.value=a,mt.isSequenceEvent(i)){let c=this.sequences,d=Fa(c,i[2]);if(!d)throw new Error('Sequence id "'+i[2]+'" not found');let g=new e(d.events,d.sequences?d.sequences.concat(c):c,i.slice(5));g.startBeat=a[0],g.stopBeat=a[0]+a[4],g.target=a[3];let h=-1;for(;this[++h];);this[h]=g}return this}static from(t){return new e(t.events,t.sequences)}[Symbol.iterator](){return this}};function Na(e,t){let n;for(n in e)if(e[n]!==t[n])return!1;return!0}var Up=X(Na,!0);function Ta(e,t,n){let r=e(t),o=e(n);return o===r?0:r>o?1:-1}var Or=X(Ta,!0);var{abs:ka,EPSILON:Ga}=Math;function he(e,t){return Math.round(t/e)*e}function K(e,t,n=Ga){return e!==void 0&&(e===t||ka(e-t)<n)}function at(e,t,n){return K(e,t,n)||e<t}function Pa(e,t,n){return K(e,t,n)||e>t}function wt(e,t,n){return e!==void 0&&t!==void 0&&!at(e,t,n)}function de(e,t,n){return e!==void 0&&t!==void 0&&!Pa(e,t,n)}var{pow:Oa}=Math,Ma=1/24,La=[2,3,4,5,6,7,9],qa=1/12,Mr=.25,Lr=.2,An={},Et=0;function qr(e,t){return Math.cos(2*Math.PI*t/e)}function $r(e,t,n,r,o){let i=e/t,a=0,l=0,s=0,u,f;for(r[o-1]&&wt(F(r[o-1]),n+.5*i,Ma)&&(s=1),--o;r[++o]!==void 0&&r[o][0]-n<i/4;)s=1;for(--o;r[++o]!==void 0&&r[o][0]-n<e-i/4;){if(u=Math.round((r[o][0]-n)/i),f=1<<u,u<t&&f>s){if(t>4&&f>s<<1)return;s+=f}a+=qr(i,r[o][0]-n),l+=1,!(r[o][0]+r[o][4]-n>e)&&(a+=Lr*qr(i,r[o][0]+r[o][4]-n),l+=Lr)}if(!(t>4&&u!==t-1)&&l)return An.score=a/(l+1),An.rhythm=s,An}function $a(e,t,n,r,o,i,a){let l=n[r-1]&&F(n[r-1])>o+.125?o:t*Math.floor((n[r][0]-o)/t)+o,s=i.length;for(;t/i[--s]<qa;);++s;let u,f;for(;u=i[--s];)f=$r(t,u,l,n,r),f&&f.score>=Et&&f.score&&(Et=f.score,e.beat=l,e.duration=t,e.divisor=u,e.rhythm=f.rhythm),n[r][0]>=l+.5*t&&l+1.5*t<a&&(f=$r(t,u,l+.5*t,n,r),f&&f.score>=Et&&(Et=f.score,e.beat=l+.5*t,e.duration=t,e.divisor=u,e.rhythm=f.rhythm));return e}function Hr(e,t,n){let r=-1;for(;e[++r]!==void 0&&e[r][0]<t;);if(!e[r])return;let o={};Et=Mr;let i=1/8;for(;(i*=2)&&i<=n;)$a(o,i,e,r,t,La,t+n);return Et>Mr&&o}function Ur(e,t){return t<Oa(2,e)-1}function Rn(e){return 2**Math.ceil(Math.log2(e))}function Ir(e){return 2**Math.floor(Math.log2(e))}function Bn(e){return e>0&&(e&e-1)===0}function Fn(e,t,n){if(K(0,n,e/2))return t;let r=t*2;for(;(r/=2)>e;)if(K(0,gt(r,n),e/2))return r;return r}function Ot(e,t){let n=-1,r=0;for(;e[++n]!==void 0;);for(;arguments[++r]!==void 0;)e[n++]=arguments[r];return e}function yt(e){let t=-1;for(;e[++t]!==void 0;);return t}function Nn(e){return e[yt(e)-1]}function Tn(e,t){let n=[],r=-1;for(;t[++r]!==void 0;)n.push(e(t[r],r));return n}var J={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var xe=Object.assign,{abs:Gf,ceil:Ha,floor:ge,min:zr,max:Vr,pow:Pf,sqrt:Xr,round:Of}=Math,I=1/16,Mt=1/24,Ua=Or(it("row"));function Wr(e,t,n,r){return e+t/r.length}function Kr(e,t){return Vr(e,F(t))}function Ia(e,t){return D(e[2])<D(t[2])?1:-1}function Jr(e,t,n,r){if(!r.length)return[];let o=[],i=-1,a;for(;a=r[++i];){let p=a.scribeEvents,c=a.scribeIndex,d=ae(p,c,t),g=ce(d),h=e.getSpelling(g,a),m=e.getRow(n,h);o.push({type:"note",pitch:h,part:n,row:m,stave:e,event:a})}o.sort(Ua),o[0].top=!0,o[o.length-1].bottom=!0;let l=o[0].row,s=o[o.length-1].row,u=n.stemup===void 0?Qr(e,n,l,s):n.stemup,f=0;for(i=-1;o[++i];)o[i].stemup=u,i>0&&o[i].row-o[i-1].row===1?o[i].clusterdown=++f:f=0;for(f=0,i=o.length-1;i--;)o[i+1].row-o[i].row===1?o[i].clusterup=++f:f=0;return o}function Xa(e,t,n){let r=-1,o=0,i,a;for(;n[++r];)a=e.getRow(t,n[r]),a!==void 0&&a>o&&(o=a,i=n[r]);return{row:o,pitch:i}}function Wa(e,t,n){let r=-1,o=128,i,a;for(;n[++r];)a=e.getRow(t,n[r]),a!==void 0&&a<o&&(o=a,i=n[r]);return{row:o,pitch:i}}function Qr(e,t,n,r){let o=t.centerRow||e.centerRow,i=n-o;return r-o+i>0}function Zr(e,t,n){let{row:r}=Xa(e,t,n),{row:o}=Wa(e,t,n);return Qr(e,t,r,o)}function ja(e,t,n){let r=[],o=-1,i;for(;i=n[++o];)i.type==="note"&&r.push(i.pitch);return Zr(e,t,r)}var jr=0;function tt(e,t,n,r){let o=-1;for(;r[++o]&&r[o].beat===r.beat;);if(!r[o])return e;let i=r[0].beat,l=Nn(r).beat-i,s=n.stemup===void 0?Zr(t,n,Tn(it("pitch"),r)):n.stemup;if(n.beam){let y;for(o=-1;y=r[++o];)y.stemup=s,y.beam=r;return e.push(xe(r,{duration:l,stemup:s,range:0,id:++jr})),e}let u=[],f;for(o=-1;f=r[++o];){let y=t.getRow(n,f.pitch);if(y===void 0)continue;let T;for(;r[++o]&&K(r[o].beat,f.beat,Mt);)T=t.getRow(n,r[o].pitch),T!==void 0&&(s?T<y&&(y=T):T>y&&(y=T));--o,u.push(y)}let p=u.length-1,c=u.slice(0,ge(.5*u.length)).reduce(Wr,0),d=u.slice(Ha(.5*u.length)).reduce(Wr,0),g=Array.from(u,(y,T)=>(.2+.1*p)*T*(d-c)/p),h=g[g.length-1]-g[0],m=s?-50:50,w;for(o=u.length;o--;)w=g[o]-u[o],m=s?w>m?w:m:w<m?w:m;for(o=u.length;o--;)g[o]-=m+u[0];let E=-1;for(o=-1;f=r[++o];){for(++E,f.stemup=s,f.beam=r,f.stemHeight=s?1-.125*(g[o]-u[o]+u[0]):1+.125*(g[o]-u[o]+u[0]);r[++o]&&K(r[o].beat,f.beat,I);)r[o].stemup=s,r[o].beam=r,r[o].stemHeight=f.stemHeight;--o}return e.push(xe(r,{pitch:r[0].pitch,y:g[0],duration:l,stemup:s,range:h,id:++jr})),e}function me(e,t){let n=2*Rn(t);for(;(n/=2)>e/2;){if(1.75*n===t)return 1.75*n;if(1.5*n===t)return 1.5*n;if(n<=t)return n}return e}function za(e,t,n){n=n||1/0;let r=4*Rn(t);for(;(r/=2)>e/2;)if(r<=t*2&&r<=n)return r;return e}function Yr(e,t,n,r,o,i){let l=Ir(t.divisor),s=ge(o/t.divisor)*t.divisor,u=Fn(.125,l,o-s);if(i<r){if(e.indexOf(i-o)!==-1)return i-o;let p=ge(i/t.divisor)*t.divisor;if(o===s){if(e.indexOf(p-o)!==-1)return p-o;let c=s+t.divisor<i&&s+t.divisor;return c?c-o:me(.125,i-o)}if(K(i,p,I)){let c=s+t.divisor<i&&s+t.divisor;return c&&e.indexOf(c-o)!==-1?c-o:u}}let f=ge(r/t.divisor)*t.divisor;if(o===s){if(e.indexOf(r-o)!==-1)return r-o;if(e.indexOf(f-o)!==-1)return f-o;let p=s+t.divisor<r&&s+t.divisor;return p?p-o:za(.125,r-o,i-o)}else if(K(r,f,I)){if(e.indexOf(r-o)!==-1)return r-o;let p=s+t.divisor<r&&s+t.divisor;return p&&e.indexOf(p-o)!==-1?p-o:u}else{let p=4*u;return(o-s)%p/u===1?o+2*u===i?2*u:(o+3*u>=i&&console.log("Next event beat is inside quaduplet"),u<1?r>=o+u*3/2?3*u:r>=o+u?u:me(.125,r-o):r>=o+u*3?u*3:r>=o+u*2?u*2:r>o+u?u:me(.125,r-o)):r>o+u?u:me(.125,r-o)}}function Va(e,t,n,r,o,i){return{type:"rest",beat:i,duration:Yr(e,t,i,o,i,o),stave:n,part:r}}function kn(e,t,n,r,o,i,a){for(;wt(a,i,I);){let l=Va(t,n,r,o,a,i);e.push(l),i+=l.duration}return a}function Ka(e,t,n,r,o,i){let{pitch:a,event:l,row:s}=r,u=Nt.test(a)?1:Ft.test(a)?-1:void 0,f=a[0]+a.slice(-1);if(u!==t[f])return t[f]=u,{type:"acci",beat:n,pitch:a,row:s,clump:o,cluster:i,part:e,value:u||0}}function Ja(e,t,n){let r=-1,o,i=0,a;for(;o=e[++r];)o.type==="acci"&&o.beat===t&&o.row<n&&o.row>i&&(i=o.row,a=r);return e[a]}function _r(e,t,n,r,o,i){let a=-1,l=0,s,u,f,p=!!i.find(c=>c.stemup?c.clusterup%2===1:c.clusterdown%2===1);for(;s=i[++a];)de(s.event[0],t.beat,I)||(f=Ja(e,o,s.row),l=f&&f.row-s.row<6&&f.cluster===p?f.clump+1:0,u=Ka(n,r,o,s,l,p),u&&e.push(u))}function to(e,t,n,r,o){let i=o[0].row,a=o[0].pitch,l=i-(n.topRow||t.topRow)+1;l<0&&e.push({type:"ledge",beat:r,pitch:a,part:n,rows:l});let s=o[o.length-1].row,u=o[o.length-1].pitch;l=s-(n.bottomRow||t.bottomRow),l>0&&e.push({type:"ledge",beat:r,pitch:u,part:n,rows:l})}function Qa(e,t,n){let{beat:r,duration:o,divisor:i}=n,a=t.stemup===void 0?ja(e,t,n):t.stemup,l=-1,s;for(;s=n[++l];)s.type==="note"&&!s.beam&&(s.stemup=a);let u=r+.5*o,f=D(e.topPitch)-12,p,c=yt(n);for(;(s=n[--c])&&s.beat>u;);for(++c;(s=n[--c])&&s.beat+s.duration>u;){let E=D(s.pitch);(!p||E>p)&&(p=E)}let d=f;for(c=-1;(s=n[++c])&&s.beat<r+I;){let E=D(s.pitch);(!d||E>d)&&(d=E)}let g=f;for(c=yt(n);(s=n[--c])&&s.beat>r+o-o/i-I;){let E=D(s.pitch);(!g||E>g)&&(g=E)}let h=Math.ceil((d+g)/2),m=Q(h);h>p&&(p=h),n.pitch=Q(p),n.stemup=a;let w=g-d;n.angle=w<0?4*Xr(-w):-4*Xr(w)}function Za(e,t,n,r,o,i,a,l,s,u,f,p,c,d,g){(l.swingAsStraight8ths&&u===1||l.swingAsStraight16ths&&u===.5)&&f===3&&(p===4||p===5)&&(f=2);let h=u/f,m=s+u,w={type:"tuplet",beat:s,duration:u,divisor:f,rhythm:p,part:i,stave:n},E;for(Bn(f)||e.push(w);de(s,m,Mt);){for(;(E=d[++g])&&at(E[0]-t.beat,s+.5*h,Mt);)c.push(E);if(--g,!c.length){e.push({type:"rest",beat:s,duration:h,stave:n,part:i}),s+=h;continue}let y=Jr(n,r,i,c);to(e,n,i,s,y),_r(e,t,i,o,s,y);let T=zr(c.reduce(Kr,0)-t.beat,E?E[0]-t.beat:t.duration,w.beat+w.duration),C=Vr(h,he(h,T-s)),A=-1;for(;y[++A];)e.push(xe(y[A],{beat:s,duration:C}));for(Ot(w,...y),wt(C,.5,Mt)?a&&(tt(e,n,i,a),a=void 0):a||(a={type:"beam",beat:s,part:i}),a&&Ot(a,...y),A=c.length;A--;){let U=F(c[A])-t.beat;at(U,s+C+.5*h,Mt)?c.splice(A,1):e.push({type:"tie",beat:s,pitch:y[A].pitch,duration:C,stemup:y[A].stemup,part:i,event:c[A]})}s+=C}return a&&tt(e,n,i,a),Qa(n,i,w),g}function Gn(e,t,n,r=0,o={},i,a,l=J){let s=[],{headDurations:u,restDurations:f}=l,p=0,c=-1,d,g,h;for(;(d=a[++c])&&at(d[0]+d[4]-t.beat,p,I););for(--c;de(p,t.duration,I);){h&&t.divisions.find(U=>K(p,U,I))&&(tt(e,n,i,h),h=void 0);let m=Hr(a,t.beat+p,t.duration-p);if(m&&!Bn(m.divisor)){wt(m.beat-t.beat,p,I)&&kn(e,l.restDurations,t,n,i,p,m.beat-t.beat),h&&Ur(m.divisor,m.rhythm)&&(tt(e,n,i,h),h=void 0),c=Za(e,t,n,r,o,i,h,l,m.beat-t.beat,m.duration,m.divisor,m.rhythm,s,a,c),p=m.beat-t.beat+m.duration;continue}for(;(d=a[++c])&&at(d[0]-t.beat,p,I);)s.push(d);if(--c,n.pitched&&s.sort(Ia),!s.length){if(!d){h&&(tt(e,n,i,h),h=void 0),kn(e,l.restDurations,t,n,i,p,t.duration);break}let U=he(.125,d[0]-t.beat);if(U<=p){console.log(`Problem at bar ${t.count}, moving to next bar ${p} ${U}`),t.error="Stop beat has ended up less than beat";break}h&&(eo(t.divisions,p,U)||U-p>=.5)&&(tt(e,n,i,h),h=void 0),kn(e,f,t,n,i,p,U),p=U;continue}let w=Jr(n,r,i,s);to(e,n,i,p,w),_r(e,t,i,o,p,w);let E=s[0][0]-t.beat,y=zr(t.duration,s.reduce(Kr,0)-t.beat),T=d&&he(.125,d[0])-t.beat,C=Yr(u,t,E,y,p,T),A=-1;for(;w[++A];)e.push(xe(w[A],{beat:p,duration:C}));for(C>=1?h&&(tt(e,n,i,h),h=void 0):h||(h={type:"beam",beat:p,part:i}),h&&Ot(h,...w),A=s.length;A--;){let U=F(s[A])-t.beat;at(U,p+C,I)||U-(p+C)<.125+1/16*(F(s[A])-s[A][0])?s.splice(A,1):e.push({type:"tie",beat:p,pitch:w[A].pitch,duration:C,stemup:w[A].stemup,part:i,event:s[A]})}p+=C}return h&&tt(e,n,i,h),e}var Ya={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function _a(e,t){return Ya[e+","+t]||ne}function eo(e,t,n){let r=-1;for(;e[++r]&&e[r]<=t;);return n>e[r]?e[r]:void 0}var tc=[];function no(e,t){return xt(t).reduce((r,o,i)=>{let a=o-q[i];if(a!==0){let l=H(q[i]),s=10;for(;s--;)r[l+s]=a}return r},e),e}function ec(e,t,n,r,o,i,a){let l=-1,s;for(;s=i[++l];)switch(s[1]){case"key":{let u=B(s[2]);no(o,u),t.key=u;break}case"meter":{e.push({type:"timesig",beat:0,numerator:s[3]===1.5?s[2]/.5:s[2]/s[3],denominator:s[3]===1.5?8:4/s[3],stave:n,event:s});break}case"symbol":{e.push({type:"symbol"+s[2],stave:n});break}case"chord":{let u=s[0]-t.beat,f=ae(i,l,r),p=ce(f),c=n.getSpelling(p,s);c==="C♭"&&a.spellChordRootCFlatAsB&&(c="B"),c==="E♯"&&a.spellChordRootESharpAsF&&(c="F"),c==="B♯"&&a.spellChordRootBSharpAsC&&(c="C"),c==="F♭"&&a.spellChordRootFFlatAsE&&(c="E"),e.push({type:"chord",beat:u,duration:s[0]+s[4]>t.beat+t.duration?t.duration-u:s[4],root:c,extension:s[3],event:s,stave:n});break}case"text":{let u=s[0]-t.beat;e.push({type:"text",beat:u,duration:s[0]+s[3]>t.beat+t.duration?t.duration-u:s[3],value:s[2],event:s,stave:n});break}case"sequence":{t.doubleBarLine=!0;break}default:{if(tc.includes(s[1]))return;console.log('Scribe: ignoring event type "'+s[1]+'"')}}return e}function Lt(e,t,n,r,o,i,a,l,s,u=J){let f=[];if(s){let m=F(s);m>t&&m<=t+n&&a.push(s)}let p=no({},i),c={type:"bar",beat:t,duration:n,key:i,divisor:r||4,divisions:_a(n,r),stave:o,count:e,symbols:f};ec(f,c,o,i,p,a,J);let d=o.parts.reduce((m,w)=>w.centerRow?m.add(w.centerRow):m,new Set);d.size||d.add(o.centerRow);let g;for(g of o.parts){let m=l[g.name];!m||!m.length||(d.delete(g.centerRow||o.centerRow),Gn(f,c,o,i,p,g,m,u))}let h;for(h of d)Gn(f,c,o,i,p,{centerRow:h},[],u);return c}function nc(e,t){if(!(e==="stave"||e==="event"||e==="sequence"||e==="beam"))return t}function rc(e){let t=e.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(t,nc)}function ct(e,t){e.symbols=e.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"barrepeat",count:t,duration:e.duration}])}function we(e,t,n){let r=rc(n);switch(t.length){case 1:break;case 2:break;case 3:{r==="[]"&&t[0]==="[]"?t.length=0:r===t[0]&&r===t[1]&&r===t[2]&&n.symbols.filter(o=>o.type!=="clef"&&o.type!=="timesig").find(o=>o.type!=="rest")?(ct(e[e.length-2],1),ct(e[e.length-1],1),ct(n,1)):(r!==t[1]||t[0]!==t[2])&&(t.length=2);break}case 4:{r===t[0]&&r===t[1]&&r===t[2]&&r===t[3]?(ct(n,1),t.length=3):(r!==t[1]||t[0]!==t[2]||r!==t[3])&&(t.length=2);break}case 5:{r===t[1]&&r===t[3]&&t[0]===t[2]&&t[0]===t[4]?(e.length-=2,ct(e[e.length-1],2),ct(n,2)):t.length=4;break}case 6:break;case 7:{r===t[1]&&r===t[3]&&t[0]===t[2]&&t[0]===t[4]?(e.length-=1,ct(n,2),t.length=5):t.length=1;break}}for(t.unshift(r);t.length>8;)t.pop()}function Pn(e,t,n){let r=n.target?e.parts[n.target]:e.getPart(n[2]),o=t[r.name]||(t[r.name]=[]);t[r.name].push(n)}function On(e,t,n,r=J){let o=[],i=[],a=[],l=[],s=0,u=[],f={},p=0,c=0,d,g,h,m;for(h of e)if(h.scribeIndex=o.length,h.scribeEvents=o,o.push(h),!t.includes(h[1])){for(;h[0]>=s+d;){let E=Lt(i.length+1,s,d,g,n,p,u,f,m,r);we(i,l,E),i.push(E),p=E.key,s=s+d,u=[],f={};let y=-1;for(;a[++y];)Pn(n,f,a[y]),F(a[y])<s+d&&a.splice(y--,1)}switch(h[1]){case"note":{Pn(n,f,h),F(h)>s+d&&a.push(h),c<F(h)&&(c=F(h));break}case"sequence":{h.events===e.events&&(m=h),c<F(h)&&(c=F(h));break}case"meter":d=h[2],g=h[3],h[0]!==s&&console.log("TODO");default:u.push(h)}}for(;a.length;){let E=Lt(i.length+1,s,d,g,n,p,u,f,m,r);we(i,l,E),i.push(E),s=s+d,u=[],f={};let y=-1;for(;h=a[++y];)Pn(n,f,h),F(h)<s+d&&a.splice(y--,1)}for(;s<c-d;){let E=Lt(i.length+1,s,d,g,n,p,u,f,m,r);we(i,l,E),i.push(E),s=s+d,u=[],f={}}d||(d=F(o[o.length-1]));let w=Lt(i.length+1,s,d,g,n,p,u,f,m,r);return we(i,l,w),i.push(w),i}var Ee=Symbol("scribe-id"),oc=0;function ut(e){return e[Ee]||(e[Ee]=++oc+""),e[Ee]}var ye=Math.abs,be={flat:`<span class="chord-flat">${_t}</span>`,sharp:`<span class="chord-sharp">${ee}</span>`},ic={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},sc={2:tn,1:ee,0:te,"-1":_t,"-2":_e},ac={treble:St,"treble-down":Ct,"treble-up":At,alto:Rt,bass:Bt,drum:Yt,percussion:Yt},cc={"1.33":cn,"0.67":an,"0.33":sn,"0.17":on,"0.08":rn},uc=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function O(e){return e.toFixed(4).replace(/\.?0+$/,"")}var Mn=R(it("type"),{barrepeat:e=>b("span",{class:"barrepeat",html:N["barRepeat"+e.count],data:{duration:e.duration}}),clef:e=>b("span",{class:`${e.clef}-clef clef`,html:ac[e.clef]}),chord:e=>{let t=uc.exec(e.extension);return b("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+e.root.replace(Nt,be.sharp).replace(Ft,be.flat)+'</span><span class="chord-ext">'+(t[1]?'<span class="chord-ext-'+t[1]+'">'+t[1]+"</span>":"")+(t[2]?"<sub>"+t[2]+"</sub>":"")+(t[3]?"<sup>"+t[3].replace(Nt,be.sharp).replace(Ft,be.flat)+"</sup>":"")+"</span>"+(e.bass?ln+'<span class="chord-bass">'+e.bass+"</span>":""),data:{beat:O(e.beat),duration:O(e.duration),event:ut(e.event)}})},timesig:e=>e.stave.getTimeSigHTML?b("fragment",e.stave.getTimeSigHTML(e.numerator,e.denominator,ut(e.event))):b("span",{class:"timesig",html:`<sup>${N["timeSig"+e.numerator]}</sup>
                <sub>${N["timeSig"+e.denominator]}</sub>`,data:{event:ut(e.event)}}),symbolcoda:e=>b("p",{html:un,class:"coda"}),barcount:e=>b("span",{html:e.text,class:"barcount"}),text:e=>b("span",{class:"lyric",part:"lyric",html:e.value,data:{beat:O(e.beat),duration:O(e.duration),event:ut(e.event)}}),acci:e=>b("span",{class:(ic[e.value]||"acci")+(e.clump?" acci-"+e.clump:"")+(e.cluster?" acci-cluster":""),html:sc[e.value]||te,data:{beat:e.beat&&O(e.beat),pitch:e.pitch,part:e.part.name,event:e.event&&ut(e.event)}}),ledge:e=>b("svg",{class:`${e.rows<0?"up":"down"}-ledge ledge`,viewBox:e.rows<0?`0 ${9+e.rows-.5} 5 ${ye(e.rows)}`:`0 -0.5 5 ${ye(e.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:O(e.beat),pitch:e.pitch,part:e.part.name}}),note:e=>b("data",{class:`${e.stemup?"up-note ":"down-note "}${e.top?"top-note ":""}${e.bottom?"bottom-note ":""}${e.stemup?e.clusterup%2===1?"cluster-note ":"":e.clusterdown%2===1?"cluster-note ":""}${e.beam?"beam-note ":""}note`,style:e.stemHeight?`--stem-height: ${e.stemHeight};`:void 0,html:e.stave.getNoteHTML(e.pitch,e.dynamic,e.duration),title:`${e.pitch} (${D(e.pitch)})`,data:{beat:O(e.beat),pitch:e.pitch,duration:O(e.duration),part:e.part.name,beam:e.beam&&e.beam.id,event:ut(e.event)}}),beam:(e,t)=>b("svg",{class:`${e.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(e.range<0?e.range:0)-.5} 1 ${ye(e.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${O(e.duration)}; ${e.y?"--translate-y:"+e.y*.125+";":""} height: ${(ye(e.range)+Z)*.125}em; align-self: ${e.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*Z} L1,${e.range-.5*Z} L1,${e.range+.5*Z} L0,${.5*Z} Z"></path>`,data:{beat:O(e.beat),pitch:e.pitch,part:e.part.name,beam:e.id}}),tie:e=>b("svg",{class:`${e.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:O(e.beat),pitch:e.pitch,duration:O(e.duration),part:e.part.name}}),tuplet:e=>b("span",{class:`${e.stemup?"up":"down"}-tuplet tuplet`,html:N["tuplet"+e.divisor],data:{beat:O(e.beat),pitch:e.pitch,duration:O(e.duration),divisor:e.divisor,rhythm:e.rhythm.toString(2).split("").reverse().join(""),part:e.part.name},style:`--angle: ${e.angle}deg;`}),rest:e=>b("span",{class:"rest",html:cc[e.duration.toFixed(2)]||N["rest"+(e.duration+"").replace(".","")]||"",data:{beat:O(e.beat),pitch:e.pitch,duration:O(e.duration),part:e.part.name},"aria-hidden":"true"}),default:function(e){return function(t){e[t.type]||(e[t.type]=!0,console.log(t),console.error('Scribe: symbol type "'+t.type+'" not rendered'))}}({})});function lc(e){return e[0]<=0&&e[1]==="meter"}function pc(e){return e[0]<=0&&e[1]==="key"}function fc(e,t){let n=Mn(t);return n&&e.push(n),e}function hc(e,t){return e.push(b("div",{class:`${t.stave.type}-stave stave ${t.doubleBarLine?"end-bar ":""}bar${t.error?" error ":""}`,data:{beat:t.beat,duration:t.duration,count:t.count,key:H(t.key)},children:t.symbols.reduce(fc,[])})),e}function Ln(e,t,n,r,o,i=1/0,a=0,l=0,s=J){let u=e.events;!u.find(lc)&&o&&u.unshift([0,"meter",o[2],o[3]]),!u.find(pc)&&r&&u.unshift([0,"key",r]);let c=fe.create(n||"treble"),d=[];a&&d.push("transpose",a),l&&d.push("displace",l);let g=new Pt(u,e.sequences,d),h=On(g,t,c,s),m=h.reduce(hc,[]),E=h[0].key,y=c.createSignatureSymbols(E),T=b("div",{class:`${c.type}-stave signature-stave stave`,children:y.map(Mn),data:{key:H(E)}}),C=b("div",{id:"side",class:"side",data:{key:H(E)}}),A=24;for(;A--;)C.appendChild(T.cloneNode(!0));return m.unshift(C),m}var ro=Object.assign,dc=Object.defineProperties,mc=new URL("shadow.css",import.meta.url),ve=v.of(),gc=[],oo=new ResizeObserver(e=>{for(let t of e)x(t.target).shadowRoot.querySelectorAll(".beam").forEach(Cn)}),_h=dc(Le("scribe-music",{shadow:`
        <link rel="stylesheet" href="${mc}" />
    `,construct:function(e,t){let n=e.querySelector("link");gc.push(r=>n.href=r),ve.value&&(n.href=ve.value),t.data=v.of(),t.clef=v.of("treble"),t.key=v.of("C"),t.meter=v.of(),t.beat=v.of(0),t.duration=v.of(1/0),t.transpose=v.of(0),t.excludes=v.of([]),t.swingAsStraight8ths=v.of(!1),t.swingAsStraight16ths=v.of(!1),t.debug=v.of(!1),t.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(e,t){if(t.isSafari&&this.classList.add("safari"),oo.observe(this,{box:"content-box"}),!this.src){let n=this.textContent.trim();t.data.value=ot(this.type,n)}return v.frame(()=>{let n=t.data.value&&Ln(t.data.value,t.excludes.value,t.clef.value,t.key.value,t.meter.value,t.duration.value,t.transpose.value,t.beat.value,ro({},J,{swingAsStraight8ths:t.swingAsStraight8ths.value,swingAsStraight16ths:t.swingAsStraight16ths.value}));if(e.querySelectorAll(".side, .bar, style").forEach(s=>s.remove()),e.append.apply(e,n),!n)return;let o=e.getElementById("side").dataset.key,a={"G♭":6,"C♯":5,"D♭":5,"G♯":4,"A♭":4,"D♯":3,"E♭":3,"B♭":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"F♯":6}[o],l=b("style",":host { --signature-width: "+(2.25+a*.625+.625).toFixed(4)+"em; }");e.appendChild(l),e.querySelectorAll(".beam").forEach(Cn),t.debug.value&&e.querySelectorAll(".bar").forEach(s=>{let u=parseFloat(s.dataset.duration),f=0,p,c;s.querySelector(".barrepeat")||(s.querySelectorAll(".rest[data-duration], .note[data-duration]").forEach(d=>{p!==parseFloat(d.dataset.beat)&&(p=parseFloat(d.dataset.beat),c=parseFloat(d.dataset.duration),f+=c)}),Math.round(f/.0625)!==Math.round(u/.0625)&&s.classList.add("error"))})})},disconnect:function(){oo.unobserve(this)}},{clef:{attribute:function(e){this.clef=e},get:function(){return x(this).clef.value},set:function(e){if(!fe[e]){console.warn('<scribe-music> Attempt to set invalid clef="'+e+'" ignored');return}x(this).clef.value=e}},key:{attribute:function(e){this.key=e===""?"C":e},get:function(){return x(this).key.value},set:function(e){let t=x(this);if(typeof e!="string"||!/^[A-G][#b♯♭]?$/.test(e)){console.warn('<scribe-music> Attempt to set invalid key="'+e+'" ignored');return}t.key.value=e.replace(/[#b]$/,n=>n==="#"?"♯":"♭")}},meter:{attribute:function(e){this.meter=e===""?"4/4":e},get:function(){return dr(x(this).meter.value)},set:function(e){x(this).meter.value=ro([0],hr(e))}},beat:{attribute:function(e){this.beat=e},get:function(){return x(this).beat.value},set:function(e){x(this).beat.value=typeof e=="number"?e:parseFloat(e)}},duration:{attribute:function(e){this.duration=e},get:function(){return x(this).duration.value},set:function(e){x(this).duration.value=typeof e=="number"?e:parseFloat(e)}},transpose:{attribute:function(e){this.transpose=e},get:function(){return x(this).transpose.value},set:function(e){x(this).transpose.value=typeof e=="number"?Math.round(e):parseInt(e,10)}},type:{attribute:function(e){this.type=e},writable:!0,value:"application/json"},src:{attribute:function(e){this.src=e},get:function(){return x(this).src},set:function(e){let t=x(this);t.src=e;let n=new URL(e,window.location);if(window.location.origin===n.origin&&window.location.pathname===n.pathname){let r=this.getRootNode().getElementById(n.hash.slice(1));if(!r)throw new Error('<scribe-music> src script "'+e+'" not found in document');this.data=JSON.parse(r.textContent)}else fr(this.type,n.href).then(r=>this.data=r)},default:null},data:{get:function(){return x(this).data.value},set:function(e){x(this).data.value=e},default:null},swing:{attribute:function(e){x(this).swingAsStraight8ths.value=e!==null}},shuffle:{attribute:function(e){x(this).swingAsStraight16ths.value=e!==null}},debug:{attribute:function(e){this.debug=e!==null},get:function(){return x(this).debug.value},set:function(e){x(this).debug.value=!!e}},excludes:{attribute:function(e){return x(this).excludes.value=e.split(/\s+/)}}},null,"github.com/stephband/scribe/"),{stylesheet:{set:e=>ve.value=e,get:()=>ve.value}});export{_h as default};
//# sourceMappingURL=element.js.map
