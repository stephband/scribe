/* Scribe 
   0.3.1
   By Stephen */

var jr=Object.defineProperty;var zr=(e,t)=>{for(var n in t)jr(e,n,{get:t[n],enumerable:!0})};var T,_;function Vr(e,t){let n=-1;for(;e[++n]&&e[n]!==t;);for(;e[n++];)e[n-1]=e[n]}function we(e){let t=0;for(;e[--t];)e[t].stop&&e[t].stop(),e[t]=void 0}function gt(e,t){let n=0;for(;t[--n]&&t[n]!==e;);for(t[n]=e,n=-1;e[++n]&&e[n]!==t;);e[n]=t}function ut(e){let t=-1,n;for(;n=e[++t];)e[t]=void 0,n.invalidate(e)}function Ee(e,t){let n=0;for(;e[--n];)if(e[n]===t)return!0}var b=class e{static isSignal(t){return t instanceof e}static of(t){return new he(t)}static from(t,n){if(t.then){let r=e.of();return t.then(o=>r.value=o),r}return t.pipe?t.pipe(new de):new Rt(t,n)}static compute(t,n){return new Rt(t,n)}static fromProperty(t,n){return new me(t,n)}static frame(t){return new Mt(t)}static tick(t){return new Lt(t)}static temporal(t,n){return new ge(t,n)}static evaluate(t,n,r=t){let o=T;T=t,o||(_=!1);let i=n.apply(r);return T=o,i}static get hasInvalidDependency(){return _}static get evaluating(){return T}constructor(t){t&&(this.name=t)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},he=class extends b{#t;constructor(t){super(),this.#t=t}get value(){return T&&gt(this,T),this.#t}set value(t){this.#t!==t&&(this.#t=t,ut(this))}},de=class extends b{#t;constructor(t){super(),this.#t=t}get value(){return T&&gt(this,T),this.#t}push(t){this.#t!==t&&(this.#t=t,ut(this))}},me=class extends b{#t;#e;constructor(t,n){super(t),this.object=n}evaluate(){return this.object[this.name]}get value(){return T&&gt(this,T),this.#t?this.#e:(this.#e=b.evaluate(this,this.evaluate,this),_||(this.#t=!0),this.#e)}set value(t){if(this.#e===t)return;let{object:n,name:r}=this;n[r]=t,t=n[r],this.#e!==t&&(this.#e=t,ut(this))}invalidate(t){this.#t&&(t&&!Ee(this,t)||(this.#t=!1,we(this),ut(this)))}},Rt=class extends b{#t;#e;#n;#r;constructor(t,n){super(),this.#t=t,this.#e=n}get value(){return T&&gt(this,T),this.#n?this.#r:(this.#r=b.evaluate(this,this.#t,this.#e),_||(this.#n=!0),this.#r)}invalidate(t){this.#n&&(t&&!Ee(this,t)||(this.#n=!1,we(this),ut(this)))}},ge=class extends b{#t=0;constructor(t,n){super(t),this.object=n}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return b.evaluating&&(gt(this,T),this.getTime()<this.#t&&(_=!0)),this.evaluate()}set value(t){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==t&&(this.object[this.name]=t,invalidateUntil(this.getTime()))}invalidateUntil(t){let r=this.getTime()>=this.#t;this.#t=t,r&&ut(this)}},Nt=class extends b{constructor(t){if(super(),T){let n=0;for(;T[--n]&&T[n]!==this;);T[n]=this}t&&(this.evaluate=t,(b.evaluate(this,this.evaluate)||_)&&this.cue())}invalidate(t){this.constructor.observers.indexOf(this)===-1&&(t&&!Ee(this,t)||(we(this),this.cue()))}stop(){let t=0,n;for(;n=this[--t];){let i=-1;this[t]=void 0,n.stop?n.stop():Vr(n,this)}let r=this.constructor.observers,o=r.indexOf(this);if(o!==-1){if(r===xe)throw new Error("Attempt to remove observer while observers is rendering");r.splice(o,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},xe;function qn(e){let t=-1,n;for(xe=e;n=e[++t];)!b.evaluate(n,n.evaluate)&&!_&&e.splice(t--,1);return xe=void 0,e}var $n=Promise.resolve();function Hn(){qn(Lt.observers).length&&$n.then(Hn)}var Lt=class extends Nt{static observers=[];cue(){let t=this.constructor.observers;t.length||$n.then(Hn),t.push(this)}};function Un(){qn(Mt.observers).length&&requestAnimationFrame(Un)}var Mt=class extends Nt{static observers=[];cue(){let t=this.constructor.observers;t.length||window.requestAnimationFrame(Un),t.push(this)}};function H(e){return e}function S(e,t){return function(){let r=e.apply(this,arguments),o=t[r]||t.default;if(!o)throw new Error('overload() no function defined for key "'+r+'"');return o.apply(this,arguments)}}function lt(e){var t=new Map;return function(r){if(t.has(r))return t.get(r);var o=e(r);return t.set(r,o),o}}var Jr=Array.prototype;function Kr(e,t){return typeof e=="function"?e.apply(null,t):e}function In(e,t,n){n=n||e.length;var r=n===1?t?e:lt(e):lt(function(o){return In(function(){var i=[o];return i.push.apply(i,arguments),e.apply(null,i)},t,n-1)});return function o(i){return arguments.length===0?o:arguments.length===1?r(i):arguments.length>=n?e.apply(null,arguments):Kr(r(i),Jr.slice.call(arguments,1))}}var Z=In;function P(){}var Qr=S(H,{is:P,tag:P,data:function(e,t,n){for(e in n)n[e]===void 0&&delete n[e];Object.assign(t.dataset,n)},dataset:function(e,t,n){for(e in n)n[e]===void 0&&delete n[e];Object.assign(t.dataset,n)},html:function(e,t,n){t.innerHTML=n},text:function(e,t,n){t.textContent=n},style:S((e,t,n)=>typeof n,{string:(e,t,n)=>t.style=n,object:(e,t,n)=>Object.assign(t.style,n)}),children:function(e,t,n){t.innerHTML="",t.append.apply(t,n)},href:function(e,t,n){t instanceof SVGElement?t.setAttribute("href",n):t.href=n},points:I,cx:I,cy:I,r:I,x:I,y:I,dx:I,dy:I,transform:I,preserveAspectRatio:I,viewBox:I,default:function(e,t,n){e in t?t[e]=n:t.setAttribute(e,n)}});function I(e,t,n){t.setAttribute(e,n)}function Zr(e,t){for(var n=Object.keys(t),r=n.length;r--;)t[n[r]]!==void 0&&Qr(n[r],e,t[n[r]]);return e}var Ot=Z(Zr,!0);var ye="http://www.w3.org/2000/svg",Xn=document.createElement("template"),ve=(e,t)=>t&&typeof t;function Wn(e,t=""){let n=document.createRange();return n.selectNode(e),n.createContextualFragment(t)}var O=S(ve,{string:function(e,t){let n=document.createElementNS(ye,e);return n.innerHTML=t,n},object:function(e,t){let n=document.createElementNS(ye,e);return typeof t.length=="number"?n.append.apply(n,t):Ot(n,t),n},default:e=>document.createElementNS(ye,e)}),Yr=S(ve,{string:function(e,t){let n=document.createElement(e);return n.innerHTML=t,n},object:function(e,t){let n=document.createElement(e);return typeof t.length=="number"?n.append.apply(n,t):Ot(n,t),n},default:e=>document.createElement(e)}),_r=S(H,{comment:function(e,t){return document.createComment(t||"")},fragment:S(ve,{string:function(e,t,n){return n?Wn(n,t):(Xn.innerHTML=t,Xn.content.cloneNode(!0))},object:function(e,t,n){let r=n?Wn(n):document.createDocumentFragment();return typeof t.length=="number"?r.append.apply(r,t):Ot(r,t),r},default:()=>document.createDocumentFragment()}),circle:O,ellipse:O,g:O,glyph:O,image:O,line:O,rect:O,use:O,path:O,pattern:O,polygon:O,polyline:O,svg:O,tspan:O,text:O,default:Yr}),y=_r;function be(e,t,n){let r;typeof n!="string"&&n.input!==void 0&&n.index!==void 0&&(r=n,n=r.input.slice(n.index+n[0].length+(n.consumed||0)));let o=e.exec(n);if(!o)return;let i=t(o);return r&&(r.consumed=(r.consumed||0)+o.index+o[0].length+(o.consumed||0)),i}var Zc=Z(be,!0);function to(e,t,n){throw n.input!==void 0&&n.index!==void 0&&(n=n.input),new Error('Cannot parse string "'+(n.length>128?n.length.slice(0,128)+"…":n)+'"')}function eo(e,t,n){let r=-1;for(;++r<n.length;)t=n[r]!==void 0&&e[r]?e[r](t,n):t;return e.done?e.done(t,n):e.close?e.close(t,n):t}function no(e,t,n,r){let o=be(e,i=>eo(t,n,i),r);return o===void 0?t.catch?t.catch(n,r):to(e,t,r):o}var jn=Z(no,!0);var zn=Symbol("internals");function De(e,t,n){return t[zn]=t.attachInternals&&!t.getAttribute("is")?t.attachInternals():{shadowRoot:n}}function E(e){return e[zn]}var Vn=Object.defineProperties;var Be={},ro={name:{set:function(e){return this.setAttribute("name",e)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return E(this).form}},labels:{get:function(){return E(this).labels}},validity:{get:function(){return E(this).validity}},validationMessage:{get:function(){return E(this).validationMessage}},willValidate:{get:function(){return E(this).willValidate}},checkValidity:{value:function(){return E(this).checkValidity()}},reportValidity:{value:function(){return E(this).reportValidity()}}},Se=!1,oo=jn(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(e,t)=>({name:t[1]}),2:(e,t)=>({name:t[3],tag:t[2]}),catch:function(e,t){throw new SyntaxError(`dom element() – name must be of the form 'element-name' or 'tag is="element-name"' (`+t+")")}},null),Jn={once:!0};function io(e){return e.sheet?Promise.resolve({target:e}):new Promise((t,n)=>{e.addEventListener("load",t,Jn),e.addEventListener("error",n,Jn)})}function so(e){e.stop()}function co(e){if(Be[e])return Be[e];let t=document.createElement(e).constructor;if(t===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+e+"> is HTMLUnknownElement");return Be[e]=t}function ao(e,t){if(e.hasOwnProperty(t)){let n=e[t];delete e[t],e[t]=n}return e}function Kn(e,t){let n=e.attachShadow({mode:t.mode||"closed",delegatesFocus:t.focusable||!1});if(t.stylesheet){let r=y("link",{rel:"stylesheet",href:t.stylesheet});n.append(r)}return n}function uo(e,t){return typeof t=="string"?t[0]==="#"?e.appendChild(document.getElementById(t.slice(1)).content.clone(!0)):e.innerHTML=t:e.appendChild(t.content.clone(!0)),e}function lo(e){let t=e.isUpgraded;return e.isUpgraded=!0,!t}function Qn(e,t){return Array.from(e.querySelectorAll('[is="'+t+'"]')).filter(lo)}var po=S((e,t)=>typeof t,{object:(e,t)=>t,function:(e,t)=>({value:t}),default:(e,t)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof t)}});function Ce(e,t={},n={},r=""){let{name:o,tag:i}=oo(e),a=typeof i=="string"?co(i):HTMLElement,c=[],s={},u,h;for(u in n)h=po(u,n[u]),h.attribute&&c.push(u),(h.set||h.get||"value"in h)&&(s[u]=h),n[u]=h;function l(){let p=Reflect.construct(a,arguments,l),f=t.mode||typeof t.shadow=="string"?Kn(p,t):void 0;t.shadow&&uo(f,t.shadow);let d=De(l,p,f);return i&&(Se=!0),t.construct&&t.construct.call(p,f,d),Object.keys(s).reduce(ao,p),p}if(l.prototype=Object.create(a.prototype,s),n.value&&(l.formAssociated=!0,Vn(l.prototype,ro),(t.enable||t.disable)&&(l.prototype.formDisabledCallback=function(p){let f=E(this);return p?t.disable&&t.disable.call(this,f.shadowRoot,f):t.enable&&t.enable.call(this,f.shadowRoot,f)}),t.reset&&(l.prototype.formResetCallback=function(){let p=E(this);return t.reset.call(this,p.shadowRoot,p)}),t.restore&&(l.prototype.formStateRestoreCallback=function(){let p=E(this);return t.restore.call(this,p.shadowRoot,p)})),c.length&&(l.observedAttributes=c,l.prototype.attributeChangedCallback=function(p,f,d){return n[p].attribute.call(this,d)}),t.connect&&(l.prototype.connectedCallback=function(){let p=E(this),f=p.shadowRoot;if(p.stopable=t.connect.call(this,f,p),!f)return;let d=f.querySelectorAll('link[rel="stylesheet"]');if(d.length){let m=y("style","*:not(slot), slot:not([name]) { display: none !important; }");f.prepend(m);let w;p.loadPromise?w=p.loadPromise.then(()=>new Promise(requestAnimationFrame)):w=p.loadPromise=Promise.all(Array.from(d,io)),w.finally(()=>{m.remove(),t.load&&t.load.call(this,f,p)})}else t.load&&t.load.call(this,f,p)}),l.prototype.disconnectedCallback=function(){let p=E(this);p.stopable&&(p.stopable.stop?p.stopable.stop():p.stopable.forEach(so)),t.disconnect&&t.disconnect.call(this,p.shadowRoot,p)},window.console&&window.console.log("%c<"+(i?i+" is="+o:o)+">%c "+r,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(o,l,i&&{extends:i}),i&&!Se){let p=document.createElement("div");if(p.style.position="fixed",p.style.left="-1000px",p.style.top="-1000px",p.innerHTML="<"+i+' is="'+o+'"></'+i+">",document.body.append(p),p.remove(),Se)l.polyfillByRoot=P;else{let f=function(m){let w={};Object.keys(s).forEach(B=>{m[B]!==void 0&&(w[B]=m[B])}),Vn(m,s);let x=t.mode||t.shadow?Kn(m,t):void 0,C=De(l,m,x);t.construct&&t.construct.call(m,x,C),Object.assign(m,w);let g=-1,M;for(;M=c[++g];){let B=m.attributes[M];B&&n[M].attribute.call(m,B.value)}t.connect&&t.connect.call(m,x,C)},d=function(m){Qn(m,o).forEach(f),new MutationObserver(()=>Qn(m,o).forEach(f)).observe(m,{childList:!0,subtree:!0})};l.polyfillByRoot=d,d(document)}}else l.polyfillByRoot=P;return l}var kt=e=>typeof e;var fo=Object.defineProperties,Zn=S(kt,{function:e=>e(),object:e=>e.stop()}),tt=class extends H{#t;stop(){if(this.status==="done")return this;this.status="done";let t=this.#t;return this.#t=void 0,t&&t.forEach(Zn),this}done(t){return this.status==="done"?(Zn(listener),this):((this.#t||(this.#t=[])).push(t),this)}};fo(tt.prototype,{status:{writable:!0}});function ho(e){throw new TypeError("Stream cannot be created .from() "+typeof e)}function k(e,t){if(t===void 0)return;let n=-1;for(;e[++n];)e[n].push(t);return e}function mo(e){tt.prototype.stop.apply(e);let t=-1,n;for(;n=e[++t];)e[t]=void 0,n.stop&&(Me(n,e),n[-1]||n.stop());return e}function Me(e,t){let n=0;for(;e[--n]&&e[n]!==t;);for(;e[n--];)e[n+1]=e[n]}function Yn(e,t){let n=-1;for(;e[++n]&&e[n]!==t;);for(;e[n++];)e[n-1]=e[n]}function go(e,t){Me(t,e),Yn(e,t)}var xt=class extends tt{stop(){if(this.status==="done")return this;let t;for(;t=this[-1];){let n=-1;for(;this[n--];)this[n+1]=this[n];Yn(t,this),t.stop&&!t[0]&&t.stop(t)}return super.stop()}},Gt=class extends xt{constructor(t){super(),this.push=t}},qt=class extends xt{constructor(t,n){super(),this.fn=t,this.value=n,this.i=0}push(t){let n=this.fn;this.value=n(this.value,t,this.i++,this)}},R=class extends xt{start(){if(this.status)return this;let t=0,n;t:for(;n=this[--t];){let r=-1;for(;n[++r];)if(n[r]===this)continue t;n[r]=this,r===0&&n.start&&n.start()}return this}stop(){if(this.status==="done")return this;super.stop();let t=-1,n;for(;n=this[++t];)this[t]=void 0,n.stop&&(Me(n,this),n[-1]||n.stop());return this}pipe(t){if(t.stop){let r=0;for(;t[--r]&&t[r]!==this;);t[r]=this}if(t.start&&!(t[0]||t.status==="running"))return t;let n=-1;for(;this[++n]&&this[n]!==t;);return this[n]=t,n||this.start(),t}each(t){return this.pipe(new Gt(t))}buffer(...t){return this.pipe(new pt(t))}filter(t){return this.pipe(new Te(t))}flatMap(t){return this.pipe(new Fe(t))}map(t){return this.pipe(new Ht(t))}reduce(t,n){return this.pipe(new qt(t,n)).value}scan(t,n){return this.pipe(new Re(t,n))}slice(t,n){return this.pipe(new Ne(t,n))}split(t){return this.pipe(new Le(t))}[Symbol.asyncIterator]=async function*(){let t=[],n=o=>t.push(o);function r(o,i){n=o}for(this.each(o=>n(o)).done(()=>n=P);n!==P;)yield t.length?t.shift():await new Promise(r)};static from=S(kt,{function:t=>new Ht(t),object:t=>typeof t.pipe=="function"?t:typeof t.then=="function"?new Ae(t):typeof t.length=="number"?new pt(Array.from(t)):ho(t)});static of(...t){return t.length<2?new $t(t[0]):new pt(t)}static buffer(t){return new pt(t)}static value(t){return new $t(t)}static merge(...t){return new Pe(t)}static push=k;static stop=mo;static unpipe=go;static each(t){return new Gt(t)}static reduce(t,n){return new qt(t,n)}},Ae=class extends R{constructor(t){super(),this.promise=t}start(){return this.promise.then(t=>k(this,t)).finally(()=>this.stop()),this}},$t=class extends R{constructor(t){super(),this.value=t}start(){return this.value!==void 0&&(k(this,this.value),this.status==="done")?this:super.start()}push(t){return this.value=t,k(this,t)}},pt=class extends R{constructor(t){super(),this.values=t||[]}start(){let t=this.values;if(!t)return super.start();let n=-1;for(;n++<t.length;)if(k(this,t[n]),this.status==="done")return this;return this.values=void 0,super.start()}push(t){return this.value=t,this.values?this.values.push(this.value):k(this,this.value)}},Te=class extends R{constructor(t){super(),this.fn=t}push(t){let n=this.fn;return n(t)&&k(this,t)}},Fe=class extends R{constructor(t){super(),this.fn=t}push(t){let n=this.fn,r=n(t);if(r!==void 0)if(isIterable(r))for(let o of r)k(this,o);else r.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(r.each(o=>k(this,o)))):r.then&&r.then(o=>k(this,o))}},Ht=class extends R{constructor(t){super(),this.fn=t}push(t){let n=this.fn,r=n(t);return r!==void 0&&k(this,r)}},Pe=class extends R{constructor(t){super(),this.inputs=t}push(t){return k(this,t)}pipe(t){let n=-1,r;for(;r=this.inputs[++n];)R.from(r).pipe(this);return R.prototype.pipe.call(this,t)}},Re=class extends R{constructor(t,n){super(),this.fn=t,this.value=n}push(t){let n=this.fn;this.value=n(this.value,t),k(this,this.value)}},Ne=class extends R{constructor(t,n=1/0){super(),this.index=-t,this.indexEnd=n-t}push(t){++this.index>0&&k(this,t),this.index===this.indexEnd&&this.stop()}},Le=class extends R{constructor(t){super(),this.chunk=[],typeof t=="number"?this.n=t:this.fn=t}fn(){return this.chunk.length===this.n}push(t){let n=this.chunk;this.fn(t)?(k(this,n),this.chunk=[]):n.push(t)}};var Sa={fullscreenchange:lt(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},xo=0;window.addEventListener("click",e=>xo=e.timeStamp);function Oe(e){return function(){return arguments[e]}}function ke(e){return e}function et(){}function X(){return this}var _n=Object.create,wo=Object.freeze,tr=wo(_n(_n(Object.prototype,{at:{value:et},shift:{value:et},push:{value:et},forEach:{value:et},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:X},find:{value:et},findIndex:{value:function(){return-1}},flat:{value:X},flatMap:{value:X},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:X},reduce:{value:Oe(1)},sort:{value:X},each:{value:X},pipe:{value:ke},start:{value:X},stop:{value:X},done:{value:X},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Ge(e,t){return(t%e+e)%e}var nr=e=>Ge(12,e);var Eo=/^([A-G][♭♯#b]?)(-?\d)$/,yo=/^[A-G][♭♯#b]?/,vo=/-?\d$/,bo=/[Hh]z$/,wt={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},er={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Bass Drum 2",36:"Bass Drum 1",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Tom 2",42:"Closed Hi-hat",43:"Low Tom 1",44:"Pedal Hi-hat",45:"Mid Tom 2",46:"Open Hi-hat",47:"Mid Tom 1",48:"High Tom 2",49:"Crash Cymbal 1",50:"High Tom 1",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function rr(e){return e.toLowerCase().replace(/\s+/g,"-")}for(let e in er)wt[rr(er[e])]=parseInt(e,10);var Do=69;function Bo(e,t=440){var n=Do+12*Math.log(e/t)/Math.log(2);return Math.fround(n)}function v(e){if(typeof e=="number")return e;if(bo.test(e))return Bo(parseFloat(e));let t=Eo.exec(e);return t?(parseInt(t[2],10)+1)*12+wt[t[1]]:wt[rr(e)]}function N(e){return typeof e=="number"?nr(e):wt[yo.exec(e)[0]]}var Ut=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function Et(e){return It(e)+Xt(e)}function It(e){return Ut[nr(e)]}function Xt(e){return typeof e=="number"?Math.floor(e/12)-1:Number(wt[(vo.exec(name)||tr)[0]])}function qe(e){var t={};return function(r){return r in t?t[r]:t[r]=e(r)}}function Wt(e){return function(n,...r){var o=e[n]||e.default;return o&&o.apply(this,r)}}var So={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function $e(e,t){if(t){var n=So[e.toLowerCase()]||e,r;try{r=new window.DOMParser().parseFromString(t,n)}catch{return}if(!r||r.getElementsByTagName("parsererror").length)throw new Error("Invalid "+e.toUpperCase()+": "+t);return r}}function or(e){return $e("html",e)}function ir(e){return $e("svg",e)}var z=Object.assign,ft={headers:function(e){return{}},body:H},Co=Wt({"application/x-www-form-urlencoded":function(e){return z(e,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(e){return z(e,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(e){return z(e,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(e){return z(e,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(e){return z(e,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(e){return z(e,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(e){return z(e,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(e){return z(e,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),Ao=Wt({"application/json":function(e){return e instanceof FormData?To(e):JSON.stringify(e)},"application/x-www-form-urlencoded":function(e){return e instanceof FormData?cr(e):ar(e)},"multipart/form-data":function(e){return e instanceof FormData?e:Fo(e)},default:H});function To(e){return JSON.stringify(Array.from(e.entries()).reduce(function(t,n){return t[n[0]]=n[1],t},{}))}function cr(e){return new URLSearchParams(e).toString()}function ar(e){return Object.keys(e).reduce((t,n)=>(t.append(n,e[n]),t),new URLSearchParams)}function Fo(e){throw new Error("TODO: dataToFormData(data)")}function Po(e,t){return t instanceof FormData?e+"?"+cr(t):e+"?"+ar(t)}function Ro(e,t,n,r){let o=typeof n=="string"?n:n&&n["Content-Type"]||"application/json",i=Co(o,z(ft.headers&&t?ft.headers(t):{},typeof n=="string"?{}:n)),a={method:e,mode:"cors",headers:i,credentials:"same-origin",signal:r&&r.signal};return e!=="GET"&&(a.body=Ao(o,ft.body?ft.body(t):t)),a}function jt(e){return e.blob()}function No(e){return e.json().catch(t=>{throw new Error("Cannot parse JSON "+e.url+". "+t.message)})}function sr(e){return e.formData()}function Lo(e){return e.text()}function Mo(e){return e.text().then(t=>/^\s*<!DOCTYPE html>/.test(t)?or(t):y("fragment",t))}function Oo(e){return e.text().then(t=>/^\s*<\?xml/.test(t)?ir(t):(console.warn("Untested SVG fragment parsing in request.js!"),y("fragment",t)))}var ko={"text/plain":Lo,"text/html":Mo,"image/svg+xml":Oo,"application/json":No,"multipart/form-data":sr,"application/x-www-form-urlencoded":sr,audio:jt,"audio/wav":jt,"audio/m4a":jt,"application/zip":jt};function Go(e){if(ft.onresponse&&(e=ft.onresponse(e)),!e.ok)throw new Error(e.statusText+"");let t=e.headers.get("Content-Type");if(!t)return;let n=t.replace(/\;.*$/,"");return ko[n](e)}function ur(e="GET",t,n={},r="application/json"){e=e.toUpperCase(),e==="GET"&&n&&(t=Po(t,n));let o=Ro(e,n,r,arguments[4]);return fetch(t,o).then(Go)}function lr(e){return ur("GET",e)}var qo={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},$o=/^[ABCDEFG][b♭#♯]{0,1}-?\d$/,pr=/^[ABCDEFG][b♭#♯]{0,1}/;function He(e){let t=e.trim().split(/\s+/),n=[],r=-1;for(;t[++r]!==void 0;){let o=Number(t[r]),i=t[++r];$o.test(i)?(i="note",--r):pr.test(i)&&(i="chord",--r);let a=[o,i],c=qo[i];if(c===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let s=pr.exec(t[++r])[0],u=t[r].slice(s.length)||t[++r],h=Number(t[++r]);a.push(s,u,h)}else for(;c--;){let s=Number(t[++r]);a.push(Number.isNaN(s)?t[r]:s)}n.push(a)}return n}function Ho(e){let t=e.files[Object.keys(e.files)[0]];return nt(t.type,t.content)}function Uo(e){let t=e.settings.find(matches({id:13324}))||e.settings[0];return nt("abc",t.abc)}function nt(e,t){if(typeof t=="object")return t.files?Ho(t):t.settings?Uo():Array.isArray(t)?{id:0,events:t}:t;if(e==="sequence"||e==="text/plain")return{events:He(t)};{let n=JSON.parse(t);return Array.isArray(n)?{id:0,events:n}:n}}var Io=qe(lr);var fr=S((e,t)=>typeof t,{string:function(e,t){return Io(t).then(n=>nt(e,n)).catch(n=>console.error(n))},default:function(e,t,n,r){t[e]=r}});var Xo=/^(\d+)\/(\d+)$/;function hr(e){let t=Xo.exec(e),n=parseInt(t[1],10),r=4/parseInt(t[2],10);return{1:"meter",2:n*r,3:r}}function dr(e){let t=e[2],n=e[3],r=t/n,o=4/n;return r+"/"+o}var A={};zr(A,{acciDoubleFlat:()=>ze,acciDoubleSharp:()=>Ve,acciFlat:()=>zt,acciNatural:()=>Vt,acciParensLeft:()=>ni,acciParensRight:()=>ri,acciSharp:()=>Jt,augmentationDot:()=>Ai,barLine:()=>Kt,barRepeat1:()=>Qi,barRepeat2:()=>Zi,barRepeat4:()=>Yi,barRepeatBegin:()=>ns,barRepeatDots:()=>is,barRepeatEnd:()=>rs,barRepeatEndBegin:()=>os,barRepeatLowerDot:()=>es,barRepeatSlash:()=>_i,barRepeatUpperDot:()=>ts,chordAugmented:()=>ws,chordBassSlash:()=>nn,chordBracketLeft:()=>Ds,chordBracketRight:()=>Bs,chordDiminished:()=>gs,chordGlyphs:()=>Ss,chordHalfDiminished:()=>xs,chordMajorSeventh:()=>Es,chordMinor:()=>ys,chordParensLeftTall:()=>vs,chordParensRightTall:()=>bs,clefAlto:()=>Xe,clefBass:()=>vt,clefDrum:()=>We,clefPercussion:()=>je,clefTreble:()=>yt,clefTrebleDown:()=>Ue,clefTrebleUp:()=>Ie,coda:()=>en,graceNoteStemDown:()=>ki,graceNoteStemUp:()=>Oi,head1:()=>oi,head2:()=>ii,head4:()=>si,headBracketLeft:()=>Je,headBracketRight:()=>Ke,headCircle:()=>fi,headCircleX:()=>hi,headDiamond:()=>ai,headDiamondWide:()=>ui,headPlus:()=>pi,headSlashHorizontalEnds:()=>gi,headSlashVerticalEnds:()=>mi,headSlashed2:()=>ci,headTriangleUp:()=>di,headX:()=>li,metDot:()=>Mi,metNote05Down:()=>Li,metNote05Up:()=>Pi,metNote1Down:()=>Ni,metNote1Up:()=>Fi,metNote2Down:()=>Ri,metNote2Up:()=>Ti,note0125Down:()=>Ci,note0125Up:()=>vi,note025Down:()=>Si,note025Up:()=>yi,note05Down:()=>Bi,note05Up:()=>Ei,note1Down:()=>Di,note1Up:()=>wi,note2Down:()=>bi,note2Up:()=>xi,rest0125:()=>Qe,rest01875:()=>Xi,rest025:()=>Ze,rest0375:()=>Wi,rest05:()=>Ye,rest075:()=>ji,rest1:()=>_e,rest15:()=>zi,rest2:()=>tn,rest3:()=>Vi,rest4:()=>Ji,rest6:()=>Ki,tailDown0125:()=>Ii,tailDown025:()=>Hi,tailDown05:()=>qi,tailUp0125:()=>Ui,tailUp025:()=>$i,tailUp05:()=>Gi,textBeam16Long:()=>Os,textBeam16Short:()=>Ms,textBeam8Long:()=>Ls,textBeam8Short:()=>Ns,textDot:()=>ks,textNote16Long:()=>Rs,textNote16Short:()=>Ps,textNote8Long:()=>Fs,textNote8Short:()=>Ts,textNoteLong:()=>As,textNoteShort:()=>Cs,textTie:()=>Gs,textTuplet3Long:()=>Is,textTuplet3Short:()=>$s,textTupletBeginLong:()=>Us,textTupletBeginShort:()=>qs,textTupletEndLong:()=>Xs,textTupletEndShort:()=>Hs,timeSig0:()=>Wo,timeSig1:()=>jo,timeSig2:()=>zo,timeSig3:()=>Vo,timeSig4:()=>Jo,timeSig5:()=>Ko,timeSig6:()=>Qo,timeSig7:()=>Zo,timeSig8:()=>Yo,timeSig9:()=>_o,timeSigCommon:()=>ti,timeSigCutCommon:()=>ei,tuplet0:()=>ss,tuplet1:()=>cs,tuplet2:()=>as,tuplet3:()=>us,tuplet4:()=>ls,tuplet5:()=>ps,tuplet6:()=>fs,tuplet7:()=>hs,tuplet8:()=>ds,tuplet9:()=>ms});var yt="&#xE050;",Ue="&#xE052;",Ie="&#xE053;",Xe="&#xE05C;",vt="&#xE062;",We="&#xE069;",je="&#xE069;",Wo="&#xE080;",jo="&#xE081;",zo="&#xE082;",Vo="&#xE083;",Jo="&#xE084;",Ko="&#xE085;",Qo="&#xE086;",Zo="&#xE087;",Yo="&#xE088;",_o="&#xE089;",ti="&#xE08A;",ei="&#xE08B;",ze="&#xE264;",zt="&#xE260;",Vt="&#xE261;",Jt="&#xE262;",Ve="&#xE263;",ni="&#xE26A;",ri="&#xE26B;",oi="&#xE0A4;",ii="&#xE0A3;",si="&#xE0A2;",Je="&#xE0F5;",Ke="&#xE0F6;",ci="&#xE0D0;",ai="&#xE0DB;",ui="&#xE0DC;",li="&#xE0A9;",pi="&#xE0AF;",fi="&#xE0E8;",hi="&#xE0B3;",di="&#xE0BE;",mi="&#xE100;",gi="&#xE101;",xi="&#xE1D3;",wi="&#xE1D5;",Ei="&#xE1D7;",yi="&#xE1D9;",vi="&#xE1DB;",bi="&#xE1D4;",Di="&#xE1D6;",Bi="&#xE1D8;",Si="&#xE1DA;",Ci="&#xE1DC;",Ai="&#xE1E7;",Ti="&#xECA3;",Fi="&#xECA5;",Pi="&#xECA7;",Ri="&#xECA4;",Ni="&#xECA6;",Li="&#xECA8;",Mi="&#xECB7;",Oi="&#xE560;",ki="&#xE561;",Gi="&#xE240;",qi="&#xE241;",$i="&#xE242;",Hi="&#xE243;",Ui="&#xE244;",Ii="&#xE245;",Qe="&#xE4E8;",Xi="&#xE4E8;&#xE1E7;",Ze="&#xE4E7;",Wi="&#xE4E7;&#xE1E7;",Ye="&#xE4E6;",ji="&#xE4E6;&#xE1E7;",_e="&#xE4E5;",zi="&#xE4E5;&#x200A;&#xE1E7;",tn="&#xE4E4;",Vi="&#xE4E4;&#x200A;&#xE1E7;",Ji="&#xE4E3;",Ki="&#xE4E3;&#x200A;&#xE1E7;",Kt="&#xE030",Qi="&#xE500;",Zi="&#xE501;",Yi="&#xE502;",_i="&#xE504;",ts="&#xE503;",es="&#xE505;",ns="&#xE040",rs="&#xE041",os="&#xE042",is="&#xE043",en="&#xE048",ss="&#xE880;",cs="&#xE881;",as="&#xE882;",us="&#xE883;",ls="&#xE884;",ps="&#xE885;",fs="&#xE886;",hs="&#xE887;",ds="&#xE888;",ms="&#xE889;",gs="&#xE870;",xs="&#xE871;",ws="&#xE872;",Es="&#xE873;",ys="&#xE874;",vs="&#xE875;",bs="&#xE876;",Ds="(",Bs=")",nn="&#xE87B;",Ss={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},Cs="&#xE1F0;",As="&#xE1F1;",Ts="&#xE1F2;",Fs="&#xE1F3;",Ps="&#xE1F4;",Rs="&#xE1F5;",Ns="&#xE1F7;",Ls="&#xE1F8;",Ms="&#xE1F9;",Os="&#xE1FA;",ks="&#xE1FC;",Gs="&#xE1FD;",qs="&#xE1FE",$s="&#xE1FF",Hs="&#xE200",Us="&#xE201",Is="&#xE202",Xs="&#xE203";function rn(e){return function(){return arguments[e]}}function W(){return this}var mr=Object.create,Ws=Object.freeze,Qt=Ws(mr(mr(Object.prototype,{at:{value:P},shift:{value:P},push:{value:P},forEach:{value:P},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:W},find:{value:P},findIndex:{value:function(){return-1}},flat:{value:W},flatMap:{value:W},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:W},reduce:{value:rn(1)},sort:{value:W},each:{value:W},pipe:{value:H},start:{value:W},stop:{value:W},done:{value:W},valueOf:{value:function(){return null}}}),{length:{value:0}}));function on(e,t){return(t%e+e)%e}function V(e){return on(12,e)}function gr(e){return e[1]==="chord"}function sn(e){return e[1]==="note"}function xr(e){return e[1]==="sequence"}function js(e,t){return t[e]}var Y=Z(js,!0);var Zt=S(Y(1),{chord:e=>e[4],lyric:e=>e[3],note:e=>e[4],sequence:e=>e[4],default:e=>0});function $(e){return e[0]+Zt(e)}function wr(e,t){return e>t?1:e<t?-1:0}var J=[0,2,4,5,7,9,11];function zs(e,t,n){return n.indexOf(e)===t}function Er(e,t){return e.map(n=>V(n+t)).filter(zs).sort(wr)}var ln=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function pn(e){return Er(J,e)}var{abs:Nu}=Math,Vs={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},Js=Float32Array.of(.9,.9,.8,1,1,.8,.8,.8,.9,1,1,1),Ks=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/9+0,4/6+0+0,1/6+0+0],Lu={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function an(e){let t=new Float32Array(12),n=N(e+2),r=7;for(;r--;)t[n=N(n+5)]=1;return t}function un(e,t,n){let r=e.length;for(;r--;)e[r]*=1-n+n*t[r];return e}var cn={note:(e,t,n=1)=>{let r=v(t[2]),o=an(r);return un(e,o,n*(1-r/192))},chord:(e,t,n=1)=>{let r=N(t[2]),o=Vs[t[3].replace(/\(|\)/g,"")];if(!o)return console.warn('No scale for chord extension "'+t[3]+'"'),e;let i=o.map(s=>N(r+s)),a=i.length,c;for(;a--;)c=an(i[a]),un(e,c,n*Js[o[a]]);return e}};function _t(e,t,n){let r=e[t],o=r[0],i=sn(r)?an(v(r[2])):gr(r)?cn.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),r):0;if(n!==void 0){let c=Float32Array.from({length:12},(s,u)=>Ks[(u+12-n)%12]);un(i,c,.3)}let a=t;for(;r=e[--a];){let c=cn[r[1]];if(!c)continue;let s=$(r);if(s>o)c(i,r,.5);else if(r[1]==="note"&&o-s<3){if(1-(o-s)/3>1)throw new Error("Influence should never be > 1 "+o+" "+s);c(i,r,.25*(1-(o-s)/3))}}for(a=t;(r=e[++a])&&r[0]-o<2;){if(!sn(r))continue;let c=cn[r[1]];if(c){if(1-(r[0]-o)/2>1)throw new Error("Influence should never be > 1 "+o+" "+stopBeat);c(i,r,.3*(1-(r[0]-o)/2))}}return i}var Yt=[0,7,5,2,10,9,3,4,8,11,1,6];function te(e){let t=Yt.length,n=0,r;for(;t--;)e[Yt[t]]>n&&(n=e[Yt[t]],r=Yt[t]);return r}var rt=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,bt=/b|♭/,Dt=/#|♯/;var fn=/b|♭|#|♯/g;var yr={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function vr(e,t){let n=ln[e],r=N(t),o=n.spellings[V(r)];return Ut[V(r-o)]+yr[o]}function ee(e,t){let n=ln[e],r,o,i;if(typeof t=="string"){let[s,u,h,l]=rt.exec(t)||[t];l&&(r=v(t),o=n.spellings[V(r)],i=Xt(r-o))}else r=t,o=n.spellings[V(r)],i=Xt(r-o);let a=Ut[V(r-o)],c=yr[o];return a+c+i}var D=class{constructor(){}clef="";pitched=!0;rows=Qt;getNoteHTML(t,n,r){let o=r>=4||Math.fround(r)===Math.fround(2.666666667)?"head4":r>=2||Math.fround(r)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${o}">${A[o]}</span>`}get minPitch(){return this.rows[0]}get midPitch(){return this.rows[13]}get maxPitch(){return this.rows[27]}get minLinePitch(){return this.rows[9]}get midLinePitch(){return this.rows[13]}get maxLinePitch(){return this.rows[17]}movePitch(t,n){let r=v(this.minPitch),o=v(this.maxPitch),i=v(t)+n;return i>=r&&i<=o?i:void 0}getPart(t){return this.getRowDiff(this.midLinePitch,t)<0?{stemDirection:"up",tieDirection:"up"}:{stemDirection:"down",tieDirection:"down"}}parts=[{}];getPartIndex(t){return 0}getRowDiff(t,n){let r=t.replace(fn,""),o=n.replace(fn,""),i=this.rows.indexOf(r),a=this.rows.indexOf(o);if(i===-1)throw new Error('Pitch "'+t+'" is not supported by stave '+this.constructor.name);if(a===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return a-i}getSpelling(t,n){return n[1]==="chord"?vr(t,n[2]):ee(t,n[2])}yRatioToPitch(t){let n=floor(t*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};var ot=class extends D{type="drum";clef=We;pitched=!1;rows=["","","","","","","","pedal-hi-hat","bass-drum-2","bass-drum-1","low-tom-2","low-tom-1","mid-tom-2","snare-drum-1","mid-tom-1","high-tom-1","closed-hi-hat","ride-cymbal-1","crash-cymbal-1","crash-cymbal-2","splash-cymbal","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#e={27:0,28:0,29:0,30:0,31:13,32:0,33:0,34:0,35:10,36:9,37:14,38:14,39:13,40:14,41:11,42:17,43:12,44:8,45:13,46:17,47:13,48:15,49:19,50:16,51:18,52:21,53:18,54:13,55:21,56:16,57:20,58:0,59:19,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0};get maxPitch(){return this.rows[25]}get minLinePitch(){return this.rows[8]}get midLinePitch(){return this.rows[12]}get maxLinePitch(){return this.rows[16]}getNoteHTML(t,n,r){let o=v(t),i=this.#t[o],a=A[i],c=i?`<span class="head" data-glyph="${i}">${a}</span>`:super.getNoteHTML(t,n,r);return n<.02?Je+c+Ke:c}getPart(t){return[35,36,37,38,40,41,43,44,45,47,50].includes(v(t))?{part:"drums",stemDirection:"down",tieDirection:"down",centerRow:"stave-lower"}:{stemDirection:"up",tieDirection:"up",centerRow:"stave-upper"}}parts=[{part:"drums",stemup:!1,tieup:!1,centerRow:"stave-lower"},{part:"cymbals",stemup:!0,tieup:!0,centerRow:"stave-upper"}];getPartIndex(t){return[35,36,37,38,40,41,43,44,45,47,50].includes(v(t))?1:0}getRowDiff(t,n){let r=v(t),o=v(n),i=this.#e[r],a=this.#e[o];if(i===void 0)throw new Error('Pitch "'+t+'" is not supported by stave '+this.constructor.name);if(a===void 0)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return a-i}getSpelling(t,n){return n[1]==="note"?Et(v(n[2])):ee(t,n[2])}yRatioToPitch(t){let n=floor(t*this.rows.length),r=n<4?4:n>17?17:n;return this.pitches[r]}};var Bt=class extends ot{type="percussion";clef=je;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get minLinePitch(){return this.rows[8]}get midLinePitch(){return this.rows[8]}get maxLinePitch(){return this.rows[8]}getPart(t){return[35,36,37,38,40,41,43,44,45,47,50].includes(v(t))?{stemDirection:"down",tieDirection:"down"}:{stemDirection:"up",tieDirection:"up"}}getRowDiff(t,n){return 0}};var St=class extends D{type="piano";rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"];getClefHTML(){return`<span class="treble-clef clef">${yt}</span><span class="bass-clef clef">${vt}</span>`}getTimeSigHTML(t,n,r){return`<span class="timesig" data-event="${r}" data-part="upper">
            <sup>${A["timeSig"+t]}</sup>
            <sub>${A["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${r}" data-part="lower">
            <sup>${A["timeSig"+t]}</sup>
            <sub>${A["timeSig"+n]}</sub>
        </span>`}getPart(t){return/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(t)?{part:"lower",centerPitch:"D3",centerRow:"stave-lower"}:{centerPitch:"B4",centerRow:"stave-upper"}}};var hn=class extends D{type="treble-up";clef=Ie;rows=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6","B6","C7","D7","E7","F7","G7","A7"]},dn=class extends D{type="treble";clef=yt;rows=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"]},mn=class extends D{type="treble-down";clef=Ue;rows=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5"]},gn=class extends D{type="alto";clef=Xe;rows=["D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"]},xn=class extends D{type="bass";clef=vt;rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5"]};D.treble=dn;D["treble-up"]=hn;D["treble-down"]=mn;D.alto=gn;D.bass=xn;D.piano=St;D.drum=ot;D.percussion=Bt;D.create=e=>new D[e];var ne=D;function Qs(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function wn(e){return e===window?Qs():e.getClientRects()[0]||e.getBoundingClientRect()}var K=1.1;function Zs(e){return parseFloat(e.dataset.duration)}function Ys(e){let t=e.childNodes;for(;t.length>1;)e.removeChild(e.lastChild)}function br(e,t,n){return`M${t[n[0]]}, ${-e*t[n[0]]-.5*K}
        L${t[n[n.length-1]]},${-e*t[n[n.length-1]]-.5*K}
        L${t[n[n.length-1]]},${-e*t[n[n.length-1]]+.5*K}
        L${t[n[0]]}, ${-e*t[n[0]]+.5*K}
        Z`}function En(e,t,n,r,o,i){if(i<.125)return;let a=r-1,c;for(;t[++a];)t[a]<=i?c?c.push(a):c=[a]:c&&(e.appendChild(y("path",{class:`beam-path-${4/i} beam-path`,d:br(o,n,c)})),En(e,t,n,c[0],o,i/2),c=void 0);c&&(e.appendChild(y("path",{class:`beam-path-${4/i} beam-path`,d:br(o,n,c)})),En(e,t,n,c[0],o,i/2),c=void 0)}function yn(e){let t=e.dataset.events.split(/\s+/),n=e.parentElement,r=t.map(l=>n.querySelector('.note[data-event="'+l+'"]')),o=r.map(Zs),i=e.viewBox.baseVal,a=i.y<-.5?i.y+.5:i.height-1,c=r.map(wn),s=c[0].x,u=c[c.length-1].x,h=c.map(l=>(l.x-s)/(u-s));Ys(e),En(e,o,h,0,-a,.25)}var vn=Object.assign,Dr=[],_s={done:!0,value:void 0};var Br={key:2,meter:1,default:0},tc={},wl=Y(0);function Sr(e){return Br[e[1]]||Br.default}function ec(e,t){return t[0]<e[0]?1:t[0]>e[0]?-1:Sr(t)-Sr(e)}function nc(e,t){return e.find(n=>n.id===t)}var rc={offset:(e,t,n)=>(n[0]-=e[++t],t),rate:(e,t,n)=>(n[0]/=e[++t],t),quantize:(e,t,n)=>{},transpose:(e,t,n)=>{switch(n[1]){case"note":case"chord":case"key":{let r=typeof n[2]=="string"?v(n[2]):n[2];n[2]=r+e[t+1];break}}return t+1}};function bn(e,t){let n=-1,r;for(;r=e[++n];)n=rc[r](e,n,t);return t}var Dn=class e{constructor(t,n=Dr,r=0,o=1/0,i=Dr){t.sort(ec),this.events=t,this.sequences=n,this.beat=r,this.duration=o,this.transforms=i;let a=-1,c;for(;(c=t[++a])&&bn(this.transforms,vn(tc,c))[0]<0;);this.n=a-1}next(){let{buffer:t,events:n,sequences:r,n:o}=this,i=n[o+1],a=i&&bn(this.transforms,vn({event:i,events:n},i)),c,s=0,u=0,h=i?a[0]:this.duration,l;for(;c=this[--s];)c.value||(c.next().value&&bn(this.transforms,c.value),c.done&&++u),c.value&&c.value[0]<h&&(l=c,h=c.value[0]),u&&(this[s]=this[s-u]);if(l)return this.value=l.value,this.value[0]+=this.beat,l.value=void 0,this;if(!a||this.duration<=a[0])return vn(this,_s);if(xr(i)){let p=this.sequences,f=nc(p,i[2]);if(!f)throw new Error('Sequence "'+i[2]+'" not found');let d=i.slice(5),m=new e(f.events,f.sequences?f.sequences.concat(p):p,a[0],a[4],d),w=0;for(;this[--w];);this[w]=m}return this.n+=1,this.value=a,this.value[0]+=this.beat,this}[Symbol.iterator](){return this}},Ct=class e{constructor(t,n=[],r=""){this.name=r,this.events=t,this.sequences=n}of(...t){return new e(t)}from(t){return t.length?new e(t):new e(t.events,t.sequences,t.name)}[Symbol.iterator](){return new Dn(this.events,this.sequences)}};function Bn(e){return 2**Math.ceil(Math.log2(e))}function Cr(e){return e>0&&(e&e-1)===0}var oc=[2,3,4,5,6,7,9],ic=1/12,Ar=.4,ht=0;function Tr(e,t){return .5*(1+Math.cos(2*Math.PI*t/e))}var Sn={};function Fr(e,t,n,r,o){let i=e/t,a=0,c=0,s=0,u,h;for(--o;r[++o]!==void 0&&r[o][0]-n<i/4;)s=1;for(--o;r[++o]!==void 0&&r[o][0]-n<e-i/4;){if(u=Math.round((r[o][0]-n)/i),h=1<<u,h>s){if(t>4&&h>s<<1)return;s+=h}a+=Tr(i,r[o][0]-n),c+=1,!(r[o][0]+r[o][4]-n>e)&&(a+=Ar*Tr(i,r[o][0]+r[o][4]-n),c+=Ar)}if(!(t>4&&u!==t-1)&&c)return Sn.score=a/c,Sn.rhythm=s,Sn}function sc(e,t,n,r,o,i,a){let c=t*Math.floor((n[r][0]-o)/t)+o,s=i.length;for(;t/i[--s]<ic;);++s;let u,h;for(;u=i[--s];)h=Fr(t,u,c,n,r),h&&h.score>=ht&&(ht=h.score,e.beat=c,e.duration=t,e.divisor=u,e.rhythm=h.rhythm),n[r][0]>=c+.5*t&&c+1.5*t<a&&(h=Fr(t,u,c+.5*t,n,r),h&&h.score>=ht&&(ht=h.score,e.beat=c+.5*t,e.duration=t,e.divisor=u,e.rhythm=h.rhythm));return e}function Cn(e,t,n){let r=-1;for(;e[++r]!==void 0&&e[r][0]<t;);if(!e[r])return;let o={};ht=0;let i=1/8;for(;(i*=2)&&i<=n;)sc(o,i,e,r,t,oc,t+n);return ht>0&&o}function At(e,t){return Math.round(t/e)*e}function it(e,t,n=Math.EPSILON){return e!==void 0&&(e===t||Math.abs(e-t)<n)}function st(e,t,n){return it(e,t,n)||e<t}function cc(e,t,n){return it(e,t,n)||e>t}function re(e,t,n){return e!==void 0&&t!==void 0&&!st(e,t,n)}function An(e,t,n){return e!==void 0&&t!==void 0&&!cc(e,t,n)}function oe(e,t){let n=e.length;for(;e[--n]&&e[n]>t;);return e[n]}function Tt(e,t){let n=-1,r=0;for(;e[++n]!==void 0;);for(;arguments[++r]!==void 0;)e[n++]=arguments[r];return e}function dt(e){let t=-1;for(;e[++t]!==void 0;);return t}function ie(e){return e[dt(e)-1]}function Ft(e,t){let n=[],r=-1;for(;t[++r]!==void 0;)n.push(e(t[r],r));return n}var j={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0};var Rr=Object.assign,{abs:Pr,ceil:mp,floor:gp,min:ac,max:Nr}=Math,F=1/24,xp=[0,2/24,3/24,4/24,6/24,8/24,9/24,10/24,12/24,14/24,15/24,16/24,18/24,20/24,21/24,22/24,1],Pn=[1/8,6/32,7/32,1/4,6/16,7/16,1/2,6/8,7/8,1,6/4,7/4,2,6/2,7/2,4,6,7,8],wp=Pn[0],Tn=[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8];function Rn(e){return e[0]+Zt(e)}function Lr(e,t){return Nr(e,Rn(t))}function Mr(e,t,n,r,o){if(n[0]!==r[o+1])throw console.log(o,n,r),new Error("HELP "+o);let i={},a=-1,c;for(;c=n[++a];){let s=_t(r,++o,t),u=te(s);i[a]=e.getSpelling(u,c)}return i}function se(e){let[t,n,r,o]=rt.exec(e[0]),i=o,a=N(n),c=e[0],s=0;for(;e[++s];){let[u,h,l,p]=rt.exec(e[s]);(p<i||p===i&&N(h)<a)&&(i=p,a=N(h),c=e[s])}return c}function ce(e){let[t,n,r,o]=rt.exec(e[0]),i=o,a=N(n),c=e[0],s=0;for(;e[++s];){let[u,h,l,p]=rt.exec(e[s]);(p>i||p===i&&N(h)>a)&&(i=p,a=N(h),c=e[s])}return c}function Nn(e,t,n){let r=e.getRowDiff(e.midLinePitch,t);return e.getRowDiff(e.midLinePitch,n)+r<-1}function Or(e,t){let n=se(t),r=ce(t);return Nn(e,n,r)}function uc(e,t){let n=[],r=-1,o;for(;o=t[++r];)o.type==="note"&&n.push(o.pitch);return Or(e,n)}function ct(e,t,n,r){let o=-1;for(;r[++o]&&r[o].beat===r.beat;);if(!r[o])return e;let i=r[0].beat,c=ie(r).beat-i,s=n.stemup===void 0?Or(t,Ft(Y("pitch"),r)):n.stemup,u=[],h;for(o=-1;h=r[++o];){let M=h.pitch;for(;r[++o]&&it(r[o].beat,h.beat,F);)s?v(r[o].pitch)>v(M)&&(M=r[o].pitch):v(r[o].pitch)<v(M)&&(M=r[o].pitch);--o,u.push(M)}let l=dt(r),p=0,f=0,d;for(o=-1;u[++o];)d=t.getRowDiff(t.midLinePitch,u[o]),o<(u.length-1)/2?p+=d/Math.floor(u.length/2):o>(u.length-1)/2&&(f+=d/Math.floor(u.length/2));let m=r[0],w=ie(r),x=t.getRowDiff(m.pitch,w.pitch),C=f-p,g=Pr(C)>Pr(.75*x)?.5*x:.5*C;for(o=-1;h=r[++o];)h.stemup=s,h.beam=r,h.stemHeight=s?1+.125*(g*o/(u.length-1)-t.getRowDiff(m.pitch,h.pitch)):1+.125*(-g*o/(u.length-1)+t.getRowDiff(m.pitch,h.pitch));return e.push(Rr(r,{pitch:m.pitch,duration:c,stemup:s,range:g})),e}function lc(e,t,n){let{beat:r,duration:o,divisor:i}=n,a=t.stemup===void 0?uc(e,n):t.stemup,c=-1,s;for(;s=n[++c];)s.type==="note"&&!s.beam&&(s.stemup=a);let u=r+.5*o,h=v(e.maxLinePitch)-12,l,p=dt(n);for(;(s=n[--p])&&s.beat>u;);for(++p;(s=n[--p])&&s.beat+s.duration>u;){let x=v(s.pitch);(!l||x>l)&&(l=x)}let f=h;for(p=-1;(s=n[++p])&&s.beat<F;){let x=v(s.pitch);(!f||x>f)&&(f=x)}let d=h;for(p=n.length;(s=n[--p])&&s.beat>r+o-o/i-F;){let x=v(s.pitch);(!d||x>d)&&(d=x)}let m=Math.ceil((f+d)/2),w=Et(m);m>l&&(l=m),n.pitch=Et(l),n.angle=-3*Math.sqrt(d-f),n.stemup=a}function pc(e,t,n,r,o,i,a){let c=i-a;if(!(a===0||t.includes(a))||!(i===n||t.includes(i))){let h=Mn(t,a,a+c);h&&(c=h-a)}let s=e.length;for(;e[--s]+F>c;);c=e[s+1]||e[e.length-1];let u=8;for(;(u*=.5)&&a%u;);return u<c&&(c=u),{type:"rest",beat:a,duration:c,stave:r,part:o}}function Fn(e,t,n,r,o,i,a){for(;re(a,i,F);){let c=pc(t,n.divisions,n.duration||100,r,o,a,i);e.push(c),i+=c.duration}return a}function fc(e,t,n,r,o,i,a){let c=Dt.test(a)?1:bt.test(a)?-1:void 0,s=a[0]+a.slice(-1);c!==r[s]&&(r[s]=c,e.push(Rr({},{type:"acci",beat:o,pitch:a,part:n,stave:t,event:i,value:c||0})))}function kr(e,t,n,r,o,i,a){let c=-1;for(;a[++c];)fc(e,t,n,r,o,i[c],a[c]);return o}function Gr(e,t,n,r){let o=ce(r),i=t.getRowDiff(o,t.maxLinePitch)+1;i<0&&e.push({type:"ledge",beat:n,pitch:o,rows:i}),o=se(r),i=t.getRowDiff(o,t.minLinePitch)-1,i>0&&e.push({type:"ledge",beat:n,pitch:o,rows:i})}function hc(e,t,n,r,o,i,a,c,s,u,h,l,p,f){(a.swingAsStraight8ths&&s===1||a.swingAsStraight16ths&&s===.5)&&u===3&&(h===4||h===5)&&(u=2);let d=s/u,m=c+s,w={type:"tuplet",beat:c,duration:s,divisor:u,part:i,stave:n},x,C;for(Cr(u)||e.push(w);An(c,m,F);){for(;(x=p[++f])&&st(x[0]-t.beat,c+.5*d,F);)l.push(x);if(--f,!l.length){e.push({type:"rest",beat:c,duration:d,stave:n,part:i}),c+=d;continue}let g=Mr(n,r,l,p,f-l.length),M=se(g),B=ce(g),mt=i.stemup===void 0?Nn(n,M,B):i.stemup,q=ac(l.reduce(Lr,0)-t.beat,x?x[0]-t.beat:t.duration,w.beat+w.duration),G=Nr(d,At(d,q-c));re(G,.5,F)?C&&(ct(e,n,i,C),C=void 0):C||(C={type:"beam",beat:c,part:i}),Gr(e,n,c,g),kr(e,n,i,o,c,l,g);let U=-1;for(;l[++U];)e.push({type:"note",beat:c,pitch:g[U],duration:G,part:i,stemup:mt,top:g[U]===B,bottom:g[U]===M,stave:n,event:l[U]});for(Tt(w,...e.slice(-1*l.length)),C&&Tt(C,...e.slice(-1*l.length)),U=l.length;U--;){let Wr=Rn(l[U])-t.beat;st(Wr,c+G+.5*d,F)?l.splice(U,1):e.push({type:"tie",beat:c,pitch:g[U],duration:G,stemup:mt,part:i,event:l[U]})}c+=G}return C&&ct(e,n,i,C),lc(n,i,w),f}function Ln(e,t,n,r=0,o={},i,a,c=j){let s=[],u=0,h=-1,l,p,f;for(;(l=a[++h])&&st(l[0]+l[4]-t.beat,u,F););for(--h;An(u,t.duration,F);){f&&t.divisions.find(G=>it(u,G,F))&&(ct(e,n,i,f),f=void 0);let d=Cn(a,t.beat+u,t.duration-u);if(d&&d.divisor!==2&&d.divisor!==4){re(d.beat-t.beat,u,F)&&Fn(e,Tn,t,n,i,u,d.beat-t.beat),f&&(ct(e,n,i,f),f=void 0),h=hc(e,t,n,r,o,i,c,d.beat-t.beat,d.duration,d.divisor,d.rhythm,s,a,h),u=d.beat-t.beat+d.duration;continue}for(;(l=a[++h])&&st(l[0]-t.beat,u,F);)s.push(l);if(--h,!s.length){if(!l){f&&(ct(e,n,i,f),f=void 0),Fn(e,Tn,t,n,i,u,t.duration);break}let G=At(.125,l[0]-t.beat);if(G<=u){console.log(`Problem at bar ${t.count}, moving to next bar ${u} ${G}`),t.error="Stop beat has ended up less than beat";break}Fn(e,Tn,t,n,i,u,G),u=G;continue}let m=Mr(n,r,s,a,h-s.length),w=se(m),x=ce(m),C=i.stemup===void 0?Nn(n,w,x):i.stemup;Gr(e,n,u,m),kr(e,n,i,o,u,s,m);let g=s.reduce(Lr,0)-t.beat,M=l&&At(.125,l[0])-t.beat;M<g?g=M:g%t.divisor>.6?g=Math.ceil(g/t.divisor)*t.divisor:g-u<1&&g-u>.5*Bn(g-u)?g=Bn(g-u)+u:g=At(.125,g),t.duration<g&&(g=t.duration);let B=oe(Pn,g-u)||headDuration[0];if(g=u+B,!B||!g){console.log("We have a problem. Stopping bar render."),console.log("DURATION ",B,g),t.error="Bad duration";break}let mt=Mn(t.divisions,u,u+B);mt&&(!(u===0||it(0,u%t.divisor,F))||!(g===t.duration||it(0,g%t.divisor,F)))&&(B=oe(Pn,mt-u)),B>=1?f&&(ct(e,n,i,f),f=void 0):f||(f={type:"beam",beat:u,part:i});let q=-1;for(;s[++q];)e.push({type:"note",beat:u,pitch:m[q],duration:B,part:i,stemup:C,top:m[q]===x,bottom:m[q]===w,stave:n,event:s[q]});for(f&&Tt(f,...e.slice(-1*s.length)),q=s.length;q--;){let G=Rn(s[q])-t.beat;st(G,u+B,F)?s.splice(q,1):e.push({type:"tie",beat:u,pitch:m[q],duration:B,stemup:C,part:i,event:s[q]})}u+=B}return f&&(ct(e,n,i,f),f=void 0),e}var dc={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function mc(e,t){return dc[e+","+t]||Qt}function Mn(e,t,n){let r=-1;for(;e[++r]&&e[r]<=t;);return n>e[r]?e[r]:void 0}var gc=[],xc={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},qr=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function wc(e,t){let n=qr.indexOf(e.pitch),r=qr.indexOf(t.pitch);return n>r?1:n<r?-1:0}function $r(e,t){return pn(t).reduce((r,o,i)=>{let a=o-J[i];if(a!==0){let c=It(J[i]),s=10;for(;s--;)r[c+s]=a}return r},e),e}function Ec(e,t,n,r,o,i,a){let c=-1,s;for(;s=i[++c];)switch(s[1]){case"key":{let u=N(s[2]),h=pn(u);$r(o,u),e.push.apply(e,h.map((l,p)=>l-J[p]&&{type:"acci",pitch:It(J[p])+xc[l-J[p]],value:l-J[p],stave:n}).filter(l=>!!l).sort(wc)),t.key=u;break}case"meter":{e.push({type:"timesig",beat:0,numerator:s[3]===1.5?s[2]/.5:s[2]/s[3],denominator:s[3]===1.5?8:4/s[3],stave:n,event:s});break}case"symbol":{e.push({type:"symbol"+s[2],stave:n});break}case"chord":{let u=s[0]-t.beat,h=_t(i,c,r),l=te(h),p=n.getSpelling(l,s);p==="C♭"&&a.spellChordRootCFlatAsB&&(p="B"),p==="E♯"&&a.spellChordRootESharpAsF&&(p="F"),p==="B♯"&&a.spellChordRootBSharpAsC&&(p="C"),p==="F♭"&&a.spellChordRootFFlatAsE&&(p="E"),e.push({type:"chord",beat:u,duration:s[0]+s[4]>t.beat+t.duration?t.duration-u:s[4],root:p,extension:s[3],event:s,stave:n});break}case"lyric":{let u=s[0]-t.beat;e.push({type:"lyric",beat:u,duration:s[0]+s[3]>t.beat+t.duration?t.duration-u:s[3],value:s[2],event:s,stave:n});break}case"sequence":{e.push({type:"doublebarline",stave:n,event:s}),e.push({type:"barcount",text:t.count,stave:n});break}default:{if(gc.includes(s[1]))return;console.log('Scribe: ignoring event type "'+s[1]+'"')}}return e}function Pt(e,t,n,r,o,i,a,c,s,u=j){let h=[];if(s){let d=$(s);d>t&&d<=t+n&&a.push(s)}let l=$r({},i),p={type:"bar",beat:t,duration:n,key:i,divisor:r,divisions:mc(n,r),stave:o,count:e,symbols:h};p.symbols.push({type:"clef",beat:0,stave:o}),Ec(h,p,o,i,l,a,j);let f;for(f in c)Ln(h,p,o,i,l,f,c[f],u);return f||Ln(h,p,o,i,l,"0",[],u),p}var ae=Symbol("scribe-id"),yc=0;function Q(e){return e[ae]||(e[ae]=++yc+""),e[ae]}var ue=Math.abs,le={flat:`<span class="chord-flat">${zt}</span>`,sharp:`<span class="chord-sharp">${Jt}</span>`},vc={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},bc={2:Ve,1:Jt,0:Vt,"-1":zt,"-2":ze},Dc={"1.33":tn,"0.67":_e,"0.33":Ye,"0.17":Ze,"0.08":Qe},Bc=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function L(e){return e.toFixed(4).replace(/\.?0+$/,"")}var Hr=S(Y("type"),{BARREPEAT:e=>y("span",{class:"BARREPEAT",html:A["barRepeat"+e.count],data:{duration:e.duration}}),clef:e=>e.stave.getClefHTML?y("fragment",e.stave.getClefHTML()):y("span",{class:`${e.stave.type}-clef clef`,html:e.stave.clef}),chord:e=>{let t=Bc.exec(e.extension);return y("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+e.root.replace(Dt,le.sharp).replace(bt,le.flat)+'</span><span class="chord-ext">'+(t[1]?'<span class="chord-ext-'+t[1]+'">'+t[1]+"</span>":"")+(t[2]?"<sub>"+t[2]+"</sub>":"")+(t[3]?"<sup>"+t[3].replace(Dt,le.sharp).replace(bt,le.flat)+"</sup>":"")+"</span>"+(e.bass?nn+'<span class="chord-bass">'+e.bass+"</span>":""),data:{beat:L(e.beat+1),duration:L(e.duration),event:Q(e.event)}})},timesig:e=>e.stave.getTimeSigHTML?y("fragment",e.stave.getTimeSigHTML(e.numerator,e.denominator,Q(e.event))):y("span",{class:"timesig",html:`<sup>${A["timeSig"+e.numerator]}</sup>
                <sub>${A["timeSig"+e.denominator]}</sub>`,data:{event:Q(e.event)}}),symbolcoda:e=>y("p",{html:en,class:"coda"}),barcount:e=>y("span",{html:e.text,class:"barcount"}),doublebarline:e=>y("span",{html:Kt+"&#x200A;"+Kt,class:"barline"}),lyric:e=>y("span",{class:"lyric",part:"lyric",html:e.value,data:{beat:L(e.beat+1),duration:L(e.duration),event:Q(e.event)}}),acci:e=>y("span",{class:vc[e.value]||"acci",html:bc[e.value]||Vt,data:e.beat===void 0?{pitch:e.pitch}:{beat:L(e.beat+1),pitch:e.pitch,part:e.part,event:Q(e.event)}}),ledge:e=>y("svg",{class:`${e.rows<0?"up":"down"}-ledge ledge`,viewBox:`0 -0.5 4.4 ${ue(e.rows)}`,preserveAspectRatio:"xMidYMin",style:`height: ${ue(e.rows)*.125}em;`,html:`
            <line x1="0" x2="4.4" y1="0" y2="0"></line>
            <line x1="0" x2="4.4" y1="2" y2="2"></line>
            <line x1="0" x2="4.4" y1="4" y2="4"></line>
            <line x1="0" x2="4.4" y1="6" y2="6"></line>
            <line x1="0" x2="4.4" y1="8" y2="8"></line>
        `,data:{beat:L(e.beat+1),pitch:e.pitch}}),note:e=>y("data",{class:`${e.stemup?"up-note":"down-note"} ${e.top?"top-note":""} ${e.bottom?"bottom-note":""} note`,style:e.stemHeight?`--stem-height: ${e.stemHeight};`:void 0,html:e.stave.getNoteHTML(e.pitch,e.dynamic,e.duration),data:{beat:L(e.beat+1),pitch:e.pitch,duration:L(e.duration),part:e.part,beam:e.beam&&Q(e.beam),event:Q(e.event)}}),beam:e=>y("svg",{class:`${e.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(e.range>0?-e.range:0)-.5} 1 ${ue(e.range)+1}`,preserveAspectRatio:"none",style:`height: ${(ue(e.range)+.5)*.125}em; align-self: ${e.range>0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*K} L1,${-e.range-.5*K} L1,${-e.range+.5*K} L0,${.5*K} Z"></path>`,data:{beat:L(e.beat+1),pitch:e.pitch,duration:L(e.duration),part:e.part,events:Ft(t=>Q(t.event),e).join(" ")}}),tie:e=>y("svg",{class:`${e.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:L(e.beat+1),pitch:e.pitch,duration:L(e.duration),part:e.part}}),tuplet:e=>y("span",{class:`${e.stemup?"up":"down"}-tuplet tuplet`,html:A["tuplet"+e.divisor],data:{beat:L(e.beat+1),pitch:e.pitch,duration:L(e.duration),part:e.part},style:`--angle: ${e.angle}deg;`}),rest:e=>y("span",{class:"rest",html:Dc[e.duration.toFixed(2)]||A["rest"+(e.duration+"").replace(".","")]||"",data:{beat:L(e.beat+1),pitch:e.pitch,duration:L(e.duration),part:e.part},"aria-hidden":"true"}),default:function(e){return function(t){e[t.type]||(e[t.type]=!0,console.log(t),console.error('Scribe: symbol type "'+t.type+'" not rendered'))}}({})});function Sc(e,t){let n=Hr(t);return n&&e.push(n),e}function Ur(e,t){return e.push(y("div",{class:`${t.stave.type}-stave stave ${t.error?"error ":""}bar`,data:{beat:t.beat,duration:t.duration,count:t.count},children:t.symbols.reduce(Sc,[])})),e}function Cc(e,t){if(!(e==="stave"||e==="event"||e==="sequence"||e==="beam"))return t}function Ac(e){let t=e.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(t,Cc)}function at(e,t){e.symbols=e.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"BARREPEAT",count:t,duration:e.duration}])}function pe(e,t,n){let r=Ac(n);switch(t.length){case 1:break;case 2:break;case 3:{r===t[0]&&r===t[1]&&r===t[2]&&n.symbols.filter(o=>o.type!=="clef"&&o.type!=="timesig").find(o=>o.type!=="rest")?(at(e[e.length-2],1),at(e[e.length-1],1),at(n,1)):(r!==t[1]||t[0]!==t[2])&&(t.length=2);break}case 4:{r===t[0]&&r===t[1]&&r===t[2]&&r===t[3]?(at(n,1),t.length=3):(r!==t[1]||t[0]!==t[2]||r!==t[3])&&(t.length=2);break}case 5:{r===t[1]&&r===t[3]&&t[0]===t[2]&&t[0]===t[4]?(e.length-=2,at(e[e.length-1],2),at(n,2)):t.length=4;break}case 6:break;case 7:{r===t[1]&&r===t[3]&&t[0]===t[2]&&t[0]===t[4]?(e.length-=1,at(n,2),t.length=5):t.length=1;break}}for(t.unshift(r);t.length>8;)t.pop()}function On(e,t,n){let r=e.getPartIndex(n[2]),o=t[r]||(t[r]=[]);t[r].push(n)}function kn(e,t,n=j){let r=[],o=[],i=[],a=0,c=[],s={},u=0,h=0,l,p,f,d;for(f of e){for(;f[0]>=a+l;){let w=Pt(r.length+1,a,l,p,t,u,c,s,d,n);pe(r,i,w),r.push(w),u=w.key,a=a+l,c=[],s={};let x=-1;for(;o[++x];)On(t,s,o[x]),$(o[x])<a+l&&o.splice(x--,1)}switch(f[1]){case"note":{On(t,s,f),$(f)>a+l&&o.push(f),h<$(f)&&(h=$(f));break}case"sequence":{f.events===e.events&&(d=f),h<$(f)&&(h=$(f));break}case"meter":l=f[2],p=f[3],f[0]!==a&&console.log("TODO");default:c.push(f)}}for(;o.length;){let w=Pt(r.length+1,a,l,p,t,u,c,s,d,n);pe(r,i,w),r.push(w),a=a+l,c=[],s={};let x=-1;for(;f=o[++x];)On(t,s,f),$(f)<a+l&&o.splice(x--,1)}for(;a<h-l;){let w=Pt(r.length+1,a,l,p,t,u,c,s,d,n);pe(r,i,w),r.push(w),a=a+l,c=[],s={}}let m=Pt(r.length+1,a,l,p,t,u,c,s,d,n);return pe(r,i,m),r.push(m),r}function Tc(e){return e[0]<=0&&e[1]==="meter"}function Fc(e){return e[0]<=0&&e[1]==="key"}function Gn(e,t,n,r,o,i=j){let a=e.events;!a.find(Tc)&&r&&a.unshift([0,"meter",r[2],r[3]]),!a.find(Fc)&&n&&a.unshift([0,"key",n]);let u=new Ct(a,e.sequences,e.name),h=ne.create(t||"treble"),l=[];return kn(u,h,i).reduce(Ur,l)}var Ir=Object.assign,Pc=Object.defineProperties,Rc=new URL("shadow.css",import.meta.url),fe=b.of(),Nc=[],Xr=new ResizeObserver(e=>{for(let t of e)E(t.target).shadowRoot.querySelectorAll(".beam").forEach(yn)}),Rf=Pc(Ce("scribe-music",{shadow:`<link rel="stylesheet" href="${Rc}" />`,construct:function(e,t){let n=e.querySelector("link");Nc.push(r=>n.href=r),fe.value&&(n.href=fe.value),t.data=b.of(),t.clef=b.of("treble"),t.key=b.of("C"),t.meter=b.of([-4,"meter",4,1]),t.transpose=b.of(0),t.swingAsStraight8ths=b.of(!1),t.swingAsStraight16ths=b.of(!1),t.debug=b.of(!1),t.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(e,t){if(t.isSafari&&this.classList.add("safari"),Xr.observe(this,{box:"content-box"}),!this.src){let n=this.textContent.trim();t.data.value=nt(this.type,n)}return b.frame(()=>{let n=t.data.value&&Gn(t.data.value,t.clef.value,t.key.value,t.meter.value,t.transpose.value,Ir({},j,{swingAsStraight8ths:t.swingAsStraight8ths.value,swingAsStraight16ths:t.swingAsStraight16ths.value}));e.querySelectorAll(".bar").forEach(r=>r.remove()),e.append.apply(e,n),e.querySelectorAll(".beam").forEach(yn),t.debug.value&&e.querySelectorAll(".bar").forEach(r=>{let o=parseFloat(r.dataset.duration),i=0,a,c;r.querySelector(".BARREPEAT")||(r.querySelectorAll(".rest[data-duration], .note[data-duration]").forEach(s=>{a!==parseFloat(s.dataset.beat)&&(a=parseFloat(s.dataset.beat),c=parseFloat(s.dataset.duration),i+=c)}),Math.round(i/.0625)!==Math.round(o/.0625)&&r.classList.add("error"))})})},disconnect:function(){Xr.unobserve(this)}},{clef:{attribute:function(e){this.clef=e},get:function(){return E(this).clef.value},set:function(e){if(!ne[e]){console.warn('<scribe-music> Attempt to set invalid clef="'+e+'" ignored');return}E(this).clef.value=e}},key:{attribute:function(e){this.key=e===""?"C":e},get:function(){return E(this).key.value},set:function(e){let t=E(this);if(typeof e!="string"||!/^[A-G][#b♯♭]?$/.test(e)){console.warn('<scribe-music> Attempt to set invalid key="'+e+'" ignored');return}t.key.value=e.replace(/[#b]$/,n=>n==="#"?"♯":"♭")}},meter:{attribute:function(e){this.meter=e===""?"4/4":e},get:function(){return dr(E(this).meter.value)},set:function(e){E(this).meter.value=Ir([0],hr(e))}},transpose:{attribute:function(e){this.transpose=e},get:function(){return E(this).transpose.value},set:function(e){E(this).transpose.value=typeof e=="number"?Math.round(e):parseInt(e,10)}},type:{attribute:function(e){this.type=e},writable:!0,value:"application/json"},src:{attribute:function(e){this.src=e},get:function(){return E(this).src},set:function(e){let t=E(this);t.src=e;let n=new URL(e,window.location);if(window.location.origin===n.origin&&window.location.pathname===n.pathname){let r=this.getRootNode().getElementById(n.hash.slice(1));if(!r)throw new Error('<scribe-music> src script "'+e+'" not found in document');this.data=JSON.parse(r.textContent)}else fr(this.type,n.href).then(r=>this.data=r)},default:null},data:{get:function(){return E(this).data.value},set:function(e){E(this).data.value=e},default:null},swing:{attribute:function(e){E(this).swingAsStraight8ths.value=e!==null}},shuffle:{attribute:function(e){E(this).swingAsStraight16ths.value=e!==null}},debug:{attribute:function(e){this.debug=e!==null},get:function(){return E(this).debug.value},set:function(e){E(this).debug.value=!!e}}},null,"github.com/stephband/scribe/"),{stylesheet:{set:e=>fe.value=e,get:()=>fe.value}});export{Rf as default};
//# sourceMappingURL=element.js.map
