/* Scribe 
   0.4.18
   By stephband */

var yo=Object.defineProperty;var Eo=(t,e)=>{for(var n in e)yo(t,n,{get:e[n],enumerable:!0})};var P,nt;function bo(t,e){let n=-1;for(;t[++n]&&t[n]!==e;);for(;t[n++];)t[n-1]=t[n]}function Ge(t){let e=0;for(;t[--e];)t[e].stop&&t[e].stop(),t[e]=void 0}function Ct(t,e){let n=0;for(;e[--n]&&e[n]!==t;);for(e[n]=t,n=-1;t[++n]&&t[n]!==e;);t[n]=e}function ft(t){let e=-1,n;for(;n=t[++e];)t[e]=void 0,n.invalidate(t)}function Pe(t,e){let n=0;for(;t[--n];)if(t[n]===e)return!0}var v=class t{static isSignal(e){return e instanceof t}static of(e){return new Be(e)}static from(e,n){if(e.then){let r=t.of();return e.then(o=>r.value=o),r}return e.pipe?e.pipe(new Fe):new It(e,n)}static compute(e,n){return new It(e,n)}static fromProperty(e,n){return new Ne(e,n)}static frame(e){return new Xt(e)}static tick(e){return new zt(e)}static temporal(e,n){return new ke(e,n)}static evaluate(e,n,r=e){let o=P;P=e,o||(nt=!1);let i=n.apply(r);return P=o,i}static get hasInvalidDependency(){return nt}static get evaluating(){return P}constructor(e){e&&(this.name=e)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},Be=class extends v{#t;constructor(e){super(),this.#t=e}get value(){return P&&Ct(this,P),this.#t}set value(e){this.#t!==e&&(this.#t=e,ft(this))}},Fe=class extends v{#t;constructor(e){super(),this.#t=e}get value(){return P&&Ct(this,P),this.#t}push(e){this.#t!==e&&(this.#t=e,ft(this))}},Ne=class extends v{#t;#e;constructor(e,n){super(e),this.object=n}evaluate(){return this.object[this.name]}get value(){return P&&Ct(this,P),this.#t?this.#e:(this.#e=v.evaluate(this,this.evaluate,this),nt||(this.#t=!0),this.#e)}set value(e){if(this.#e===e)return;let{object:n,name:r}=this;n[r]=e,e=n[r],this.#e!==e&&(this.#e=e,ft(this))}invalidate(e){this.#t&&(e&&!Pe(this,e)||(this.#t=!1,Ge(this),ft(this)))}},It=class extends v{#t;#e;#n;#r;constructor(e,n){super(),this.#t=e,this.#e=n}get value(){return P&&Ct(this,P),this.#n?this.#r:(this.#r=v.evaluate(this,this.#t,this.#e),nt||(this.#n=!0),this.#r)}invalidate(e){this.#n&&(e&&!Pe(this,e)||(this.#n=!1,Ge(this),ft(this)))}},ke=class extends v{#t=0;constructor(e,n){super(e),this.object=n}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return v.evaluating&&(Ct(this,P),this.getTime()<this.#t&&(nt=!0)),this.evaluate()}set value(e){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==e&&(this.object[this.name]=e,invalidateUntil(this.getTime()))}invalidateUntil(e){let r=this.getTime()>=this.#t;this.#t=e,r&&ft(this)}},Wt=class extends v{constructor(e){if(super(),P){let n=0;for(;P[--n]&&P[n]!==this;);P[n]=this}e&&(this.evaluate=e,(v.evaluate(this,this.evaluate)||nt)&&this.cue())}invalidate(e){this.constructor.observers.indexOf(this)===-1&&(e&&!Pe(this,e)||(Ge(this),this.cue()))}stop(){let e=0,n;for(;n=this[--e];){let i=-1;this[e]=void 0,n.stop?n.stop():bo(n,this)}let r=this.constructor.observers,o=r.indexOf(this);if(o!==-1){if(r===Te)throw new Error("Attempt to remove observer while observers is rendering");r.splice(o,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},Te;function Xn(t){let e=-1,n;for(Te=t;n=t[++e];)!v.evaluate(n,n.evaluate)&&!nt&&t.splice(e--,1);return Te=void 0,t}var jn=Promise.resolve();function Vn(){Xn(zt.observers).length&&jn.then(Vn)}var zt=class extends Wt{static observers=[];cue(){let e=this.constructor.observers;e.length||jn.then(Vn),e.push(this)}};function Kn(){Xn(Xt.observers).length&&requestAnimationFrame(Kn)}var Xt=class extends Wt{static observers=[];cue(){let e=this.constructor.observers;e.length||window.requestAnimationFrame(Kn),e.push(this)}};function vo(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function rt(t){return t===window?vo():t.getClientRects()[0]||t.getBoundingClientRect()}function k(t){return t}function D(t,e){return function(){let r=t.apply(this,arguments),o=e[r]||e.default;if(!o)throw new Error('overload() no function defined for key "'+r+'"');return o.apply(this,arguments)}}function ht(t){var e=new Map;return function(r){if(e.has(r))return e.get(r);var o=t(r);return e.set(r,o),o}}var So=Array.prototype;function Do(t,e){return typeof t=="function"?t.apply(null,e):t}function Jn(t,e,n){n=n||t.length;var r=n===1?e?t:ht(t):ht(function(o){return Jn(function(){var i=[o];return i.push.apply(i,arguments),t.apply(null,i)},e,n-1)});return function o(i){return arguments.length===0?o:arguments.length===1?r(i):arguments.length>=n?t.apply(null,arguments):Do(r(i),So.slice.call(arguments,1))}}var W=Jn;function O(){}var Co=D(k,{is:O,tag:O,data:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},dataset:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},html:function(t,e,n){e.innerHTML=n},text:function(t,e,n){e.textContent=n},style:D((t,e,n)=>typeof n,{string:(t,e,n)=>e.style=n,object:(t,e,n)=>Object.assign(e.style,n)}),children:function(t,e,n){e.innerHTML="",e.append.apply(e,n)},href:function(t,e,n){e instanceof SVGElement?e.setAttribute("href",n):e.href=n},points:X,cx:X,cy:X,r:X,x:X,y:X,dx:X,dy:X,transform:X,preserveAspectRatio:X,viewBox:X,default:function(t,e,n){t in e?e[t]=n:e.setAttribute(t,n)}});function X(t,e,n){e.setAttribute(t,n)}function Ro(t,e){for(var n=Object.keys(e),r=n.length;r--;)e[n[r]]!==void 0&&Co(n[r],t,e[n[r]]);return t}var jt=W(Ro,!0);var Oe="http://www.w3.org/2000/svg",Qn=document.createElement("template"),Me=(t,e)=>e&&typeof e;function Zn(t,e=""){let n=document.createRange();return n.selectNode(t),n.createContextualFragment(e)}var L=D(Me,{string:function(t,e){let n=document.createElementNS(Oe,t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElementNS(Oe,t);return typeof e.length=="number"?n.append.apply(n,e):jt(n,e),n},default:t=>document.createElementNS(Oe,t)}),Ao=D(Me,{string:function(t,e){let n=document.createElement(t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElement(t);return typeof e.length=="number"?n.append.apply(n,e):jt(n,e),n},default:t=>document.createElement(t)}),Bo=D(k,{comment:function(t,e){return document.createComment(e||"")},fragment:D(Me,{string:function(t,e,n){return n?Zn(n,e):(Qn.innerHTML=e,Qn.content.cloneNode(!0))},object:function(t,e,n){let r=n?Zn(n):document.createDocumentFragment();return typeof e.length=="number"?r.append.apply(r,e):jt(r,e),r},default:()=>document.createDocumentFragment()}),circle:L,ellipse:L,g:L,glyph:L,image:L,line:L,rect:L,use:L,path:L,pattern:L,polygon:L,polyline:L,svg:L,tspan:L,text:L,default:Ao}),b=Bo;function Le(t,e,n){let r;typeof n!="string"&&n.input!==void 0&&n.index!==void 0&&(r=n,n=r.input.slice(n.index+n[0].length+(n.consumed||0)));let o=t.exec(n);if(!o)return;let i=e(o);return r&&(r.consumed=(r.consumed||0)+o.index+o[0].length+(o.consumed||0)),i}var tu=W(Le,!0);function Fo(t,e,n){throw n.input!==void 0&&n.index!==void 0&&(n=n.input),new Error('Cannot parse string "'+(n.length>128?n.length.slice(0,128)+"â€¦":n)+'"')}function No(t,e,n){let r=-1;for(;++r<n.length;)e=n[r]!==void 0&&t[r]?t[r](e,n):e;return t.done?t.done(e,n):t.close?t.close(e,n):e}function ko(t,e,n,r){let o=Le(t,i=>No(e,n,i),r);return o===void 0?e.catch?e.catch(n,r):Fo(t,e,r):o}var Yn=W(ko,!0);var _n=Symbol("internals");function $e(t,e,n){return e[_n]=e.attachInternals&&!e.getAttribute("is")?e.attachInternals():{shadowRoot:n}}function w(t){return t[_n]}var tr=Object.defineProperties;var qe={},To={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return w(this).form}},labels:{get:function(){return w(this).labels}},validity:{get:function(){return w(this).validity}},validationMessage:{get:function(){return w(this).validationMessage}},willValidate:{get:function(){return w(this).willValidate}},checkValidity:{value:function(){return w(this).checkValidity()}},reportValidity:{value:function(){return w(this).reportValidity()}}},He=!1,Go=Yn(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() â€“ name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null),er={once:!0};function Po(t){return t.sheet?Promise.resolve({target:t}):new Promise((e,n)=>{t.addEventListener("load",e,er),t.addEventListener("error",n,er)})}function Oo(t){t.stop()}function Mo(t){if(qe[t])return qe[t];let e=document.createElement(t).constructor;if(e===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+t+"> is HTMLUnknownElement");return qe[t]=e}function Lo(t,e){if(t.hasOwnProperty(e)){let n=t[e];delete t[e],t[e]=n}return t}function nr(t,e){let n=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(e.stylesheet){let r=b("link",{rel:"stylesheet",href:e.stylesheet});n.append(r)}return n}function $o(t,e){return typeof e=="string"?e[0]==="#"?t.appendChild(document.getElementById(e.slice(1)).content.clone(!0)):t.innerHTML=e:t.appendChild(e.content.clone(!0)),t}function qo(t){let e=t.isUpgraded;return t.isUpgraded=!0,!e}function rr(t,e){return Array.from(t.querySelectorAll('[is="'+e+'"]')).filter(qo)}var Ho=D((t,e)=>typeof e,{object:(t,e)=>e,function:(t,e)=>({value:e}),default:(t,e)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof e)}});function Ue(t,e={},n={},r=""){let{name:o,tag:i}=Go(t),a=typeof i=="string"?Mo(i):HTMLElement,l=[],s={},u,f;for(u in n)f=Ho(u,n[u]),f.attribute&&l.push(u),(f.set||f.get||"value"in f)&&(s[u]=f),n[u]=f;function p(){let c=Reflect.construct(a,arguments,p),d=e.mode||typeof e.shadow=="string"?nr(c,e):void 0;e.shadow&&$o(d,e.shadow);let g=$e(p,c,d);return i&&(He=!0),e.construct&&e.construct.call(c,d,g),Object.keys(s).reduce(Lo,c),c}if(p.prototype=Object.create(a.prototype,s),n.value&&(p.formAssociated=!0,tr(p.prototype,To),(e.enable||e.disable)&&(p.prototype.formDisabledCallback=function(c){let d=w(this);return c?e.disable&&e.disable.call(this,d.shadowRoot,d):e.enable&&e.enable.call(this,d.shadowRoot,d)}),e.reset&&(p.prototype.formResetCallback=function(){let c=w(this);return e.reset.call(this,c.shadowRoot,c)}),e.restore&&(p.prototype.formStateRestoreCallback=function(){let c=w(this);return e.restore.call(this,c.shadowRoot,c)})),l.length&&(p.observedAttributes=l,p.prototype.attributeChangedCallback=function(c,d,g){return n[c].attribute.call(this,g)}),e.connect&&(p.prototype.connectedCallback=function(){let c=w(this),d=c.shadowRoot;if(c.stopable=e.connect.call(this,d,c),!d)return;let g=d.querySelectorAll('link[rel="stylesheet"]');if(g.length){let h=b("style","*:not(slot), slot:not([name]) { display: none !important; }");d.prepend(h);let m;c.loadPromise?m=c.loadPromise.then(()=>new Promise(requestAnimationFrame)):m=c.loadPromise=Promise.all(Array.from(g,Po)),m.finally(()=>{h.remove(),e.load&&e.load.call(this,d,c)})}else e.load&&e.load.call(this,d,c)}),p.prototype.disconnectedCallback=function(){let c=w(this);c.stopable&&(c.stopable.stop?c.stopable.stop():c.stopable.forEach(Oo)),e.disconnect&&e.disconnect.call(this,c.shadowRoot,c)},window.console&&window.console.log("%c<"+(i?i+" is="+o:o)+">%c "+r,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(o,p,i&&{extends:i}),i&&!He){let c=document.createElement("div");if(c.style.position="fixed",c.style.left="-1000px",c.style.top="-1000px",c.innerHTML="<"+i+' is="'+o+'"></'+i+">",document.body.append(c),c.remove(),He)p.polyfillByRoot=O;else{let d=function(h){let m={};Object.keys(s).forEach(A=>{h[A]!==void 0&&(m[A]=h[A])}),tr(h,s);let x=e.mode||e.shadow?nr(h,e):void 0,y=$e(p,h,x);e.construct&&e.construct.call(h,x,y),Object.assign(h,m);let E=-1,T;for(;T=l[++E];){let A=h.attributes[T];A&&n[T].attribute.call(h,A.value)}e.connect&&e.connect.call(h,x,y)},g=function(h){rr(h,o).forEach(d),new MutationObserver(()=>rr(h,o).forEach(d)).observe(h,{childList:!0,subtree:!0})};p.polyfillByRoot=g,g(document)}}else p.polyfillByRoot=O;return p}var dt=t=>typeof t;var Uo=Object.defineProperties,or=D(dt,{function:t=>t(),object:t=>t.stop()}),ot=class extends k{#t;stop(){if(this.status==="done")return this;this.status="done";let e=this.#t;return this.#t=void 0,e&&e.forEach(or),this}done(e){return this.status==="done"?(or(listener),this):((this.#t||(this.#t=[])).push(e),this)}};Uo(ot.prototype,{status:{writable:!0}});function Io(t){throw new TypeError("Stream cannot be created .from() "+typeof t)}function $(t,e){if(e===void 0)return;let n=-1;for(;t[++n];)t[n].push(e);return t}function Wo(t){ot.prototype.stop.apply(t);let e=-1,n;for(;n=t[++e];)t[e]=void 0,n.stop&&(Je(n,t),n[-1]||n.stop());return t}function Je(t,e){let n=0;for(;t[--n]&&t[n]!==e;);for(;t[n--];)t[n+1]=t[n]}function ir(t,e){let n=-1;for(;t[++n]&&t[n]!==e;);for(;t[n++];)t[n-1]=t[n]}function zo(t,e){Je(e,t),ir(t,e)}var Rt=class extends ot{stop(){if(this.status==="done")return this;let e;for(;e=this[-1];){let n=-1;for(;this[n--];)this[n+1]=this[n];ir(e,this),e.stop&&!e[0]&&e.stop(e)}return super.stop()}},Vt=class extends Rt{constructor(e){super(),this.push=e}},Kt=class extends Rt{constructor(e,n){super(),this.fn=e,this.value=n,this.i=0}push(e){let n=this.fn;this.value=n(this.value,e,this.i++,this)}},M=class extends Rt{start(){if(this.status)return this;let e=0,n;t:for(;n=this[--e];){let r=-1;for(;n[++r];)if(n[r]===this)continue t;n[r]=this,r===0&&n.start&&n.start()}return this}stop(){if(this.status==="done")return this;super.stop();let e=-1,n;for(;n=this[++e];)this[e]=void 0,n.stop&&(Je(n,this),n[-1]||n.stop());return this}pipe(e){if(e.stop){let r=0;for(;e[--r]&&e[r]!==this;);e[r]=this}if(e.start&&!(e[0]||e.status==="running"))return e;let n=-1;for(;this[++n]&&this[n]!==e;);return this[n]=e,n||this.start(),e}each(e){return this.pipe(new Vt(e))}buffer(...e){return this.pipe(new mt(e))}filter(e){return this.pipe(new We(e))}flatMap(e){return this.pipe(new ze(e))}map(e){return this.pipe(new Qt(e))}reduce(e,n){return this.pipe(new Kt(e,n)).value}scan(e,n){return this.pipe(new je(e,n))}slice(e,n){return this.pipe(new Ve(e,n))}split(e){return this.pipe(new Ke(e))}[Symbol.asyncIterator]=async function*(){let e=[],n=o=>e.push(o);function r(o,i){n=o}for(this.each(o=>n(o)).done(()=>n=O);n!==O;)yield e.length?e.shift():await new Promise(r)};static from=D(dt,{function:e=>new Qt(e),object:e=>typeof e.pipe=="function"?e:typeof e.then=="function"?new Ie(e):typeof e.length=="number"?new mt(Array.from(e)):Io(e)});static of(...e){return e.length<2?new Jt(e[0]):new mt(e)}static buffer(e){return new mt(e)}static value(e){return new Jt(e)}static merge(...e){return new Xe(e)}static push=$;static stop=Wo;static unpipe=zo;static each(e){return new Vt(e)}static reduce(e,n){return new Kt(e,n)}},Ie=class extends M{constructor(e){super(),this.promise=e}start(){return this.promise.then(e=>$(this,e)).finally(()=>this.stop()),this}},Jt=class extends M{constructor(e){super(),this.value=e}start(){return this.value!==void 0&&($(this,this.value),this.status==="done")?this:super.start()}push(e){return this.value=e,$(this,e)}},mt=class extends M{constructor(e){super(),this.values=e||[]}start(){let e=this.values;if(!e)return super.start();let n=-1;for(;n++<e.length;)if($(this,e[n]),this.status==="done")return this;return this.values=void 0,super.start()}push(e){return this.value=e,this.values?this.values.push(this.value):$(this,this.value)}},We=class extends M{constructor(e){super(),this.fn=e}push(e){let n=this.fn;return n(e)&&$(this,e)}},ze=class extends M{constructor(e){super(),this.fn=e}push(e){let n=this.fn,r=n(e);if(r!==void 0)if(isIterable(r))for(let o of r)$(this,o);else r.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(r.each(o=>$(this,o)))):r.then&&r.then(o=>$(this,o))}},Qt=class extends M{constructor(e){super(),this.fn=e}push(e){let n=this.fn,r=n(e);return r!==void 0&&$(this,r)}},Xe=class extends M{constructor(e){super(),this.inputs=e}push(e){return $(this,e)}pipe(e){let n=-1,r;for(;r=this.inputs[++n];)M.from(r).pipe(this);return M.prototype.pipe.call(this,e)}},je=class extends M{constructor(e,n){super(),this.fn=e,this.value=n}push(e){let n=this.fn;this.value=n(this.value,e),$(this,this.value)}},Ve=class extends M{constructor(e,n=1/0){super(),this.index=-e,this.indexEnd=n-e}push(e){++this.index>0&&$(this,e),this.index===this.indexEnd&&this.stop()}},Ke=class extends M{constructor(e){super(),this.chunk=[],typeof e=="number"?this.n=e:this.fn=e}fn(){return this.chunk.length===this.n}push(e){let n=this.chunk;this.fn(e)?($(this,n),this.chunk=[]):n.push(e)}};var Bu={fullscreenchange:ht(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},Xo=0;window.addEventListener("click",t=>Xo=t.timeStamp);function Qe(t){return function(){return arguments[t]}}function Ze(t){return t}function it(){}function j(){return this}var sr=Object.create,jo=Object.freeze,ar=jo(sr(sr(Object.prototype,{at:{value:it},shift:{value:it},push:{value:it},forEach:{value:it},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:j},find:{value:it},findIndex:{value:function(){return-1}},flat:{value:j},flatMap:{value:j},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:j},reduce:{value:Qe(1)},sort:{value:j},each:{value:j},pipe:{value:Ze},start:{value:j},stop:{value:j},done:{value:j},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Ye(t,e){return(e%t+t)%t}var cr=t=>Ye(12,t);var Vo=/^([A-G][â™­â™¯#b]?)(-?\d)$/,Ko=/^[A-G][â™­â™¯#b]?/,Jo=/-?\d$/,Qo=/[Hh]z$/,At={C:0,"Câ™¯":1,"C#":1,"Dâ™­":1,Db:1,D:2,"Dâ™¯":3,"D#":3,"Eâ™­":3,Eb:3,E:4,F:5,"Fâ™¯":6,"F#":6,"Gâ™­":6,Gb:6,G:7,"Gâ™¯":8,"G#":8,"Aâ™­":8,Ab:8,A:9,"Aâ™¯":10,"A#":10,"Bâ™­":10,Bb:10,B:11},_e={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Low Bass Drum",36:"High Bass Drum",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Floor Tom",42:"Closed Hi-hat",43:"High Floor Tom",44:"Pedal Hi-hat",45:"Low Tom",46:"Open Hi-hat",47:"Low Mid Tom",48:"High Mid Tom",49:"Crash Cymbal 1",50:"High Tom",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function ur(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in _e)At[ur(_e[t])]=parseInt(t,10);var Zo=69;function Yo(t,e=440){var n=Zo+12*Math.log(t/e)/Math.log(2);return Math.fround(n)}function S(t){if(typeof t=="number")return t;if(Qo.test(t))return Yo(parseFloat(t));let e=Vo.exec(t);return e?(parseInt(e[2],10)+1)*12+At[e[1]]:At[ur(t)]}function C(t){return typeof t=="number"?cr(t):At[Ko.exec(t)[0]]}var Zt=["C","Câ™¯","D","Eâ™­","E","F","Fâ™¯","G","Gâ™¯","A","Bâ™­","B"];function Q(t){return H(t)+Yt(t)}function H(t){return Zt[cr(t)]}function Yt(t){return typeof t=="number"?Math.floor(t/12)-1:Number(At[(Jo.exec(name)||ar)[0]])}function lr(t){let e=S(t);return _e[e]||""}function tn(t){var e={};return function(r){return r in e?e[r]:e[r]=t(r)}}function _t(t){return function(n,...r){var o=t[n]||t.default;return o&&o.apply(this,r)}}var _o={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function en(t,e){if(e){var n=_o[t.toLowerCase()]||t,r;try{r=new window.DOMParser().parseFromString(e,n)}catch{return}if(!r||r.getElementsByTagName("parsererror").length)throw new Error("Invalid "+t.toUpperCase()+": "+e);return r}}function pr(t){return en("html",t)}function fr(t){return en("svg",t)}var _=Object.assign,gt={headers:function(t){return{}},body:k},ti=_t({"application/x-www-form-urlencoded":function(t){return _(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(t){return _(t,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(t){return _(t,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(t){return _(t,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(t){return _(t,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(t){return _(t,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(t){return _(t,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(t){return _(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),ei=_t({"application/json":function(t){return t instanceof FormData?ni(t):JSON.stringify(t)},"application/x-www-form-urlencoded":function(t){return t instanceof FormData?dr(t):mr(t)},"multipart/form-data":function(t){return t instanceof FormData?t:ri(t)},default:k});function ni(t){return JSON.stringify(Array.from(t.entries()).reduce(function(e,n){return e[n[0]]=n[1],e},{}))}function dr(t){return new URLSearchParams(t).toString()}function mr(t){return Object.keys(t).reduce((e,n)=>(e.append(n,t[n]),e),new URLSearchParams)}function ri(t){throw new Error("TODO: dataToFormData(data)")}function oi(t,e){return e instanceof FormData?t+"?"+dr(e):t+"?"+mr(e)}function ii(t,e,n,r){let o=typeof n=="string"?n:n&&n["Content-Type"]||"application/json",i=ti(o,_(gt.headers&&e?gt.headers(e):{},typeof n=="string"?{}:n)),a={method:t,mode:"cors",headers:i,credentials:"same-origin",signal:r&&r.signal};return t!=="GET"&&(a.body=ei(o,gt.body?gt.body(e):e)),a}function te(t){return t.blob()}function si(t){return t.json().catch(e=>{throw new Error("Cannot parse JSON "+t.url+". "+e.message)})}function hr(t){return t.formData()}function ai(t){return t.text()}function ci(t){return t.text().then(e=>/^\s*<!DOCTYPE html>/.test(e)?pr(e):b("fragment",e))}function ui(t){return t.text().then(e=>/^\s*<\?xml/.test(e)?fr(e):(console.warn("Untested SVG fragment parsing in request.js!"),b("fragment",e)))}var li={"text/plain":ai,"text/html":ci,"image/svg+xml":ui,"application/json":si,"multipart/form-data":hr,"application/x-www-form-urlencoded":hr,audio:te,"audio/wav":te,"audio/m4a":te,"application/zip":te};function pi(t){if(gt.onresponse&&(t=gt.onresponse(t)),!t.ok)throw new Error(t.statusText+"");let e=t.headers.get("Content-Type");if(!e)return;let n=e.replace(/\;.*$/,"");return li[n](t)}function gr(t="GET",e,n={},r="application/json"){t=t.toUpperCase(),t==="GET"&&n&&(e=oi(e,n));let o=ii(t,n,r,arguments[4]);return fetch(e,o).then(pi)}function wr(t){return gr("GET",t)}var fi={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},hi=/^[ABCDEFG][bâ™­#â™¯]{0,1}-?\d$/,xr=/^[ABCDEFG][bâ™­#â™¯]{0,1}/;function nn(t){let e=t.trim().split(/\s+/),n=[],r=-1;for(;e[++r]!==void 0;){let o=Number(e[r]),i=e[++r];hi.test(i)?(i="note",--r):xr.test(i)&&(i="chord",--r);let a=[o,i],l=fi[i];if(l===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let s=xr.exec(e[++r])[0],u=e[r].slice(s.length)||e[++r],f=Number(e[++r]);a.push(s,u,f)}else for(;l--;){let s=Number(e[++r]);a.push(Number.isNaN(s)?e[r]:s)}n.push(a)}return n}function di(t){let e=t.files[Object.keys(t.files)[0]];return st(e.type,e.content)}function mi(t){let e=t.settings.find(matches({id:13324}))||t.settings[0];return st("abc",e.abc)}function st(t,e){if(typeof e=="object")return e.files?di(e):e.settings?mi():Array.isArray(e)?{id:0,events:e}:e;if(t==="sequence"||t==="text/plain")return{events:nn(e)};{let n=JSON.parse(e);return Array.isArray(n)?{id:0,events:n}:n}}var gi=tn(wr);var yr=D((t,e)=>typeof e,{string:function(t,e){return gi(e).then(n=>st(t,n)).catch(n=>console.error(n))},default:function(t,e,n,r){e[t]=r}});var wi=/^(\d+)\/(\d+)$/;function Er(t){let e=wi.exec(t),n=parseInt(e[1],10),r=4/parseInt(e[2],10);return{1:"meter",2:n*r,3:r}}function br(t){let e=t[2],n=t[3],r=e/n,o=4/n;return r+"/"+o}var G={};Eo(G,{acciDoubleFlat:()=>rn,acciDoubleSharp:()=>on,acciFlat:()=>ne,acciNatural:()=>re,acciParensLeft:()=>Ni,acciParensRight:()=>ki,acciSharp:()=>oe,augmentationDot:()=>Yi,barLine:()=>bs,barRepeat1:()=>vs,barRepeat2:()=>Ss,barRepeat4:()=>Ds,barRepeatBegin:()=>Bs,barRepeatDots:()=>ks,barRepeatEnd:()=>Fs,barRepeatEndBegin:()=>Ns,barRepeatLowerDot:()=>As,barRepeatSlash:()=>Cs,barRepeatUpperDot:()=>Rs,chordAugmented:()=>zs,chordBassSlash:()=>wn,chordBracketLeft:()=>Js,chordBracketRight:()=>Qs,chordDiminished:()=>Is,chordGlyphs:()=>Zs,chordHalfDiminished:()=>Ws,chordMajorSeventh:()=>Xs,chordMinor:()=>js,chordParensLeftTall:()=>Vs,chordParensRightTall:()=>Ks,clefAlto:()=>kt,clefBass:()=>Tt,clefDrum:()=>ee,clefTreble:()=>Bt,clefTrebleDown:()=>Ft,clefTrebleUp:()=>Nt,coda:()=>gn,graceNoteStemDown:()=>as,graceNoteStemUp:()=>ss,head1:()=>sn,head2:()=>an,head4:()=>cn,headBracketLeft:()=>un,headBracketRight:()=>ln,headCircle:()=>Li,headCircleX:()=>$i,headDiamond:()=>Gi,headDiamondWide:()=>Pi,headPlus:()=>Mi,headSlashHorizontalEnds:()=>Ui,headSlashVerticalEnds:()=>Hi,headSlashed2:()=>Ti,headTriangleUp:()=>qi,headX:()=>Oi,metDot:()=>is,metNote05Down:()=>os,metNote05Up:()=>es,metNote1Down:()=>rs,metNote1Up:()=>ts,metNote2Down:()=>ns,metNote2Up:()=>_i,note0125Down:()=>Zi,note0125Up:()=>ji,note025Down:()=>Qi,note025Up:()=>Xi,note05Down:()=>Ji,note05Up:()=>zi,note1Down:()=>Ki,note1Up:()=>Wi,note2Down:()=>Vi,note2Up:()=>Ii,rest0125:()=>pn,rest01875:()=>ds,rest025:()=>fn,rest0375:()=>ms,rest05:()=>hn,rest075:()=>gs,rest1:()=>dn,rest15:()=>ws,rest2:()=>mn,rest3:()=>xs,rest4:()=>ys,rest6:()=>Es,tailDown0125:()=>hs,tailDown025:()=>ps,tailDown05:()=>us,tailUp0125:()=>fs,tailUp025:()=>ls,tailUp05:()=>cs,textBeam16Long:()=>aa,textBeam16Short:()=>sa,textBeam8Long:()=>ia,textBeam8Short:()=>oa,textDot:()=>ca,textNote16Long:()=>ra,textNote16Short:()=>na,textNote8Long:()=>ea,textNote8Short:()=>ta,textNoteLong:()=>_s,textNoteShort:()=>Ys,textTie:()=>ua,textTuplet3Long:()=>da,textTuplet3Short:()=>pa,textTupletBeginLong:()=>ha,textTupletBeginShort:()=>la,textTupletEndLong:()=>ma,textTupletEndShort:()=>fa,timeSig0:()=>xi,timeSig1:()=>yi,timeSig2:()=>Ei,timeSig3:()=>bi,timeSig4:()=>vi,timeSig5:()=>Si,timeSig6:()=>Di,timeSig7:()=>Ci,timeSig8:()=>Ri,timeSig9:()=>Ai,timeSigCommon:()=>Bi,timeSigCutCommon:()=>Fi,tuplet0:()=>Ts,tuplet1:()=>Gs,tuplet2:()=>Ps,tuplet3:()=>Os,tuplet4:()=>Ms,tuplet5:()=>Ls,tuplet6:()=>$s,tuplet7:()=>qs,tuplet8:()=>Hs,tuplet9:()=>Us});var Bt="&#xE050;",Ft="&#xE052;",Nt="&#xE053;",kt="&#xE05C;",Tt="&#xE062;",ee="&#xE069;",xi="&#xE080;",yi="&#xE081;",Ei="&#xE082;",bi="&#xE083;",vi="&#xE084;",Si="&#xE085;",Di="&#xE086;",Ci="&#xE087;",Ri="&#xE088;",Ai="&#xE089;",Bi="&#xE08A;",Fi="&#xE08B;",rn="&#xE264;",ne="&#xE260;",re="&#xE261;",oe="&#xE262;",on="&#xE263;",Ni="&#xE26A;",ki="&#xE26B;",sn="&#xE0A4;",an="&#xE0A3;",cn="&#xE0A2;",un="&#xE0F5;",ln="&#xE0F6;",Ti="&#xE0D0;",Gi="&#xE0DB;",Pi="&#xE0DC;",Oi="&#xE0A9;",Mi="&#xE0AF;",Li="&#xE0E8;",$i="&#xE0B3;",qi="&#xE0BE;",Hi="&#xE100;",Ui="&#xE101;",Ii="&#xE1D3;",Wi="&#xE1D5;",zi="&#xE1D7;",Xi="&#xE1D9;",ji="&#xE1DB;",Vi="&#xE1D4;",Ki="&#xE1D6;",Ji="&#xE1D8;",Qi="&#xE1DA;",Zi="&#xE1DC;",Yi="&#xE1E7;",_i="&#xECA3;",ts="&#xECA5;",es="&#xECA7;",ns="&#xECA4;",rs="&#xECA6;",os="&#xECA8;",is="&#xECB7;",ss="&#xE560;",as="&#xE561;",cs="&#xE240;",us="&#xE241;",ls="&#xE242;",ps="&#xE243;",fs="&#xE244;",hs="&#xE245;",pn="&#xE4E8;",ds="&#xE4E8;&#xE1E7;",fn="&#xE4E7;",ms="&#xE4E7;&#xE1E7;",hn="&#xE4E6;",gs="&#xE4E6;&#xE1E7;",dn="&#xE4E5;",ws="&#xE4E5;&#x200A;&#xE1E7;",mn="&#xE4E4;",xs="&#xE4E4;&#x200A;&#xE1E7;",ys="&#xE4E3;",Es="&#xE4E3;&#x200A;&#xE1E7;",bs="&#xE030",vs="&#xE500;",Ss="&#xE501;",Ds="&#xE502;",Cs="&#xE504;",Rs="&#xE503;",As="&#xE505;",Bs="&#xE040",Fs="&#xE041",Ns="&#xE042",ks="&#xE043",gn="&#xE048",Ts="&#xE880;",Gs="&#xE881;",Ps="&#xE882;",Os="&#xE883;",Ms="&#xE884;",Ls="&#xE885;",$s="&#xE886;",qs="&#xE887;",Hs="&#xE888;",Us="&#xE889;",Is="&#xE870;",Ws="&#xE871;",zs="&#xE872;",Xs="&#xE873;",js="&#xE874;",Vs="&#xE875;",Ks="&#xE876;",Js="(",Qs=")",wn="&#xE87B;",Zs={"âˆ†â™¯11":"î¡³îµ¢11","âˆ†":"î¡³",7:"7","-7":"î¡´7","-â™­6":"î¡´îµ 6","7susâ™­9":"7susîµ¢",Ã¸:"î¡±","7â™¯11":"7îµ¢11","-âˆ†":"î¡´î¡³","âˆ†â™­6":"î¡³îµ 6","-â™­9":"î¡´îµ 9",Ã¸7:"î¡±7","âˆ†â™¯5":"î¡³îµ¢5","7alt":"7alt","Â°":"î¡°",dim:"î¡°","7â™­9":"7îµ ","+7":"î¡²7"},Ys="&#xE1F0;",_s="&#xE1F1;",ta="&#xE1F2;",ea="&#xE1F3;",na="&#xE1F4;",ra="&#xE1F5;",oa="&#xE1F7;",ia="&#xE1F8;",sa="&#xE1F9;",aa="&#xE1FA;",ca="&#xE1FC;",ua="&#xE1FD;",la="&#xE1FE",pa="&#xE1FF",fa="&#xE200",ha="&#xE201",da="&#xE202",ma="&#xE203";function xn(t){return function(){return arguments[t]}}function V(){return this}var vr=Object.create,ga=Object.freeze,ie=ga(vr(vr(Object.prototype,{at:{value:O},shift:{value:O},push:{value:O},forEach:{value:O},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:V},find:{value:O},findIndex:{value:function(){return-1}},flat:{value:V},flatMap:{value:V},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:V},reduce:{value:xn(1)},sort:{value:V},each:{value:V},pipe:{value:k},start:{value:V},stop:{value:V},done:{value:V},valueOf:{value:function(){return null}}}),{length:{value:0}}));function z(t){return Math.pow(10,t/20)}var wa=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function at(t){return function(n){if(typeof n=="number")return n;var r=wa.exec(n);if(!r||!t[r[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+n+'" (accepted units '+Object.keys(t).join(", ")+")");return r?t.catch(parseFloat(r[1]),r[2]):t.catch(parseFloat(n))}return t[r[2]||""](parseFloat(r[1]))}}var Sr={fff:z(-5),ff:z(-10),f:z(-15),mf:z(-20),mp:z(-25),p:z(-30),pp:z(-35),ppp:z(-40)},Dr=at({"":parseFloat,db:z,dB:z,catch:t=>{if(!Sr[t])throw new Error('Sequence: dynamic "'+t+'" not recognised');return Sr[t]}});var xa=/b|#/g,ya={b:"â™­","#":"â™¯"};function Ea(t){return ya[t]}function yn(t){switch(t[1]){case"chord":t[2]=C(t[2]),t[3]=t[3].replaceAll(xa,Ea);break;case"lyric":console.warn('Old data contains "lyric" event, should be "text"'),t[1]="text";break;case"key":t[2]=C(t[2]);break;case"note":t[2]=S(t[2]),t[3]=Dr(t[3]);break}return t}var ba=Object.assign,se=Object.defineProperty,ae={writable:!0};function va(t){let e=[],n=-1;for(;t[++n]!==void 0;)e.push(t[n]);return e}function wt(t){return t.toFixed(4).replace(/\.?0+$/,"")}var xt=class t{constructor(){ba(this,yn(arguments)),se(this,"event",ae),se(this,"events",ae),se(this,"index",ae),se(this,"target",ae)}toJSON(){return va(this)}toString(){let e=wt(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+H(this[2])+" "+this[3]+" "+wt(this[4]);break;case"key":e+=" "+H(this[2]);break;case"note":e+=" "+Q(this[2])+" "+this[3]+" "+wt(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+wt(this[4])+" "+this[5];break;case"rate":e+=" "+wt(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+wt(this[4]);break;case"start":case"stop":e+=" "+Q(this[2])+" "+this[3];break;default:let n=1;for(;this[++n]!==void 0;)e+=this[n]}return e}static of(...e){return new t(...e)}static from(e,n,r){let o=new t(...e);return o.event=e,o.events=n,o.index=r,o}static isChordEvent=En;static isNoteEvent=ce;static isSequenceEvent=Sa};function En(t){return t[1]==="chord"}function ce(t){return t[1]==="note"}function Sa(t){return t[1]==="sequence"}function Da(t,e){return e[t]}var ct=W(Da,!0);var Cr=D(ct(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function F(t){return t[0]+Cr(t)}function yt(t,e){return(e%t+t)%t}function Z(t){return yt(12,t)}function Rr(t,e){return t>e?1:t<e?-1:0}var q=[0,2,4,5,7,9,11];function Ca(t,e,n){return n.indexOf(t)===e}function Ar(t,e){return t.map(n=>Z(n+e)).filter(Ca).sort(Rr)}var Dn=[{name:"C",symbol:"Câˆ†",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Dâ™­",symbol:"Dâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"Dâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"Eâ™­",symbol:"Eâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"Eâˆ†",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"Fâˆ†",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Fâ™¯",symbol:"Fâ™¯âˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"Gâˆ†",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"Aâ™­",symbol:"Aâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"Aâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"Bâ™­",symbol:"Bâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"Bâˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function Et(t){return Ar(q,t)}var{abs:Kl}=Math,Ra={"":[0,4,7],"âˆ†":[0,4,7,11],"âˆ†7":[0,4,7,11],"âˆ†â™¯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-6":[0,3,7,9],"-13":[0,3,7,9],"-â™­6":[0,3,7,8],"7susâ™­9":[0,1,5,7,10],Ã¸:[0,3,6,10],"-âˆ†":[0,3,7,11],"7â™¯11":[0,4,6,7,10],"âˆ†â™­6":[0,4,7,8],"-â™­9":[0,1,3,7],Ã¸7:[0,2,3,6,10],"âˆ†â™¯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"Â°":[0,3,6,9],"7â™­9":[0,1,4,7,10],"7â™¯9":[0,3,4,7,10],"7â™­13":[0,4,7,8,10],"13â™­9":[0,1,4,7,9],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},Aa=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),Ba=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],Jl={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function vn(t){let e=new Float32Array(12),n=C(t+2),r=7;for(;r--;)n=C(n+5),e[n]=1;return e}function Sn(t,e,n){let r=t.length;for(;r--;)t[r]*=1-n+n*e[r];return t}var bn={note:(t,e,n=1)=>{let r=S(e[2]),o=vn(r);return Sn(t,o,n*(1-r/192))},chord:(t,e,n=1)=>{let r=C(e[2]),o=Ra[e[3].replace(/\(|\)/g,"")];if(!o)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=o.map(s=>C(r+s)),a=i.length,l;for(;a--;)l=vn(i[a]),Sn(t,l,n/i.length*Aa[o[a]]);return t}};function le(t,e,n){let r=t[e],o=r[0],i=ce(r)?vn(S(r[2])):En(r)?bn.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),r):0;if(n!==void 0){let l=Float32Array.from({length:12},(s,u)=>Ba[(u+12-n)%12]);Sn(i,l,.3)}let a=e;for(;r=t[--a];){let l=bn[r[1]];if(!l)continue;let s=F(r);if(s>o)l(i,r,.5);else if(r[1]==="note"&&o-s<3){if(1-(o-s)/3>1)throw new Error("Influence should never be > 1 "+o+" "+s);l(i,r,.25*(1-(o-r[0])/3))}}for(a=e;(r=t[++a])&&r[0]-o<2;){if(!ce(r))continue;let l=bn[r[1]];if(l){if(1-(r[0]-o)/2>1)throw new Error("Influence should never be > 1 "+o+" "+stopBeat);l(i,r,.3*(1-(r[0]-o)/2))}}return i}var ue=[0,7,5,2,10,9,3,4,8,11,1,6];function pe(t){let e=ue.length,n=0,r;for(;e--;)t[ue[e]]>n&&(n=t[ue[e]],r=ue[e]);return r}var Fr=/^([A-G])([b#â™­â™¯ð„«ð„ª])?(-?\d)?$/,Gt=/b|â™­/,Pt=/#|â™¯/;var fe=/b|â™­|#|â™¯/g,he={"-2":"ð„«","-1":"â™­",0:"",1:"â™¯",2:"ð„ª"},Br=["Fâ™¯","Câ™¯","Gâ™¯","Dâ™¯","Aâ™¯","Eâ™¯","Bâ™¯","Bâ™­","Eâ™­","Aâ™­","Dâ™­","Gâ™­","Câ™­","Fâ™­"];function de(t,e){let n=Br.indexOf(t.pitch),r=Br.indexOf(e.pitch);return n>r?1:n<r?-1:0}var Nr={"-2":"ð„«","-1":"â™­",0:"",1:"â™¯",2:"ð„ª"};function kr(t,e){let n=Dn[t],r=C(e),o=n.spellings[Z(r)];return Zt[Z(r-o)]+Nr[o]}function Tr(t,e){let n=Dn[t],r,o,i;if(typeof e=="string"){let[s,u,f,p]=Fr.exec(e)||[e];p&&(r=S(e),o=n.spellings[Z(r)],i=Yt(r-o))}else r=e,o=n.spellings[Z(r)],i=Yt(r-o);let a=Zt[Z(r-o)],l=Nr[o];return a+l+i}var Fa=globalThis||window;var{floor:Gr,round:pp}=Math,R=class{constructor(){}pitched=!0;rows=ie;getNoteHTML(e,n,r){let o=r>=4||Math.fround(r)===Math.fround(2.666666667)?"head4":r>=2||Math.fround(r)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${o}">${G[o]}</span>`}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return Gr(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,n){let r=S(this.minPitch),o=S(this.maxPitch),i=S(e)+n;return i>=r&&i<=o?i:void 0}parts=[{name:"main"}];getPart(e){return this.parts[0]}getRow(e,n){let o=(typeof n=="string"?n:Q(n)).replace(fe,""),i=this.rows.indexOf(o);if(Fa.DEBUG&&i===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+n+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getPitch(e){return this.rows[e].split(/\s+/)[0]}getSpelling(e,n){return n[1]==="chord"?kr(e,n[2]):Tr(e,n[2])}createKeySymbols(e){let n=[],r=C(e),o=Et(r);return n.push.apply(n,o.map((i,a)=>i-q[a]&&{type:"acci",pitch:H(q[a])+he[i-q[a]],value:i-q[a],part:this.parts[0]}).filter(i=>!!i).sort(de)),n}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let n=Gr(e*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};var Na=globalThis||window;function Pr(t){return lr(t).toLowerCase().replace(/\s+/g,"-").replace(/-drum|-cymbal/,"")}var ut=class extends R{type="drum";pitched=!1;rows=["","","","","splash chinese","crash-2","crash-1","ride-1 ride-2 ride-bell","closed-hi-hat open-hi-hat","high-tom cowbell","low-mid-tom high-mid-tom","snare-1 snare2 side-stick","low-tom sticks hand-clap tambourine","high-floor-tom","low-floor-tom","low-bass high-bass","","pedal-hi-hat","","","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};getNoteHTML(e,n,r){let o=S(e),i=this.#t[o],a=G[i],l=i?`<span class="head" data-glyph="${i}">${a}</span>`:super.getNoteHTML(e,n,r);return n<.02?un+l+ln:l}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(S(e))?this.parts[0]:this.parts[1]}getRow(e,n){let r=typeof n=="string"?n:Pr(n);if(!r)throw new Error("Drum name not found for pitch "+n);let o=this.rows.findIndex(i=>i.includes(r));if(Na.DEBUG&&o===-1)throw new Error('Pitch "'+r+'" is not supported by stave '+this.constructor.name);return o===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),o>-1?o:void 0}getSpelling(e,n){return n[1]==="note"?Pr(S(n[2])):super.getSpelliing(e,n[2])}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let n=floor(e*this.rows.length),r=n<4?4:n>17?17:n;return this.pitches[r]}};var Ot=class extends ut{type="percussion";rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var ka=globalThis||window,Or=Object.assign,Mt=class extends R{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(e,n,r){return`<span class="timesig" data-event="${r}" data-part="rh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${r}" data-part="lh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+n]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(e,n){n=typeof n=="string"?n:Q(n);let r=e.name+"-"+n.replace(fe,""),o=this.rows.findIndex(i=>i.includes(r));if(ka.DEBUG&&o===-1)throw new Error('Pitch "'+r+'" is not supported by '+this.constructor.name);return o===-1&&console.warn('Pitch "'+r+'" is not supported by '+this.constructor.name),o>-1?o:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#â™­â™¯ð„«ð„ª]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let n=[],r=C(e),i=Et(r).map((a,l)=>a-q[l]&&{type:"acci",pitch:H(q[l])+he[a-q[l]],value:a-q[l]}).filter(a=>!!a).sort(de);return n.push.apply(n,i.map(a=>Or({part:this.parts[1]},a))),n.push.apply(n,i.map(a=>Or({part:this.parts[2]},a))),n}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var Cn=class extends R{type="treble-up";clef=Nt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},Rn=class extends R{type="treble";clef=Bt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},An=class extends R{type="treble-down";clef=Ft;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},Bn=class extends R{type="alto";clef=kt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Fn=class extends R{type="bass";clef=Tt;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};R.treble=new Rn;R["treble-up"]=new Cn;R["treble-down"]=new An;R.alto=new Bn;R.bass=new Fn;R.piano=new Mt;R.drum=new ut;R.percussion=new Ot;R.create=t=>(console.warn("Deprecated: Stave.create(type). Use Stave[type]."),R[t]);var me=R;var Mr=t=>t*Math.PI/180;var Lr=at({deg:Mr,rad:k,turn:t=>t*2*Math.PI,catch:function(t){throw new Error('Cannot parse value "'+t+'"')}});var Ta=/px$/,Ga=/deg$|turn$|rad$/;function Pa(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function ge(t,e){var n=Pa(t,e);return typeof n=="string"?Ta.test(n)?parseFloat(n):Ga.test(n)?Lr(n):n:n}var we,xe;function Oa(){if(!we){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",we=ge("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return we}function Ma(){return xe||(xe=ge("font-size",document.documentElement)),xe}window.addEventListener("resize",()=>{we=void 0,xe=void 0});var La=D(dt,{number:k,string:at({px:k,em:t=>Oa()*t,rem:t=>Ma()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),$r=La;var qr=D((t,e)=>e[1],{note:(t,e)=>(e[2]=S(e[2])+t,e),chord:(t,e)=>(e[2]=C(C(e[2])+t),e[5]!==void 0&&(e[5]=C(C(e[2])+t)),e),key:(t,e)=>(e[2]=C(C(e[2])+t),e),default:k});var $a={displace:(t,e,n)=>(n[0]-=t[++e],e),rate:(t,e,n)=>{switch(n[0]/=t[++e],n[1]){case"chord":case"note":case"sequence":n[4]/=t[e];break;case"text":n[3]/=t[e];break}return e},quantize:(t,e,n)=>{},transpose:(t,e,n)=>(qr(t[e+1],n),e+1)};function Lt(t,e){let n=-1,r;for(;r=t[++n];)n=$a[r](t,n,e);return e}var Hr=Object.assign,Ur=[],qa={done:!0,value:void 0},Ir={key:2,meter:1,default:0},Ha={};function Wr(t){return Ir[t[1]]||Ir.default}function Ua(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:Wr(e)-Wr(t)}function Ia(t,e){return t.find(n=>n.id===e)}var $t=class t{constructor(e,n=Ur,r=Ur){e.sort(Ua),this.events=e,this.sequences=n,this.transforms=r;let o=-1,i;for(;(i=e[++o])&&Lt(r,Hr(Ha,i))[0]<0;);this.n=o-1}next(){let{events:e,sequences:n,transforms:r,n:o}=this,i=e[o+1],a=i&&Lt(r,xt.from(i,e,o+1)),l,s=-1,u=0,f=a?a[0]:1/0,p;for(;l=this[++s];){let c=l.value;c||((c=l.next().value)&&(Lt(this.transforms,c),c[0]+=l.startBeat,c.target=(c.target||0)+l.target),(l.done||c[0]>=l.stopBeat)&&++u),c&&c[0]<l.stopBeat&&c[0]<f&&(p=l,f=c[0]),u&&(this[s]=this[s+u])}if(p)return this.value=p.value,p.value=void 0,this;if(!a)return Hr(this,qa);if(this.n+=1,this.value=a,xt.isSequenceEvent(i)){let c=this.sequences,d=Ia(c,i[2]);if(!d)throw new Error('Sequence id "'+i[2]+'" not found');let g=new t(d.events,d.sequences?d.sequences.concat(c):c,i.slice(5));g.startBeat=a[0],g.stopBeat=a[0]+a[4],g.target=a[3];let h=-1;for(;this[++h];);this[h]=g}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};function Wa(t,e){let n;for(n in t)if(t[n]!==e[n])return!1;return!0}var wf=W(Wa,!0);function za(t,e,n){let r=t(e),o=t(n);return o===r?0:r>o?1:-1}var zr=W(za,!0);var{abs:Xa,EPSILON:ja}=Math;function ye(t,e){return Math.round(e/t)*t}function K(t,e,n=ja){return t!==void 0&&(t===e||Xa(t-e)<n)}function lt(t,e,n){return K(t,e,n)||t<e}function Va(t,e,n){return K(t,e,n)||t>e}function bt(t,e,n){return t!==void 0&&e!==void 0&&!lt(t,e,n)}function Ee(t,e,n){return t!==void 0&&e!==void 0&&!Va(t,e,n)}var{pow:Ka}=Math,Ja=1/24,Qa=[2,3,4,5,6,7,9],Za=1/12,Xr=.25,jr=.2,Nn={},vt=0;function Vr(t,e){return Math.cos(2*Math.PI*e/t)}function Kr(t,e,n,r,o){let i=t/e,a=0,l=0,s=0,u,f;for(r[o-1]&&bt(F(r[o-1]),n+.5*i,Ja)&&(s=1),--o;r[++o]!==void 0&&r[o][0]-n<i/4;)s=1;for(--o;r[++o]!==void 0&&r[o][0]-n<t-i/4;){if(u=Math.round((r[o][0]-n)/i),f=1<<u,u<e&&f>s){if(e>4&&f>s<<1)return;s+=f}a+=Vr(i,r[o][0]-n),l+=1,!(r[o][0]+r[o][4]-n>t)&&(a+=jr*Vr(i,r[o][0]+r[o][4]-n),l+=jr)}if(!(e>4&&u!==e-1)&&l)return Nn.score=a/(l+1),Nn.rhythm=s,Nn}function Ya(t,e,n,r,o,i,a){let l=n[r-1]&&F(n[r-1])>o+.125?o:e*Math.floor((n[r][0]-o)/e)+o,s=i.length;for(;e/i[--s]<Za;);++s;let u,f;for(;u=i[--s];)f=Kr(e,u,l,n,r),f&&f.score>=vt&&f.score&&(vt=f.score,t.beat=l,t.duration=e,t.divisor=u,t.rhythm=f.rhythm),n[r][0]>=l+.5*e&&l+1.5*e<a&&(f=Kr(e,u,l+.5*e,n,r),f&&f.score>=vt&&(vt=f.score,t.beat=l+.5*e,t.duration=e,t.divisor=u,t.rhythm=f.rhythm));return t}function Jr(t,e,n){let r=-1;for(;t[++r]!==void 0&&t[r][0]<e;);if(!t[r])return;let o={};vt=Xr;let i=1/8;for(;(i*=2)&&i<=n;)Ya(o,i,t,r,e,Qa,e+n);return vt>Xr&&o}function Qr(t,e){return e<Ka(2,t)-1}function kn(t){return 2**Math.ceil(Math.log2(t))}function Zr(t){return 2**Math.floor(Math.log2(t))}function Tn(t){return t>0&&(t&t-1)===0}function Gn(t,e,n){if(K(0,n,t/2))return e;let r=e*2;for(;(r/=2)>t;)if(K(0,yt(r,n),t/2))return r;return r}function qt(t,e){let n=-1,r=0;for(;t[++n]!==void 0;);for(;arguments[++r]!==void 0;)t[n++]=arguments[r];return t}function St(t){let e=-1;for(;t[++e]!==void 0;);return e}function Pn(t){return t[St(t)-1]}function On(t,e){let n=[],r=-1;for(;e[++r]!==void 0;)n.push(t(e[r],r));return n}var J={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var Se=Object.assign,{abs:ch,ceil:_a,floor:ve,min:eo,max:no,pow:uh,sqrt:Yr,round:lh}=Math,I=1/16,Ht=1/24,tc=zr(ct("row"));function _r(t,e,n,r){return t+e/r.length}function ro(t,e){return no(t,F(e))}function ec(t,e){return S(t[2])<S(e[2])?1:-1}function oo(t,e,n,r){if(!r.length)return[];let o=[],i=-1,a;for(;a=r[++i];){let p=a.scribeEvents,c=a.scribeIndex,d=le(p,c,e),g=pe(d),h=t.getSpelling(g,a),m=t.getRow(n,h);o.push({type:"note",pitch:h,part:n,row:m,stave:t,event:a})}o.sort(tc),o[0].top=!0,o[o.length-1].bottom=!0;let l=o[0].row,s=o[o.length-1].row,u=n.stemup===void 0?io(t,n,l,s):n.stemup,f=0;for(i=-1;o[++i];)o[i].stemup=u,i>0&&o[i].row-o[i-1].row===1?o[i].clusterdown=++f:f=0;for(f=0,i=o.length-1;i--;)o[i+1].row-o[i].row===1?o[i].clusterup=++f:f=0;return o}function nc(t,e,n){let r=-1,o=0,i,a;for(;n[++r];)a=t.getRow(e,n[r]),a!==void 0&&a>o&&(o=a,i=n[r]);return{row:o,pitch:i}}function rc(t,e,n){let r=-1,o=128,i,a;for(;n[++r];)a=t.getRow(e,n[r]),a!==void 0&&a<o&&(o=a,i=n[r]);return{row:o,pitch:i}}function io(t,e,n,r){let o=e.centerRow||t.centerRow,i=n-o;return r-o+i>0}function so(t,e,n){let{row:r}=nc(t,e,n),{row:o}=rc(t,e,n);return io(t,e,r,o)}function oc(t,e,n){let r=[],o=-1,i;for(;i=n[++o];)i.type==="note"&&r.push(i.pitch);return so(t,e,r)}var to=0;function et(t,e,n,r){let o=-1;for(;r[++o]&&r[o].beat===r.beat;);if(!r[o])return t;let i=r[0].beat,l=Pn(r).beat-i,s=n.stemup===void 0?so(e,n,On(ct("pitch"),r)):n.stemup;if(n.beam){let E;for(o=-1;E=r[++o];)E.stemup=s,E.beam=r;return t.push(Se(r,{duration:l,stemup:s,range:0,id:++to})),t}let u=[],f;for(o=-1;f=r[++o];){let E=e.getRow(n,f.pitch);if(E===void 0)continue;let T;for(;r[++o]&&K(r[o].beat,f.beat,Ht);)T=e.getRow(n,r[o].pitch),T!==void 0&&(s?T<E&&(E=T):T>E&&(E=T));--o,u.push(E)}let p=u.length-1,c=u.slice(0,ve(.5*u.length)).reduce(_r,0),d=u.slice(_a(.5*u.length)).reduce(_r,0),g=Array.from(u,(E,T)=>(.2+.1*p)*T*(d-c)/p),h=g[g.length-1]-g[0],m=s?-50:50,x;for(o=u.length;o--;)x=g[o]-u[o],m=s?x>m?x:m:x<m?x:m;for(o=u.length;o--;)g[o]-=m+u[0];let y=-1;for(o=-1;f=r[++o];){for(++y,f.stemup=s,f.beam=r,f.stemHeight=s?1-.125*(g[o]-u[o]+u[0]):1+.125*(g[o]-u[o]+u[0]);r[++o]&&K(r[o].beat,f.beat,I);)r[o].stemup=s,r[o].beam=r,r[o].stemHeight=f.stemHeight;--o}return t.push(Se(r,{pitch:r[0].pitch,y:g[0],duration:l,stemup:s,range:h,id:++to})),t}function be(t,e){let n=2*kn(e);for(;(n/=2)>t/2;){if(1.75*n===e)return 1.75*n;if(1.5*n===e)return 1.5*n;if(n<=e)return n}return t}function ic(t,e,n){n=n||1/0;let r=4*kn(e);for(;(r/=2)>t/2;)if(r<=e*2&&r<=n)return r;return t}function ao(t,e,n,r,o,i){let l=Zr(e.divisor),s=ve(o/e.divisor)*e.divisor,u=Gn(.125,l,o-s);if(i<r){if(t.indexOf(i-o)!==-1)return i-o;let p=ve(i/e.divisor)*e.divisor;if(o===s){if(t.indexOf(p-o)!==-1)return p-o;let c=s+e.divisor<i&&s+e.divisor;return c?c-o:be(.125,i-o)}if(K(i,p,I)){let c=s+e.divisor<i&&s+e.divisor;return c&&t.indexOf(c-o)!==-1?c-o:u}}let f=ve(r/e.divisor)*e.divisor;if(o===s){if(t.indexOf(r-o)!==-1)return r-o;if(t.indexOf(f-o)!==-1)return f-o;let p=s+e.divisor<r&&s+e.divisor;return p?p-o:ic(.125,r-o,i-o)}else if(K(r,f,I)){if(t.indexOf(r-o)!==-1)return r-o;let p=s+e.divisor<r&&s+e.divisor;return p&&t.indexOf(p-o)!==-1?p-o:u}else{let p=4*u;return(o-s)%p/u===1?o+2*u===i?2*u:(o+3*u>=i&&console.log("Next event beat is inside quaduplet"),u<1?r>=o+u*3/2?3*u:r>=o+u?u:be(.125,r-o):r>=o+u*3?u*3:r>=o+u*2?u*2:r>o+u?u:be(.125,r-o)):r>o+u?u:be(.125,r-o)}}function sc(t,e,n,r,o,i){return{type:"rest",beat:i,duration:ao(t,e,i,o,i,o),stave:n,part:r}}function Mn(t,e,n,r,o,i,a){for(;bt(a,i,I);){let l=sc(e,n,r,o,a,i);t.push(l),i+=l.duration}return a}function ac(t,e,n,r,o,i){let{pitch:a,event:l,row:s}=r,u=Pt.test(a)?1:Gt.test(a)?-1:void 0,f=a[0]+a.slice(-1);if(u!==e[f])return e[f]=u,{type:"acci",beat:n,pitch:a,row:s,clump:o,cluster:i,part:t,event:l,value:u||0}}function cc(t,e,n){let r=-1,o,i=0,a;for(;o=t[++r];)o.type==="acci"&&o.beat===e&&o.row<n&&o.row>i&&(i=o.row,a=r);return t[a]}function co(t,e,n,r,o,i){let a=-1,l=0,s,u,f,p=!!i.find(c=>c.stemup?c.clusterup%2===1:c.clusterdown%2===1);for(;s=i[++a];)Ee(s.event[0],e.beat,I)||(f=cc(t,o,s.row),l=f&&f.row-s.row<6&&f.cluster===p?f.clump+1:0,u=ac(n,r,o,s,l,p),u&&t.push(u))}function uo(t,e,n,r,o){let i=o[0].row,a=o[0].pitch,l=i-(n.topRow||e.topRow)+1;l<0&&t.push({type:"ledge",beat:r,pitch:a,part:n,rows:l});let s=o[o.length-1].row,u=o[o.length-1].pitch;l=s-(n.bottomRow||e.bottomRow),l>0&&t.push({type:"ledge",beat:r,pitch:u,part:n,rows:l})}function uc(t,e,n){let{beat:r,duration:o,divisor:i}=n,a=e.stemup===void 0?oc(t,e,n):e.stemup,l=-1,s;for(;s=n[++l];)s.type==="note"&&!s.beam&&(s.stemup=a);let u=r+.5*o,f=S(t.topPitch)-12,p,c=St(n);for(;(s=n[--c])&&s.beat>u;);for(++c;(s=n[--c])&&s.beat+s.duration>u;){let y=S(s.pitch);(!p||y>p)&&(p=y)}let d=f;for(c=-1;(s=n[++c])&&s.beat<r+I;){let y=S(s.pitch);(!d||y>d)&&(d=y)}let g=f;for(c=St(n);(s=n[--c])&&s.beat>r+o-o/i-I;){let y=S(s.pitch);(!g||y>g)&&(g=y)}let h=Math.ceil((d+g)/2),m=Q(h);h>p&&(p=h),n.pitch=Q(p),n.stemup=a;let x=g-d;n.angle=x<0?4*Yr(-x):-4*Yr(x)}function lc(t,e,n,r,o,i,a,l,s,u,f,p,c,d,g){(l.swingAsStraight8ths&&u===1||l.swingAsStraight16ths&&u===.5)&&f===3&&(p===4||p===5)&&(f=2);let h=u/f,m=s+u,x={type:"tuplet",beat:s,duration:u,divisor:f,rhythm:p,part:i,stave:n},y;for(Tn(f)||t.push(x);Ee(s,m,Ht);){for(;(y=d[++g])&&lt(y[0]-e.beat,s+.5*h,Ht);)c.push(y);if(--g,!c.length){t.push({type:"rest",beat:s,duration:h,stave:n,part:i}),s+=h;continue}let E=oo(n,r,i,c);uo(t,n,i,s,E),co(t,e,i,o,s,E);let T=eo(c.reduce(ro,0)-e.beat,y?y[0]-e.beat:e.duration,x.beat+x.duration),A=no(h,ye(h,T-s)),B=-1;for(;E[++B];)t.push(Se(E[B],{beat:s,duration:A}));for(qt(x,...E),bt(A,.5,Ht)?a&&(et(t,n,i,a),a=void 0):a||(a={type:"beam",beat:s,part:i}),a&&qt(a,...E),B=c.length;B--;){let U=F(c[B])-e.beat;lt(U,s+A+.5*h,Ht)?c.splice(B,1):t.push({type:"tie",beat:s,pitch:E[B].pitch,duration:A,stemup:E[B].stemup,part:i,event:c[B]})}s+=A}return a&&et(t,n,i,a),uc(n,i,x),g}function Ln(t,e,n,r=0,o={},i,a,l=J){let s=[],{headDurations:u,restDurations:f}=l,p=0,c=-1,d,g,h;for(;(d=a[++c])&&lt(d[0]+d[4]-e.beat,p,I););for(--c;Ee(p,e.duration,I);){h&&e.divisions.find(U=>K(p,U,I))&&(et(t,n,i,h),h=void 0);let m=Jr(a,e.beat+p,e.duration-p);if(m&&!Tn(m.divisor)){bt(m.beat-e.beat,p,I)&&Mn(t,l.restDurations,e,n,i,p,m.beat-e.beat),h&&Qr(m.divisor,m.rhythm)&&(et(t,n,i,h),h=void 0),c=lc(t,e,n,r,o,i,h,l,m.beat-e.beat,m.duration,m.divisor,m.rhythm,s,a,c),p=m.beat-e.beat+m.duration;continue}for(;(d=a[++c])&&lt(d[0]-e.beat,p,I);)s.push(d);if(--c,n.pitched&&s.sort(ec),!s.length){if(!d){h&&(et(t,n,i,h),h=void 0),Mn(t,l.restDurations,e,n,i,p,e.duration);break}let U=ye(.125,d[0]-e.beat);if(U<=p){console.log(`Problem at bar ${e.count}, moving to next bar ${p} ${U}`),e.error="Stop beat has ended up less than beat";break}h&&(lo(e.divisions,p,U)||U-p>=.5)&&(et(t,n,i,h),h=void 0),Mn(t,f,e,n,i,p,U),p=U;continue}let x=oo(n,r,i,s);uo(t,n,i,p,x),co(t,e,i,o,p,x);let y=s[0][0]-e.beat,E=eo(e.duration,s.reduce(ro,0)-e.beat),T=d&&ye(.125,d[0])-e.beat,A=ao(u,e,y,E,p,T),B=-1;for(;x[++B];)t.push(Se(x[B],{beat:p,duration:A}));for(A>=1?h&&(et(t,n,i,h),h=void 0):h||(h={type:"beam",beat:p,part:i}),h&&qt(h,...x),B=s.length;B--;){let U=F(s[B])-e.beat;lt(U,p+A,I)||U-(p+A)<.125+1/16*(F(s[B])-s[B][0])?s.splice(B,1):t.push({type:"tie",beat:p,pitch:x[B].pitch,duration:A,stemup:x[B].stemup,part:i,event:s[B]})}p+=A}return h&&et(t,n,i,h),t}var pc={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function fc(t,e){return pc[t+","+e]||ie}function lo(t,e,n){let r=-1;for(;t[++r]&&t[r]<=e;);return n>t[r]?t[r]:void 0}var hc=[];function po(t,e){return Et(e).reduce((r,o,i)=>{let a=o-q[i];if(a!==0){let l=H(q[i]),s=10;for(;s--;)r[l+s]=a}return r},t),t}function dc(t,e,n,r,o,i,a){let l=-1,s;for(;s=i[++l];)switch(s[1]){case"key":{let u=C(s[2]);po(o,u),e.key=u;break}case"meter":{t.push({type:"timesig",beat:0,numerator:s[3]===1.5?s[2]/.5:s[2]/s[3],denominator:s[3]===1.5?8:4/s[3],stave:n,event:s});break}case"symbol":{t.push({type:"symbol"+s[2],stave:n});break}case"chord":{let u=s[0]-e.beat,f=le(i,l,r),p=pe(f),c=n.getSpelling(p,s);c==="Câ™­"&&a.spellChordRootCFlatAsB&&(c="B"),c==="Eâ™¯"&&a.spellChordRootESharpAsF&&(c="F"),c==="Bâ™¯"&&a.spellChordRootBSharpAsC&&(c="C"),c==="Fâ™­"&&a.spellChordRootFFlatAsE&&(c="E"),t.push({type:"chord",beat:u,duration:s[0]+s[4]>e.beat+e.duration?e.duration-u:s[4],root:c,extension:s[3],event:s,stave:n});break}case"text":{let u=s[0]-e.beat;t.push({type:"text",beat:u,duration:s[0]+s[3]>e.beat+e.duration?e.duration-u:s[3],value:s[2],event:s,stave:n});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(hc.includes(s[1]))return;console.log('Scribe: ignoring event type "'+s[1]+'"')}}return t}function Ut(t,e,n,r,o,i,a,l,s,u=J){let f=[];if(s){let m=F(s);m>e&&m<=e+n&&a.push(s)}let p=po({},i),c={type:"bar",beat:e,duration:n,key:i,divisor:r||4,divisions:fc(n,r),stave:o,count:t,symbols:f};dc(f,c,o,i,p,a,J);let d=o.parts.reduce((m,x)=>x.centerRow?m.add(x.centerRow):m,new Set);d.size||d.add(o.centerRow);let g;for(g of o.parts){let m=l[g.name];!m||!m.length||(d.delete(g.centerRow||o.centerRow),Ln(f,c,o,i,p,g,m,u))}let h;for(h of d)Ln(f,c,o,i,p,{centerRow:h},[],u);return c}function mc(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function gc(t){let e=t.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(e,mc)}function pt(t,e){t.symbols=t.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function De(t,e,n){let r=gc(n);switch(e.length){case 1:break;case 2:break;case 3:{r==="[]"&&e[0]==="[]"?e.length=0:r===e[0]&&r===e[1]&&r===e[2]&&n.symbols.filter(o=>o.type!=="clef"&&o.type!=="timesig").find(o=>o.type!=="rest")?(pt(t[t.length-2],1),pt(t[t.length-1],1),pt(n,1)):(r!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{r===e[0]&&r===e[1]&&r===e[2]&&r===e[3]?(pt(n,1),e.length=3):(r!==e[1]||e[0]!==e[2]||r!==e[3])&&(e.length=2);break}case 5:{r===e[1]&&r===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,pt(t[t.length-1],2),pt(n,2)):e.length=4;break}case 6:break;case 7:{r===e[1]&&r===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,pt(n,2),e.length=5):e.length=1;break}}for(e.unshift(r);e.length>8;)e.pop()}function $n(t,e,n){let r=n.target?t.parts[n.target]:t.getPart(n[2]),o=e[r.name]||(e[r.name]=[]);e[r.name].push(n)}function qn(t,e,n,r=J){let o=[],i=[],a=[],l=[],s=0,u=[],f={},p=0,c=0,d,g,h,m;for(h of t)if(h.scribeIndex=o.length,h.scribeEvents=o,o.push(h),!e.includes(h[1])){for(;h[0]>=s+d;){let y=Ut(i.length+1,s,d,g,n,p,u,f,m,r);De(i,l,y),i.push(y),p=y.key,s=s+d,u=[],f={};let E=-1;for(;a[++E];)$n(n,f,a[E]),F(a[E])<s+d&&a.splice(E--,1)}switch(h[1]){case"note":{$n(n,f,h),F(h)>s+d&&a.push(h),c<F(h)&&(c=F(h));break}case"sequence":{h.events===t.events&&(m=h),c<F(h)&&(c=F(h));break}case"meter":d=h[2],g=h[3],h[0]!==s&&console.log("TODO");default:u.push(h)}}for(;a.length;){let y=Ut(i.length+1,s,d,g,n,p,u,f,m,r);De(i,l,y),i.push(y),s=s+d,u=[],f={};let E=-1;for(;h=a[++E];)$n(n,f,h),F(h)<s+d&&a.splice(E--,1)}for(;s<c-d;){let y=Ut(i.length+1,s,d,g,n,p,u,f,m,r);De(i,l,y),i.push(y),s=s+d,u=[],f={}}d||(d=o.length?F(o[o.length-1]):1);let x=Ut(i.length+1,s,d,g,n,p,u,f,m,r);return De(i,l,x),i.push(x),i}var Hn=Symbol("scribe-id"),wc={},Un=0;function tt(t){for(;t.event;)t=t.event;return t[Hn]?t[Hn]:(t[Hn]=++Un,wc[Un]=t,Un)}var Y=1.1;function xc(t){return parseFloat(t.dataset.beat)}function yc(t){return parseFloat(t.dataset.duration)}function Ec(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function fo(t,e,n,r,o){let i=n[0],a=n.length===1?r%(o*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],l=n.length===1?r%(o*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[n[n.length-1]];return`M${a}, ${-t*a-.5*Y}
        L${l},${-t*l-.5*Y}
        L${l},${-t*l+.5*Y}
        L${a}, ${-t*a+.5*Y}
        Z`}function In(t,e,n,r,o,i,a){if(a<.0833)return;let l=o-1,s;for(;n[++l];)n[l]<=a?s?s.push(l):s=[l]:s&&(t.appendChild(b("path",{class:`beam-path-${4/a} beam-path`,d:fo(i,r,s,e[l-1],a)})),In(t,e,n,r,s[0],i,a/2),s=void 0);s&&(t.appendChild(b("path",{class:`beam-path-${4/a} beam-path`,d:fo(i,r,s,e[l-1],a)})),In(t,e,n,r,s[0],i,a/2),s=void 0)}function ho(t){let e=t.dataset.beam,n=t.parentElement,r=Array.from(n.querySelectorAll('.top-note[data-beam="'+e+'"]')),o=r.map(xc),i=r.map(yc),a=t.viewBox.baseVal,l=a.y<-.5?a.y+.5:a.height-1,s=r.map(rt),u=s[0].x,f=s[s.length-1].x,p=s.map(c=>(c.x-u)/(f-u));Ec(t),In(t,o,i,p,0,-l,.25)}function N(t,e){return e.toFixed(t).replace(/\.?0+$/,"")}var Ce=Math.abs,Re={flat:`<span class="chord-flat">${ne}</span>`,sharp:`<span class="chord-sharp">${oe}</span>`},bc={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},vc={2:on,1:oe,0:re,"-1":ne,"-2":rn},Sc={treble:Bt,"treble-down":Ft,"treble-up":Nt,alto:kt,bass:Tt,drum:ee,percussion:ee},Dc={"1.33":mn,"0.67":dn,"0.33":hn,"0.17":fn,"0.08":pn},Cc=/^(âˆ†|-|Ã¸|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function Rc(t){let e=-1,n="";for(;t[++e];)n+=(n?" ":"")+tt(t[e].event);return n}var Wn=D(ct("type"),{barrepeat:t=>b("span",{class:"barrepeat",html:G["barRepeat"+t.count],data:{beat:0,duration:t.duration}}),clef:t=>b("span",{class:`${t.clef}-clef clef`,html:Sc[t.clef]}),chord:t=>{let e=Cc.exec(t.extension);return b("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(Pt,Re.sharp).replace(Gt,Re.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(Pt,Re.sharp).replace(Gt,Re.flat)+"</sup>":"")+"</span>"+(t.bass?wn+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:N(4,t.beat),duration:N(4,t.duration),event:tt(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?b("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,tt(t.event))):b("span",{class:"timesig",html:`<sup>${G["timeSig"+t.numerator]}</sup>
                <sub>${G["timeSig"+t.denominator]}</sub>`,data:{event:tt(t.event)}}),symbolcoda:t=>b("p",{html:gn,class:"coda"}),barcount:t=>b("span",{html:t.text,class:"barcount"}),text:t=>b("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:N(4,t.beat),duration:N(4,t.duration),event:tt(t.event)}}),acci:t=>b("span",{class:(bc[t.value]||"acci")+(t.clump?" acci-"+t.clump:"")+(t.cluster?" acci-cluster":""),html:vc[t.value]||re,data:{beat:t.beat&&N(4,t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&tt(t.event)}}),ledge:t=>b("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${Ce(t.rows)}`:`0 -0.5 5 ${Ce(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:N(4,t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>b("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${S(t.pitch)})`,data:{beat:N(4,t.beat),pitch:t.pitch,duration:N(4,t.duration),part:t.part.name,beam:t.beam&&t.beam.id,event:tt(t.event)}}),beam:(t,e)=>b("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${Ce(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${N(4,t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(Ce(t.range)+Y)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*Y} L1,${t.range-.5*Y} L1,${t.range+.5*Y} L0,${.5*Y} Z"></path>`,data:{beat:N(4,t.beat),pitch:t.pitch,part:t.part.name,beam:t.id,events:Rc(t)}}),tie:t=>b("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:N(4,t.beat),pitch:t.pitch,duration:N(4,t.duration),part:t.part.name,event:tt(t.event)}}),tuplet:t=>b("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:G["tuplet"+t.divisor],data:{beat:N(4,t.beat),pitch:t.pitch,duration:N(4,t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>b("span",{class:"rest",html:Dc[t.duration.toFixed(2)]||G["rest"+(t.duration+"").replace(".","")]||"",data:{beat:N(4,t.beat),pitch:t.pitch,duration:N(4,t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function Ac(t){return t[0]<=0&&t[1]==="meter"}function Bc(t){return t[0]<=0&&t[1]==="key"}function Fc(t,e){let n=Wn(e);return n&&t.push(n),t}function Nc(t,e){return t.push(b("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:H(e.key),stave:e.stave.type},children:e.symbols.reduce(Fc,[])})),t}function mo(t,e,n,r,o,i=1/0,a=0,l=0,s=J){let u=t.events;!u.find(Ac)&&o&&u.unshift([0,"meter",o[2],o[3]]),!u.find(Bc)&&r&&u.unshift([0,"key",r]);let c=me[n||"treble"],d=[];a&&d.push("transpose",a),l&&d.push("displace",l);let g=new $t(u,t.sequences,d),h=qn(g,e,c,s),m=h.reduce(Nc,[]),y=h[0].key,E=c.createSignatureSymbols(y),T=b("div",{class:`${c.type}-stave signature-stave stave`,children:E.map(Wn),data:{key:H(y)}}),A=b("div",{id:"side",class:"side",data:{key:H(y)}}),B=24;for(;B--;)A.appendChild(T.cloneNode(!0));return m.unshift(A),m}var Dt=[b("span",sn),b("span",an),b("span",cn)];function kc(t){t.remove()}function go(t){t.append.apply(t,Dt);let e=rt(Dt[0]).width,n=rt(Dt[1]).width,r=rt(Dt[2]).width,o=window.getComputedStyle(Dt[0]),i=$r(o.fontSize);Dt.forEach(kc);let l=t.querySelector(".side").dataset.key,u={"Gâ™­":6,"Câ™¯":5,"Dâ™­":5,"Gâ™¯":4,"Aâ™­":4,"Dâ™¯":3,"Eâ™­":3,"Bâ™­":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6}[l];return`--head-1-size: ${N(6,e/i)}; --head-2-size: ${N(6,n/i)}; --head-4-size: ${N(6,r/i)}; --signature-width: ${(2.25+u*.625+.625).toFixed(4)}em;`}function zn(t){t.querySelectorAll(".beam").forEach(ho)}var wo=Object.assign,Tc=Object.defineProperties,Gc=new URL("shadow.css",import.meta.url),Ae=v.of(),Pc=[],xo=new ResizeObserver(t=>{for(let e of t)zn(w(e.target).shadowRoot)}),Ld=Tc(Ue("scribe-music",{shadow:`
        <link rel="stylesheet" href="${Gc}" />
    `,construct:function(t,e){let n=t.querySelector("link");Pc.push(r=>n.href=r),Ae.value&&(n.href=Ae.value),e.data=v.of(),e.clef=v.of("treble"),e.key=v.of("C"),e.meter=v.of(),e.beat=v.of(0),e.duration=v.of(1/0),e.transpose=v.of(0),e.excludes=v.of([]),e.swingAsStraight8ths=v.of(!1),e.swingAsStraight16ths=v.of(!1),e.debug=v.of(!1),e.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(t,e){if(e.isSafari&&this.classList.add("safari"),xo.observe(this,{box:"content-box"}),!this.src){let n=this.textContent.trim();e.data.value=st(this.type,n)}return v.frame(()=>{if(!e.data.value)return;let n=e.data.value&&mo(e.data.value,e.excludes.value,e.clef.value,e.key.value,e.meter.value,e.duration.value,e.transpose.value,e.beat.value,wo({},J,{swingAsStraight8ths:e.swingAsStraight8ths.value,swingAsStraight16ths:e.swingAsStraight16ths.value}));if(t.querySelectorAll(".side, .bar, style").forEach(o=>o.remove()),t.append.apply(t,n),!n)return;let r=b("style",`:host { ${go(t)} }`);t.appendChild(r),zn(t)})},disconnect:function(){xo.unobserve(this)}},{clef:{attribute:function(t){this.clef=t},get:function(){return w(this).clef.value},set:function(t){if(!me[t]){console.warn('<scribe-music> Attempt to set invalid clef="'+t+'" ignored');return}w(this).clef.value=t}},key:{attribute:function(t){this.key=t===""?"C":t},get:function(){return w(this).key.value},set:function(t){let e=w(this);if(typeof t!="string"||!/^[A-G][#bâ™¯â™­]?$/.test(t)){console.warn('<scribe-music> Attempt to set invalid key="'+t+'" ignored');return}e.key.value=t.replace(/[#b]$/,n=>n==="#"?"â™¯":"â™­")}},meter:{attribute:function(t){this.meter=t===""?"4/4":t},get:function(){return br(w(this).meter.value)},set:function(t){w(this).meter.value=wo([0],Er(t))}},beat:{attribute:function(t){this.beat=t},get:function(){return w(this).beat.value},set:function(t){w(this).beat.value=typeof t=="number"?t:parseFloat(t)}},duration:{attribute:function(t){this.duration=t},get:function(){return w(this).duration.value},set:function(t){w(this).duration.value=typeof t=="number"?t:parseFloat(t)}},transpose:{attribute:function(t){this.transpose=t},get:function(){return w(this).transpose.value},set:function(t){w(this).transpose.value=typeof t=="number"?Math.round(t):parseInt(t,10)}},type:{attribute:function(t){this.type=t},writable:!0,value:"application/json"},src:{attribute:function(t){this.src=t},get:function(){return w(this).src},set:function(t){let e=w(this);e.src=t;let n=new URL(t,window.location);if(window.location.origin===n.origin&&window.location.pathname===n.pathname){let r=this.getRootNode().getElementById(n.hash.slice(1));if(!r)throw new Error('<scribe-music> src script "'+t+'" not found in document');this.data=JSON.parse(r.textContent)}else yr(this.type,n.href).then(r=>this.data=r)},default:null},data:{get:function(){return w(this).data.value},set:function(t){w(this).data.value=t},default:null},swing:{attribute:function(t){w(this).swingAsStraight8ths.value=t!==null}},shuffle:{attribute:function(t){w(this).swingAsStraight16ths.value=t!==null}},debug:{attribute:function(t){this.debug=t!==null},get:function(){return w(this).debug.value},set:function(t){w(this).debug.value=!!t}},excludes:{attribute:function(t){return w(this).excludes.value=t.split(/\s+/)}}},null,"github.com/stephband/scribe/"),{stylesheet:{set:t=>Ae.value=t,get:()=>Ae.value}});export{Ld as default};
//# sourceMappingURL=element.js.map
