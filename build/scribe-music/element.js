/* Scribe 
   0.4.36
   By stephband */

var Oi=Object.defineProperty;var Ui=(t,e)=>{for(var r in e)Oi(t,r,{get:e[r],enumerable:!0})};var q,ft;function Li(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function lr(t){let e=0;for(;t[--e];)t[e].stop&&t[e].stop(),t[e]=void 0}function Ut(t,e){let r=0;for(;e[--r]&&e[r]!==t;);for(e[r]=t,r=-1;t[++r]&&t[r]!==e;);t[r]=e}function Rt(t){let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.invalidate(t)}function hr(t,e){let r=0;for(;t[--r];)if(t[r]===e)return!0}var S=class t{static isSignal(e){return e instanceof t}static of(e){return new sr(e)}static from(e,r){if(e.then){let o=t.of();return e.then(n=>o.value=n),o}return e.pipe?e.pipe(new ar):new ce(e,r)}static compute(e,r){return new ce(e,r)}static fromProperty(e,r){return new cr(e,r)}static frame(e){return new le(e)}static tick(e){return new pe(e)}static temporal(e,r){return new ur(e,r)}static evaluate(e,r,o=e){let n=q;q=e,n||(ft=!1);let i=r.apply(o);return q=n,i}static get hasInvalidDependency(){return ft}static get evaluating(){return q}constructor(e){e&&(this.name=e)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},sr=class extends S{#t;constructor(e){super(),this.#t=e}get value(){return q&&Ut(this,q),this.#t}set value(e){this.#t!==e&&(this.#t=e,Rt(this))}},ar=class extends S{#t;constructor(e){super(),this.#t=e}get value(){return q&&Ut(this,q),this.#t}push(e){this.#t!==e&&(this.#t=e,Rt(this))}},cr=class extends S{#t;#e;constructor(e,r){super(e),this.object=r}evaluate(){return this.object[this.name]}get value(){return q&&Ut(this,q),this.#t?this.#e:(this.#e=S.evaluate(this,this.evaluate,this),ft||(this.#t=!0),this.#e)}set value(e){if(this.#e===e)return;let{object:r,name:o}=this;r[o]=e,e=r[o],this.#e!==e&&(this.#e=e,Rt(this))}invalidate(e){this.#t&&(e&&!hr(this,e)||(this.#t=!1,lr(this),Rt(this)))}},ce=class extends S{#t;#e;#r;#o;constructor(e,r){super(),this.#t=e,this.#e=r}get value(){return q&&Ut(this,q),this.#r?this.#o:(this.#o=S.evaluate(this,this.#t,this.#e),ft||(this.#r=!0),this.#o)}invalidate(e){this.#r&&(e&&!hr(this,e)||(this.#r=!1,lr(this),Rt(this)))}},ur=class extends S{#t=0;constructor(e,r){super(e),this.object=r}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return S.evaluating&&(Ut(this,q),this.getTime()<this.#t&&(ft=!0)),this.evaluate()}set value(e){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==e&&(this.object[this.name]=e,invalidateUntil(this.getTime()))}invalidateUntil(e){let o=this.getTime()>=this.#t;this.#t=e,o&&Rt(this)}},ue=class extends S{constructor(e){if(super(),q){let r=0;for(;q[--r]&&q[r]!==this;);q[r]=this}e&&(this.evaluate=e,(S.evaluate(this,this.evaluate)||ft)&&this.cue())}invalidate(e){this.constructor.observers.indexOf(this)===-1&&(e&&!hr(this,e)||(lr(this),this.cue()))}stop(){let e=0,r;for(;r=this[--e];){let i=-1;this[e]=void 0,r.stop?r.stop():Li(r,this)}let o=this.constructor.observers,n=o.indexOf(this);if(n!==-1){if(o===pr)throw new Error("Attempt to remove observer while observers is rendering");o.splice(n,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},pr;function ko(t){let e=-1,r;for(pr=t;r=t[++e];)!S.evaluate(r,r.evaluate)&&!ft&&t.splice(e--,1);return pr=void 0,t}var $o=Promise.resolve();function Mo(){ko(pe.observers).length&&$o.then(Mo)}var pe=class extends ue{static observers=[];cue(){let e=this.constructor.observers;e.length||$o.then(Mo),e.push(this)}};function Go(){ko(le.observers).length&&requestAnimationFrame(Go)}var le=class extends ue{static observers=[];cue(){let e=this.constructor.observers;e.length||window.requestAnimationFrame(Go),e.push(this)}};function qi(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function mt(t){return t===window?qi():t.getClientRects()[0]||t.getBoundingClientRect()}function G(t){return t}function A(t,e){return function(){let o=t.apply(this,arguments),n=e[o]||e.default;if(!n)throw new Error('overload() no function defined for key "'+o+'"');return n.apply(this,arguments)}}var Oo=globalThis||window,Uo;function St(t){var e=new Map;return function(o){if(Oo.DEBUG&&!Uo&&o===void 0&&(Uo=!0,console.warn("cache() called with undefined. Not illegal, but potentially bad.")),Oo.DEBUG&&arguments.length>1&&console.warn("cache() called with "+arguments.length+" arguments. Accepts exactly 1."),e.has(o))return e.get(o);var n=t(o);return e.set(o,n),n}}var Lo=globalThis||window,Pi=Array.prototype;function Hi(t,e){return typeof t=="function"?t.apply(null,e):t}function he(t,e,r){r=r||t.length;var o=r===1?e?t:St(t):St(function(n){return he(function(){var i=[n];return i.push.apply(i,arguments),t.apply(null,i)},e,r-1)});return function n(i){return arguments.length===0?n:arguments.length===1?o(i):arguments.length>=r?t.apply(null,arguments):Hi(o(i),Pi.slice.call(arguments,1))}}if(typeof Lo<"u"&&Lo.DEBUG){let t=he,e=function(){var o=function(){};try{Object.defineProperty(o,"length",{value:2})}catch{return!1}return o.length===2}(),r=function(n,i,s,u){return u.toString=function(){return/function\s*[\w\d]*\s*\([,\w\d\s]*\)/.exec(s.toString())+" { ["+n+"] }"},e&&Object.defineProperty(u,"length",{value:i}),u};he=function(n,i,s){return s=s||n.length,r("curried",s,n,t(n,i,s))}}var Z=he;function L(){}var Ii=A(G,{is:L,tag:L,data:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},dataset:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},html:function(t,e,r){e.innerHTML=r},text:function(t,e,r){e.textContent=r},style:A((t,e,r)=>typeof r,{string:(t,e,r)=>e.style=r,object:(t,e,r)=>Object.assign(e.style,r)}),children:function(t,e,r){e.innerHTML="",e.append.apply(e,r)},href:function(t,e,r){e instanceof SVGElement?e.setAttribute("href",r):e.href=r},points:_,cx:_,cy:_,r:_,x:_,y:_,dx:_,dy:_,transform:_,preserveAspectRatio:_,viewBox:_,default:function(t,e,r){t in e?e[t]=r:e.setAttribute(t,r)}});function _(t,e,r){e.setAttribute(t,r)}function zi(t,e){for(var r=Object.keys(e),o=r.length;o--;)e[r[o]]!==void 0&&Ii(r[o],t,e[r[o]]);return t}var fe=Z(zi,!0);var fr="http://www.w3.org/2000/svg",qo=document.createElement("template"),mr=(t,e)=>e&&typeof e;function Po(t,e=""){let r=document.createRange();return r.selectNode(t),r.createContextualFragment(e)}var z=A(mr,{string:function(t,e){let r=document.createElementNS(fr,t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElementNS(fr,t);return typeof e.length=="number"?r.append.apply(r,e):fe(r,e),r},default:t=>document.createElementNS(fr,t)}),Wi=A(mr,{string:function(t,e){let r=document.createElement(t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElement(t);return typeof e.length=="number"?r.append.apply(r,e):fe(r,e),r},default:t=>document.createElement(t)}),ji=A(G,{comment:function(t,e){return document.createComment(e||"")},fragment:A(mr,{string:function(t,e,r){return r?Po(r,e):(qo.innerHTML=e,qo.content.cloneNode(!0))},object:function(t,e,r){let o=r?Po(r):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):fe(o,e),o},default:()=>document.createDocumentFragment()}),circle:z,ellipse:z,g:z,glyph:z,image:z,line:z,rect:z,use:z,path:z,pattern:z,polygon:z,polyline:z,svg:z,tspan:z,text:z,default:Wi}),v=ji;function dr(t,e,r){let o;typeof r!="string"&&r.input!==void 0&&r.index!==void 0&&(o=r,r=o.input.slice(r.index+r[0].length+(r.consumed||0)));let n=t.exec(r);if(!n)return;let i=e(n);return o&&(o.consumed=(o.consumed||0)+n.index+n[0].length+(n.consumed||0)),i}var jp=Z(dr,!0);function Vi(t,e,r){throw r.input!==void 0&&r.index!==void 0&&(r=r.input),new Error('Cannot parse string "'+(r.length>128?r.length.slice(0,128)+"‚Ä¶":r)+'"')}function Xi(t,e,r){let o=-1;for(;++o<r.length;)e=r[o]!==void 0&&t[o]?t[o](e,r):e;return t.done?t.done(e,r):t.close?t.close(e,r):e}function Ki(t,e,r,o){let n=dr(t,i=>Xi(e,r,i),o);return n===void 0?e.catch?e.catch(r,o):Vi(t,e,o):n}var Ho=Z(Ki,!0);var Io=Symbol("internals");function gr(t,e,r){return e[Io]=e.attachInternals&&!e.getAttribute("is")?e.attachInternals():{shadowRoot:r}}function y(t){return t[Io]}var zo=Object.defineProperties;var wr={},Yi={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return y(this).form}},labels:{get:function(){return y(this).labels}},validity:{get:function(){return y(this).validity}},validationMessage:{get:function(){return y(this).validationMessage}},willValidate:{get:function(){return y(this).willValidate}},checkValidity:{value:function(){return y(this).checkValidity()}},reportValidity:{value:function(){return y(this).reportValidity()}}},xr=!1,Zi=Ho(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() ‚Äì name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null),Wo={once:!0};function Ji(t){return t.sheet?Promise.resolve({target:t}):new Promise((e,r)=>{t.addEventListener("load",e,Wo),t.addEventListener("error",r,Wo)})}function Qi(t){t.stop()}function _i(t){if(wr[t])return wr[t];let e=document.createElement(t).constructor;if(e===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+t+"> is HTMLUnknownElement");return wr[t]=e}function ts(t,e){if(t.hasOwnProperty(e)){let r=t[e];delete t[e],t[e]=r}return t}function jo(t,e){let r=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(e.stylesheet){let o=v("link",{rel:"stylesheet",href:e.stylesheet});r.append(o)}return r}function es(t,e){return typeof e=="string"?e[0]==="#"?t.appendChild(document.getElementById(e.slice(1)).content.clone(!0)):t.innerHTML=e:t.appendChild(e.content.clone(!0)),t}function rs(t){let e=t.isUpgraded;return t.isUpgraded=!0,!e}function Vo(t,e){return Array.from(t.querySelectorAll('[is="'+e+'"]')).filter(rs)}var os=A((t,e)=>typeof e,{object:(t,e)=>e,function:(t,e)=>({value:e}),default:(t,e)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof e)}});function yr(t,e={},r={},o=""){let{name:n,tag:i}=Zi(t),s=typeof i=="string"?_i(i):HTMLElement,u=[],a={},c,l;for(c in r)l=os(c,r[c]),l.attribute&&u.push(c),(l.set||l.get||"value"in l)&&(a[c]=l),r[c]=l;function h(){let p=Reflect.construct(s,arguments,h),m=e.mode||typeof e.shadow=="string"?jo(p,e):void 0;e.shadow&&es(m,e.shadow);let d=gr(h,p,m);return i&&(xr=!0),e.construct&&e.construct.call(p,m,d),Object.keys(a).reduce(ts,p),p}if(h.prototype=Object.create(s.prototype,a),r.value&&(h.formAssociated=!0,zo(h.prototype,Yi),(e.enable||e.disable)&&(h.prototype.formDisabledCallback=function(p){let m=y(this);return p?e.disable&&e.disable.call(this,m.shadowRoot,m):e.enable&&e.enable.call(this,m.shadowRoot,m)}),e.reset&&(h.prototype.formResetCallback=function(){let p=y(this);return e.reset.call(this,p.shadowRoot,p)}),e.restore&&(h.prototype.formStateRestoreCallback=function(){let p=y(this);return e.restore.call(this,p.shadowRoot,p)})),u.length&&(h.observedAttributes=u,h.prototype.attributeChangedCallback=function(p,m,d){return r[p].attribute.call(this,d)}),e.connect&&(h.prototype.connectedCallback=function(){let p=y(this),m=p.shadowRoot;if(p.stopable=e.connect.call(this,m,p),!m)return;let d=m.querySelectorAll('link[rel="stylesheet"]');if(d.length){let f=v("style","*:not(slot), slot:not([name]) { display: none !important; }");m.prepend(f);let g;p.loadPromise?g=p.loadPromise.then(()=>new Promise(requestAnimationFrame)):g=p.loadPromise=Promise.all(Array.from(d,Ji)),g.finally(()=>{f.remove(),e.load&&e.load.call(this,m,p)})}else e.load&&e.load.call(this,m,p)}),h.prototype.disconnectedCallback=function(){let p=y(this);p.stopable&&(p.stopable.stop?p.stopable.stop():p.stopable.forEach(Qi)),e.disconnect&&e.disconnect.call(this,p.shadowRoot,p)},window.console&&window.console.log("%c<"+(i?i+" is="+n:n)+">%c "+o,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(n,h,i&&{extends:i}),i&&!xr){let p=document.createElement("div");if(p.style.position="fixed",p.style.left="-1000px",p.style.top="-1000px",p.innerHTML="<"+i+' is="'+n+'"></'+i+">",document.body.append(p),p.remove(),xr)h.polyfillByRoot=L;else{let m=function(f){let g={};Object.keys(a).forEach(C=>{f[C]!==void 0&&(g[C]=f[C])}),zo(f,a);let x=e.mode||e.shadow?jo(f,e):void 0,E=gr(h,f,x);e.construct&&e.construct.call(f,x,E),Object.assign(f,g);let b=-1,U;for(;U=u[++b];){let C=f.attributes[U];C&&r[U].attribute.call(f,C.value)}e.connect&&e.connect.call(f,x,E)},d=function(f){Vo(f,n).forEach(m),new MutationObserver(()=>Vo(f,n).forEach(m)).observe(f,{childList:!0,subtree:!0})};h.polyfillByRoot=d,d(document)}}else h.polyfillByRoot=L;return h}var At=t=>typeof t;var ns=Object.defineProperties,Xo=A(At,{function:t=>t(),object:t=>t.stop()}),dt=class extends G{#t;stop(){if(this.status==="done")return this;this.status="done";let e=this.#t;return this.#t=void 0,e&&e.forEach(Xo),this}done(e){return this.status==="done"?(Xo(listener),this):((this.#t||(this.#t=[])).push(e),this)}};ns(dt.prototype,{status:{writable:!0}});function is(t){throw new TypeError("Stream cannot be created .from() "+typeof t)}function W(t,e){if(e===void 0)return;let r=-1;for(;t[++r];)t[r].push(e);return t}function ss(t){dt.prototype.stop.apply(t);let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.stop&&(Nr(r,t),r[-1]||r.stop());return t}function Nr(t,e){let r=0;for(;t[--r]&&t[r]!==e;);for(;t[r--];)t[r+1]=t[r]}function Ko(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function as(t,e){Nr(e,t),Ko(t,e)}var Lt=class extends dt{stop(){if(this.status==="done")return this;let e;for(;e=this[-1];){let r=-1;for(;this[r--];)this[r+1]=this[r];Ko(e,this),e.stop&&!e[0]&&e.stop(e)}return super.stop()}},me=class extends Lt{constructor(e){super(),this.push=e}},de=class extends Lt{constructor(e,r){super(),this.fn=e,this.value=r,this.i=0}push(e){let r=this.fn;this.value=r(this.value,e,this.i++,this)}},I=class extends Lt{start(){if(this.status)return this;let e=0,r;t:for(;r=this[--e];){let o=-1;for(;r[++o];)if(r[o]===this)continue t;r[o]=this,o===0&&r.start&&r.start()}return this}stop(){if(this.status==="done")return this;super.stop();let e=-1,r;for(;r=this[++e];)this[e]=void 0,r.stop&&(Nr(r,this),r[-1]||r.stop());return this}pipe(e){if(e.stop){let o=0;for(;e[--o]&&e[o]!==this;);e[o]=this}if(e.start&&!(e[0]||e.status==="running"))return e;let r=-1;for(;this[++r]&&this[r]!==e;);return this[r]=e,r||this.start(),e}each(e){return this.pipe(new me(e))}buffer(...e){return this.pipe(new Dt(e))}filter(e){return this.pipe(new br(e))}flatMap(e){return this.pipe(new vr(e))}map(e){return this.pipe(new we(e))}reduce(e,r){return this.pipe(new de(e,r)).value}scan(e,r){return this.pipe(new Sr(e,r))}slice(e,r){return this.pipe(new Ar(e,r))}split(e){return this.pipe(new Dr(e))}[Symbol.asyncIterator]=async function*(){let e=[],r=n=>e.push(n);function o(n,i){r=n}for(this.each(n=>r(n)).done(()=>r=L);r!==L;)yield e.length?e.shift():await new Promise(o)};static from=A(At,{function:e=>new we(e),object:e=>typeof e.pipe=="function"?e:typeof e.then=="function"?new Er(e):typeof e.length=="number"?new Dt(Array.from(e)):is(e)});static of(...e){return e.length<2?new ge(e[0]):new Dt(e)}static buffer(e){return new Dt(e)}static value(e){return new ge(e)}static merge(...e){return new Rr(e)}static push=W;static stop=ss;static unpipe=as;static each(e){return new me(e)}static reduce(e,r){return new de(e,r)}},Er=class extends I{constructor(e){super(),this.promise=e}start(){return this.promise.then(e=>W(this,e)).finally(()=>this.stop()),this}},ge=class extends I{constructor(e){super(),this.value=e}start(){return this.value!==void 0&&(W(this,this.value),this.status==="done")?this:super.start()}push(e){return this.value=e,W(this,e)}},Dt=class extends I{constructor(e){super(),this.values=e||[]}start(){let e=this.values;if(!e)return super.start();let r=-1;for(;r++<e.length;)if(W(this,e[r]),this.status==="done")return this;return this.values=void 0,super.start()}push(e){return this.value=e,this.values?this.values.push(this.value):W(this,this.value)}},br=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn;return r(e)&&W(this,e)}},vr=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);if(o!==void 0)if(isIterable(o))for(let n of o)W(this,n);else o.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(o.each(n=>W(this,n)))):o.then&&o.then(n=>W(this,n))}},we=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);return o!==void 0&&W(this,o)}},Rr=class extends I{constructor(e){super(),this.inputs=e}push(e){return W(this,e)}pipe(e){let r=-1,o;for(;o=this.inputs[++r];)I.from(o).pipe(this);return I.prototype.pipe.call(this,e)}},Sr=class extends I{constructor(e,r){super(),this.fn=e,this.value=r}push(e){let r=this.fn;this.value=r(this.value,e),W(this,this.value)}},Ar=class extends I{constructor(e,r=1/0){super(),this.index=-e,this.indexEnd=r-e}push(e){++this.index>0&&W(this,e),this.index===this.indexEnd&&this.stop()}},Dr=class extends I{constructor(e){super(),this.chunk=[],typeof e=="number"?this.n=e:this.fn=e}fn(){return this.chunk.length===this.n}push(e){let r=this.chunk;this.fn(e)?(W(this,r),this.chunk=[]):r.push(e)}};var yl={fullscreenchange:St(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},cs=0;window.addEventListener("click",t=>cs=t.timeStamp);function Fr(t){return function(){return arguments[t]}}function Cr(t){return t}function gt(){}function tt(){return this}var Yo=Object.create,us=Object.freeze,Zo=us(Yo(Yo(Object.prototype,{at:{value:gt},shift:{value:gt},push:{value:gt},forEach:{value:gt},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:tt},find:{value:gt},findIndex:{value:function(){return-1}},flat:{value:tt},flatMap:{value:tt},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:tt},reduce:{value:Fr(1)},sort:{value:tt},each:{value:tt},pipe:{value:Cr},start:{value:tt},stop:{value:tt},done:{value:tt},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Br(t,e){return(e%t+t)%t}var Jo=t=>Br(12,t);var ps=/^([A-G][‚ô≠‚ôØ#b]?)(-?\d)$/,ls=/^[A-G][‚ô≠‚ôØ#b]?/,hs=/-?\d$/,fs=/[Hh]z$/,qt={C:0,"C‚ôØ":1,"C#":1,"D‚ô≠":1,Db:1,D:2,"D‚ôØ":3,"D#":3,"E‚ô≠":3,Eb:3,E:4,F:5,"F‚ôØ":6,"F#":6,"G‚ô≠":6,Gb:6,G:7,"G‚ôØ":8,"G#":8,"A‚ô≠":8,Ab:8,A:9,"A‚ôØ":10,"A#":10,"B‚ô≠":10,Bb:10,B:11},Tr={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Low Bass Drum",36:"High Bass Drum",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Floor Tom",42:"Closed Hi-hat",43:"High Floor Tom",44:"Pedal Hi-hat",45:"Low Tom",46:"Open Hi-hat",47:"Low Mid Tom",48:"High Mid Tom",49:"Crash Cymbal 1",50:"High Tom",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Qo(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in Tr)qt[Qo(Tr[t])]=parseInt(t,10);var ms=69;function ds(t,e=440){var r=ms+12*Math.log(t/e)/Math.log(2);return Math.fround(r)}function R(t){if(typeof t=="number")return t;if(fs.test(t))return ds(parseFloat(t));let e=ps.exec(t);return e?(parseInt(e[2],10)+1)*12+qt[e[1]]:qt[Qo(t)]}function T(t){return typeof t=="number"?Jo(t):qt[ls.exec(t)[0]]}var xe=["C","C‚ôØ","D","E‚ô≠","E","F","F‚ôØ","G","G‚ôØ","A","B‚ô≠","B"];function nt(t){return j(t)+ye(t)}function j(t){return xe[Jo(t)]}function ye(t){return typeof t=="number"?Math.floor(t/12)-1:Number(qt[(hs.exec(name)||Zo)[0]])}function _o(t){let e=R(t);return Tr[e]||""}function J(t){return Math.pow(10,t/20)}var gs=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function wt(t){return function(r){if(typeof r=="number")return r;var o=gs.exec(r);if(!o){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(r)}if(!t[o[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(parseFloat(o[1]),o[2])}return t[o[2]||""](parseFloat(o[1]))}}var tn={fff:J(-4.5),ff:J(-9),f:J(-13.5),mf:J(-18),mp:J(-22.5),p:J(-27),pp:J(-31.5),ppp:J(-36)},ct=wt({"":parseFloat,db:J,dB:J,catch:t=>{if(!tn[t])throw new Error('Sequence: dynamic "'+t+'" not recognised');return tn[t]}});function lt(t,e){return(e%t+t)%t}function kr(t){return lt(12,t)}var Ee=/b{1,2}|#{1,2}/g,ws={b:"‚ô≠","#":"‚ôØ",bb:"ùÑ´","##":"ùÑ™"};function be(t){return ws[t]}function xs(t,[e,r]){return t[r]=e,t}function et(t){return Object.entries(t).reduce(xs,{})}var V={sequence:1,note:2,param:3,rate:4,key:5,meter:6,chord:7,text:8,start:9,stop:10,clef:11},en=et(V),$r={2:16,5:1,6:4,7:18,9:8,10:8,11:1};function rn(t){if(typeof t=="string")return t;if(t in en)return en[t];throw new Error(`Type ${t} not recognised`)}var k={step:0,linear:1,exponential:2,target:3,curve:4,hold:5,cancel:6},on=et(k),nn={0:4,1:4,2:4,3:12,5:0,6:0};function Mr(t){return typeof t=="number"?on[t]||"step":t}var{floor:cn,log:sn}=Math,Nt=36,an=Nt-1,ys=cn(sn(Number.MAX_SAFE_INTEGER)/sn(Nt))+1;function Gr(t){if(t.length<2)return t.length?0:-1;if(t.length>ys)throw new Error("Cannot generate harmonic id, more than 11 notes "+t);let e=0,r=0,o=1;for(;++r<t.length;){let n=t[r]-t[r-1];if(n<1||n>an)throw new Error(`Cannot generate harmonic id, interval out of range 1-${an} `+t);e+=n*o,o*=Nt}return e}function w(){return Gr(arguments)}function ve(t){if(t===-1)return Uint8Array.of();if(t===0)return Uint8Array.of(0);let e=2;for(;t>=Nt**(e-1);)++e;let r=new Uint8Array(e);r[0]=0;let o=1;for(;t>0;){let n=t%Nt;r[o]=r[o-1]+n,t=cn(t/Nt),++o}return r}var Re={aug:w(0,4,8),sus:w(0,5,7),maj:w(0,4,7),min:w(0,3,7),dim:w(0,3,6),"‚àÜ‚ôØ11":w(0,4,6,7,11),"‚àÜ":w(0,4,7,11),7:w(0,4,7,10),9:w(0,2,4,7,10),13:w(0,4,7,9,10),"7sus":w(0,5,7,10),"7sus4":w(0,5,7,10),"-7":w(0,3,7,10),"-9":w(0,2,3,7,10),"-11":w(0,3,5,7,10),"-‚ô≠6":w(0,3,7,8,10),"sus‚ô≠9":w(0,1,5,7,10),"7sus‚ô≠9":w(0,1,5,7,10),√∏:w(0,3,6,10),"7‚ôØ11":w(0,2,4,6,7,9,10),"-‚àÜ":w(0,2,3,5,7,9,11),"7‚ô≠13":w(0,2,4,5,7,8,10),"13sus‚ô≠9":w(0,1,3,5,7,9,10),√∏9:w(0,2,3,5,6,8,10),"‚àÜ+":w(0,2,4,6,8,9,11),"‚àÜ‚ôØ4‚ôØ5":w(0,2,4,6,8,9,11),"7alt":w(0,1,3,4,6,8,10),"-‚àÜ‚ô≠6":w(0,2,3,5,7,8,11),"7‚ô≠9‚ô≠13":w(0,1,4,5,7,8,10),"‚àÜ‚ôØ5":w(0,2,4,5,8,9,11),"‚àÜ‚ô≠6":w(0,2,4,5,7,8,11),"7‚ôØ9":w(0,3,4,7,10),"7‚ô≠9":w(0,1,3,4,6,7,9,10),"¬∞":w(0,2,3,5,6,8,9,11),"+":w(0,2,4,6,8,10),"+7":w(0,2,4,6,8,10)},Es=et(Re);function Or(t){return typeof t=="string"?Re[t.replaceAll(/\(\)/g,"").replaceAll(Ee,be)]:typeof t=="object"?Gr(t):t}function Se(t){let e=Or(t);return Es[e]||ve(e)}var Ur={0:"bank",1:"modulation",2:"breath",4:"foot",5:"portamento",7:"volume",8:"balance",10:"pan",11:"expression",64:"sustain",65:"portamento",66:"sostenuto",67:"soft",68:"legato",69:"hold",71:"harmonics",72:"release",73:"attack",74:"brightness",91:"reverb",92:"tremolo",93:"chorus",94:"detune",95:"phaser",120:"sound-off",121:"reset",122:"local",123:"notes-off",124:"omni-off",125:"omni-on",126:"monophonic",127:"polyphonic"},eh=Object.entries(Ur).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});var bs=Object.assign,Lr=bs({},Ur,{3:"mute",6:"gain",9:"angle",12:"distance",13:"azimuth",14:"mix",15:"phase",16:"frequency",17:"Q",18:"depth",19:"cutoff",20:"type",21:"delay",22:"feedback",128:"stop",129:"start",130:"record",131:"pitch",132:"rate",133:"meter",134:"key",135:"touch"}),un=Object.entries(Lr).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});function pn(t){return typeof t=="number"&&Lr[t]||t}var P={displace:1,rate:2,gain:3,quantize:4,transpose:5},vs=et(P),ln={1:9,2:5,3:5,4:5,5:2},Pt={1:1,2:1,3:1,4:1,5:1};function hn(t){return typeof t=="number"&&vs[t]||t}var Ae=Object.defineProperty,De={writable:!0};function Rs(t){let e=[],r=-1;for(;t[++r]!==void 0;)e.push(t[r]);return e}function Ft(t){return t.toFixed(4).replace(/\.?0+$/,"")}function fn(t){let e;for(;e=t.event;)t=e;return t}var N=class t{constructor(e,r){switch(this[0]=e,this[1]=rn(r),this[1]){case"chord":this[2]=T(arguments[2]),this[3]=Or(arguments[3]),this[4]=arguments[4]||0,arguments[5]&&(this[5]=arguments[5]||0);break;case"text":this[2]=arguments[2],this[3]=arguments[3];break;case"key":this[2]=T(arguments[2]);break;case"note":this[2]=R(arguments[2]),this[3]=ct(arguments[3]),this[4]=arguments[4]||0;break;case"rate":this[2]=arguments[2],this[3]=Mr(arguments[3]),(this[3]==="target"||this[3]==="curve")&&(this[4]=arguments[4]||0);break;case"param":this[2]=pn(arguments[2]),this[3]=arguments[3],this[4]=Mr(arguments[4]),(this[4]==="target"||this[4]==="curve")&&(this[5]=arguments[5]||0);break;case"sequence":this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4]||0;let o=5;for(;arguments[o]!==void 0;){let n=arguments[o];this[o]=hn(n);let i=P[this[o]],s=o+(Pt[i]||0);for(;o++<s;)this[o]=arguments[o]||0}break;case"start":case"stop":this[2]=R(arguments[2]),this[3]=ct(arguments[3]);break;default:this[2]=arguments[2],this[3]=arguments[3]}Ae(this,"event",De),Ae(this,"events",De),Ae(this,"index",De),Ae(this,"target",De)}move(e){let r=fn(this);return r[0]=this[0]=this[0]+e,this}transpose(e){let r=fn(this);switch(this[1]){case"chord":case"key":r[2]=this[2]=kr(this[2]+e);break;case"note":case"start":case"stop":r[2]=this[2]=this[2]+e;break;case"sequence":console.log("TODO: transpose sequence");break}return this}*[Symbol.iterator](){let e=-1;for(;this[++e]!==void 0;)yield this[e]}toJSON(){return Rs(this)}toString(){let e=Ft(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+j(this[2])+" "+Se(this[3])+" "+Ft(this[4]);break;case"key":e+=" "+j(this[2]);break;case"note":e+=" "+nt(this[2])+" "+this[3]+" "+Ft(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+Ft(this[4])+" "+this[5];break;case"rate":e+=" "+Ft(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+Ft(this[4]);break;case"start":case"stop":e+=" "+nt(this[2])+" "+this[3];break;default:let r=1;for(;this[++r]!==void 0;)e+=this[r]}return e}static of(...e){return new t(...e)}static from(e,r,o){let n=new t(...e);return n.event=e,n.events=r,n.index=o,n}static isChord=qr;static isNote=Ne;static isSequence=Pr};function qr(t){return t[1]==="chord"}function Ne(t){return t[1]==="note"}function Pr(t){return t[1]==="sequence"}function Ss(t,e){let r;for(r in t)if(t[r]!==e[r])return!1;return!0}var Ht=Z(Ss,!0);var mn=A((t,e)=>e[1],{note:(t,e)=>(e[2]=R(e[2])+t,e),chord:(t,e)=>(e[2]=T(T(e[2])+t),e[5]!==void 0&&(e[5]=T(T(e[2])+t)),e),key:(t,e)=>(e[2]=T(T(e[2])+t),e),default:G});var As={displace:(t,e,r)=>(r[0]-=t[++e],e),rate:(t,e,r)=>{switch(r[0]/=t[++e],r[1]){case"chord":case"note":case"sequence":r[4]/=t[e];break;case"text":r[3]/=t[e];break}return e},gain:(t,e,r)=>{switch(++e,r[1]){case"note":r[3]*=ct(t[e]);break}return e},quantize:(t,e,r)=>{},transpose:(t,e,r)=>(mn(t[e+1],r),e+1)};function It(t,e){let r=-1,o;for(;o=t[++r];)r=As[o](t,r,e);return e}var dn=Object.assign,gn=[],Ds={done:!0,value:void 0},wn={key:2,meter:1,default:0},Ns={};function xn(t){return wn[t[1]]||wn.default}function yn(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:xn(e)-xn(t)}function En(t,e){let r=-1;for(;t[++r]&&yn(t[r],e)<1;);return t.splice(r,0,e),r}function Fs(t,e){let r=[],o=t-1;for(;this[++t]!==void 0;)r.push(this[t]);return r}function Cs(t,e){return t.find(r=>r.id===e)}var xt=class t{constructor(e,r=gn,o=gn){e.sort(yn),this.events=e,this.sequences=r,this.transforms=o;let n=-1,i;for(;(i=e[++n])&&It(o,dn(Ns,i))[0]<0;);this.n=n-1}next(){let{events:e,sequences:r,transforms:o,n}=this,i=e[n+1],s=i&&It(o,N.from(i,e,n+1)),u,a=-1,c=0,l=s?s[0]:1/0,h;for(;u=this[++a];){let p=u.value;p||((p=u.next().value)&&(It(this.transforms,p),p[0]+=u.startBeat,p.target=(p.target||0)+u.target),(u.done||p[0]>=u.stopBeat)&&++c),p&&p[0]<u.stopBeat&&p[0]<l&&(h=u,l=p[0]),c&&(this[a]=this[a+c])}if(h)return this.value=h.value,h.value=void 0,this;if(!s)return dn(this,Ds);if(this.n+=1,this.value=s,Pr(i)){let p=this.sequences,m=Cs(p,i[2]);if(!m)throw new Error('Sequence id "'+i[2]+'" not found');let d=new t(m.events,m.sequences?m.sequences.concat(p):p,Fs(5,i));d.startBeat=s[0],d.stopBeat=s[0]+s[4],d.target=s[3];let f=-1;for(;this[++f];);this[f]=d}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};var Bs=Object.assign;var Q=class t{constructor(e,r){this.events=e,r&&(this.sequences=r.map(t.from))}create(){let e=new N(...arguments);return En(this.events,e),e}delete(e,r){r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2]));let o=this.events.findIndex(Ht(arguments));return o>-1&&this.events.splice(o,1),this}find(e,r){return r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2])),this.events.find(Ht(arguments))}get(e){return this.sequences&&this.sequences.find(Ht({id:e}))}select(e,r){return this.events.filter(Ht({0:e,1:r}))}static of(...e){return new t(e)}static from(e){let{events:r,sequences:o,...n}=e;return e.length?new t(e):Bs(new t(r,o),n)}[Symbol.iterator](){return new xt(this.events,this.sequences)}};function Ts(t,e){return e[t]}var ut=Z(Ts,!0);var ks=2,$s=10,bn=4,Zh=(1<<ks)-1,Ms=(1<<$s)-1,Gs=(1<<bn)-1;function Fe(t,e,r){return t<<14|e<<4|r}function vn(t){return t>>14}function Rn(t){return t>>bn&Ms}function Ce(t){return t&Gs}function Hr(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[],o=0;for(;o<t.length;){let n=e.getFloat64(o,!0);o+=8;let i=e.getUint16(o,!0);o+=2;let s=vn(i),u=Rn(i);switch(s){case 0:switch(u){case V.note:r.push(N.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0),e.getFloat64(o+8,!0))),o+=16;break;case V.meter:r.push(N.of(n,u,e.getFloat16(o,!0),e.getFloat16(o+2,!0))),o+=4;break;case V.chord:r.push(N.of(n,u,t[o],e.getFloat64(o+1,!0),e.getFloat64(o+9,!0),t[o+17])),o+=18;break;case V.key:r.push(N.of(n,u,e.getInt8(o))),o+=1;break;case V.clef:r.push(N.of(n,u,t[o])),o+=1;break;case V.sequence:{let a=e.getUint16(o,!0),c=e.getUint16(o+2,!0),l=e.getFloat64(o+4,!0),h=t[o+12],p=[n,u,a,c,l];o+=13;let m=0;for(;m<h;){let d=t[o+m];switch(m+=1,p.push(d),d){case P.displace:p.push(e.getFloat64(o+m,!0)),m+=8;break;case P.rate:case P.gain:case P.quantize:p.push(e.getFloat32(o+m,!0)),m+=4;break;case P.transpose:p.push(e.getInt8(o+m)),m+=1;break;default:throw new Error(`Unknown transform number: ${d}`)}}r.push(N.from(p)),o+=h;break}case V.text:{let a=e.getFloat64(o,!0),c=t[o+8];o+=9;let l=t.subarray(o,o+c);r.push(N.of(n,u,new TextDecoder().decode(l),a)),o+=c;break}case V.start:case V.stop:r.push(N.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0))),o+=8;break;default:{let a=Ce(i);switch(a){case k.step:case k.linear:case k.exponential:r.push(N.of(n,u,e.getFloat32(o,!0),a)),o+=4;break;case k.target:r.push(N.of(n,u,e.getFloat32(o,!0),a,e.getFloat64(o+4,!0))),o+=12;break;case k.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(N.of(n,u,p,a,c));break;default:r.push(N.of(n,u,void 0,a));break}break}}break;case 1:{let a=Ce(i);switch(a){case k.step:case k.linear:case k.exponential:r.push(N.of(n,"param",u,e.getFloat32(o,!0),a)),o+=4;break;case k.target:r.push(N.of(n,"param",u,e.getFloat32(o,!0),a,e.getFloat64(o+4,!0))),o+=12;break;case k.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(N.of(n,"param",u,p,a,c));break;default:r.push(N.of(n,"param",u,void 0,a));break}break}default:throw new Error(`Cannot deserialise unknown address ${s}.${u}.${Ce(i)}`)}}return r}var Ir={"FùÑ´":-15,"CùÑ´":-14,"GùÑ´":-13,"DùÑ´":-12,"AùÑ´":-11,"EùÑ´":-10,"BùÑ´":-9,"F‚ô≠":-8,"C‚ô≠":-7,"G‚ô≠":-6,"D‚ô≠":-5,"A‚ô≠":-4,"E‚ô≠":-3,"B‚ô≠":-2,F:-1,C:0,G:1,D:2,A:3,E:4,B:5,"F‚ôØ":6,"C‚ôØ":7,"G‚ôØ":8,"D‚ôØ":9,"A‚ôØ":10,"E‚ôØ":11,"B‚ôØ":12,"FùÑ™":13,"CùÑ™":14,"GùÑ™":15,"DùÑ™":16,"AùÑ™":17,"EùÑ™":18,"BùÑ™":19},hf=et(Ir);function Sn(t){if(typeof t=="number")return t;let e=t.replaceAll(Ee,be);if(e in Ir)return Ir[e];throw new Error(`Key "${t}" not recognised`)}var An=255;function Dn(t,e){if(t.length<=e)return t;let r=e;for(;r>0&&(t[r]&192)===128;)r--;return t.slice(0,r)}function Os(t){let e=t[1],r=V[e],o=10;if(r in $r)return o+$r[r];let n;switch(e){case"text":{let i=new TextEncoder().encode(t[2]),s=Dn(i,An);return o+8+1+s.length}case"sequence":{for(o+=13,n=4;++n<t.length;){let i=P[t[n]];o+=ln[i],n+=Pt[i]}return o}case"param":n=4;case"rate":n===void 0&&(n=3);default:{let i=typeof t[n]=="string"?k[t[n]]||0:t[n]||0;return i===k.curve?o+8+2+t[n-1].length*4:o+nn[i]}}}function Us(t){let e=t[1];switch(e){case"param":{let r=typeof t[2]=="string"?un[t[2]]||0:t[2],o=typeof t[4]=="string"?k[t[4]]||0:t[4];return Fe(1,r,o)}case"rate":{let r=V[e],o=typeof t[3]=="string"?k[t[3]]||0:t[3]||0;return Fe(0,r,o)}default:{let r=V[e];if(r===void 0)throw new Error(`Event type ${e} not recognised`);return Fe(0,r,0)}}}function zr(t){let e=0;for(let u of t)e+=Os(u);let r=new Uint8Array(e),o=new DataView(r.buffer),n=-1,i,s=0;for(;i=t[++n];){o.setFloat64(s,i[0],!0),s+=8;let u=Us(i);switch(o.setUint16(s,u,!0),s+=2,i[1]){case"note":o.setFloat32(s,i[2],!0),o.setFloat32(s+4,i[3],!0),o.setFloat64(s+8,i[4],!0),s+=16;break;case"param":case"rate":{let c=i[1]==="rate"?2:3;switch(typeof i[c+1]=="string"?k[i[c+1]]||0:i[c+1]||0){case k.step:case k.linear:case k.exponential:o.setFloat32(s,i[c],!0),s+=4;break;case k.target:o.setFloat32(s,i[c],!0),o.setFloat64(s+4,i[c+2]||0,!0),s+=12;break;case k.curve:o.setFloat64(s,i[c+2]||0,!0),s+=8;let h=i[c],p=h.length*4;o.setUint16(s,p,!0),s+=2;let m=-1;for(;h[++m]!==void 0;)o.setFloat32(s+m*4,h[m],!0);s+=p;break}break}case"meter":o.setFloat16(s,i[2],!0),o.setFloat16(s+2,i[3],!0),s+=4;break;case"chord":{let c=typeof i[2]=="number"?i[2]:0;r[s]=c;let l=typeof i[3]=="string"?Re[i[3]]||0:i[3];o.setFloat64(s+1,l,!0),o.setFloat64(s+9,i[4],!0);let h=typeof i[5]=="number"?i[5]:0;r[s+17]=h,s+=18;break}case"key":{o.setInt8(s,Sn(i[2])),s+=1;break}case"sequence":{o.setUint16(s,i[2],!0),o.setUint16(s+2,i[3],!0),o.setFloat64(s+4,i[4],!0),s+=12;let c=s;s+=1;let l=4;for(;++l<i.length;){let h=i[l],p=typeof h=="string"?P[h]:h;if(p===void 0)throw new Error(`Transform name "${h}" not recognised`);switch(r[s]=p,s+=1,p){case P.displace:o.setFloat64(s,i[l+1],!0),s+=8;break;case P.rate:case P.gain:case P.quantize:o.setFloat32(s,i[l+1],!0),s+=4;break;case P.transpose:o.setInt8(s,i[l+1]),s+=1;break;default:throw new Error(`Transform number ${p} not recognised`)}l+=Pt[p]}r[c]=s-c-1;break}case"text":{let c=new TextEncoder().encode(i[2]),l=Dn(c,An);o.setFloat64(s,i[3],!0),r[s+8]=l.length,r.set(l,s+9),s+=9+l.length;break}case"start":case"stop":o.setFloat32(s,i[2],!0),o.setFloat32(s+4,i[3],!0),s+=8;break;case"clef":let a=typeof i[2]=="number"?i[2]:0;r[s]=a,s+=1;break}}return r}var Nn={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.sequence",defs:{main:{type:"record",description:"A sequence of timed events. Full documentation at https://github.com/soundio/sequence/.",key:"any",record:{type:"object",required:["events"],properties:{id:{type:"integer",description:'Identifies this sequence for playback by a "sequence" event.',maximum:65535},url:{type:"string",format:"uri",description:"Canonical location of this sequence. May be an `at://` URI or an `https://` URL to a JSON endpoint."},name:{type:"string",description:"Name of the sequence",maxLength:1280,maxGraphemes:640},version:{type:"integer",description:"Version number for the byte array encoding of the events field."},events:{type:"bytes",description:"Serialised and binary encoded array of events of the form `[beat, type, data...]`, where `data` parameters depend on `type` and the byte layout of the serialised data conforms to the Sequence spec at https://github.com/soundio/sequence.",maxLength:524288},sequences:{type:"array",description:'A collection of sequences that may be played back by "sequence" events.',items:{type:"ref",ref:"io.sound.sequence"}},credits:{type:"array",description:"Attribution for composers, arrangers, etc",maxLength:60,items:{type:"ref",ref:"io.sound.credit"}},bskyPostRef:{type:"ref",ref:"com.atproto.repo.strongRef",description:"Strong reference to a Bluesky post. Useful to keep track of comments off-platform."},publishedAt:{type:"string",format:"datetime",description:"Timestamp of the time of publication."},updatedAt:{type:"string",format:"datetime",description:"Timestamp of the time of last edit."},tags:{type:"array",description:"Array of strings used to tag the sequence.",items:{type:"string",maxLength:1280,maxGraphemes:128}}}}}}};var Fn={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.credit",defs:{main:{type:"object",description:"Attribution for a creative work",required:["name","role"],properties:{name:{type:"string",description:"Name of the credited person",maxLength:640,maxGraphemes:320},role:{type:"string",description:"Role: composer, lyricist, arranger, etc",maxLength:64,maxGraphemes:32,knownValues:["composer","arranger","lyricist","transcriber","orchestrator","adapter","artist","producer"]},url:{type:"string",format:"uri",description:"URL to credited person's profile or website"}}}}};var Cn=Object.assign,Bn=Nn.defs.main.record,Ps=Fn.defs.main,Hs=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$/,Is=/^at:\/\/[^/\s]+(\/([\w.-]+)(\/[\w.-]+)?)?$/,zs=/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/,Ws=/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/,js=["alt","arpa","example","internal","invalid","local","localhost","onion"],Vs=new Intl.Segmenter(void 0,{granularity:"grapheme"});function Be(t){return[...Vs.segment(t)].length}var Xs=new TextEncoder;function Ct(t){return Xs.encode(t).byteLength}var Ks=A(G,{datetime:(t,e,r)=>{if(!Hs.test(r))throw new Error(`Record "${e}" invalid datetime format "${r}"`);if(r.includes("t")||r.endsWith("z")&&!r.endsWith("Z"))throw new Error(`Record "${e}" datetime must use uppercase T and Z`)},uri:(t,e,r)=>{if(Ct(r)>8192)throw new Error(`Record "${e}" URI exceeds 8KB maximum`);try{new URL(r)}catch(o){throw new Error(`Record "${e}" ${o.message}`)}},"at-uri":(t,e,r)=>{if(Ct(r)>8192)throw new Error(`Record "${e}" AT URI exceeds 8KB maximum`);if(!r.startsWith("at://"))throw new Error(`Record "${e}" AT URI must start with at://`);if(!Is.test(r))throw new Error(`Record "${e}" invalid AT URI format`)},handle:(t,e,r)=>{if(r.length>253)throw new Error(`Record "${e}" handle exceeds 253 characters`);if(!zs.test(r))throw new Error(`Record "${e}" invalid handle format`);let o=r.split(".").pop().toLowerCase();if(js.includes(o))throw new Error(`Record "${e}" handle has disallowed TLD "${o}"`)},nsid:(t,e,r)=>{if(r.length>317)throw new Error(`Record "${e}" NSID "${r}" exceeds 317 characters`);if(!Ws.test(r))throw new Error(`Record "${e}" Invalid NSID format "${r}"`)}}),Tn=A(ut("type"),{boolean:(t,e,r)=>{if(typeof r!="boolean")throw new Error(`Record "${e}" not of type "boolean"`);if(t.const!==void 0&&r!==t.const)throw new Error(`Record "${e}" must be ${t.const}`)},integer:(t,e,r)=>{if(!Number.isInteger(r))throw new Error(`Record "${e}" not of type "integer"`);if(t.minimum!==void 0&&r<t.minimum)throw new Error(`Record "${e}" is ${r}, minimum ${t.minimum}`);if(t.maximum!==void 0&&r>t.maximum)throw new Error(`Record "${e}" is ${r}, maximum ${t.maximum}`);if(t.enum&&!t.enum.includes(r))throw new Error(`Record "${e}" must be one of [${t.enum.join(", ")}]`)},string:(t,e,r)=>{if(typeof r!="string")throw new Error(`Record "${e}" not of type "string"`);if(t.minLength&&Ct(r)<t.minLength)throw new Error(`Record "${e}" has ${Ct(r)} bytes, minimum ${t.minLength}`);if(t.maxLength&&Ct(r)>t.maxLength)throw new Error(`Record "${e}" has ${Ct(r)} bytes, maximum ${t.maxLength}`);if(t.minGraphemes&&Be(r)<t.minGraphemes)throw new Error(`Record "${e}" has ${Be(r)} graphemes, minimum ${t.minGraphemes}`);if(t.maxGraphemes&&Be(r)>t.maxGraphemes)throw new Error(`Record "${e}" has ${Be(r)} graphemes, maximum ${t.maxGraphemes}`);t.format&&Ks(t.format,e,r)},bytes:(t,e,r)=>{if(!(r&&typeof r=="object"&&"$bytes"in r))throw new Error(`Record "${e}" not of type "bytes"`);if(typeof r.$bytes!="string")throw new Error(`Record "${e}".$bytes must be a string`);let o=r.$bytes.length*.75;if(t.minLength&&o<t.minLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, minimum ${t.minLength}`);if(t.maxLength&&o>t.maxLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, maximum ${t.maxLength}`)},array:(t,e,r)=>{if(!Array.isArray(r))throw new Error(`Record "${e}" not of type "array"`);if(t.minLength&&r.length<t.minLength)throw new Error(`Record "${e}" has ${r.length} items, minimum ${t.minLength}`);if(t.maxLength&&r.length>t.maxLength)throw new Error(`Record "${e}" has ${r.length} items, maximum ${t.maxLength}`);t.items&&r.forEach((o,n)=>{Tn(t.items,`${e}[${n}]`,o)})},object:(t,e,r)=>{if(typeof r!="object"||r===null||Array.isArray(r))throw new Error(`Record "${e}" not of type "object"`);Te(t,r)},ref:(t,e,r)=>{switch(t.ref){case"io.sound.sequence":Te(Bn,r);break;case"io.sound.credit":Te(Ps,r);break;default:console.log(`External schema ref ${t.ref} not validated`)}}});function Ys(t=[],e){let r;for(r of t)if(!(r in e))throw new Error(`Record missing required "${r}" property`)}function Te(t,e){let{type:r,required:o,properties:n}=t;if(r!=="object")throw new Error(`Attempting to validate object with schema of type "${r}"`);Ys(o,e);let i,s;for(i in e)i in n&&(s=n[i],Tn(s,i,e[i]))}var zt=0;function Wr(t){return Te(Bn,t)}function ke(t){let{events:e,sequences:r,...o}=t;return Cn(o,{version:zt,events:{$bytes:zr(e).toBase64()}}),Wr(o),r&&(o.sequences=r.map(ke)),o}function jr(t){let{version:e,events:r,sequences:o,...n}=t;if(e!==zt)throw new Error(`Cannot decode record version ${e} with decoder version ${zt}`);let i=Uint8Array.fromBase64(r.$bytes);return Cn(new Q(Hr(i),o),n)}var kn=Object.assign,Zs=Q.from;Q.from=function(e){return e.events&&e.events.$bytes?jr(e):Zs(e)};kn(Q,{version:zt,toRecord:ke,fromRecord:jr,validateRecord:Wr});kn(Q.prototype,{toRecord:function(){return ke(this)}});function Vr(t){var e={};return function(o){return o in e?e[o]:e[o]=t(o)}}function $e(t){return function(r,...o){var n=t[r]||t.default;return n&&n.apply(this,o)}}var Js={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function Xr(t,e){if(e){var r=Js[t.toLowerCase()]||t,o;try{o=new window.DOMParser().parseFromString(e,r)}catch{return}if(!o||o.getElementsByTagName("parsererror").length)throw new Error("Invalid "+t.toUpperCase()+": "+e);return o}}function $n(t){return Xr("html",t)}function Mn(t){return Xr("svg",t)}var pt=Object.assign,Bt={headers:function(t){return{}},body:G},Qs=$e({"application/x-www-form-urlencoded":function(t){return pt(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(t){return pt(t,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(t){return pt(t,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(t){return pt(t,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(t){return pt(t,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(t){return pt(t,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(t){return pt(t,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(t){return pt(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),_s=$e({"application/json":function(t){return t instanceof FormData?ta(t):JSON.stringify(t)},"application/x-www-form-urlencoded":function(t){return t instanceof FormData?On(t):Un(t)},"multipart/form-data":function(t){return t instanceof FormData?t:ea(t)},default:G});function ta(t){return JSON.stringify(Array.from(t.entries()).reduce(function(e,r){return e[r[0]]=r[1],e},{}))}function On(t){return new URLSearchParams(t).toString()}function Un(t){return Object.keys(t).reduce((e,r)=>(e.append(r,t[r]),e),new URLSearchParams)}function ea(t){throw new Error("TODO: dataToFormData(data)")}function ra(t,e){return e instanceof FormData?t+"?"+On(e):t+"?"+Un(e)}function oa(t,e,r,o){let n=typeof r=="string"?r:r&&r["Content-Type"]||"application/json",i=Qs(n,pt(Bt.headers&&e?Bt.headers(e):{},typeof r=="string"?{}:r)),s={method:t,mode:"cors",headers:i,credentials:"same-origin",signal:o&&o.signal};return t!=="GET"&&(s.body=_s(n,Bt.body?Bt.body(e):e)),s}function Me(t){return t.blob()}function na(t){return t.json().catch(e=>{throw new Error("Cannot parse JSON "+t.url+". "+e.message)})}function Gn(t){return t.formData()}function ia(t){return t.text()}function sa(t){return t.text().then(e=>/^\s*<!DOCTYPE html>/.test(e)?$n(e):v("fragment",e))}function aa(t){return t.text().then(e=>/^\s*<\?xml/.test(e)?Mn(e):(console.warn("Untested SVG fragment parsing in request.js!"),v("fragment",e)))}var ca={"text/plain":ia,"text/html":sa,"image/svg+xml":aa,"application/json":na,"multipart/form-data":Gn,"application/x-www-form-urlencoded":Gn,audio:Me,"audio/wav":Me,"audio/m4a":Me,"application/zip":Me};function ua(t){if(Bt.onresponse&&(t=Bt.onresponse(t)),!t.ok)throw new Error(t.statusText+"");let e=t.headers.get("Content-Type");if(!e)return;let r=e.replace(/\;.*$/,"");return ca[r](t)}function Ln(t="GET",e,r={},o="application/json"){t=t.toUpperCase(),t==="GET"&&r&&(e=ra(e,r));let n=oa(t,r,o,arguments[4]);return fetch(e,n).then(ua)}function qn(t){return Ln("GET",t)}var pa={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},la=/^[ABCDEFG][b‚ô≠#‚ôØ]{0,1}-?\d$/,Pn=/^[ABCDEFG][b‚ô≠#‚ôØ]{0,1}/;function Kr(t){let e=t.trim().split(/\s+/),r=[],o=-1;for(;e[++o]!==void 0;){let n=Number(e[o]),i=e[++o];la.test(i)?(i="note",--o):Pn.test(i)&&(i="chord",--o);let s=[n,i],u=pa[i];if(u===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let a=Pn.exec(e[++o])[0],c=e[o].slice(a.length)||e[++o],l=Number(e[++o]);s.push(a,c,l)}else for(;u--;){let a=Number(e[++o]);s.push(Number.isNaN(a)?e[o]:a)}r.push(s)}return r}function ha(t){let e=t.files[Object.keys(t.files)[0]];return yt(e.type,e.content)}function fa(t){let e=t.settings.find(matches({id:13324}))||t.settings[0];return yt("abc",e.abc)}function yt(t,e){if(typeof e=="object")return e.files?ha(e):e.settings?fa():Array.isArray(e)?{id:0,events:e}:e;if(t==="sequence"||t==="text/plain")return{events:Kr(e)};{let r=JSON.parse(e);return Array.isArray(r)?{id:0,events:r}:r}}var ma=Vr(qn);var Hn=A((t,e)=>typeof e,{string:function(t,e){return ma(e).then(r=>yt(t,r)).catch(r=>console.error(r))},default:function(t,e,r,o){e[t]=o}});var da=/^(\d+)\/(\d+)$/;function In(t){let e=da.exec(t),r=parseInt(e[1],10),o=4/parseInt(e[2],10);return{1:"meter",2:r*o,3:o}}function zn(t){let e=t[2],r=t[3],o=e/r,n=4/r;return o+"/"+n}var O={};Ui(O,{accentDown:()=>Ue,accentUp:()=>Oe,acciDoubleFlat:()=>Yt,acciDoubleSharp:()=>Qt,acciFlat:()=>Zt,acciNatural:()=>Tt,acciParensLeft:()=>Fa,acciParensRight:()=>Ca,acciSharp:()=>Jt,augmentationDot:()=>Za,barLine:()=>Rc,barRepeat1:()=>Sc,barRepeat2:()=>Ac,barRepeat4:()=>Dc,barRepeatBegin:()=>Bc,barRepeatDots:()=>$c,barRepeatEnd:()=>Tc,barRepeatEndBegin:()=>kc,barRepeatLowerDot:()=>Cc,barRepeatSlash:()=>Nc,barRepeatUpperDot:()=>Fc,chordAugmented:()=>Vc,chordBassSlash:()=>no,chordBracketLeft:()=>Jc,chordBracketRight:()=>Qc,chordDiminished:()=>Wc,chordGlyphs:()=>_c,chordHalfDiminished:()=>jc,chordMajorSeventh:()=>Xc,chordMinor:()=>Kc,chordParensLeftTall:()=>Yc,chordParensRightTall:()=>Zc,clefAlto:()=>Xt,clefBass:()=>Kt,clefDrum:()=>Ge,clefTreble:()=>Wt,clefTrebleDown:()=>jt,clefTrebleUp:()=>Vt,coda:()=>oo,graceNoteStemDown:()=>uc,graceNoteStemUp:()=>cc,head1:()=>Yr,head2:()=>Zr,head4:()=>Jr,headBracketLeft:()=>_t,headBracketRight:()=>te,headCircle:()=>Ga,headCircleX:()=>Oa,headDiamond:()=>Ta,headDiamondWide:()=>ka,headPlus:()=>Ma,headSlashHorizontalEnds:()=>qa,headSlashVerticalEnds:()=>La,headSlashed2:()=>Ba,headTriangleUp:()=>Ua,headX:()=>$a,marcatoDown:()=>qe,marcatoUp:()=>Le,metDot:()=>ac,metNote05Down:()=>sc,metNote05Up:()=>oc,metNote1Down:()=>ic,metNote1Up:()=>rc,metNote2Down:()=>nc,metNote2Up:()=>ec,note0125Down:()=>Ya,note0125Up:()=>Wa,note025Down:()=>Ka,note025Up:()=>za,note05Down:()=>Xa,note05Up:()=>Ia,note1Down:()=>Va,note1Up:()=>Ha,note2Down:()=>ja,note2Up:()=>Pa,rest0125:()=>Qr,rest01875:()=>gc,rest025:()=>_r,rest0375:()=>wc,rest05:()=>to,rest075:()=>xc,rest1:()=>eo,rest15:()=>yc,rest2:()=>ro,rest3:()=>Ec,rest4:()=>bc,rest6:()=>vc,staccatoDown:()=>Qa,staccatoUp:()=>Ja,tailDown0125:()=>dc,tailDown025:()=>fc,tailDown05:()=>lc,tailUp0125:()=>mc,tailUp025:()=>hc,tailUp05:()=>pc,tenutoDown:()=>tc,tenutoUp:()=>_a,textBeam16Long:()=>uu,textBeam16Short:()=>cu,textBeam8Long:()=>au,textBeam8Short:()=>su,textDot:()=>pu,textNote16Long:()=>iu,textNote16Short:()=>nu,textNote8Long:()=>ou,textNote8Short:()=>ru,textNoteLong:()=>eu,textNoteShort:()=>tu,textTie:()=>lu,textTuplet3Long:()=>gu,textTuplet3Short:()=>fu,textTupletBeginLong:()=>du,textTupletBeginShort:()=>hu,textTupletEndLong:()=>wu,textTupletEndShort:()=>mu,timeSig0:()=>ga,timeSig1:()=>wa,timeSig2:()=>xa,timeSig3:()=>ya,timeSig4:()=>Ea,timeSig5:()=>ba,timeSig6:()=>va,timeSig7:()=>Ra,timeSig8:()=>Sa,timeSig9:()=>Aa,timeSigCommon:()=>Da,timeSigCutCommon:()=>Na,tuplet0:()=>Mc,tuplet1:()=>Gc,tuplet2:()=>Oc,tuplet3:()=>Uc,tuplet4:()=>Lc,tuplet5:()=>qc,tuplet6:()=>Pc,tuplet7:()=>Hc,tuplet8:()=>Ic,tuplet9:()=>zc});var Wt="&#xE050;",jt="&#xE052;",Vt="&#xE053;",Xt="&#xE05C;",Kt="&#xE062;",Ge="&#xE069;",ga="&#xE080;",wa="&#xE081;",xa="&#xE082;",ya="&#xE083;",Ea="&#xE084;",ba="&#xE085;",va="&#xE086;",Ra="&#xE087;",Sa="&#xE088;",Aa="&#xE089;",Da="&#xE08A;",Na="&#xE08B;",Yt="&#xE264;",Zt="&#xE260;",Tt="&#xE261;",Jt="&#xE262;",Qt="&#xE263;",Fa="&#xE26A;",Ca="&#xE26B;",Yr="&#xE0A4;",Zr="&#xE0A3;",Jr="&#xE0A2;",_t="&#xE0F5;",te="&#xE0F6;",Ba="&#xE0D0;",Ta="&#xE0DB;",ka="&#xE0DC;",$a="&#xE0A9;",Ma="&#xE0AF;",Ga="&#xE0E8;",Oa="&#xE0B3;",Ua="&#xE0BE;",La="&#xE100;",qa="&#xE101;",Pa="&#xE1D3;",Ha="&#xE1D5;",Ia="&#xE1D7;",za="&#xE1D9;",Wa="&#xE1DB;",ja="&#xE1D4;",Va="&#xE1D6;",Xa="&#xE1D8;",Ka="&#xE1DA;",Ya="&#xE1DC;",Za="&#xE1E7;",Oe="&#xE4A0;",Ue="&#xE4A1;",Ja="&#xE4A2;",Qa="&#xE4A3;",_a="&#xE4A4;",tc="&#xE4A5;",Le="&#xE4AC;",qe="&#xE4AD;",ec="&#xECA3;",rc="&#xECA5;",oc="&#xECA7;",nc="&#xECA4;",ic="&#xECA6;",sc="&#xECA8;",ac="&#xECB7;",cc="&#xE560;",uc="&#xE561;",pc="&#xE240;",lc="&#xE241;",hc="&#xE242;",fc="&#xE243;",mc="&#xE244;",dc="&#xE245;",Qr="&#xE4E8;",gc="&#xE4E8;&#xE1E7;",_r="&#xE4E7;",wc="&#xE4E7;&#xE1E7;",to="&#xE4E6;",xc="&#xE4E6;&#xE1E7;",eo="&#xE4E5;",yc="&#xE4E5;&#x200A;&#xE1E7;",ro="&#xE4E4;",Ec="&#xE4E4;&#x200A;&#xE1E7;",bc="&#xE4E3;",vc="&#xE4E3;&#x200A;&#xE1E7;",Rc="&#xE030",Sc="&#xE500;",Ac="&#xE501;",Dc="&#xE502;",Nc="&#xE504;",Fc="&#xE503;",Cc="&#xE505;",Bc="&#xE040",Tc="&#xE041",kc="&#xE042",$c="&#xE043",oo="&#xE048",Mc="&#xE880;",Gc="&#xE881;",Oc="&#xE882;",Uc="&#xE883;",Lc="&#xE884;",qc="&#xE885;",Pc="&#xE886;",Hc="&#xE887;",Ic="&#xE888;",zc="&#xE889;",Wc="&#xE870;",jc="&#xE871;",Vc="&#xE872;",Xc="&#xE873;",Kc="&#xE874;",Yc="&#xE875;",Zc="&#xE876;",Jc="(",Qc=")",no="&#xE87B;",_c={"‚àÜ‚ôØ11":"Ó°≥Óµ¢11","‚àÜ":"Ó°≥",7:"7","-7":"Ó°¥7","-‚ô≠6":"Ó°¥Óµ†6","7sus‚ô≠9":"7susÓµ¢",√∏:"Ó°±","7‚ôØ11":"7Óµ¢11","-‚àÜ":"Ó°¥Ó°≥","‚àÜ‚ô≠6":"Ó°≥Óµ†6","-‚ô≠9":"Ó°¥Óµ†9",√∏7:"Ó°±7","‚àÜ‚ôØ5":"Ó°≥Óµ¢5","7alt":"7alt","¬∞":"Ó°∞",dim:"Ó°∞","7‚ô≠9":"7Óµ†","+7":"Ó°≤7"},tu="&#xE1F0;",eu="&#xE1F1;",ru="&#xE1F2;",ou="&#xE1F3;",nu="&#xE1F4;",iu="&#xE1F5;",su="&#xE1F7;",au="&#xE1F8;",cu="&#xE1F9;",uu="&#xE1FA;",pu="&#xE1FC;",lu="&#xE1FD;",hu="&#xE1FE",fu="&#xE1FF",mu="&#xE200",du="&#xE201",gu="&#xE202",wu="&#xE203";function io(t){return function(){return arguments[t]}}function rt(){return this}var Wn=Object.create,xu=Object.freeze,Pe=xu(Wn(Wn(Object.prototype,{at:{value:L},shift:{value:L},push:{value:L},forEach:{value:L},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:rt},find:{value:L},findIndex:{value:function(){return-1}},flat:{value:rt},flatMap:{value:rt},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:rt},reduce:{value:io(1)},sort:{value:rt},each:{value:rt},pipe:{value:G},start:{value:rt},stop:{value:rt},done:{value:rt},valueOf:{value:function(){return null}}}),{length:{value:0}}));var jn=A(ut(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function $(t){return t[0]+jn(t)}function it(t){return lt(12,t)}function Vn(t,e){return t>e?1:t<e?-1:0}var X=[0,2,4,5,7,9,11];function yu(t,e,r){return r.indexOf(t)===e}function Xn(t,e){return t.map(r=>it(r+e)).filter(yu).sort(Vn)}var uo=[{name:"C",symbol:"C‚àÜ",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D‚ô≠",symbol:"D‚ô≠‚àÜ",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D‚àÜ",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E‚ô≠",symbol:"E‚ô≠‚àÜ",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E‚àÜ",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F‚àÜ",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F‚ôØ",symbol:"F‚ôØ‚àÜ",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G‚àÜ",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A‚ô≠",symbol:"A‚ô≠‚àÜ",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A‚àÜ",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B‚ô≠",symbol:"B‚ô≠‚àÜ",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B‚àÜ",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function kt(t){return Xn(X,t)}var{abs:Bm}=Math,Eu=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),bu=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],Tm={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function ao(t){let e=new Float32Array(12),r=T(t+2),o=7;for(;o--;)r=T(r+5),e[r]=1;return e}function co(t,e,r){let o=t.length;for(;o--;)t[o]*=1-r+r*e[o];return t}var so={note:(t,e,r=1)=>{let o=R(e[2]),n=ao(o);return co(t,n,r*(1-o/192))},chord:(t,e,r=1)=>{let o=T(e[2]),n=ve(e[3]),i=n.length,s;for(;i--;)s=ao(o+n[i]),co(t,s,r/n.length*Eu[n[i]]);return t}};function Ie(t,e,r){let o=t[e],n=o[0],i=Ne(o)?ao(R(o[2])):qr(o)?so.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(r!==void 0){let u=Float32Array.from({length:12},(a,c)=>bu[(c+12-r)%12]);co(i,u,.3)}let s=e;for(;o=t[--s];){let u=so[o[1]];if(!u)continue;let a=$(o);if(a>n)u(i,o,.5);else if(o[1]==="note"&&n-a<3){if(1-(n-a)/3>1)throw new Error("Influence should never be > 1 "+n+" "+a);u(i,o,.25*(1-(n-o[0])/3))}}for(s=e;(o=t[++s])&&o[0]-n<2;){if(!Ne(o))continue;let u=so[o[1]];if(u){if(1-(o[0]-n)/2>1)throw new Error("Influence should never be > 1 "+n+" "+stopBeat);u(i,o,.3*(1-(o[0]-n)/2))}}return i}var He=[0,7,5,2,10,9,3,4,8,11,1,6];function ze(t){let e=He.length,r=0,o;for(;e--;)t[He[e]]>r&&(r=t[He[e]],o=He[e]);return o}var Yn=/^([A-G])([b#‚ô≠‚ôØùÑ´ùÑ™])?(-?\d)?$/,Zn=/b|‚ô≠/,Jn=/#|‚ôØ/;var We=/b|‚ô≠|#|‚ôØ/g;var je={"-2":"ùÑ´","-1":"‚ô≠",0:"",1:"‚ôØ",2:"ùÑ™"},Kn=["F‚ôØ","C‚ôØ","G‚ôØ","D‚ôØ","A‚ôØ","E‚ôØ","B‚ôØ","B‚ô≠","E‚ô≠","A‚ô≠","D‚ô≠","G‚ô≠","C‚ô≠","F‚ô≠"];function Ve(t,e){let r=Kn.indexOf(t.pitch),o=Kn.indexOf(e.pitch);return r>o?1:r<o?-1:0}var Qn={"-2":"ùÑ´","-1":"‚ô≠",0:"",1:"‚ôØ",2:"ùÑ™"};function _n(t,e){let r=uo[t],o=T(e),n=r.spellings[it(o)];return xe[it(o-n)]+Qn[n]}function ti(t,e){let r=uo[t],o,n,i;if(typeof e=="string"){let[a,c,l,h]=Yn.exec(e)||[e];h&&(o=R(e),n=r.spellings[it(o)],i=ye(o-n))}else o=e,n=r.spellings[it(o)],i=ye(o-n);let s=xe[it(o-n)],u=Qn[n];return s+u+i}var H={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,marcatoThreshold:ct("-6dB"),accentThreshold:ct("-12dB"),ghostThreshold:ct("-30dB"),headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var vu=globalThis||window;var{floor:ei,round:Zm}=Math,F=class{constructor(){}pitched=!0;rows=Pe;getHeadHTML(e,r,o){let n=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${n}">${O[n]}</span>`}getNoteHTML(e,r,o){return r<H.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${_t}</span>
            ${this.getHeadHTML(e,r,o)}
            <span class="post" data-glyph="headBracketRight">${te}</span>`:this.getHeadHTML(e,r,o)}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return ei(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,r){let o=R(this.minPitch),n=R(this.maxPitch),i=R(e)+r;return i>=o&&i<=n?i:void 0}parts=[{name:"main"}];getPart(e){return this.parts[0]}getRow(e,r){let n=(typeof r=="string"?r:nt(r)).replace(We,""),i=this.rows.indexOf(n);if(vu.DEBUG&&i===-1)throw new Error('Pitch "'+r+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getPitch(e){let r=this.rows[e];return r?r.split(/\s+/)[0]:void 0}getSpelling(e,r){return r[1]==="chord"?_n(e,r[2]):ti(e,r[2])}createKeySymbols(e){let r=[],o=T(e),n=kt(o);return r.push.apply(r,n.map((i,s)=>i-X[s]&&{type:"acci",pitch:j(X[s])+je[i-X[s]],value:i-X[s],part:this.parts[0]}).filter(i=>!!i).sort(Ve)),r}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let r=ei(e*this.pitches.length);return r<0?this.pitches[0]:r>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[r]}};function po(t){if(t=typeof t=="number"?t+"":t.trim(),typeof t=="string")return t.toLowerCase().replace(/^[\W_]+/,"").replace(/[\W_]+$/,"").replace(/[\W_]+/g,"-")}var Ru=globalThis||window;function D(t){return po(_o(t))}var Et=class extends F{type="drum";pitched=!1;rows=["","","",D(55)+" "+D(52),D(57),D(49),D(51)+" "+D(53)+" "+D(59),D(42)+" "+D(46),D(50)+" "+D(56),D(48)+" "+D(47),D(38)+" "+D(40),D(45)+" "+D(31)+" "+D(39)+" "+D(54),D(43),D(41),D(35)+" "+D(36),"",D(44),"","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#e={31:!0,35:!0,36:!0,37:!0,38:!0,40:!0,41:!0,42:!0,43:!0,45:!0,47:!0,48:!0,50:!0,56:!0};getNoteHTML(e,r,o){let n=R(e),i=this.#t[n],s=this.#e[n],u=i?`<span class="head" data-glyph="${i}">${O[i]}</span>`:this.getHeadHTML(e,r,o);return s&&r<H.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${_t}</span>
            ${u}
            <span class="post" data-glyph="headBracketRight">${te}</span>
            `:u}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(e){return[35,36,37,38,40,41,43,44,45,47,48,50].includes(R(e))?this.parts[0]:this.parts[1]}getRow(e,r){let o=typeof r=="string"?r:D(r);if(!o)throw new Error("Number not found for pitch "+r);let n=this.rows.findIndex(i=>i.includes(o));if(Ru.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),n>-1?n:void 0}getSpelling(e,r){return r[1]==="note"?D(r[2]):super.getSpelling(e,r[2])}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let r=floor(e*this.rows.length),o=r<4?4:r>17?17:r;return this.pitches[o]}};var ee=class extends Et{type="percussion";rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var Su=globalThis||window,ri=Object.assign,re=class extends F{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(e,r,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${O["timeSig"+e]}</sup>
            <sub>${O["timeSig"+r]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${O["timeSig"+e]}</sup>
            <sub>${O["timeSig"+r]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(e,r){r=typeof r=="string"?r:nt(r);let o=e.name+"-"+r.replace(We,""),n=this.rows.findIndex(i=>i.includes(o));if(Su.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by '+this.constructor.name),n>-1?n:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#‚ô≠‚ôØùÑ´ùÑ™]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let r=[],o=T(e),i=kt(o).map((s,u)=>s-X[u]&&{type:"acci",pitch:j(X[u])+je[s-X[u]],value:s-X[u]}).filter(s=>!!s).sort(Ve);return r.push.apply(r,i.map(s=>ri({part:this.parts[1]},s))),r.push.apply(r,i.map(s=>ri({part:this.parts[2]},s))),r}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var lo=class extends F{type="treble-up";clef=Vt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},ho=class extends F{type="treble";clef=Wt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},fo=class extends F{type="treble-down";clef=jt;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},mo=class extends F{type="alto";clef=Xt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},go=class extends F{type="bass";clef=Kt;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};F.treble=new ho;F["treble-up"]=new lo;F["treble-down"]=new fo;F.alto=new mo;F.bass=new go;F.piano=new re;F.drum=new Et;F.percussion=new ee;F.create=t=>(console.warn("Deprecated: Stave.create(type). Use Stave[type]."),F[t]);var Xe=F;var oi=t=>t*Math.PI/180;var ni=wt({deg:oi,rad:G,turn:t=>t*2*Math.PI,catch:function(t){throw new Error('Cannot parse value "'+t+'"')}});var Au=/px$/,Du=/deg$|turn$|rad$/;function Nu(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function Ke(t,e){var r=Nu(t,e);return typeof r=="string"?Au.test(r)?parseFloat(r):Du.test(r)?ni(r):r:r}var Ye,Ze;function Fu(){if(!Ye){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",Ye=Ke("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return Ye}function Cu(){return Ze||(Ze=Ke("font-size",document.documentElement)),Ze}window.addEventListener("resize",()=>{Ye=void 0,Ze=void 0});var Bu=A(At,{number:G,string:wt({px:G,em:t=>Fu()*t,rem:t=>Cu()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),ii=Bu;function Tu(t,e,r){let o=t(e),n=t(r);return n===o?0:o>n?1:-1}var si=Z(Tu,!0);var{abs:ku,EPSILON:$u}=Math;function Je(t,e){return Math.round(e/t)*t}function ot(t,e,r=$u){return e!==void 0&&(e===t||ku(t-e)<r)}function bt(t,e,r){return ot(t,e,r)||e<t}function Mu(t,e,r){return ot(t,e,r)||e>t}function $t(t,e,r){return e!==void 0&&t!==void 0&&!bt(t,e,r)}function Qe(t,e,r){return e!==void 0&&t!==void 0&&!Mu(t,e,r)}var{pow:Gu}=Math,Ou=1/24,Uu=[2,3,4,5,6,7,9],Lu=1/12,ai=.25,ci=.2,wo={},Mt=0;function ui(t,e){return Math.cos(2*Math.PI*e/t)}function pi(t,e,r,o,n){let i=t/e,s=0,u=0,a=0,c,l;for(o[n-1]&&$t(r+.5*i,$(o[n-1]),Ou)&&(a=1),--n;o[++n]!==void 0&&o[n][0]-r<i/4;)a=1;for(--n;o[++n]!==void 0&&o[n][0]-r<t-i/4;){if(c=Math.round((o[n][0]-r)/i),l=1<<c,c<e&&l>a){if(e>4&&l>a<<1)return;a+=l}s+=ui(i,o[n][0]-r),u+=1,!(o[n][0]+o[n][4]-r>t)&&(s+=ci*ui(i,o[n][0]+o[n][4]-r),u+=ci)}if(!(e>4&&c!==e-1)&&u)return wo.score=s/(u+1),wo.rhythm=a,wo}function qu(t,e,r,o,n,i,s){let u=r[o-1]&&$(r[o-1])>n+.125?n:e*Math.floor((r[o][0]-n)/e)+n,a=i.length;for(;e/i[--a]<Lu;);++a;let c,l;for(;c=i[--a];)l=pi(e,c,u,r,o),l&&l.score>=Mt&&l.score&&(Mt=l.score,t.beat=u,t.duration=e,t.divisor=c,t.rhythm=l.rhythm),r[o][0]>=u+.5*e&&u+1.5*e<s&&(l=pi(e,c,u+.5*e,r,o),l&&l.score>=Mt&&(Mt=l.score,t.beat=u+.5*e,t.duration=e,t.divisor=c,t.rhythm=l.rhythm));return t}function li(t,e,r){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let n={};Mt=ai;let i=1/8;for(;(i*=2)&&i<=r;)qu(n,i,t,o,e,Uu,e+r);return Mt>ai&&n}function hi(t,e){return e<Gu(2,t)-1}function xo(t){return 2**Math.ceil(Math.log2(t))}function fi(t){return 2**Math.floor(Math.log2(t))}function yo(t){return t>0&&(t&t-1)===0}function Eo(t,e,r){if(ot(0,r,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(ot(0,lt(o,r),t/2))return o;return o}function oe(t,e){let r=-1,o=0;for(;t[++r]!==void 0;);for(;arguments[++o]!==void 0;)t[r++]=arguments[o];return t}function Gt(t){let e=-1;for(;t[++e]!==void 0;);return e}function bo(t){return t[Gt(t)-1]}function vo(t,e){let r=[],o=-1;for(;e[++o]!==void 0;)r.push(t(e[o],o));return r}var er=Object.assign,{abs:Ag,ceil:Pu,floor:tr,min:wi,max:xi,pow:Dg,sqrt:mi,round:Ng}=Math,Y=1/16,ne=1/24,Hu=si(ut("row"));function di(t,e,r,o){return t+e/o.length}function yi(t,e){return xi(t,$(e))}function Iu(t,e){return R(t[2])<R(e[2])?1:-1}function Ei(t,e,r,o){if(!o.length)return[];let n=[],i=-1,s;for(;s=o[++i];){let h=s.scribeEvents,p=s.scribeIndex,m=Ie(h,p,e),d=ze(m),f=t.getSpelling(d,s),g=t.getRow(r,f);n.push({type:"note",pitch:f,dynamic:s[3],part:r,row:g,stave:t,event:s})}n.sort(Hu),n[0].top=!0,n[n.length-1].bottom=!0;let u=n[0].row,a=n[n.length-1].row,c=r.stemup===void 0?bi(t,r,u,a):r.stemup,l=0;for(i=-1;n[++i];)n[i].stemup=c,i>0&&n[i].row-n[i-1].row===1?n[i].clusterdown=++l:l=0;for(l=0,i=n.length-1;i--;)n[i+1].row-n[i].row===1?n[i].clusterup=++l:l=0;return n}function zu(t,e,r){let o=-1,n=0,i,s;for(;r[++o];)s=t.getRow(e,r[o]),s!==void 0&&s>n&&(n=s,i=r[o]);return{row:n,pitch:i}}function Wu(t,e,r){let o=-1,n=128,i,s;for(;r[++o];)s=t.getRow(e,r[o]),s!==void 0&&s<n&&(n=s,i=r[o]);return{row:n,pitch:i}}function bi(t,e,r,o){let n=e.centerRow||t.centerRow,i=r-n;return o-n+i>0}function vi(t,e,r){let{row:o}=zu(t,e,r),{row:n}=Wu(t,e,r);return bi(t,e,o,n)}function ju(t,e,r){let o=[],n=-1,i;for(;i=r[++n];)i.type==="note"&&o.push(i.pitch);return vi(t,e,o)}var gi=0;function ht(t,e,r,o){let n=-1;for(;o[++n]&&o[n].beat===o.beat;);if(!o[n])return t;let i=o[0].beat,u=bo(o).beat-i,a=r.stemup===void 0?vi(e,r,vo(ut("pitch"),o)):r.stemup;if(r.beam){let b;for(n=-1;b=o[++n];)b.stemup=a,b.beam=o;return t.push(er(o,{duration:u,stemup:a,range:0,id:++gi})),t}let c=[],l;for(n=-1;l=o[++n];){let b=e.getRow(r,l.pitch);if(b===void 0)continue;let U;for(;o[++n]&&ot(o[n].beat,l.beat,ne);)U=e.getRow(r,o[n].pitch),U!==void 0&&(a?U<b&&(b=U):U>b&&(b=U));--n,c.push(b)}let h=c.length-1,p=c.slice(0,tr(.5*c.length)).reduce(di,0),m=c.slice(Pu(.5*c.length)).reduce(di,0),d=Array.from(c,(b,U)=>(.2+.1*h)*U*(m-p)/h),f=d[d.length-1]-d[0],g=a?-50:50,x;for(n=c.length;n--;)x=d[n]-c[n],g=a?x>g?x:g:x<g?x:g;for(n=c.length;n--;)d[n]-=g+c[0];let E=-1;for(n=-1;l=o[++n];){for(++E,l.stemup=a,l.beam=o,l.stemHeight=a?1-.125*(d[n]-c[n]+c[0]):1+.125*(d[n]-c[n]+c[0]);o[++n]&&ot(o[n].beat,l.beat,Y);)o[n].stemup=a,o[n].beam=o,o[n].stemHeight=l.stemHeight;--n}return t.push(er(o,{pitch:o[0].pitch,y:d[0],duration:u,stemup:a,range:f,id:++gi})),t}function _e(t,e){let r=2*xo(e);for(;(r/=2)>t/2;){if(1.75*r===e)return 1.75*r;if(1.5*r===e)return 1.5*r;if(r<=e)return r}return t}function Vu(t,e,r){r=r||1/0;let o=4*xo(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=r)return o;return t}function Ri(t,e,r,o,n,i){let u=fi(e.divisor),a=tr(n/e.divisor)*e.divisor,c=Eo(.125,u,n-a);if(i<o){if(t.indexOf(i-n)!==-1)return i-n;let h=tr(i/e.divisor)*e.divisor;if(n===a){if(t.indexOf(h-n)!==-1)return h-n;let p=a+e.divisor<i&&a+e.divisor;return p?p-n:_e(.125,i-n)}if(ot(i,h,Y)){let p=a+e.divisor<i&&a+e.divisor;return p&&t.indexOf(p-n)!==-1?p-n:c}}let l=tr(o/e.divisor)*e.divisor;if(n===a){if(t.indexOf(o-n)!==-1)return o-n;if(t.indexOf(l-n)!==-1)return l-n;let h=a+e.divisor<o&&a+e.divisor;return h?h-n:Vu(.125,o-n,i-n)}else if(ot(o,l,Y)){if(t.indexOf(o-n)!==-1)return o-n;let h=a+e.divisor<o&&a+e.divisor;return h&&t.indexOf(h-n)!==-1?h-n:c}else{let h=4*c;return(n-a)%h/c===1?n+2*c===i?2*c:(n+3*c>=i&&console.log("Next event beat is inside quaduplet"),c<1?o>=n+c*3/2?3*c:o>=n+c?c:_e(.125,o-n):o>=n+c*3?c*3:o>=n+c*2?c*2:o>n+c?c:_e(.125,o-n)):o>n+c?c:_e(.125,o-n)}}function Xu(t,e,r,o,n,i){return{type:"rest",beat:i,duration:Ri(t,e,i,n,i,n),stave:r,part:o}}function Ro(t,e,r,o,n,i,s){for(;$t(i,s,Y);){let u=Xu(e,r,o,n,s,i);t.push(u),i+=u.duration}return s}function Ku(t,e,r,o,n,i){let{pitch:s,event:u,row:a}=o,c=Jn.test(s)?1:Zn.test(s)?-1:void 0,l=s[0]+s.slice(-1);if(c!==e[l])return e[l]=c,{type:"acci",beat:r,pitch:s,row:a,clump:n,cluster:i,part:t,event:u,value:c||0}}function Yu(t,e,r){let o=-1,n,i=0,s;for(;n=t[++o];)n.type==="acci"&&n.beat===e&&n.row<r&&n.row>i&&(i=n.row,s=o);return t[s]}function Si(t,e,r,o,n,i){let s=-1,u=0,a,c,l,h=!!i.find(p=>p.stemup?p.clusterup%2===1:p.clusterdown%2===1);for(;a=i[++s];)Qe(e.beat,a.event[0],Y)||(l=Yu(t,n,a.row),u=l&&l.row-a.row<6&&l.cluster===h?l.clump+1:0,c=Ku(r,o,n,a,u,h),c&&t.push(c))}function Ai(t,e,r,o,n,i){let s=-1/0,u=-1,a,c;for(;a=n[++u];)a.dynamic>s&&(s=a.dynamic,c=a.event);if(n.length&&s>=i.accentThreshold){let l=n[0].stemup?n[n.length-1]:n[0];t.push({type:"accent",beat:o,pitch:l.pitch,dynamic:s,stemup:l.stemup,stave:e,part:r,event:c})}}function Di(t,e,r,o,n){let i=n[0].row,s=n[0].pitch,u=i-(r.topRow||e.topRow)+1;u<0&&t.push({type:"ledge",beat:o,pitch:s,part:r,rows:u});let a=n[n.length-1].row,c=n[n.length-1].pitch;u=a-(r.bottomRow||e.bottomRow),u>0&&t.push({type:"ledge",beat:o,pitch:c,part:r,rows:u})}function Zu(t,e,r){let{beat:o,duration:n,divisor:i}=r,s=e.stemup===void 0?ju(t,e,r):e.stemup,u=-1,a;for(;a=r[++u];)a.type==="note"&&!a.beam&&(a.stemup=s);let c=o+.5*n,l=R(t.topPitch)-12,h,p=Gt(r);for(;(a=r[--p])&&a.beat>c;);for(++p;(a=r[--p])&&a.beat+a.duration>c;){let E=R(a.pitch);(!h||E>h)&&(h=E)}let m=l;for(p=-1;(a=r[++p])&&a.beat<o+Y;){let E=R(a.pitch);(!m||E>m)&&(m=E)}let d=l;for(p=Gt(r);(a=r[--p])&&a.beat>o+n-n/i-Y;){let E=R(a.pitch);(!d||E>d)&&(d=E)}let f=Math.ceil((m+d)/2),g=nt(f);f>h&&(h=f),r.pitch=nt(h),r.stemup=s;let x=d-m;r.angle=x<0?4*mi(-x):-4*mi(x)}function Ju(t,e,r,o,n,i,s,u,a,c,l,h,p,m,d){(u.swingAsStraight8ths&&c===1||u.swingAsStraight16ths&&c===.5)&&l===3&&(h===4||h===5)&&(l=2);let f=c/l,g=a+c,x={type:"tuplet",beat:a,duration:c,divisor:l,rhythm:h,part:i,stave:r},E;for(yo(l)||t.push(x);Qe(g,a,ne);){for(;(E=m[++d])&&bt(a+.5*f,E[0]-e.beat,ne);)p.push(E);if(--d,!p.length){t.push({type:"rest",beat:a,duration:f,stave:r,part:i}),a+=f;continue}let b=Ei(r,o,i,p);Di(t,r,i,a,b),Si(t,e,i,n,a,b),Ai(t,r,i,a,b,u);let U=wi(p.reduce(yi,0)-e.beat,E?E[0]-e.beat:e.duration,x.beat+x.duration),C=xi(f,Je(f,U-a)),B=-1;for(;b[++B];)t.push(er(b[B],{beat:a,duration:C}));for(oe(x,...b),$t(.5,C,ne)?s&&(ht(t,r,i,s),s=void 0):s||(s={type:"beam",beat:a,part:i}),s&&oe(s,...b),B=p.length;B--;){let K=$(p[B])-e.beat;bt(a+C+.5*f,K,ne)?p.splice(B,1):t.push({type:"tie",beat:a,pitch:b[B].pitch,duration:C,stemup:b[B].stemup,part:i,event:p[B]})}a+=C}return s&&ht(t,r,i,s),Zu(r,i,x),d}function So(t,e,r,o=0,n={},i,s,u=H){let a=[],{headDurations:c,restDurations:l}=u,h=0,p=-1,m,d,f;for(;(m=s[++p])&&bt(h,m[0]+m[4]-e.beat,Y););for(--p;Qe(e.duration,h,Y);){f&&e.divisions.find(K=>ot(h,K,Y))&&(ht(t,r,i,f),f=void 0);let g=li(s,e.beat+h,e.duration-h);if(g&&!yo(g.divisor)){$t(h,g.beat-e.beat,Y)&&Ro(t,u.restDurations,e,r,i,h,g.beat-e.beat),f&&hi(g.divisor,g.rhythm)&&(ht(t,r,i,f),f=void 0),p=Ju(t,e,r,o,n,i,f,u,g.beat-e.beat,g.duration,g.divisor,g.rhythm,a,s,p),h=g.beat-e.beat+g.duration;continue}for(;(m=s[++p])&&bt(h,m[0]-e.beat,Y);)a.push(m);if(--p,r.pitched&&a.sort(Iu),!a.length){if(!m){f&&(ht(t,r,i,f),f=void 0),Ro(t,u.restDurations,e,r,i,h,e.duration);break}let K=Je(.125,m[0]-e.beat);if(K<=h){console.log(`Problem at bar ${e.count}, moving to next bar ${h} ${K}`),e.error="Stop beat has ended up less than beat";break}f&&(Ni(e.divisions,h,K)||K-h>=.5)&&(ht(t,r,i,f),f=void 0),Ro(t,l,e,r,i,h,K),h=K;continue}let x=Ei(r,o,i,a);Di(t,r,i,h,x),Si(t,e,i,n,h,x),Ai(t,r,i,h,x,u);let E=a[0][0]-e.beat,b=wi(e.duration,a.reduce(yi,0)-e.beat),U=m&&Je(.125,m[0])-e.beat,C=Ri(c,e,E,b,h,U),B=-1;for(;x[++B];)t.push(er(x[B],{beat:h,duration:C}));for(C>=1?f&&(ht(t,r,i,f),f=void 0):f||(f={type:"beam",beat:h,part:i}),f&&oe(f,...x),B=a.length;B--;){let K=$(a[B])-e.beat;bt(h+C,K,Y)||K-(h+C)<.125+1/16*($(a[B])-a[B][0])?a.splice(B,1):t.push({type:"tie",beat:h,pitch:x[B].pitch,duration:C,stemup:x[B].stemup,part:i,event:a[B]})}h+=C}return f&&ht(t,r,i,f),t}var Qu={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function _u(t,e){return Qu[t+","+e]||Pe}function Ni(t,e,r){let o=-1;for(;t[++o]&&t[o]<=e;);return r>t[o]?t[o]:void 0}var tp=[];function Fi(t,e){return kt(e).reduce((o,n,i)=>{let s=n-X[i];if(s!==0){let u=j(X[i]),a=10;for(;a--;)o[u+a]=s}return o},t),t}function ep(t,e,r,o,n,i,s){let u=-1,a;for(;a=i[++u];)switch(a[1]){case"key":{let c=T(a[2]);Fi(n,c),e.key=c;break}case"meter":{t.push({type:"timesig",beat:0,numerator:a[3]===1.5?a[2]/.5:a[2]/a[3],denominator:a[3]===1.5?8:4/a[3],stave:r,event:a});break}case"symbol":{t.push({type:"symbol"+a[2],stave:r});break}case"chord":{let c=a[0]-e.beat,l=Ie(i,u,o),h=ze(l),p=r.getSpelling(h,a);p==="C‚ô≠"&&s.spellChordRootCFlatAsB&&(p="B"),p==="E‚ôØ"&&s.spellChordRootESharpAsF&&(p="F"),p==="B‚ôØ"&&s.spellChordRootBSharpAsC&&(p="C"),p==="F‚ô≠"&&s.spellChordRootFFlatAsE&&(p="E"),t.push({type:"chord",beat:c,duration:a[0]+a[4]>e.beat+e.duration?e.duration-c:a[4],root:p,extension:Se(a[3]),event:a,stave:r});break}case"text":{let c=a[0]-e.beat;t.push({type:"text",beat:c,duration:a[0]+a[3]>e.beat+e.duration?e.duration-c:a[3],value:a[2],event:a,stave:r});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(tp.includes(a[1]))return;console.log('Scribe: ignoring event type "'+a[1]+'"')}}return t}function ie(t,e,r,o,n,i,s,u,a,c=H){let l=[];if(a){let g=$(a);g>e&&g<=e+r&&s.push(a)}let h=Fi({},i),p={type:"bar",beat:e,duration:r,key:i,divisor:o||4,divisions:_u(r,o),stave:n,count:t,symbols:l};ep(l,p,n,i,h,s,H);let m=n.parts.reduce((g,x)=>x.centerRow?g.add(x.centerRow):g,new Set);m.size||m.add(n.centerRow);let d;for(d of n.parts){let g=u[d.name];!g||!g.length||(m.delete(d.centerRow||n.centerRow),So(l,p,n,i,h,d,g,c))}let f;for(f of m)So(l,p,n,i,h,{centerRow:f},[],c);return p}function rp(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function op(t){let e=t.symbols.filter(r=>r.type==="chord"||r.type==="note");return JSON.stringify(e,rp)}function vt(t,e){t.symbols=t.symbols.filter(r=>r.type==="doublebarline"||r.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function rr(t,e,r){let o=op(r);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&r.symbols.filter(n=>n.type!=="clef"&&n.type!=="timesig").find(n=>n.type!=="rest")?(vt(t[t.length-2],1),vt(t[t.length-1],1),vt(r,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(vt(r,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,vt(t[t.length-1],2),vt(r,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,vt(r,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function Ao(t,e,r){let o=r.target?t.parts[r.target]:t.getPart(r[2]),n=e[o.name]||(e[o.name]=[]);e[o.name].push(r)}function Do(t,e,r,o=H){let n=[],i=[],s=[],u=[],a=0,c=[],l={},h=0,p=0,m,d,f,g;for(f of t)if(f.scribeIndex=n.length,f.scribeEvents=n,n.push(f),!e.includes(f[1])){for(;f[0]>=a+m;){let E=ie(i.length+1,a,m,d,r,h,c,l,g,o);rr(i,u,E),i.push(E),h=E.key,a=a+m,c=[],l={};let b=-1;for(;s[++b];)Ao(r,l,s[b]),$(s[b])<a+m&&s.splice(b--,1)}switch(f[1]){case"note":{Ao(r,l,f),$(f)>a+m&&s.push(f),p<$(f)&&(p=$(f));break}case"sequence":{f.events===t.events&&(g=f),p<$(f)&&(p=$(f));break}case"meter":m=f[2],d=f[3],f[0]!==a&&console.log("TODO");default:c.push(f)}}for(;s.length;){let E=ie(i.length+1,a,m,d,r,h,c,l,g,o);rr(i,u,E),i.push(E),a=a+m,c=[],l={};let b=-1;for(;f=s[++b];)Ao(r,l,f),$(f)<a+m&&s.splice(b--,1)}for(;a<p-m;){let E=ie(i.length+1,a,m,d,r,h,c,l,g,o);rr(i,u,E),i.push(E),a=a+m,c=[],l={}}m||(m=n.length?$(n[n.length-1]):1);let x=ie(i.length+1,a,m,d,r,h,c,l,g,o);return rr(i,u,x),i.push(x),i}var No=Symbol("scribe-id"),np={},Fo=0;function st(t){for(;t.event;)t=t.event;return t[No]?t[No]:(t[No]=++Fo,np[Fo]=t,Fo)}var at=1.1;function ip(t){return parseFloat(t.dataset.beat)}function sp(t){return parseFloat(t.dataset.duration)}function ap(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function Ci(t,e,r,o,n){let i=r[0],s=r.length===1?o%(n*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],u=r.length===1?o%(n*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[r[r.length-1]];return`M${s}, ${-t*s-.5*at}
        L${u},${-t*u-.5*at}
        L${u},${-t*u+.5*at}
        L${s}, ${-t*s+.5*at}
        Z`}function Co(t,e,r,o,n,i,s){if(s<.0833)return;let u=n-1,a;for(;r[++u];)r[u]<=s?a?a.push(u):a=[u]:a&&(t.appendChild(v("path",{class:`beam-path-${4/s} beam-path`,d:Ci(i,o,a,e[u-1],s)})),Co(t,e,r,o,a[0],i,s/2),a=void 0);a&&(t.appendChild(v("path",{class:`beam-path-${4/s} beam-path`,d:Ci(i,o,a,e[u-1],s)})),Co(t,e,r,o,a[0],i,s/2),a=void 0)}function Bi(t){let e=t.dataset.beam,r=t.parentElement,o=Array.from(r.querySelectorAll('.top-note[data-beam="'+e+'"]')),n=o.map(ip),i=o.map(sp),s=t.viewBox.baseVal,u=s.y<-.5?s.y+.5:s.height-1,a=o.map(mt),c=a[0].x,l=a[a.length-1].x,h=a.map(p=>(p.x-c)/(l-c));ap(t),Co(t,n,i,h,0,-u,.25)}var cp=/‚ôÆ|(bb|ùÑ´)|(##|ùÑ™)|(b|‚ô≠)|(#|‚ôØ)/g,up={0:`<span class="glyph glyph-natural">${Tt}</span>`,1:`<span class="glyph glyph-doubleflat">${Yt}</span>`,2:`<span class="glyph glyph-doublesharp">${Qt}</span>`,3:`<span class="glyph glyph-flat">${Zt}</span>`,4:`<span class="glyph glyph-sharp">${Jt}</span>`};function pp(){let t=arguments.length-2;for(;t--;)if(arguments[t])return up[t];return""}function Bo(t){return t.replace(cp,pp)}function M(t,e){return e.toFixed(t).replace(/\.?0+$/,"")}var or=Math.abs,lp={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},hp={2:Qt,1:Jt,0:Tt,"-1":Zt,"-2":Yt},fp={treble:Wt,"treble-down":jt,"treble-up":Vt,alto:Xt,bass:Kt,drum:Ge,percussion:Ge},mp={"1.33":ro,"0.67":eo,"0.33":to,"0.17":_r,"0.08":Qr},dp=/^(‚àÜ|-|√∏|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function gp(t){let e=-1,r="";for(;t[++e];)r+=(r?" ":"")+st(t[e].event);return r}var To=A(ut("type"),{barrepeat:t=>v("span",{class:"barrepeat",html:O["barRepeat"+t.count],data:{beat:0,duration:t.duration}}),clef:t=>v("span",{class:`${t.clef}-clef clef`,html:fp[t.clef]}),chord:t=>{let e=dp.exec(t.extension);return v("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+Bo(t.root)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+Bo(e[3])+"</sup>":"")+"</span>"+(t.bass?no+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:M(4,t.beat),duration:M(4,t.duration),event:st(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?v("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,st(t.event))):v("span",{class:"timesig",html:`<sup>${O["timeSig"+t.numerator]}</sup>
                <sub>${O["timeSig"+t.denominator]}</sub>`,data:{event:st(t.event)}}),symbolcoda:t=>v("p",{html:oo,class:"coda"}),barcount:t=>v("span",{html:t.text,class:"barcount"}),text:t=>v("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:M(4,t.beat),duration:M(4,t.duration),event:st(t.event)}}),acci:t=>v("span",{class:(lp[t.value]||"acci")+(t.clump?" acci-"+t.clump:"")+(t.cluster?" acci-cluster":""),html:hp[t.value]||Tt,data:{beat:t.beat&&M(4,t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&st(t.event)}}),accent:t=>{let e=t.dynamic>=H.marcatoThreshold,r=t.stave.type==="drum"||t.stave.type==="percussion";return v("span",{class:`${t.stemup?"up":"down"}-accent accent${e?" marcato-accent":""}`,html:r?e?t.stemup?Le:qe:t.stemup?Oe:Ue:e?t.stemup?qe:Le:t.stemup?Ue:Oe,data:{beat:M(4,t.beat),pitch:t.pitch,part:t.part.name,event:st(t.event)}})},ledge:t=>v("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${or(t.rows)}`:`0 -0.5 5 ${or(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:M(4,t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>v("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${R(t.pitch)})`,data:{beat:M(4,t.beat),pitch:t.pitch,duration:M(4,t.duration),part:t.part.name,beam:t.beam&&t.beam.id,event:st(t.event)}}),beam:(t,e)=>v("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${or(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${M(4,t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(or(t.range)+at)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*at} L1,${t.range-.5*at} L1,${t.range+.5*at} L0,${.5*at} Z"></path>`,data:{beat:M(4,t.beat),pitch:t.pitch,part:t.part.name,beam:t.id,events:gp(t)}}),tie:t=>v("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:M(4,t.beat),pitch:t.pitch,duration:M(4,t.duration),part:t.part.name,event:st(t.event)}}),tuplet:t=>v("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:O["tuplet"+t.divisor],data:{beat:M(4,t.beat),pitch:t.pitch,duration:M(4,t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>v("span",{class:"rest",html:mp[t.duration.toFixed(2)]||O["rest"+(t.duration+"").replace(".","")]||"",data:{beat:M(4,t.beat),pitch:t.pitch,duration:M(4,t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});var Ti=globalThis||window,se={pink:"#FE267E",grey:"#81868f"},wp=Ti.DEBUG&&Ti.DEBUG.scribe!==!1?function(e,r,o="",n=""){console.log("%cScribe %c"+e+" %c"+r+" %c"+o+" %c"+n,"color: "+se.pink+"; font-weight: 300;","color: "+se.grey+"; font-weight: 300;","color: "+se.pink+"; font-weight: 300;","color: "+se.grey+"; font-weight: 300;","color: "+se.pink+"; font-weight: 300;")}:L,ki=wp;var xp=globalThis||window;function yp(t){return t[0]<=0&&t[1]==="meter"}function Ep(t){return t[0]<=0&&t[1]==="key"}function bp(t,e){let r=To(e);return r&&t.push(r),t}function vp(t,e){return t.push(v("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:j(e.key),stave:e.stave.type},children:e.symbols.reduce(bp,[])})),t}function $i(t,e,r,o,n,i=1/0,s=0,u=0,a=H){let c=t.events;!c.find(yp)&&n&&c.unshift([0,"meter",n[2],n[3]]),!c.find(Ep)&&o&&c.unshift([0,"key",o]);let p=Xe[r||"treble"],m=[];s&&m.push("transpose",s),u&&m.push("displace",u);let d=new xt(c,t.sequences,m),f=Do(d,e,p,a),g=f.reduce(vp,[]),E=f[0].key,b=p.createSignatureSymbols(E),U=v("div",{class:`${p.type}-stave signature-stave stave`,children:b.map(To),data:{key:j(E)}}),C=v("div",{id:"side",class:"side",data:{key:j(E)}}),B=24;for(;B--;)C.appendChild(U.cloneNode(!0));return g.unshift(C),g}var Ot=[v("span",{html:Yr,style:"width: min-content;"}),v("span",{html:Zr,style:"width: min-content;"}),v("span",{html:Jr,style:"width: min-content;"})];function Rp(t){t.remove()}function nr(t,e=t){e.append.apply(e,Ot);let r=mt(Ot[0]).width,o=mt(Ot[1]).width,n=mt(Ot[2]).width,i=window.getComputedStyle(Ot[0]),s=ii(i.fontSize);xp.DEBUG&&ki("post render font-size",s,"heads",`${r}, ${o}, ${n}`),Ot.forEach(Rp);let u=e.querySelector(".side");if(!u)return;let a=u.dataset.key,l={"G‚ô≠":6,"C‚ôØ":5,"D‚ô≠":5,"G‚ôØ":4,"A‚ô≠":4,"D‚ôØ":3,"E‚ô≠":3,"B‚ô≠":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"F‚ôØ":6}[a];return`--head-1-size: ${M(6,r/s)}; --head-2-size: ${M(6,o/s)}; --head-4-size: ${M(6,n/s)}; --signature-width: ${(2.25+l*.625+.625).toFixed(4)}em;`}function ae(t,e=t){e.querySelectorAll(".beam").forEach(Bi)}var Mi=Object.assign,Sp=Object.defineProperties,Ap=new URL("shadow.css",import.meta.url),ir=S.of(),Gi=new ResizeObserver(t=>{for(let e of t)ae(y(e.target).shadowRoot)}),uw=Sp(yr("scribe-music",{shadow:`
        <link rel="stylesheet" href="${Ap}" />
    `,construct:function(t,e){let r=t.querySelector("link");ir.value&&(r.href=ir.value),e.data=S.of(),e.clef=S.of("treble"),e.key=S.of("C"),e.meter=S.of(),e.beat=S.of(0),e.duration=S.of(1/0),e.transpose=S.of(0),e.excludes=S.of([]),e.swingAsStraight8ths=S.of(!1),e.swingAsStraight16ths=S.of(!1),e.debug=S.of(!1),e.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(t,e){if(e.isSafari&&this.classList.add("safari"),Gi.observe(this,{box:"content-box"}),!this.src){let r=this.textContent.trim();e.data.value=yt(this.type,r)}return S.frame(()=>{if(!e.data.value)return;let r=e.data.value&&$i(Q.from(e.data.value),e.excludes.value,e.clef.value,e.key.value,e.meter.value,e.duration.value,e.transpose.value,e.beat.value,Mi({},H,{swingAsStraight8ths:e.swingAsStraight8ths.value,swingAsStraight16ths:e.swingAsStraight16ths.value}));if(t.querySelectorAll(".side, .bar, style").forEach(n=>n.remove()),t.append.apply(t,r),!r)return;let o=e.style=v("style",`:host { ${nr(this,t)} }`);t.appendChild(o),ae(this,t),setTimeout(()=>{o.textContent=`:host { ${nr(this,t)} }`,ae(this,t)},2e3)})},load:function(t,{style:e}){e.textContent=`:host { ${nr(this,t)} }`,ae(this,t)},disconnect:function(){Gi.unobserve(this)}},{clef:{attribute:function(t){this.clef=t},get:function(){return y(this).clef.value},set:function(t){if(!Xe[t]){console.warn('<scribe-music> Attempt to set invalid clef="'+t+'" ignored');return}y(this).clef.value=t}},key:{attribute:function(t){this.key=t===""?"C":t},get:function(){return y(this).key.value},set:function(t){let e=y(this);if(typeof t!="string"||!/^[A-G][#b‚ôØ‚ô≠]?$/.test(t)){console.warn('<scribe-music> Attempt to set invalid key="'+t+'" ignored');return}e.key.value=t.replace(/[#b]$/,r=>r==="#"?"‚ôØ":"‚ô≠")}},meter:{attribute:function(t){this.meter=t===""?"4/4":t},get:function(){return zn(y(this).meter.value)},set:function(t){y(this).meter.value=Mi([0],In(t))}},beat:{attribute:function(t){this.beat=t},get:function(){return y(this).beat.value},set:function(t){y(this).beat.value=typeof t=="number"?t:parseFloat(t)}},duration:{attribute:function(t){this.duration=t},get:function(){return y(this).duration.value},set:function(t){y(this).duration.value=typeof t=="number"?t:parseFloat(t)}},transpose:{attribute:function(t){this.transpose=t},get:function(){return y(this).transpose.value},set:function(t){y(this).transpose.value=typeof t=="number"?Math.round(t):parseInt(t,10)}},type:{attribute:function(t){this.type=t},writable:!0,value:"application/json"},src:{attribute:function(t){this.src=t},get:function(){return y(this).src},set:function(t){let e=y(this);e.src=t;let r=new URL(t,window.location);if(window.location.origin===r.origin&&window.location.pathname===r.pathname){let o=this.getRootNode().getElementById(r.hash.slice(1));if(!o)throw new Error('<scribe-music> src script "'+t+'" not found in document');this.data=JSON.parse(o.textContent)}else Hn(this.type,r.href).then(o=>this.data=o)},default:null},data:{get:function(){return y(this).data.value},set:function(t){y(this).data.value=t},default:null},swing:{attribute:function(t){y(this).swingAsStraight8ths.value=t!==null}},shuffle:{attribute:function(t){y(this).swingAsStraight16ths.value=t!==null}},debug:{attribute:function(t){this.debug=t!==null},get:function(){return y(this).debug.value},set:function(t){y(this).debug.value=!!t}},excludes:{attribute:function(t){return y(this).excludes.value=t.split(/\s+/)}}},"stephband.band/scribe/"),{stylesheet:{set:t=>ir.value=t,get:()=>ir.value}});export{uw as default};
//# sourceMappingURL=element.js.map
