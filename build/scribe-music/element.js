/* Scribe 
   0.4.36
   By stephband */

var Pi=Object.defineProperty;var Ii=(t,e)=>{for(var r in e)Pi(t,r,{get:e[r],enumerable:!0})};var L,dt;function Hi(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function wr(t){let e=0;for(;t[--e];)t[e].stop&&t[e].stop(),t[e]=void 0}function Lt(t,e){let r=0;for(;e[--r]&&e[r]!==t;);for(e[r]=t,r=-1;t[++r]&&t[r]!==e;);t[r]=e}function At(t){let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.invalidate(t)}function xr(t,e){let r=0;for(;t[--r];)if(t[r]===e)return!0}var A=class t{static isSignal(e){return e instanceof t}static of(e){return new hr(e)}static from(e,r){if(e.then){let o=t.of();return e.then(n=>o.value=n),o}return e.pipe?e.pipe(new fr):new pe(e,r)}static compute(e,r){return new pe(e,r)}static fromProperty(e,r){return new mr(e,r)}static frame(e){return new fe(e)}static tick(e){return new he(e)}static temporal(e,r){return new dr(e,r)}static evaluate(e,r,o=e){let n=L;L=e,n||(dt=!1);let i=r.apply(o);return L=n,i}static get hasInvalidDependency(){return dt}static get evaluating(){return L}constructor(e){e&&(this.name=e)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},hr=class extends A{#t;constructor(e){super(),this.#t=e}get value(){return L&&Lt(this,L),this.#t}set value(e){this.#t!==e&&(this.#t=e,At(this))}},fr=class extends A{#t;constructor(e){super(),this.#t=e}get value(){return L&&Lt(this,L),this.#t}push(e){this.#t!==e&&(this.#t=e,At(this))}},mr=class extends A{#t;#e;constructor(e,r){super(e),this.object=r}evaluate(){return this.object[this.name]}get value(){return L&&Lt(this,L),this.#t?this.#e:(this.#e=A.evaluate(this,this.evaluate,this),dt||(this.#t=!0),this.#e)}set value(e){if(this.#e===e)return;let{object:r,name:o}=this;r[o]=e,e=r[o],this.#e!==e&&(this.#e=e,At(this))}invalidate(e){this.#t&&(e&&!xr(this,e)||(this.#t=!1,wr(this),At(this)))}},pe=class extends A{#t;#e;#r;#o;constructor(e,r){super(),this.#t=e,this.#e=r}get value(){return L&&Lt(this,L),this.#r?this.#o:(this.#o=A.evaluate(this,this.#t,this.#e),dt||(this.#r=!0),this.#o)}invalidate(e){this.#r&&(e&&!xr(this,e)||(this.#r=!1,wr(this),At(this)))}},dr=class extends A{#t=0;constructor(e,r){super(e),this.object=r}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return A.evaluating&&(Lt(this,L),this.getTime()<this.#t&&(dt=!0)),this.evaluate()}set value(e){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==e&&(this.object[this.name]=e,invalidateUntil(this.getTime()))}invalidateUntil(e){let o=this.getTime()>=this.#t;this.#t=e,o&&At(this)}},le=class extends A{constructor(e){if(super(),L){let r=0;for(;L[--r]&&L[r]!==this;);L[r]=this}e&&(this.evaluate=e,(A.evaluate(this,this.evaluate)||dt)&&this.cue())}invalidate(e){this.constructor.observers.indexOf(this)===-1&&(e&&!xr(this,e)||(wr(this),this.cue()))}stop(){let e=0,r;for(;r=this[--e];){let i=-1;this[e]=void 0,r.stop?r.stop():Hi(r,this)}let o=this.constructor.observers,n=o.indexOf(this);if(n!==-1){if(o===gr)throw new Error("Attempt to remove observer while observers is rendering");o.splice(n,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},gr;function Uo(t){let e=-1,r;for(gr=t;r=t[++e];)!A.evaluate(r,r.evaluate)&&!dt&&t.splice(e--,1);return gr=void 0,t}var Lo=Promise.resolve();function qo(){Uo(he.observers).length&&Lo.then(qo)}var he=class extends le{static observers=[];cue(){let e=this.constructor.observers;e.length||Lo.then(qo),e.push(this)}};function Po(){Uo(fe.observers).length&&requestAnimationFrame(Po)}var fe=class extends le{static observers=[];cue(){let e=this.constructor.observers;e.length||window.requestAnimationFrame(Po),e.push(this)}};function zi(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function gt(t){return t===window?zi():t.getClientRects()[0]||t.getBoundingClientRect()}function M(t){return t}function D(t,e){return function(){let o=t.apply(this,arguments),n=e[o]||e.default;if(!n)throw new Error('overload() no function defined for key "'+o+'"');return n.apply(this,arguments)}}var Io=globalThis||window,Ho;function st(t){var e=new Map;return function(o){if(Io.DEBUG&&!Ho&&o===void 0&&(Ho=!0,console.warn("cache() called with undefined. Not illegal, but potentially bad.")),Io.DEBUG&&arguments.length>1&&console.warn("cache() called with "+arguments.length+" arguments. Accepts exactly 1."),e.has(o))return e.get(o);var n=t(o);return e.set(o,n),n}}var zo=globalThis||window,ji=Array.prototype;function Wi(t,e){return typeof t=="function"?t.apply(null,e):t}function me(t,e,r){r=r||t.length;var o=r===1?e?t:st(t):st(function(n){return me(function(){var i=[n];return i.push.apply(i,arguments),t.apply(null,i)},e,r-1)});return function n(i){return arguments.length===0?n:arguments.length===1?o(i):arguments.length>=r?t.apply(null,arguments):Wi(o(i),ji.slice.call(arguments,1))}}if(typeof zo<"u"&&zo.DEBUG){let t=me,e=function(){var o=function(){};try{Object.defineProperty(o,"length",{value:2})}catch{return!1}return o.length===2}(),r=function(n,i,s,u){return u.toString=function(){return/function\s*[\w\d]*\s*\([,\w\d\s]*\)/.exec(s.toString())+" { ["+n+"] }"},e&&Object.defineProperty(u,"length",{value:i}),u};me=function(n,i,s){return s=s||n.length,r("curried",s,n,t(n,i,s))}}var Z=me;function U(){}var Ki=D(M,{is:U,tag:U,data:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},dataset:function(t,e,r){for(t in r)r[t]===void 0&&delete r[t];Object.assign(e.dataset,r)},html:function(t,e,r){e.innerHTML=r},text:function(t,e,r){e.textContent=r},style:D((t,e,r)=>typeof r,{string:(t,e,r)=>e.style=r,object:(t,e,r)=>Object.assign(e.style,r)}),children:function(t,e,r){e.innerHTML="",e.append.apply(e,r)},href:function(t,e,r){e instanceof SVGElement?e.setAttribute("href",r):e.href=r},points:_,cx:_,cy:_,r:_,x:_,y:_,dx:_,dy:_,transform:_,preserveAspectRatio:_,viewBox:_,default:function(t,e,r){t in e?e[t]=r:e.setAttribute(t,r)}});function _(t,e,r){e.setAttribute(t,r)}function Vi(t,e){for(var r=Object.keys(e),o=r.length;o--;)e[r[o]]!==void 0&&Ki(r[o],t,e[r[o]]);return t}var de=Z(Vi,!0);var yr="http://www.w3.org/2000/svg",jo=document.createElement("template"),Er=(t,e)=>e&&typeof e;function Wo(t,e=""){let r=document.createRange();return r.selectNode(t),r.createContextualFragment(e)}var z=D(Er,{string:function(t,e){let r=document.createElementNS(yr,t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElementNS(yr,t);return typeof e.length=="number"?r.append.apply(r,e):de(r,e),r},default:t=>document.createElementNS(yr,t)}),Xi=D(Er,{string:function(t,e){let r=document.createElement(t);return r.innerHTML=e,r},object:function(t,e){let r=document.createElement(t);return typeof e.length=="number"?r.append.apply(r,e):de(r,e),r},default:t=>document.createElement(t)}),Yi=D(M,{comment:function(t,e){return document.createComment(e||"")},fragment:D(Er,{string:function(t,e,r){return r?Wo(r,e):(jo.innerHTML=e,jo.content.cloneNode(!0))},object:function(t,e,r){let o=r?Wo(r):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):de(o,e),o},default:()=>document.createDocumentFragment()}),circle:z,ellipse:z,g:z,glyph:z,image:z,line:z,rect:z,use:z,path:z,pattern:z,polygon:z,polyline:z,svg:z,tspan:z,text:z,default:Xi}),v=Yi;function br(t,e,r){let o;typeof r!="string"&&r.input!==void 0&&r.index!==void 0&&(o=r,r=o.input.slice(r.index+r[0].length+(r.consumed||0)));let n=t.exec(r);if(!n)return;let i=e(n);return o&&(o.consumed=(o.consumed||0)+n.index+n[0].length+(n.consumed||0)),i}var Jp=Z(br,!0);function Zi(t,e,r){throw r.input!==void 0&&r.index!==void 0&&(r=r.input),new Error('Cannot parse string "'+(r.length>128?r.length.slice(0,128)+"â€¦":r)+'"')}function Ji(t,e,r){let o=-1;for(;++o<r.length;)e=r[o]!==void 0&&t[o]?t[o](e,r):e;return t.done?t.done(e,r):t.close?t.close(e,r):e}function Qi(t,e,r,o){let n=br(t,i=>Ji(e,r,i),o);return n===void 0?e.catch?e.catch(r,o):Zi(t,e,o):n}var Ko=Z(Qi,!0);var Vo=Symbol("internals");function vr(t,e,r){return e[Vo]=e.attachInternals&&!e.getAttribute("is")?e.attachInternals():{shadowRoot:r}}function E(t){return t[Vo]}var Xo=Object.defineProperties;var Rr={},_i={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return E(this).form}},labels:{get:function(){return E(this).labels}},validity:{get:function(){return E(this).validity}},validationMessage:{get:function(){return E(this).validationMessage}},willValidate:{get:function(){return E(this).willValidate}},checkValidity:{value:function(){return E(this).checkValidity()}},reportValidity:{value:function(){return E(this).reportValidity()}}},Sr=!1,ts=Ko(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() â€“ name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null),Yo={once:!0};function es(t){return t.sheet?Promise.resolve({target:t}):new Promise((e,r)=>{t.addEventListener("load",e,Yo),t.addEventListener("error",r,Yo)})}function rs(t){t.stop()}function os(t){if(Rr[t])return Rr[t];let e=document.createElement(t).constructor;if(e===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+t+"> is HTMLUnknownElement");return Rr[t]=e}function ns(t,e){if(t.hasOwnProperty(e)){let r=t[e];delete t[e],t[e]=r}return t}function Zo(t,e){let r=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(e.stylesheet){let o=v("link",{rel:"stylesheet",href:e.stylesheet});r.append(o)}return r}function is(t,e){return typeof e=="string"?e[0]==="#"?t.appendChild(document.getElementById(e.slice(1)).content.clone(!0)):t.innerHTML=e:t.appendChild(e.content.clone(!0)),t}function ss(t){let e=t.isUpgraded;return t.isUpgraded=!0,!e}function Jo(t,e){return Array.from(t.querySelectorAll('[is="'+e+'"]')).filter(ss)}var as=D((t,e)=>typeof e,{object:(t,e)=>e,function:(t,e)=>({value:e}),default:(t,e)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof e)}});function Ar(t,e={},r={},o=""){let{name:n,tag:i}=ts(t),s=typeof i=="string"?os(i):HTMLElement,u=[],a={},c,l;for(c in r)l=as(c,r[c]),l.attribute&&u.push(c),(l.set||l.get||"value"in l)&&(a[c]=l),r[c]=l;function h(){let p=Reflect.construct(s,arguments,h),m=e.mode||typeof e.shadow=="string"?Zo(p,e):void 0;e.shadow&&is(m,e.shadow);let d=vr(h,p,m);return i&&(Sr=!0),e.construct&&e.construct.call(p,m,d),Object.keys(a).reduce(ns,p),p}if(h.prototype=Object.create(s.prototype,a),r.value&&(h.formAssociated=!0,Xo(h.prototype,_i),(e.enable||e.disable)&&(h.prototype.formDisabledCallback=function(p){let m=E(this);return p?e.disable&&e.disable.call(this,m.shadowRoot,m):e.enable&&e.enable.call(this,m.shadowRoot,m)}),e.reset&&(h.prototype.formResetCallback=function(){let p=E(this);return e.reset.call(this,p.shadowRoot,p)}),e.restore&&(h.prototype.formStateRestoreCallback=function(){let p=E(this);return e.restore.call(this,p.shadowRoot,p)})),u.length&&(h.observedAttributes=u,h.prototype.attributeChangedCallback=function(p,m,d){return r[p].attribute.call(this,d)}),e.connect&&(h.prototype.connectedCallback=function(){let p=E(this),m=p.shadowRoot;if(p.stopable=e.connect.call(this,m,p),!m)return;let d=m.querySelectorAll('link[rel="stylesheet"]');if(d.length){let f=v("style","*:not(slot), slot:not([name]) { display: none !important; }");m.prepend(f);let g;p.loadPromise?g=p.loadPromise.then(()=>new Promise(requestAnimationFrame)):g=p.loadPromise=Promise.all(Array.from(d,es)),g.finally(()=>{f.remove(),e.load&&e.load.call(this,m,p)})}else e.load&&e.load.call(this,m,p)}),h.prototype.disconnectedCallback=function(){let p=E(this);p.stopable&&(p.stopable.stop?p.stopable.stop():p.stopable.forEach(rs)),e.disconnect&&e.disconnect.call(this,p.shadowRoot,p)},window.console&&window.console.log("%c<"+(i?i+" is="+n:n)+">%c "+o,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(n,h,i&&{extends:i}),i&&!Sr){let p=document.createElement("div");if(p.style.position="fixed",p.style.left="-1000px",p.style.top="-1000px",p.innerHTML="<"+i+' is="'+n+'"></'+i+">",document.body.append(p),p.remove(),Sr)h.polyfillByRoot=U;else{let m=function(f){let g={};Object.keys(a).forEach(F=>{f[F]!==void 0&&(g[F]=f[F])}),Xo(f,a);let x=e.mode||e.shadow?Zo(f,e):void 0,y=vr(h,f,x);e.construct&&e.construct.call(f,x,y),Object.assign(f,g);let b=-1,O;for(;O=u[++b];){let F=f.attributes[O];F&&r[O].attribute.call(f,F.value)}e.connect&&e.connect.call(f,x,y)},d=function(f){Jo(f,n).forEach(m),new MutationObserver(()=>Jo(f,n).forEach(m)).observe(f,{childList:!0,subtree:!0})};h.polyfillByRoot=d,d(document)}}else h.polyfillByRoot=U;return h}var Dt=t=>typeof t;var cs=Object.defineProperties,Qo=D(Dt,{function:t=>t(),object:t=>t.stop()}),wt=class extends M{#t;stop(){if(this.status==="done")return this;this.status="done";let e=this.#t;return this.#t=void 0,e&&e.forEach(Qo),this}done(e){return this.status==="done"?(Qo(listener),this):((this.#t||(this.#t=[])).push(e),this)}};cs(wt.prototype,{status:{writable:!0}});function us(t){throw new TypeError("Stream cannot be created .from() "+typeof t)}function j(t,e){if(e===void 0)return;let r=-1;for(;t[++r];)t[r].push(e);return t}function ps(t){wt.prototype.stop.apply(t);let e=-1,r;for(;r=t[++e];)t[e]=void 0,r.stop&&($r(r,t),r[-1]||r.stop());return t}function $r(t,e){let r=0;for(;t[--r]&&t[r]!==e;);for(;t[r--];)t[r+1]=t[r]}function _o(t,e){let r=-1;for(;t[++r]&&t[r]!==e;);for(;t[r++];)t[r-1]=t[r]}function ls(t,e){$r(e,t),_o(t,e)}var qt=class extends wt{stop(){if(this.status==="done")return this;let e;for(;e=this[-1];){let r=-1;for(;this[r--];)this[r+1]=this[r];_o(e,this),e.stop&&!e[0]&&e.stop(e)}return super.stop()}},ge=class extends qt{constructor(e){super(),this.push=e}},we=class extends qt{constructor(e,r){super(),this.fn=e,this.value=r,this.i=0}push(e){let r=this.fn;this.value=r(this.value,e,this.i++,this)}},I=class extends qt{start(){if(this.status)return this;let e=0,r;t:for(;r=this[--e];){let o=-1;for(;r[++o];)if(r[o]===this)continue t;r[o]=this,o===0&&r.start&&r.start()}return this}stop(){if(this.status==="done")return this;super.stop();let e=-1,r;for(;r=this[++e];)this[e]=void 0,r.stop&&($r(r,this),r[-1]||r.stop());return this}pipe(e){if(e.stop){let o=0;for(;e[--o]&&e[o]!==this;);e[o]=this}if(e.start&&!(e[0]||e.status==="running"))return e;let r=-1;for(;this[++r]&&this[r]!==e;);return this[r]=e,r||this.start(),e}each(e){return this.pipe(new ge(e))}buffer(...e){return this.pipe(new Nt(e))}filter(e){return this.pipe(new Nr(e))}flatMap(e){return this.pipe(new Tr(e))}map(e){return this.pipe(new ye(e))}reduce(e,r){return this.pipe(new we(e,r)).value}scan(e,r){return this.pipe(new Br(e,r))}slice(e,r){return this.pipe(new kr(e,r))}split(e){return this.pipe(new Cr(e))}[Symbol.asyncIterator]=async function*(){let e=[],r=n=>e.push(n);function o(n,i){r=n}for(this.each(n=>r(n)).done(()=>r=U);r!==U;)yield e.length?e.shift():await new Promise(o)};static from=D(Dt,{function:e=>new ye(e),object:e=>typeof e.pipe=="function"?e:typeof e.then=="function"?new Dr(e):typeof e.length=="number"?new Nt(Array.from(e)):us(e)});static of(...e){return e.length<2?new xe(e[0]):new Nt(e)}static buffer(e){return new Nt(e)}static value(e){return new xe(e)}static merge(...e){return new Fr(e)}static push=j;static stop=ps;static unpipe=ls;static each(e){return new ge(e)}static reduce(e,r){return new we(e,r)}},Dr=class extends I{constructor(e){super(),this.promise=e}start(){return this.promise.then(e=>j(this,e)).finally(()=>this.stop()),this}},xe=class extends I{constructor(e){super(),this.value=e}start(){return this.value!==void 0&&(j(this,this.value),this.status==="done")?this:super.start()}push(e){return this.value=e,j(this,e)}},Nt=class extends I{constructor(e){super(),this.values=e||[]}start(){let e=this.values;if(!e)return super.start();let r=-1;for(;r++<e.length;)if(j(this,e[r]),this.status==="done")return this;return this.values=void 0,super.start()}push(e){return this.value=e,this.values?this.values.push(this.value):j(this,this.value)}},Nr=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn;return r(e)&&j(this,e)}},Tr=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);if(o!==void 0)if(isIterable(o))for(let n of o)j(this,n);else o.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(o.each(n=>j(this,n)))):o.then&&o.then(n=>j(this,n))}},ye=class extends I{constructor(e){super(),this.fn=e}push(e){let r=this.fn,o=r(e);return o!==void 0&&j(this,o)}},Fr=class extends I{constructor(e){super(),this.inputs=e}push(e){return j(this,e)}pipe(e){let r=-1,o;for(;o=this.inputs[++r];)I.from(o).pipe(this);return I.prototype.pipe.call(this,e)}},Br=class extends I{constructor(e,r){super(),this.fn=e,this.value=r}push(e){let r=this.fn;this.value=r(this.value,e),j(this,this.value)}},kr=class extends I{constructor(e,r=1/0){super(),this.index=-e,this.indexEnd=r-e}push(e){++this.index>0&&j(this,e),this.index===this.indexEnd&&this.stop()}},Cr=class extends I{constructor(e){super(),this.chunk=[],typeof e=="number"?this.n=e:this.fn=e}fn(){return this.chunk.length===this.n}push(e){let r=this.chunk;this.fn(e)?(j(this,r),this.chunk=[]):r.push(e)}};var Al={fullscreenchange:st(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},hs=0;window.addEventListener("click",t=>hs=t.timeStamp);function Mr(t){return function(){return arguments[t]}}function Gr(t){return t}function xt(){}function tt(){return this}var tn=Object.create,fs=Object.freeze,en=fs(tn(tn(Object.prototype,{at:{value:xt},shift:{value:xt},push:{value:xt},forEach:{value:xt},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:tt},find:{value:xt},findIndex:{value:function(){return-1}},flat:{value:tt},flatMap:{value:tt},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:tt},reduce:{value:Mr(1)},sort:{value:tt},each:{value:tt},pipe:{value:Gr},start:{value:tt},stop:{value:tt},done:{value:tt},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Or(t,e){return(e%t+t)%t}function Ee(t){if(typeof t=="number"&&(t=t+""),typeof t=="string")return t.trim().toLowerCase().normalize("NFKC").replace(/[\/\?#\[\]@!$&'()*+,;=\\\s\._]+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var rn=t=>Or(12,t);var ms=/^([A-G][â™­â™¯#b]?)(-?\d)$/,ds=/^[A-G][â™­â™¯#b]?/,gs=/-?\d$/,ws=/[Hh]z$/,Pt={C:0,"Câ™¯":1,"C#":1,"Dâ™­":1,Db:1,D:2,"Dâ™¯":3,"D#":3,"Eâ™­":3,Eb:3,E:4,F:5,"Fâ™¯":6,"F#":6,"Gâ™­":6,Gb:6,G:7,"Gâ™¯":8,"G#":8,"Aâ™­":8,Ab:8,A:9,"Aâ™¯":10,"A#":10,"Bâ™­":10,Bb:10,B:11},Ur={27:"High Q",28:"Slap",29:"Scratch push",30:"Scratch pull",31:"Sticks",32:"Square click",33:"Metronome click",34:"Metronome bell",35:"Low bass drum",36:"High bass drum",37:"Side stick",38:"Snare drum 1",39:"Hand clap",40:"Snare drum 2",41:"Low floor tom",42:"Closed hi-hat",43:"High floor tom",44:"Pedal hi-hat",45:"Low tom",46:"Open hi-hat",47:"Low mid tom",48:"High mid tom",49:"Crash cymbal 1",50:"High tom",51:"Ride cymbal 1",52:"Chinese cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash cymbal",56:"Cowbell",57:"Crash cymbal 2",58:"Vibra Slap",59:"Ride cymbal 2",60:"High bongo",61:"Low bongo",62:"Mute high conga",63:"Open high conga",64:"Low conga",65:"High timbale",66:"Low timbale",67:"High agogo",68:"Low agogo",69:"Cabasa",70:"Maracas",71:"Short whistle",72:"Long whistle",73:"Short guiro",74:"Long guiro",75:"Claves",76:"High wood block",77:"Low wood block",78:"Mute cuica",79:"Open cuica",80:"Mute triangle",81:"Open triangle",82:"Shaker",83:"Jingle bell",84:"Belltree",85:"Castanets",86:"Mute surdo",87:"Open surdo"};for(let t in Ur)Pt[Ee(Ur[t])]=parseInt(t,10);var xs=69;function ys(t,e=440){var r=xs+12*Math.log(t/e)/Math.log(2);return Math.fround(r)}function R(t){if(typeof t=="number")return t;if(ws.test(t))return ys(parseFloat(t));let e=ms.exec(t);return e?(parseInt(e[2],10)+1)*12+Pt[e[1]]:Pt[Ee(t)]}function H(t){return typeof t=="number"?rn(t):Pt[ds.exec(t)[0]]}var be=["C","Câ™¯","D","Eâ™­","E","F","Fâ™¯","G","Gâ™¯","A","Bâ™­","B"];function at(t){return W(t)+ve(t)}function W(t){return be[rn(t)]}function ve(t){return typeof t=="number"?Math.floor(t/12)-1:Pt[(gs.exec(name)||en)[0]]}function on(t){let e=R(t);return Ur[e]||""}function J(t){return Math.pow(10,t/20)}var Es=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function yt(t){return function(r){if(typeof r=="number")return r;var o=Es.exec(r);if(!o){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(r)}if(!t[o[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+r+'" (accepted units '+Object.keys(t).join(", ")+")");return t.catch(parseFloat(o[1]),o[2])}return t[o[2]||""](parseFloat(o[1]))}}var nn={fff:J(-4.5),ff:J(-9),f:J(-13.5),mf:J(-18),mp:J(-22.5),p:J(-27),pp:J(-31.5),ppp:J(-36)},pt=yt({"":parseFloat,db:J,dB:J,catch:t=>{if(!nn[t])throw new Error('Sequence: dynamic "'+t+'" not recognised');return nn[t]}});function lt(t,e){return(e%t+t)%t}function Re(t){return lt(12,t)}var Se=/b{1,2}|#{1,2}/g,bs={b:"â™­","#":"â™¯",bb:"ğ„«","##":"ğ„ª"};function Ae(t){return bs[t]}function vs(t,[e,r]){return t[r]=e,t}function et(t){return Object.entries(t).reduce(vs,{})}var K={sequence:1,note:2,param:3,rate:4,key:5,meter:6,chord:7,text:8,start:9,stop:10,clef:11},sn=et(K),Lr={2:16,5:1,6:4,7:18,9:8,10:8,11:1};function an(t){if(typeof t=="string")return t;if(t in sn)return sn[t];throw new Error(`Type ${t} not recognised`)}var k={step:0,linear:1,exponential:2,target:3,curve:4,hold:5,cancel:6},cn=et(k),un={0:4,1:4,2:4,3:12,5:0,6:0};function qr(t){return typeof t=="number"?cn[t]||"step":t}function Rs(t,e){return e[t]}var rt=Z(Rs,!0);var Ss=globalThis.DEBUG,{floor:hn,log:pn}=Math,Tt=36,ln=Tt-1,As=hn(pn(Number.MAX_SAFE_INTEGER)/pn(Tt))+1;function Pr(t){if(t.length<2)return t.length?0:-1;if(t.length>As)throw new Error("Cannot generate harmonic id, more than 11 notes "+t);let e=0,r=0,o=1;for(;++r<t.length;){let n=t[r]-t[r-1];if(n<1||n>ln)throw new Error(`Cannot generate harmonic id, interval out of range 1-${ln} `+t);e+=n*o,o*=Tt}return e}function w(){return Pr(arguments)}var Ir=st(t=>{if(Ss&&typeof t!="number")throw new Error(`hsidToNumbers() takes number, called with ${typeof t}`);if(t===-1)return Uint8Array.of();if(t===0)return Uint8Array.of(0);let e=2;for(;t>=Tt**(e-1);)++e;let r=new Uint8Array(e);r[0]=0;let o=1;for(;t>0;){let n=t%Tt;r[o]=r[o-1]+n,t=hn(t/Tt),++o}return r});var fh=globalThis.DEBUG,fn=[["",w(0,2,4,7)],["+",w(0,2,4,8)],["sus",w(0,2,5,7)],["susâ™­9",w(0,1,5,7)],["-",w(0,2,3,7)],["Â°",w(0,2,3,6)],["/{4}",w(0,3,8,10)],["/{7}",w(0,5,7,9)],["/{8}",w(0,4,8,11)],["-/{3}",w(0,4,9,11)],["-/{7}",w(0,5,7,8)],["/{11}",w(0,1,5,8)],["/{1}",w(0,3,6,11)],["7/{4}",w(0,3,6,8)],["Ã¸",w(0,3,6,10)],["âˆ†6",w(0,4,7,9)],["âˆ†",w(0,2,4,7,9,11)],["âˆ†6/9",w(0,2,4,7,9)],["âˆ†â™¯11",w(0,2,4,6,7,9,11)],["7sus",w(0,2,5,7,10)],["7",w(0,2,4,7,10)],["7susâ™­9",w(0,1,5,7,10)],["13",w(0,2,4,7,9,10)],["13sus",w(0,2,5,7,9,10)],["-6",w(0,2,3,5,7,9)],["-7",w(0,2,3,5,7,9,10)],["-11",w(0,2,3,5,10)],["7â™¯11",w(0,2,4,6,7,9,10)],["-âˆ†",w(0,2,3,5,7,9,11)],["7â™­13",w(0,2,4,5,7,8,10)],["13susâ™­9",w(0,1,3,5,7,9,10)],["+7",w(0,2,4,6,8,10)],["Â°7",w(0,2,3,5,6,8,9,11)],["7â™¯9",w(0,3,4,6,7,9,10)],["7alt",w(0,1,3,4,6,8,10)],["7â™­9",w(0,1,3,4,6,7,10)],["13â™­9",w(0,1,3,4,6,7,9,10)],["7â™­9â™­13",w(0,1,4,5,7,8,10)],["-â™­6",w(0,2,3,5,7,8,10)],["-â™­9",w(0,1,3,5,7,8,10)],["Ã¸9",w(0,2,3,5,6,8,10)],["âˆ†â™¯4â™¯5",w(0,2,4,6,8,9,11)],["-âˆ†â™­6",w(0,2,3,5,7,8,11)],["âˆ†â™¯5",w(0,2,4,8,11)],["âˆ†â™­6",w(0,2,4,5,7,8,11)]],De=Object.fromEntries(fn),Ds=et(De),Ns=/[()]/g;function Hr(t){return typeof t=="string"?De[t.replaceAll(Ns,"").replaceAll(Se,Ae)]:typeof t=="object"?Pr(t):t}function Ne(t){let e=Hr(t);return Ds[e]||""}var mh=fn.map(rt(1));var zr={0:"bank",1:"modulation",2:"breath",4:"foot",5:"portamento",7:"volume",8:"balance",10:"pan",11:"expression",64:"sustain",65:"portamento",66:"sostenuto",67:"soft",68:"legato",69:"hold",71:"harmonics",72:"release",73:"attack",74:"brightness",91:"reverb",92:"tremolo",93:"chorus",94:"detune",95:"phaser",120:"sound-off",121:"reset",122:"local",123:"notes-off",124:"omni-off",125:"omni-on",126:"monophonic",127:"polyphonic"},gh=Object.entries(zr).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});var Ts=Object.assign,jr=Ts({},zr,{3:"mute",6:"gain",9:"angle",12:"distance",13:"azimuth",14:"mix",15:"phase",16:"frequency",17:"Q",18:"depth",19:"cutoff",20:"type",21:"delay",22:"feedback",128:"stop",129:"start",130:"record",131:"pitch",132:"rate",133:"meter",134:"key",135:"touch"}),mn=Object.entries(jr).reduce((t,[e,r])=>(t[r]=parseInt(e,10),t),{});function dn(t){return typeof t=="number"&&jr[t]||t}var Te={"Fğ„«":-15,"Cğ„«":-14,"Gğ„«":-13,"Dğ„«":-12,"Ağ„«":-11,"Eğ„«":-10,"Bğ„«":-9,"Fâ™­":-8,"Câ™­":-7,"Gâ™­":-6,"Dâ™­":-5,"Aâ™­":-4,"Eâ™­":-3,"Bâ™­":-2,F:-1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6,"Câ™¯":7,"Gâ™¯":8,"Dâ™¯":9,"Aâ™¯":10,"Eâ™¯":11,"Bâ™¯":12,"Fğ„ª":13,"Cğ„ª":14,"Gğ„ª":15,"Dğ„ª":16,"Ağ„ª":17,"Eğ„ª":18,"Bğ„ª":19},Wr=et(Te);function gn(t){if(typeof t=="number"){if(t in Wr)return Wr[t];throw new Error(`Key ${t} not recognised`)}return Wr[ft(t)]}function ft(t){if(typeof t=="number")return t;let e=t.replaceAll(Se,Ae);if(e in Te)return Te[e];throw new Error(`Key "${t}" not recognised`)}function Fe(t){let e=ft(t);return lt(12,e*7)}function Be(t){let e=W(t);return Te[e]}var q={displace:1,rate:2,gain:3,quantize:4,transpose:5},Fs=et(q),wn={1:9,2:5,3:5,4:5,5:2},It={1:1,2:1,3:1,4:1,5:1};function xn(t){return typeof t=="number"&&Fs[t]||t}var yn=globalThis.DEBUG,ke=Object.defineProperty,Ce={writable:!0};function Bs(t){let e=[],r=-1;for(;t[++r]!==void 0;)e.push(t[r]);return e}function Ft(t){return t.toFixed(4).replace(/\.?0+$/,"")}function En(t){let e;for(;e=t.event;)t=e;return t}var S=class t{constructor(e,r){switch(this[0]=e,this[1]=an(r),this[1]){case"chord":this[2]=H(arguments[2]),this[3]=Hr(arguments[3]),this[4]=arguments[4]||0,arguments[5]&&(this[5]=arguments[5]||0);break;case"text":this[2]=arguments[2],this[3]=arguments[3];break;case"key":this[2]=ft(arguments[2]);break;case"note":this[2]=R(arguments[2]),this[3]=pt(arguments[3]),this[4]=arguments[4]||0;break;case"rate":this[2]=arguments[2],this[3]=qr(arguments[3]),(this[3]==="target"||this[3]==="curve")&&(this[4]=arguments[4]||0);break;case"param":this[2]=dn(arguments[2]),this[3]=arguments[3],this[4]=qr(arguments[4]),(this[4]==="target"||this[4]==="curve")&&(this[5]=arguments[5]||0);break;case"sequence":this[2]=arguments[2],this[3]=arguments[3],this[4]=arguments[4]||0;let o=5;for(;arguments[o]!==void 0;){this[o]=xn(arguments[o]);let n=q[this[o]],i=o+It[n];for(;o++<i;)this[o]=arguments[o]||0}break;case"start":case"stop":this[2]=R(arguments[2]),this[3]=pt(arguments[3]);break;default:this[2]=arguments[2],this[3]=arguments[3]}ke(this,"event",Ce),ke(this,"events",Ce),ke(this,"index",Ce),ke(this,"target",Ce)}move(e){let r=En(this);return r[0]=this[0]=this[0]+e,this}transpose(e){let r=En(this);switch(this[1]){case"chord":case"key":r[2]=this[2]=Re(this[2]+e);break;case"note":case"start":case"stop":r[2]=this[2]=this[2]+e;break;case"sequence":console.log("TODO: transpose sequence");break}return this}*[Symbol.iterator](){let e=-1;for(;this[++e]!==void 0;)yield this[e]}toJSON(){return Bs(this)}toString(){let e=Ft(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+W(this[2])+" "+Ne(this[3])+" "+Ft(this[4]);break;case"key":e+=" "+gn(this[2]);break;case"note":e+=" "+at(this[2])+" "+this[3]+" "+Ft(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+Ft(this[4])+" "+this[5];break;case"rate":e+=" "+Ft(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+Ft(this[4]);break;case"start":case"stop":e+=" "+at(this[2])+" "+this[3];break;default:let r=1;for(;this[++r]!==void 0;)e+=this[r]}return e}static of(...e){return new t(...e)}static from(e,r,o){if(yn&&r!==void 0&&typeof r!="number")throw new Error("Event() cannot create event with index "+r);if(yn&&o!==void 0&&typeof o!="object")throw new Error("Event() cannot create event with events "+o);let n=new t(...e);return n.event=e,n.events=o,n.index=r,n}static isChord=Kr;static isNote=$e;static isSequence=Vr};function Kr(t){return t[1]==="chord"}function $e(t){return t[1]==="note"}function Vr(t){return t[1]==="sequence"}function ks(t,e){let r;for(r in t)if(t[r]!==e[r])return!1;return!0}var Ht=Z(ks,!0);var bn=D((t,e)=>e[1],{note:(t,e)=>(e[2]=R(e[2])+t,e),chord:(t,e)=>(e[2]=H(H(e[2])+t),e[5]!==void 0&&(e[5]=H(H(e[2])+t)),e),key:(t,e)=>(e[2]=H(H(e[2])+t),e),default:M});var Cs={displace:(t,e,r)=>(r[0]-=t[++e],e),rate:(t,e,r)=>{switch(r[0]/=t[++e],r[1]){case"chord":case"note":case"sequence":r[4]/=t[e];break;case"text":r[3]/=t[e];break}return e},gain:(t,e,r)=>{switch(++e,r[1]){case"note":r[3]*=pt(t[e]);break}return e},quantize:(t,e,r)=>{},transpose:(t,e,r)=>(bn(t[e+1],r),e+1)};function zt(t,e){let r=-1,o;for(;o=t[++r];)r=Cs[o](t,r,e);return e}var vn=Object.assign,Rn=[],$s={done:!0,value:void 0},Sn={key:2,meter:1,default:0},Ms={};function An(t){return Sn[t[1]]||Sn.default}function Dn(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:An(e)-An(t)}function Nn(t,e){let r=-1;for(;t[++r]&&Dn(t[r],e)<1;);return t.splice(r,0,e),r}function Gs(t,e){let r=[],o=t-1;for(;e[++o]!==void 0;)r.push(e[o]);return r}function Os(t,e){return t.find(r=>r.id===e)}var Et=class t{constructor(e,r=Rn,o=Rn){e.sort(Dn),this.events=e,this.sequences=r,this.transforms=o;let n=-1,i;for(;(i=e[++n])&&zt(o,vn(Ms,i))[0]<0;);this.n=n-1}next(){let{events:e,sequences:r,transforms:o,n}=this,i=e[n+1],s=i&&zt(o,S.from(i,n+1,e)),u,a=-1,c=0,l=s?s[0]:1/0,h;for(;u=this[++a];){let p=u.value;p||((p=u.next().value)&&(zt(this.transforms,p),p[0]+=u.startBeat,p.target=(p.target||0)+u.target),(u.done||p[0]>=u.stopBeat)&&++c),p&&p[0]<u.stopBeat&&p[0]<l&&(h=u,l=p[0]),c&&(this[a]=this[a+c])}if(h)return this.value=h.value,h.value=void 0,this;if(!s)return vn(this,$s);if(this.n+=1,this.value=s,Vr(i)){let p=this.sequences,m=Os(p,i[2]);if(!m)throw new Error('Sequence id "'+i[2]+'" not found');let d=new t(m.events,m.sequences?m.sequences.concat(p):p,Gs(5,i));d.startBeat=s[0],d.stopBeat=s[0]+s[4],d.target=s[3];let f=-1;for(;this[++f];);this[f]=d}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};var Us=Object.assign;var Q=class t{constructor(e,r){this.events=e.map(S.from),r&&(this.sequences=r.map(t.from))}create(){let e=new S(...arguments);return Nn(this.events,e),e}delete(e,r){r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2]));let o=this.events.findIndex(Ht(arguments));return o>-1&&this.events.splice(o,1),this}find(e,r){return r==="note"&&arguments[2]!==void 0&&(arguments[2]=R(arguments[2])),this.events.find(Ht(arguments))}get(e){return this.sequences&&this.sequences.find(Ht({id:e}))}select(e,r){return this.events.filter(Ht({0:e,1:r}))}static of(...e){return new t(e)}static from(e){let{events:r,sequences:o,...n}=e;return e.length?new t(e):Us(new t(r,o),n)}[Symbol.iterator](){return new Et(this.events,this.sequences)}};var Ls=2,qs=10,Tn=4,wf=(1<<Ls)-1,Ps=(1<<qs)-1,Is=(1<<Tn)-1;function Me(t,e,r){return t<<14|e<<4|r}function Fn(t){return t>>14}function Bn(t){return t>>Tn&Ps}function Ge(t){return t&Is}function Xr(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[],o=0;for(;o<t.length;){let n=e.getFloat64(o,!0);o+=8;let i=e.getUint16(o,!0);o+=2;let s=Fn(i),u=Bn(i);switch(s){case 0:switch(u){case K.note:r.push(S.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0),e.getFloat64(o+8,!0))),o+=16;break;case K.meter:r.push(S.of(n,u,e.getFloat16(o,!0),e.getFloat16(o+2,!0))),o+=4;break;case K.chord:r.push(S.of(n,u,t[o],e.getFloat64(o+1,!0),e.getFloat64(o+9,!0),t[o+17])),o+=18;break;case K.key:r.push(S.of(n,u,e.getInt8(o))),o+=1;break;case K.clef:r.push(S.of(n,u,t[o])),o+=1;break;case K.sequence:{let a=e.getUint16(o,!0),c=e.getUint16(o+2,!0),l=e.getFloat64(o+4,!0),h=t[o+12],p=[n,u,a,c,l];o+=13;let m=0;for(;m<h;){let d=t[o+m];switch(m+=1,p.push(d),d){case q.displace:p.push(e.getFloat64(o+m,!0)),m+=8;break;case q.rate:case q.gain:case q.quantize:p.push(e.getFloat32(o+m,!0)),m+=4;break;case q.transpose:p.push(e.getInt8(o+m)),m+=1;break;default:throw new Error(`Unknown transform number: ${d}`)}}r.push(S.from(p)),o+=h;break}case K.text:{let a=e.getFloat64(o,!0),c=t[o+8];o+=9;let l=t.subarray(o,o+c);r.push(S.of(n,u,new TextDecoder().decode(l),a)),o+=c;break}case K.start:case K.stop:r.push(S.of(n,u,e.getFloat32(o,!0),e.getFloat32(o+4,!0))),o+=8;break;default:{let a=Ge(i);switch(a){case k.step:case k.linear:case k.exponential:r.push(S.of(n,u,e.getFloat32(o,!0),a)),o+=4;break;case k.target:r.push(S.of(n,u,e.getFloat32(o,!0),a,e.getFloat64(o+4,!0))),o+=12;break;case k.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(S.of(n,u,p,a,c));break;default:r.push(S.of(n,u,void 0,a));break}break}}break;case 1:{let a=Ge(i);switch(a){case k.step:case k.linear:case k.exponential:r.push(S.of(n,"param",u,e.getFloat32(o,!0),a)),o+=4;break;case k.target:r.push(S.of(n,"param",u,e.getFloat32(o,!0),a,e.getFloat64(o+4,!0))),o+=12;break;case k.curve:let c=e.getFloat64(o,!0),l=e.getUint16(o+8,!0);if(o+=10,l<8)throw new Error(`Invalid bytes count ${l} (must hold at least 2 * Float32 bytes)`);if(l%4!==0)throw new Error(`Invalid bytes count ${l} (must hold n * Float32 bytes)`);let h=t.slice(o,o+l),p=new Float32Array(h.buffer);o+=l,r.push(S.of(n,"param",u,p,a,c));break;default:r.push(S.of(n,"param",u,void 0,a));break}break}default:throw new Error(`Cannot deserialise unknown address ${s}.${u}.${Ge(i)}`)}}return r}var kn=255;function Cn(t,e){if(t.length<=e)return t;let r=e;for(;r>0&&(t[r]&192)===128;)r--;return t.slice(0,r)}function Hs(t){let e=t[1],r=K[e],o=10;if(r in Lr)return o+Lr[r];let n;switch(e){case"text":{let i=new TextEncoder().encode(t[2]),s=Cn(i,kn);return o+8+1+s.length}case"sequence":{for(o+=13,n=4;t[++n]!==void 0;){let i=q[t[n]];o+=wn[i],n+=It[i]}return o}case"param":n=4;case"rate":n===void 0&&(n=3);default:{let i=typeof t[n]=="string"?k[t[n]]||0:t[n]||0;return i===k.curve?o+8+2+t[n-1].length*4:o+un[i]}}}function zs(t){let e=t[1];switch(e){case"param":{let r=typeof t[2]=="string"?mn[t[2]]||0:t[2],o=typeof t[4]=="string"?k[t[4]]||0:t[4];return Me(1,r,o)}case"rate":{let r=K[e],o=typeof t[3]=="string"?k[t[3]]||0:t[3]||0;return Me(0,r,o)}default:{let r=K[e];if(r===void 0)throw new Error(`Event type ${e} not recognised`);return Me(0,r,0)}}}function Yr(t){let e=0;for(let u of t)e+=Hs(u);let r=new Uint8Array(e),o=new DataView(r.buffer),n=-1,i,s=0;for(;i=t[++n];){i instanceof S||(i=S.from(i)),o.setFloat64(s,i[0],!0),s+=8;let u=zs(i);switch(o.setUint16(s,u,!0),s+=2,i[1]){case"note":o.setFloat32(s,i[2],!0),o.setFloat32(s+4,i[3],!0),o.setFloat64(s+8,i[4],!0),s+=16;break;case"param":case"rate":{let c=i[1]==="rate"?2:3;switch(typeof i[c+1]=="string"?k[i[c+1]]||0:i[c+1]||0){case k.step:case k.linear:case k.exponential:o.setFloat32(s,i[c],!0),s+=4;break;case k.target:o.setFloat32(s,i[c],!0),o.setFloat64(s+4,i[c+2]||0,!0),s+=12;break;case k.curve:o.setFloat64(s,i[c+2]||0,!0),s+=8;let h=i[c],p=h.length*4;o.setUint16(s,p,!0),s+=2;let m=-1;for(;h[++m]!==void 0;)o.setFloat32(s+m*4,h[m],!0);s+=p;break}break}case"meter":o.setFloat16(s,i[2],!0),o.setFloat16(s+2,i[3],!0),s+=4;break;case"chord":{let c=typeof i[2]=="number"?i[2]:0;r[s]=c;let l=typeof i[3]=="string"?De[i[3]]||0:i[3];o.setFloat64(s+1,l,!0),o.setFloat64(s+9,i[4],!0);let h=typeof i[5]=="number"?i[5]:0;r[s+17]=h,s+=18;break}case"key":{o.setInt8(s,ft(i[2])),s+=1;break}case"sequence":{o.setUint16(s,i[2],!0),o.setUint16(s+2,i[3],!0),o.setFloat64(s+4,i[4],!0),s+=12;let c=s;s+=1;let l=4;for(;i[++l]!==void 0;){let h=i[l],p=typeof h=="string"?q[h]:h;if(p===void 0)throw new Error(`Transform name "${h}" not recognised`);switch(r[s]=p,s+=1,p){case q.displace:o.setFloat64(s,i[l+1],!0),s+=8;break;case q.rate:case q.gain:case q.quantize:o.setFloat32(s,i[l+1],!0),s+=4;break;case q.transpose:o.setInt8(s,i[l+1]),s+=1;break;default:throw new Error(`Transform number ${p} not recognised`)}l+=It[p]}r[c]=s-c-1;break}case"text":{let c=new TextEncoder().encode(i[2]),l=Cn(c,kn);o.setFloat64(s,i[3],!0),r[s+8]=l.length,r.set(l,s+9),s+=9+l.length;break}case"start":case"stop":o.setFloat32(s,i[2],!0),o.setFloat32(s+4,i[3],!0),s+=8;break;case"clef":let a=typeof i[2]=="number"?i[2]:0;r[s]=a,s+=1;break}}return r}var $n={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.sequence",defs:{main:{type:"record",description:"A sequence of timed events. Full documentation at https://github.com/soundio/sequence/.",key:"any",record:{type:"object",required:["events"],properties:{id:{type:"integer",description:'Identifies this sequence for playback by a "sequence" event.',maximum:65535},url:{type:"string",format:"uri",description:"Canonical location of this sequence. May be an `at://` URI or an `https://` URL to a JSON endpoint."},name:{type:"string",description:"Name of the sequence",maxLength:1280,maxGraphemes:640},version:{type:"integer",description:"Version number for the byte array encoding of the events field."},events:{type:"bytes",description:"Serialised and binary encoded array of events of the form `[beat, type, data...]`, where `data` parameters depend on `type` and the byte layout of the serialised data conforms to the Sequence spec at https://github.com/soundio/sequence.",maxLength:524288},sequences:{type:"array",description:'A collection of sequences that may be played back by "sequence" events.',items:{type:"ref",ref:"io.sound.sequence"}},credits:{type:"array",description:"Attribution for composers, arrangers, etc",maxLength:60,items:{type:"ref",ref:"io.sound.credit"}},bskyPostRef:{type:"ref",ref:"com.atproto.repo.strongRef",description:"Strong reference to a Bluesky post. Useful to keep track of comments off-platform."},publishedAt:{type:"string",format:"datetime",description:"Timestamp of the time of publication."},updatedAt:{type:"string",format:"datetime",description:"Timestamp of the time of last edit."},tags:{type:"array",description:"Array of strings used to tag the sequence.",items:{type:"string",maxLength:1280,maxGraphemes:128}}}}}}};var Mn={$type:"com.atproto.lexicon.schema",lexicon:1,id:"io.sound.credit",defs:{main:{type:"object",description:"Attribution for a creative work",required:["name","role"],properties:{name:{type:"string",description:"Name of the credited person",maxLength:640,maxGraphemes:320},role:{type:"string",description:"Role: composer, lyricist, arranger, etc",maxLength:64,maxGraphemes:32,knownValues:["composer","arranger","lyricist","transcriber","orchestrator","adapter","artist","producer"]},url:{type:"string",format:"uri",description:"URL to credited person's profile or website"}}}}};var Gn=Object.assign,On=$n.defs.main.record,Ks=Mn.defs.main,Vs=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$/,Xs=/^at:\/\/[^/\s]+(\/([\w.-]+)(\/[\w.-]+)?)?$/,Ys=/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/,Zs=/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/,Js=["alt","arpa","example","internal","invalid","local","localhost","onion"],Qs=new Intl.Segmenter(void 0,{granularity:"grapheme"});function Oe(t){return[...Qs.segment(t)].length}var _s=new TextEncoder;function Bt(t){return _s.encode(t).byteLength}var ta=D(M,{datetime:(t,e,r)=>{if(!Vs.test(r))throw new Error(`Record "${e}" invalid datetime format "${r}"`);if(r.includes("t")||r.endsWith("z")&&!r.endsWith("Z"))throw new Error(`Record "${e}" datetime must use uppercase T and Z`)},uri:(t,e,r)=>{if(Bt(r)>8192)throw new Error(`Record "${e}" URI exceeds 8KB maximum`);try{new URL(r)}catch(o){throw new Error(`Record "${e}" ${o.message}`)}},"at-uri":(t,e,r)=>{if(Bt(r)>8192)throw new Error(`Record "${e}" AT URI exceeds 8KB maximum`);if(!r.startsWith("at://"))throw new Error(`Record "${e}" AT URI must start with at://`);if(!Xs.test(r))throw new Error(`Record "${e}" invalid AT URI format`)},handle:(t,e,r)=>{if(r.length>253)throw new Error(`Record "${e}" handle exceeds 253 characters`);if(!Ys.test(r))throw new Error(`Record "${e}" invalid handle format`);let o=r.split(".").pop().toLowerCase();if(Js.includes(o))throw new Error(`Record "${e}" handle has disallowed TLD "${o}"`)},nsid:(t,e,r)=>{if(r.length>317)throw new Error(`Record "${e}" NSID "${r}" exceeds 317 characters`);if(!Zs.test(r))throw new Error(`Record "${e}" Invalid NSID format "${r}"`)}}),Un=D(rt("type"),{boolean:(t,e,r)=>{if(typeof r!="boolean")throw new Error(`Record "${e}" not of type "boolean"`);if(t.const!==void 0&&r!==t.const)throw new Error(`Record "${e}" must be ${t.const}`)},integer:(t,e,r)=>{if(!Number.isInteger(r))throw new Error(`Record "${e}" not of type "integer" but type "${typeof r}"`);if(t.minimum!==void 0&&r<t.minimum)throw new Error(`Record "${e}" is ${r}, minimum ${t.minimum}`);if(t.maximum!==void 0&&r>t.maximum)throw new Error(`Record "${e}" is ${r}, maximum ${t.maximum}`);if(t.enum&&!t.enum.includes(r))throw new Error(`Record "${e}" must be one of [${t.enum.join(", ")}]`)},string:(t,e,r)=>{if(typeof r!="string")throw new Error(`Record "${e}" not of type "string"`);if(t.minLength&&Bt(r)<t.minLength)throw new Error(`Record "${e}" has ${Bt(r)} bytes, minimum ${t.minLength}`);if(t.maxLength&&Bt(r)>t.maxLength)throw new Error(`Record "${e}" has ${Bt(r)} bytes, maximum ${t.maxLength}`);if(t.minGraphemes&&Oe(r)<t.minGraphemes)throw new Error(`Record "${e}" has ${Oe(r)} graphemes, minimum ${t.minGraphemes}`);if(t.maxGraphemes&&Oe(r)>t.maxGraphemes)throw new Error(`Record "${e}" has ${Oe(r)} graphemes, maximum ${t.maxGraphemes}`);t.format&&ta(t.format,e,r)},bytes:(t,e,r)=>{if(!(r&&typeof r=="object"&&"$bytes"in r))throw new Error(`Record "${e}" not of type "bytes"`);if(typeof r.$bytes!="string")throw new Error(`Record "${e}".$bytes must be a string`);let o=r.$bytes.length*.75;if(t.minLength&&o<t.minLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, minimum ${t.minLength}`);if(t.maxLength&&o>t.maxLength)throw new Error(`Record "${e}" has ${Math.floor(o)} bytes, maximum ${t.maxLength}`)},array:(t,e,r)=>{if(!Array.isArray(r))throw new Error(`Record "${e}" not of type "array"`);if(t.minLength&&r.length<t.minLength)throw new Error(`Record "${e}" has ${r.length} items, minimum ${t.minLength}`);if(t.maxLength&&r.length>t.maxLength)throw new Error(`Record "${e}" has ${r.length} items, maximum ${t.maxLength}`);t.items&&r.forEach((o,n)=>{Un(t.items,`${e}[${n}]`,o)})},object:(t,e,r)=>{if(typeof r!="object"||r===null||Array.isArray(r))throw new Error(`Record "${e}" not of type "object"`);Ue(t,r)},ref:(t,e,r)=>{switch(t.ref){case"io.sound.sequence":Ue(On,r);break;case"io.sound.credit":Ue(Ks,r);break;default:console.log(`External schema ref ${t.ref} not validated`)}}});function ea(t=[],e){let r;for(r of t)if(!(r in e))throw new Error(`Record missing required "${r}" property`)}function Ue(t,e){let{type:r,required:o,properties:n}=t;if(r!=="object")throw new Error(`Attempting to validate object with schema of type "${r}"`);ea(o,e);let i,s;for(i in e)i in n&&(s=n[i],Un(s,i,e[i]))}var jt=0;function Zr(t){return Ue(On,t)}function Le(t){let{events:e,sequences:r,...o}=t;return Gn(o,{version:jt,events:{$bytes:Yr(e).toBase64()}}),Zr(o),r&&(o.sequences=r.map(Le)),o}function Jr(t){let{version:e,events:r,sequences:o,...n}=t;if(e!==jt)throw new Error(`Cannot decode record version ${e} with decoder version ${jt}`);let i=Uint8Array.fromBase64(r.$bytes);return Gn(new Q(Xr(i),o),n)}var Ln=Object.assign,ra=Q.from;Q.from=function(e){return e.events&&typeof e.events.$bytes=="string"?Jr(e):ra(e)};Ln(Q,{version:jt,toRecord:Le,fromRecord:Jr,validateRecord:Zr});Ln(Q.prototype,{toRecord:function(){return Le(this)}});function Qr(t){var e={};return function(o){return o in e?e[o]:e[o]=t(o)}}function qe(t){return function(r,...o){var n=t[r]||t.default;return n&&n.apply(this,o)}}var oa={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function _r(t,e){if(e){var r=oa[t.toLowerCase()]||t,o;try{o=new window.DOMParser().parseFromString(e,r)}catch{return}if(!o||o.getElementsByTagName("parsererror").length)throw new Error("Invalid "+t.toUpperCase()+": "+e);return o}}function qn(t){return _r("html",t)}function Pn(t){return _r("svg",t)}var ht=Object.assign,kt={headers:function(t){return{}},body:M},na=qe({"application/x-www-form-urlencoded":function(t){return ht(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(t){return ht(t,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(t){return ht(t,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(t){return ht(t,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(t){return ht(t,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(t){return ht(t,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(t){return ht(t,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(t){return ht(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),ia=qe({"application/json":function(t){return t instanceof FormData?sa(t):JSON.stringify(t)},"application/x-www-form-urlencoded":function(t){return t instanceof FormData?Hn(t):zn(t)},"multipart/form-data":function(t){return t instanceof FormData?t:aa(t)},default:M});function sa(t){return JSON.stringify(Array.from(t.entries()).reduce(function(e,r){return e[r[0]]=r[1],e},{}))}function Hn(t){return new URLSearchParams(t).toString()}function zn(t){return Object.keys(t).reduce((e,r)=>(e.append(r,t[r]),e),new URLSearchParams)}function aa(t){throw new Error("TODO: dataToFormData(data)")}function ca(t,e){return e instanceof FormData?t+"?"+Hn(e):t+"?"+zn(e)}function ua(t,e,r,o){let n=typeof r=="string"?r:r&&r["Content-Type"]||"application/json",i=na(n,ht(kt.headers&&e?kt.headers(e):{},typeof r=="string"?{}:r)),s={method:t,mode:"cors",headers:i,credentials:"same-origin",signal:o&&o.signal};return t!=="GET"&&(s.body=ia(n,kt.body?kt.body(e):e)),s}function Pe(t){return t.blob()}function pa(t){return t.json().catch(e=>{throw new Error("Cannot parse JSON "+t.url+". "+e.message)})}function In(t){return t.formData()}function la(t){return t.text()}function ha(t){return t.text().then(e=>/^\s*<!DOCTYPE html>/.test(e)?qn(e):v("fragment",e))}function fa(t){return t.text().then(e=>/^\s*<\?xml/.test(e)?Pn(e):(console.warn("Untested SVG fragment parsing in request.js!"),v("fragment",e)))}var ma={"text/plain":la,"text/html":ha,"image/svg+xml":fa,"application/json":pa,"multipart/form-data":In,"application/x-www-form-urlencoded":In,audio:Pe,"audio/wav":Pe,"audio/m4a":Pe,"application/zip":Pe};function da(t){if(kt.onresponse&&(t=kt.onresponse(t)),!t.ok)throw new Error(t.statusText+"");let e=t.headers.get("Content-Type");if(!e)return;let r=e.replace(/\;.*$/,"");return ma[r](t)}function jn(t="GET",e,r={},o="application/json"){t=t.toUpperCase(),t==="GET"&&r&&(e=ca(e,r));let n=ua(t,r,o,arguments[4]);return fetch(e,n).then(da)}function Wn(t){return jn("GET",t)}var ga={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},wa=/^[ABCDEFG][bâ™­#â™¯]{0,1}-?\d$/,Kn=/^[ABCDEFG][bâ™­#â™¯]{0,1}/;function to(t){let e=t.trim().split(/\s+/),r=[],o=-1;for(;e[++o]!==void 0;){let n=Number(e[o]),i=e[++o];wa.test(i)?(i="note",--o):Kn.test(i)&&(i="chord",--o);let s=[n,i],u=ga[i];if(u===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let a=Kn.exec(e[++o])[0],c=e[o].slice(a.length)||e[++o],l=Number(e[++o]);s.push(a,c,l)}else for(;u--;){let a=Number(e[++o]);s.push(Number.isNaN(a)?e[o]:a)}r.push(s)}return r}function xa(t){let e=t.files[Object.keys(t.files)[0]];return bt(e.type,e.content)}function ya(t){let e=t.settings.find(matches({id:13324}))||t.settings[0];return bt("abc",e.abc)}function bt(t,e){if(typeof e=="object")return e.files?xa(e):e.settings?ya():Array.isArray(e)?{id:0,events:e}:e;if(t==="sequence"||t==="text/plain")return{events:to(e)};{let r=JSON.parse(e);return Array.isArray(r)?{id:0,events:r}:r}}var Ea=Qr(Wn);var Vn=D((t,e)=>typeof e,{string:function(t,e){return Ea(e).then(r=>bt(t,r)).catch(r=>console.error(r))},default:function(t,e,r,o){e[t]=o}});var ba=/^(\d+)\/(\d+)$/;function Xn(t){let e=ba.exec(t),r=parseInt(e[1],10),o=4/parseInt(e[2],10);return{1:"meter",2:r*o,3:o}}function Yn(t){let e=t[2],r=t[3],o=e/r,n=4/r;return o+"/"+n}var G={};Ii(G,{accentDown:()=>ze,accentUp:()=>He,acciDoubleFlat:()=>Zt,acciDoubleSharp:()=>_t,acciFlat:()=>Jt,acciNatural:()=>Ct,acciParensLeft:()=>Ma,acciParensRight:()=>Ga,acciSharp:()=>Qt,augmentationDot:()=>rc,barLine:()=>Fc,barRepeat1:()=>Bc,barRepeat2:()=>kc,barRepeat4:()=>Cc,barRepeatBegin:()=>Oc,barRepeatDots:()=>qc,barRepeatEnd:()=>Uc,barRepeatEndBegin:()=>Lc,barRepeatLowerDot:()=>Gc,barRepeatSlash:()=>$c,barRepeatUpperDot:()=>Mc,chordAugmented:()=>Qc,chordBassSlash:()=>po,chordBracketLeft:()=>ou,chordBracketRight:()=>nu,chordDiminished:()=>Zc,chordGlyphs:()=>iu,chordHalfDiminished:()=>Jc,chordMajorSeventh:()=>_c,chordMinor:()=>tu,chordParensLeftTall:()=>eu,chordParensRightTall:()=>ru,clefAlto:()=>Xt,clefBass:()=>Yt,clefDrum:()=>Ie,clefTreble:()=>Wt,clefTrebleDown:()=>Kt,clefTrebleUp:()=>Vt,coda:()=>uo,graceNoteStemDown:()=>dc,graceNoteStemUp:()=>mc,head1:()=>eo,head2:()=>ro,head4:()=>oo,headBracketLeft:()=>te,headBracketRight:()=>ee,headCircle:()=>Ia,headCircleX:()=>Ha,headDiamond:()=>Ua,headDiamondWide:()=>La,headPlus:()=>Pa,headSlashHorizontalEnds:()=>Wa,headSlashVerticalEnds:()=>ja,headSlashed2:()=>Oa,headTriangleUp:()=>za,headX:()=>qa,marcatoDown:()=>We,marcatoUp:()=>je,metDot:()=>fc,metNote05Down:()=>hc,metNote05Up:()=>uc,metNote1Down:()=>lc,metNote1Up:()=>cc,metNote2Down:()=>pc,metNote2Up:()=>ac,note0125Down:()=>ec,note0125Up:()=>Za,note025Down:()=>tc,note025Up:()=>Ya,note05Down:()=>_a,note05Up:()=>Xa,note1Down:()=>Qa,note1Up:()=>Va,note2Down:()=>Ja,note2Up:()=>Ka,rest0125:()=>no,rest01875:()=>vc,rest025:()=>io,rest0375:()=>Rc,rest05:()=>so,rest075:()=>Sc,rest1:()=>ao,rest15:()=>Ac,rest2:()=>co,rest3:()=>Dc,rest4:()=>Nc,rest6:()=>Tc,staccatoDown:()=>nc,staccatoUp:()=>oc,tailDown0125:()=>bc,tailDown025:()=>yc,tailDown05:()=>wc,tailUp0125:()=>Ec,tailUp025:()=>xc,tailUp05:()=>gc,tenutoDown:()=>sc,tenutoUp:()=>ic,textBeam16Long:()=>du,textBeam16Short:()=>mu,textBeam8Long:()=>fu,textBeam8Short:()=>hu,textDot:()=>gu,textNote16Long:()=>lu,textNote16Short:()=>pu,textNote8Long:()=>uu,textNote8Short:()=>cu,textNoteLong:()=>au,textNoteShort:()=>su,textTie:()=>wu,textTuplet3Long:()=>vu,textTuplet3Short:()=>yu,textTupletBeginLong:()=>bu,textTupletBeginShort:()=>xu,textTupletEndLong:()=>Ru,textTupletEndShort:()=>Eu,timeSig0:()=>va,timeSig1:()=>Ra,timeSig2:()=>Sa,timeSig3:()=>Aa,timeSig4:()=>Da,timeSig5:()=>Na,timeSig6:()=>Ta,timeSig7:()=>Fa,timeSig8:()=>Ba,timeSig9:()=>ka,timeSigCommon:()=>Ca,timeSigCutCommon:()=>$a,tuplet0:()=>Pc,tuplet1:()=>Ic,tuplet2:()=>Hc,tuplet3:()=>zc,tuplet4:()=>jc,tuplet5:()=>Wc,tuplet6:()=>Kc,tuplet7:()=>Vc,tuplet8:()=>Xc,tuplet9:()=>Yc});var Wt="&#xE050;",Kt="&#xE052;",Vt="&#xE053;",Xt="&#xE05C;",Yt="&#xE062;",Ie="&#xE069;",va="&#xE080;",Ra="&#xE081;",Sa="&#xE082;",Aa="&#xE083;",Da="&#xE084;",Na="&#xE085;",Ta="&#xE086;",Fa="&#xE087;",Ba="&#xE088;",ka="&#xE089;",Ca="&#xE08A;",$a="&#xE08B;",Zt="&#xE264;",Jt="&#xE260;",Ct="&#xE261;",Qt="&#xE262;",_t="&#xE263;",Ma="&#xE26A;",Ga="&#xE26B;",eo="&#xE0A4;",ro="&#xE0A3;",oo="&#xE0A2;",te="&#xE0F5;",ee="&#xE0F6;",Oa="&#xE0D0;",Ua="&#xE0DB;",La="&#xE0DC;",qa="&#xE0A9;",Pa="&#xE0AF;",Ia="&#xE0E8;",Ha="&#xE0B3;",za="&#xE0BE;",ja="&#xE100;",Wa="&#xE101;",Ka="&#xE1D3;",Va="&#xE1D5;",Xa="&#xE1D7;",Ya="&#xE1D9;",Za="&#xE1DB;",Ja="&#xE1D4;",Qa="&#xE1D6;",_a="&#xE1D8;",tc="&#xE1DA;",ec="&#xE1DC;",rc="&#xE1E7;",He="&#xE4A0;",ze="&#xE4A1;",oc="&#xE4A2;",nc="&#xE4A3;",ic="&#xE4A4;",sc="&#xE4A5;",je="&#xE4AC;",We="&#xE4AD;",ac="&#xECA3;",cc="&#xECA5;",uc="&#xECA7;",pc="&#xECA4;",lc="&#xECA6;",hc="&#xECA8;",fc="&#xECB7;",mc="&#xE560;",dc="&#xE561;",gc="&#xE240;",wc="&#xE241;",xc="&#xE242;",yc="&#xE243;",Ec="&#xE244;",bc="&#xE245;",no="&#xE4E8;",vc="&#xE4E8;&#xE1E7;",io="&#xE4E7;",Rc="&#xE4E7;&#xE1E7;",so="&#xE4E6;",Sc="&#xE4E6;&#xE1E7;",ao="&#xE4E5;",Ac="&#xE4E5;&#x200A;&#xE1E7;",co="&#xE4E4;",Dc="&#xE4E4;&#x200A;&#xE1E7;",Nc="&#xE4E3;",Tc="&#xE4E3;&#x200A;&#xE1E7;",Fc="&#xE030",Bc="&#xE500;",kc="&#xE501;",Cc="&#xE502;",$c="&#xE504;",Mc="&#xE503;",Gc="&#xE505;",Oc="&#xE040",Uc="&#xE041",Lc="&#xE042",qc="&#xE043",uo="&#xE048",Pc="&#xE880;",Ic="&#xE881;",Hc="&#xE882;",zc="&#xE883;",jc="&#xE884;",Wc="&#xE885;",Kc="&#xE886;",Vc="&#xE887;",Xc="&#xE888;",Yc="&#xE889;",Zc="&#xE870;",Jc="&#xE871;",Qc="&#xE872;",_c="&#xE873;",tu="&#xE874;",eu="&#xE875;",ru="&#xE876;",ou="(",nu=")",po="&#xE87B;",iu={"âˆ†â™¯11":"î¡³îµ¢11","âˆ†":"î¡³",7:"7","-7":"î¡´7","-â™­6":"î¡´îµ 6","7susâ™­9":"7susîµ¢",Ã¸:"î¡±","7â™¯11":"7îµ¢11","-âˆ†":"î¡´î¡³","âˆ†â™­6":"î¡³îµ 6","-â™­9":"î¡´îµ 9",Ã¸7:"î¡±7","âˆ†â™¯5":"î¡³îµ¢5","7alt":"7alt","Â°":"î¡°",dim:"î¡°","7â™­9":"7îµ ","+7":"î¡²7"},su="&#xE1F0;",au="&#xE1F1;",cu="&#xE1F2;",uu="&#xE1F3;",pu="&#xE1F4;",lu="&#xE1F5;",hu="&#xE1F7;",fu="&#xE1F8;",mu="&#xE1F9;",du="&#xE1FA;",gu="&#xE1FC;",wu="&#xE1FD;",xu="&#xE1FE",yu="&#xE1FF",Eu="&#xE200",bu="&#xE201",vu="&#xE202",Ru="&#xE203";function lo(t){return function(){return arguments[t]}}function ot(){return this}var Zn=Object.create,Su=Object.freeze,Ke=Su(Zn(Zn(Object.prototype,{at:{value:U},shift:{value:U},push:{value:U},forEach:{value:U},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:ot},find:{value:U},findIndex:{value:function(){return-1}},flat:{value:ot},flatMap:{value:ot},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:ot},reduce:{value:lo(1)},sort:{value:ot},each:{value:ot},pipe:{value:M},start:{value:ot},stop:{value:ot},done:{value:ot},valueOf:{value:function(){return null}}}),{length:{value:0}}));function nt(t){return lt(12,t)}var Jn=D(rt(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function C(t){return t[0]+Jn(t)}var V=Uint8Array.of(0,2,4,5,7,9,11);var{abs:zm}=Math,Au=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),Du=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],jm={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]},$t=st(t=>{let e=Fe(t);return V.map(r=>nt(r+e)).sort()});function fo(t){let e=new Float32Array(12),r=H(t+2),o=7;for(;o--;)r=H(r+5),e[r]=1;return e}function mo(t,e,r){let o=t.length;for(;o--;)t[o]*=1-r+r*e[o];return t}var ho={note:(t,e,r=1)=>{let o=R(e[2]),n=fo(o);return mo(t,n,r*(1-o/192))},chord:(t,e,r=1)=>{let o=H(e[2]),n=Ir(e[3]),i=n.length,s;for(;i--;)s=fo(o+n[i]),mo(t,s,r/n.length*Au[n[i]]);return t}};function Xe(t,e,r){let o=t[e],n=o[0],i=$e(o)?fo(R(o[2])):Kr(o)?ho.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(r!==void 0){let u=Float32Array.from({length:12},(a,c)=>Du[(c+12-r)%12]);mo(i,u,.3)}let s=e;for(;o=t[--s];){let u=ho[o[1]];if(!u)continue;let a=C(o);if(a>n)u(i,o,.5);else if(o[1]==="note"&&n-a<3){if(1-(n-a)/3>1)throw new Error("Influence should never be > 1 "+n+" "+a);u(i,o,.25*(1-(n-o[0])/3))}}for(s=e;(o=t[++s])&&o[0]-n<2;){if(!$e(o))continue;let u=ho[o[1]];if(u){if(1-(o[0]-n)/2>1)throw new Error("Influence should never be > 1 "+n+" "+stopBeat);u(i,o,.3*(1-(o[0]-n)/2))}}return i}var Ve=[0,7,5,2,10,9,3,4,8,11,1,6];function Ye(t){let e=Ve.length,r=0,o;for(;e--;)t[Ve[e]]>r&&(r=t[Ve[e]],o=Ve[e]);return o}var _n=/^([A-G])([b#â™­â™¯ğ„«ğ„ª])?(-?\d)?$/,ti=/b|â™­/,ei=/#|â™¯/;var Ze=/b|â™­|#|â™¯/g;var Je={"-2":"ğ„«","-1":"â™­",0:"",1:"â™¯",2:"ğ„ª"},Qn=["Fâ™¯","Câ™¯","Gâ™¯","Dâ™¯","Aâ™¯","Eâ™¯","Bâ™¯","Bâ™­","Eâ™­","Aâ™­","Dâ™­","Gâ™­","Câ™­","Fâ™­"];function Qe(t,e){let r=Qn.indexOf(t.pitch),o=Qn.indexOf(e.pitch);return r>o?1:r<o?-1:0}var P={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,marcatoThreshold:pt("-6dB"),accentThreshold:pt("-12dB"),ghostThreshold:pt("-30dB"),headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var ri={"-2":"ğ„«","-1":"â™­",0:"",1:"â™¯",2:"ğ„ª"},Nu=globalThis||window;var{floor:oi,round:od}=Math,ni=[{name:"C",symbol:"Câˆ†",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Dâ™­",symbol:"Dâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"Dâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"Eâ™­",symbol:"Eâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"Eâˆ†",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"Fâˆ†",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Fâ™¯",symbol:"Fâ™¯âˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"Gâˆ†",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"Aâ™­",symbol:"Aâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"Aâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"Bâ™­",symbol:"Bâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"Bâˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}],T=class{constructor(){}pitched=!0;rows=Ke;getHeadHTML(e,r,o){let n=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${n}">${G[n]}</span>`}getNoteHTML(e,r,o){return r<P.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${te}</span>
            ${this.getHeadHTML(e,r,o)}
            <span class="post" data-glyph="headBracketRight">${ee}</span>`:this.getHeadHTML(e,r,o)}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return oi(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,r){let o=R(this.minPitch),n=R(this.maxPitch),i=R(e)+r;return i>=o&&i<=n?i:void 0}parts=[{name:"main"}];getPart(e){return this.parts[0]}getRow(e,r){let n=(typeof r=="string"?r:at(r)).replace(Ze,""),i=this.rows.indexOf(n);if(Nu.DEBUG&&i===-1)throw new Error('Pitch "'+r+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getPitch(e){let r=this.rows[e];return r?r.split(/\s+/)[0]:void 0}getSpelling(e,r,o=!1){if(console.log("KEY IS A ROOT NUMBER, MAKE IT A KEY",e),!o){let l=ni[e],h=H(r),p=l.spellings[h];return be[nt(h-p)]+ri[p]}let n=ni[e],i,s,u;if(typeof r=="string"){let[l,h,p,m]=_n.exec(r)||[r];m&&(i=R(r),s=n.spellings[nt(i)],u=ve(i-s))}else i=r,s=n.spellings[nt(i)],u=ve(i-s);let a=be[nt(i-s)],c=ri[s];return a+c+u}createKeySymbols(e){let r=[],o=Be(e),n=$t(o);return console.trace("IS NUMBER? MAKE SURE ITS A KEY NUMBER, NOT ROOT",o,n),r.push.apply(r,n.map((i,s)=>i-V[s]&&{type:"acci",pitch:W(V[s])+Je[i-V[s]],value:i-V[s],part:this.parts[0]}).filter(i=>!!i).sort(Qe)),r}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let r=oi(e*this.pitches.length);return r<0?this.pitches[0]:r>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[r]}};function go(t){if(t=typeof t=="number"?t+"":t.trim(),typeof t=="string")return t.toLowerCase().replace(/^[\W_]+/,"").replace(/[\W_]+$/,"").replace(/[\W_]+/g,"-")}var Tu=globalThis||window;function N(t){return go(on(t))}var vt=class extends T{type="drum";pitched=!1;rows=["","","",N(55)+" "+N(52),N(57),N(49),N(51)+" "+N(53)+" "+N(59),N(42)+" "+N(46),N(50)+" "+N(56),N(48)+" "+N(47),N(38)+" "+N(40),N(45)+" "+N(31)+" "+N(39)+" "+N(54),N(43),N(41),N(35)+" "+N(36),"",N(44),"","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#e={31:!0,35:!0,36:!0,37:!0,38:!0,40:!0,41:!0,42:!0,43:!0,45:!0,47:!0,48:!0,50:!0,56:!0};getNoteHTML(e,r,o){let n=R(e),i=this.#t[n],s=this.#e[n],u=i?`<span class="head" data-glyph="${i}">${G[i]}</span>`:this.getHeadHTML(e,r,o);return s&&r<P.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${te}</span>
            ${u}
            <span class="post" data-glyph="headBracketRight">${ee}</span>
            `:u}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(e){return[35,36,37,38,40,41,43,44,45,47,48,50].includes(R(e))?this.parts[0]:this.parts[1]}getRow(e,r){let o=typeof r=="string"?r:N(r);if(!o)throw new Error("Number not found for pitch "+r);let n=this.rows.findIndex(i=>i.includes(o));if(Tu.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),n>-1?n:void 0}getSpelling(e,r){return N(r)}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let r=floor(e*this.rows.length),o=r<4?4:r>17?17:r;return this.pitches[o]}};var re=class extends vt{type="percussion";rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var Fu=globalThis||window,ii=Object.assign,oe=class extends T{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(e,r,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+r]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+r]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(e,r){r=typeof r=="string"?r:at(r);let o=e.name+"-"+r.replace(Ze,""),n=this.rows.findIndex(i=>i.includes(o));if(Fu.DEBUG&&n===-1)throw new Error('Pitch "'+o+'" is not supported by '+this.constructor.name);return n===-1&&console.warn('Pitch "'+o+'" is not supported by '+this.constructor.name),n>-1?n:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#â™­â™¯ğ„«ğ„ª]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let r=[];console.trace("IS NUMBER? MAKE SURE ITS A KEY NUMBER, NOT ROOT",e);let n=$t(e).map((i,s)=>i-V[s]&&{type:"acci",pitch:W(V[s])+Je[i-V[s]],value:i-V[s]}).filter(i=>!!i).sort(Qe);return r.push.apply(r,n.map(i=>ii({part:this.parts[1]},i))),r.push.apply(r,n.map(i=>ii({part:this.parts[2]},i))),r}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var wo=class extends T{type="treble-up";clef=Vt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},xo=class extends T{type="treble";clef=Wt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},yo=class extends T{type="treble-down";clef=Kt;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},Eo=class extends T{type="alto";clef=Xt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},bo=class extends T{type="bass";clef=Yt;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};T.treble=new xo;T["treble-up"]=new wo;T["treble-down"]=new yo;T.alto=new Eo;T.bass=new bo;T.piano=new oe;T.drum=new vt;T.percussion=new re;T.create=t=>(console.warn("Deprecated: Stave.create(type). Use Stave[type]."),T[t]);var _e=T;var si=t=>t*Math.PI/180;var ai=yt({deg:si,rad:M,turn:t=>t*2*Math.PI,catch:function(t){throw new Error('Cannot parse value "'+t+'"')}});var Bu=/px$/,ku=/deg$|turn$|rad$/;function Cu(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function tr(t,e){var r=Cu(t,e);return typeof r=="string"?Bu.test(r)?parseFloat(r):ku.test(r)?ai(r):r:r}var er,rr;function $u(){if(!er){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",er=tr("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return er}function Mu(){return rr||(rr=tr("font-size",document.documentElement)),rr}window.addEventListener("resize",()=>{er=void 0,rr=void 0});var Gu=D(Dt,{number:M,string:yt({px:M,em:t=>$u()*t,rem:t=>Mu()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),ci=Gu;function Ou(t,e,r){let o=t(e),n=t(r);return n===o?0:o>n?1:-1}var ui=Z(Ou,!0);var{abs:Uu,EPSILON:Lu}=Math;function or(t,e){return Math.round(e/t)*t}function it(t,e,r=Lu){return e!==void 0&&(e===t||Uu(t-e)<r)}function Rt(t,e,r){return it(t,e,r)||e<t}function qu(t,e,r){return it(t,e,r)||e>t}function Mt(t,e,r){return e!==void 0&&t!==void 0&&!Rt(t,e,r)}function nr(t,e,r){return e!==void 0&&t!==void 0&&!qu(t,e,r)}var{pow:Pu}=Math,Iu=1/24,Hu=[2,3,4,5,6,7,9],zu=1/12,pi=.25,li=.2,vo={},Gt=0;function hi(t,e){return Math.cos(2*Math.PI*e/t)}function fi(t,e,r,o,n){let i=t/e,s=0,u=0,a=0,c,l;for(o[n-1]&&Mt(r+.5*i,C(o[n-1]),Iu)&&(a=1),--n;o[++n]!==void 0&&o[n][0]-r<i/4;)a=1;for(--n;o[++n]!==void 0&&o[n][0]-r<t-i/4;){if(c=Math.round((o[n][0]-r)/i),l=1<<c,c<e&&l>a){if(e>4&&l>a<<1)return;a+=l}s+=hi(i,o[n][0]-r),u+=1,!(o[n][0]+o[n][4]-r>t)&&(s+=li*hi(i,o[n][0]+o[n][4]-r),u+=li)}if(!(e>4&&c!==e-1)&&u)return vo.score=s/(u+1),vo.rhythm=a,vo}function ju(t,e,r,o,n,i,s){let u=r[o-1]&&C(r[o-1])>n+.125?n:e*Math.floor((r[o][0]-n)/e)+n,a=i.length;for(;e/i[--a]<zu;);++a;let c,l;for(;c=i[--a];)l=fi(e,c,u,r,o),l&&l.score>=Gt&&l.score&&(Gt=l.score,t.beat=u,t.duration=e,t.divisor=c,t.rhythm=l.rhythm),r[o][0]>=u+.5*e&&u+1.5*e<s&&(l=fi(e,c,u+.5*e,r,o),l&&l.score>=Gt&&(Gt=l.score,t.beat=u+.5*e,t.duration=e,t.divisor=c,t.rhythm=l.rhythm));return t}function mi(t,e,r){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let n={};Gt=pi;let i=1/8;for(;(i*=2)&&i<=r;)ju(n,i,t,o,e,Hu,e+r);return Gt>pi&&n}function di(t,e){return e<Pu(2,t)-1}function Ro(t){return 2**Math.ceil(Math.log2(t))}function gi(t){return 2**Math.floor(Math.log2(t))}function So(t){return t>0&&(t&t-1)===0}function Ao(t,e,r){if(it(0,r,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(it(0,lt(o,r),t/2))return o;return o}function ne(t,e){let r=-1,o=0;for(;t[++r]!==void 0;);for(;arguments[++o]!==void 0;)t[r++]=arguments[o];return t}function Ot(t){let e=-1;for(;t[++e]!==void 0;);return e}function Do(t){return t[Ot(t)-1]}function No(t,e){let r=[],o=-1;for(;e[++o]!==void 0;)r.push(t(e[o],o));return r}var ar=Object.assign,{abs:Bg,ceil:Wu,floor:sr,min:Ei,max:bi,pow:kg,sqrt:wi,round:Cg}=Math,Y=1/16,ie=1/24,Ku=ui(rt("row"));function xi(t,e,r,o){return t+e/o.length}function vi(t,e){return bi(t,C(e))}function Vu(t,e){return R(t[2])<R(e[2])?1:-1}function Ri(t,e,r,o){if(!o.length)return[];let n=[],i=-1,s;for(;s=o[++i];){let h=s.scribeEvents,p=s.scribeIndex,m=Xe(h,p,e),d=Ye(m),f=t.getSpelling(d,s[2],!0),g=t.getRow(r,f);n.push({type:"note",pitch:f,dynamic:s[3],part:r,row:g,stave:t,event:s})}n.sort(Ku),n[0].top=!0,n[n.length-1].bottom=!0;let u=n[0].row,a=n[n.length-1].row,c=r.stemup===void 0?Si(t,r,u,a):r.stemup,l=0;for(i=-1;n[++i];)n[i].stemup=c,i>0&&n[i].row-n[i-1].row===1?n[i].clusterdown=++l:l=0;for(l=0,i=n.length-1;i--;)n[i+1].row-n[i].row===1?n[i].clusterup=++l:l=0;return n}function Xu(t,e,r){let o=-1,n=0,i,s;for(;r[++o];)s=t.getRow(e,r[o]),s!==void 0&&s>n&&(n=s,i=r[o]);return{row:n,pitch:i}}function Yu(t,e,r){let o=-1,n=128,i,s;for(;r[++o];)s=t.getRow(e,r[o]),s!==void 0&&s<n&&(n=s,i=r[o]);return{row:n,pitch:i}}function Si(t,e,r,o){let n=e.centerRow||t.centerRow,i=r-n;return o-n+i>0}function Ai(t,e,r){let{row:o}=Xu(t,e,r),{row:n}=Yu(t,e,r);return Si(t,e,o,n)}function Zu(t,e,r){let o=[],n=-1,i;for(;i=r[++n];)i.type==="note"&&o.push(i.pitch);return Ai(t,e,o)}var yi=0;function mt(t,e,r,o){let n=-1;for(;o[++n]&&o[n].beat===o.beat;);if(!o[n])return t;let i=o[0].beat,u=Do(o).beat-i,a=r.stemup===void 0?Ai(e,r,No(rt("pitch"),o)):r.stemup;if(r.beam){let b;for(n=-1;b=o[++n];)b.stemup=a,b.beam=o;return t.push(ar(o,{duration:u,stemup:a,range:0,id:++yi})),t}let c=[],l;for(n=-1;l=o[++n];){let b=e.getRow(r,l.pitch);if(b===void 0)continue;let O;for(;o[++n]&&it(o[n].beat,l.beat,ie);)O=e.getRow(r,o[n].pitch),O!==void 0&&(a?O<b&&(b=O):O>b&&(b=O));--n,c.push(b)}let h=c.length-1,p=c.slice(0,sr(.5*c.length)).reduce(xi,0),m=c.slice(Wu(.5*c.length)).reduce(xi,0),d=Array.from(c,(b,O)=>(.2+.1*h)*O*(m-p)/h),f=d[d.length-1]-d[0],g=a?-50:50,x;for(n=c.length;n--;)x=d[n]-c[n],g=a?x>g?x:g:x<g?x:g;for(n=c.length;n--;)d[n]-=g+c[0];let y=-1;for(n=-1;l=o[++n];){for(++y,l.stemup=a,l.beam=o,l.stemHeight=a?1-.125*(d[n]-c[n]+c[0]):1+.125*(d[n]-c[n]+c[0]);o[++n]&&it(o[n].beat,l.beat,Y);)o[n].stemup=a,o[n].beam=o,o[n].stemHeight=l.stemHeight;--n}return t.push(ar(o,{pitch:o[0].pitch,y:d[0],duration:u,stemup:a,range:f,id:++yi})),t}function ir(t,e){let r=2*Ro(e);for(;(r/=2)>t/2;){if(1.75*r===e)return 1.75*r;if(1.5*r===e)return 1.5*r;if(r<=e)return r}return t}function Ju(t,e,r){r=r||1/0;let o=4*Ro(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=r)return o;return t}function Di(t,e,r,o,n,i){let u=gi(e.divisor),a=sr(n/e.divisor)*e.divisor,c=Ao(.125,u,n-a);if(i<o){if(t.indexOf(i-n)!==-1)return i-n;let h=sr(i/e.divisor)*e.divisor;if(n===a){if(t.indexOf(h-n)!==-1)return h-n;let p=a+e.divisor<i&&a+e.divisor;return p?p-n:ir(.125,i-n)}if(it(i,h,Y)){let p=a+e.divisor<i&&a+e.divisor;return p&&t.indexOf(p-n)!==-1?p-n:c}}let l=sr(o/e.divisor)*e.divisor;if(n===a){if(t.indexOf(o-n)!==-1)return o-n;if(t.indexOf(l-n)!==-1)return l-n;let h=a+e.divisor<o&&a+e.divisor;return h?h-n:Ju(.125,o-n,i-n)}else if(it(o,l,Y)){if(t.indexOf(o-n)!==-1)return o-n;let h=a+e.divisor<o&&a+e.divisor;return h&&t.indexOf(h-n)!==-1?h-n:c}else{let h=4*c;return(n-a)%h/c===1?n+2*c===i?2*c:(n+3*c>=i&&console.log("Next event beat is inside quaduplet"),c<1?o>=n+c*3/2?3*c:o>=n+c?c:ir(.125,o-n):o>=n+c*3?c*3:o>=n+c*2?c*2:o>n+c?c:ir(.125,o-n)):o>n+c?c:ir(.125,o-n)}}function Qu(t,e,r,o,n,i){return{type:"rest",beat:i,duration:Di(t,e,i,n,i,n),stave:r,part:o}}function To(t,e,r,o,n,i,s){for(;Mt(i,s,Y);){let u=Qu(e,r,o,n,s,i);t.push(u),i+=u.duration}return s}function _u(t,e,r,o,n,i){let{pitch:s,event:u,row:a}=o,c=ei.test(s)?1:ti.test(s)?-1:void 0,l=s[0]+s.slice(-1);if(c!==e[l])return e[l]=c,{type:"acci",beat:r,pitch:s,row:a,clump:n,cluster:i,part:t,event:u,value:c||0}}function tp(t,e,r){let o=-1,n,i=0,s;for(;n=t[++o];)n.type==="acci"&&n.beat===e&&n.row<r&&n.row>i&&(i=n.row,s=o);return t[s]}function Ni(t,e,r,o,n,i){let s=-1,u=0,a,c,l,h=!!i.find(p=>p.stemup?p.clusterup%2===1:p.clusterdown%2===1);for(;a=i[++s];)nr(e.beat,a.event[0],Y)||(l=tp(t,n,a.row),u=l&&l.row-a.row<6&&l.cluster===h?l.clump+1:0,c=_u(r,o,n,a,u,h),c&&t.push(c))}function Ti(t,e,r,o,n,i){let s=-1/0,u=-1,a,c;for(;a=n[++u];)a.dynamic>s&&(s=a.dynamic,c=a.event);if(n.length&&s>=i.accentThreshold){let l=n[0].stemup?n[n.length-1]:n[0];t.push({type:"accent",beat:o,pitch:l.pitch,dynamic:s,stemup:l.stemup,stave:e,part:r,event:c})}}function Fi(t,e,r,o,n){let i=n[0].row,s=n[0].pitch,u=i-(r.topRow||e.topRow)+1;u<0&&t.push({type:"ledge",beat:o,pitch:s,part:r,rows:u});let a=n[n.length-1].row,c=n[n.length-1].pitch;u=a-(r.bottomRow||e.bottomRow),u>0&&t.push({type:"ledge",beat:o,pitch:c,part:r,rows:u})}function ep(t,e,r){let{beat:o,duration:n,divisor:i}=r,s=e.stemup===void 0?Zu(t,e,r):e.stemup,u=-1,a;for(;a=r[++u];)a.type==="note"&&!a.beam&&(a.stemup=s);let c=o+.5*n,l=R(t.topPitch)-12,h,p=Ot(r);for(;(a=r[--p])&&a.beat>c;);for(++p;(a=r[--p])&&a.beat+a.duration>c;){let y=R(a.pitch);(!h||y>h)&&(h=y)}let m=l;for(p=-1;(a=r[++p])&&a.beat<o+Y;){let y=R(a.pitch);(!m||y>m)&&(m=y)}let d=l;for(p=Ot(r);(a=r[--p])&&a.beat>o+n-n/i-Y;){let y=R(a.pitch);(!d||y>d)&&(d=y)}let f=Math.ceil((m+d)/2),g=at(f);f>h&&(h=f),r.pitch=at(h),r.stemup=s;let x=d-m;r.angle=x<0?4*wi(-x):-4*wi(x)}function rp(t,e,r,o,n,i,s,u,a,c,l,h,p,m,d){(u.swingAsStraight8ths&&c===1||u.swingAsStraight16ths&&c===.5)&&l===3&&(h===4||h===5)&&(l=2);let f=c/l,g=a+c,x={type:"tuplet",beat:a,duration:c,divisor:l,rhythm:h,part:i,stave:r},y;for(So(l)||t.push(x);nr(g,a,ie);){for(;(y=m[++d])&&Rt(a+.5*f,y[0]-e.beat,ie);)p.push(y);if(--d,!p.length){t.push({type:"rest",beat:a,duration:f,stave:r,part:i}),a+=f;continue}let b=Ri(r,o,i,p);Fi(t,r,i,a,b),Ni(t,e,i,n,a,b),Ti(t,r,i,a,b,u);let O=Ei(p.reduce(vi,0)-e.beat,y?y[0]-e.beat:e.duration,x.beat+x.duration),F=bi(f,or(f,O-a)),B=-1;for(;b[++B];)t.push(ar(b[B],{beat:a,duration:F}));for(ne(x,...b),Mt(.5,F,ie)?s&&(mt(t,r,i,s),s=void 0):s||(s={type:"beam",beat:a,part:i}),s&&ne(s,...b),B=p.length;B--;){let X=C(p[B])-e.beat;Rt(a+F+.5*f,X,ie)?p.splice(B,1):t.push({type:"tie",beat:a,pitch:b[B].pitch,duration:F,stemup:b[B].stemup,part:i,event:p[B]})}a+=F}return s&&mt(t,r,i,s),ep(r,i,x),d}function Fo(t,e,r,o=0,n={},i,s,u=P){let a=[],{headDurations:c,restDurations:l}=u,h=0,p=-1,m,d,f;for(;(m=s[++p])&&Rt(h,m[0]+m[4]-e.beat,Y););for(--p;nr(e.duration,h,Y);){f&&e.divisions.find(X=>it(h,X,Y))&&(mt(t,r,i,f),f=void 0);let g=mi(s,e.beat+h,e.duration-h);if(g&&!So(g.divisor)){Mt(h,g.beat-e.beat,Y)&&To(t,u.restDurations,e,r,i,h,g.beat-e.beat),f&&di(g.divisor,g.rhythm)&&(mt(t,r,i,f),f=void 0),p=rp(t,e,r,o,n,i,f,u,g.beat-e.beat,g.duration,g.divisor,g.rhythm,a,s,p),h=g.beat-e.beat+g.duration;continue}for(;(m=s[++p])&&Rt(h,m[0]-e.beat,Y);)a.push(m);if(--p,r.pitched&&a.sort(Vu),!a.length){if(!m){f&&(mt(t,r,i,f),f=void 0),To(t,u.restDurations,e,r,i,h,e.duration);break}let X=or(.125,m[0]-e.beat);if(X<=h){console.log(`Problem at bar ${e.count}, moving to next bar ${h} ${X}`),e.error="Stop beat has ended up less than beat";break}f&&(Bi(e.divisions,h,X)||X-h>=.5)&&(mt(t,r,i,f),f=void 0),To(t,l,e,r,i,h,X),h=X;continue}let x=Ri(r,o,i,a);Fi(t,r,i,h,x),Ni(t,e,i,n,h,x),Ti(t,r,i,h,x,u);let y=a[0][0]-e.beat,b=Ei(e.duration,a.reduce(vi,0)-e.beat),O=m&&or(.125,m[0])-e.beat,F=Di(c,e,y,b,h,O),B=-1;for(;x[++B];)t.push(ar(x[B],{beat:h,duration:F}));for(F>=1?f&&(mt(t,r,i,f),f=void 0):f||(f={type:"beam",beat:h,part:i}),f&&ne(f,...x),B=a.length;B--;){let X=C(a[B])-e.beat;Rt(h+F,X,Y)||X-(h+F)<.125+1/16*(C(a[B])-a[B][0])?a.splice(B,1):t.push({type:"tie",beat:h,pitch:x[B].pitch,duration:F,stemup:x[B].stemup,part:i,event:a[B]})}h+=F}return f&&mt(t,r,i,f),t}var op={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]},ki=/\/\{(\d{1,2})\}$/;function np(t,e){return op[t+","+e]||Ke}function Bi(t,e,r){let o=-1;for(;t[++o]&&t[o]<=e;);return r>t[o]?t[o]:void 0}var ip=[];function Ci(t,e){return $t(e).reduce((o,n,i)=>{let s=n-V[i];if(s!==0){let u=W(V[i]),a=10;for(;a--;)o[u+a]=s}return o},t),t}function Bo(t,e){return e==="Câ™­"&&t.spellChordRootCFlatAsB?"B":e==="Eâ™¯"&&t.spellChordRootESharpAsF?"F":e==="Bâ™¯"&&t.spellChordRootBSharpAsC?"C":e==="Fâ™­"&&t.spellChordRootFFlatAsE?"E":e}function sp(t,e,r,o,n,i,s){let u=-1,a;for(;a=i[++u];)switch(a[1]){case"key":{let c=ft(a[2]),l=Fe(a[2]);Ci(n,c),e.key=l;break}case"meter":{t.push({type:"timesig",beat:0,numerator:a[3]===1.5?a[2]/.5:a[2]/a[3],denominator:a[3]===1.5?8:4/a[3],stave:r,event:a});break}case"symbol":{t.push({type:"symbol"+a[2],stave:r});break}case"chord":{let c=a[0]-e.beat,l=Xe(i,u,o),h=Ye(l),p=Ne(a[3]),m=ki.exec(p),d,f,g;if(m){let x=parseInt(m[1],10);d=r.getSpelling(h,nt(a[2]-x)),f=r.getSpelling(h,a[2]),g=Bo(s,d)+p.replace(ki,"/"+Bo(s,f))}else d=r.getSpelling(h,a[2]),g=Bo(s,d)+p;t.push({type:"chord",beat:c,name:g,duration:a[0]+a[4]>e.beat+e.duration?e.duration-c:a[4],event:a,stave:r});break}case"text":{let c=a[0]-e.beat;t.push({type:"text",beat:c,duration:a[0]+a[3]>e.beat+e.duration?e.duration-c:a[3],value:a[2],event:a,stave:r});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(ip.includes(a[1]))return;console.log('Scribe: ignoring event type "'+a[1]+'"')}}return t}function se(t,e,r,o,n,i,s,u,a,c=P){let l=[];if(a){let x=C(a);x>e&&x<=e+r&&s.push(a)}let h=Be(i),p=Ci({},h),m={type:"bar",beat:e,duration:r,key:i,divisor:o||4,divisions:np(r,o),stave:n,count:t,symbols:l};sp(l,m,n,i,p,s,P);let d=n.parts.reduce((x,y)=>y.centerRow?x.add(y.centerRow):x,new Set);d.size||d.add(n.centerRow);let f;for(f of n.parts){let x=u[f.name];!x||!x.length||(d.delete(f.centerRow||n.centerRow),Fo(l,m,n,i,p,f,x,c))}let g;for(g of d)Fo(l,m,n,i,p,{centerRow:g},[],c);return m}function ap(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function cp(t){let e=t.symbols.filter(r=>r.type==="chord"||r.type==="note");return JSON.stringify(e,ap)}function St(t,e){t.symbols=t.symbols.filter(r=>r.type==="doublebarline"||r.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function cr(t,e,r){let o=cp(r);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&r.symbols.filter(n=>n.type!=="clef"&&n.type!=="timesig").find(n=>n.type!=="rest")?(St(t[t.length-2],1),St(t[t.length-1],1),St(r,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(St(r,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,St(t[t.length-1],2),St(r,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,St(r,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function ko(t,e,r){let o=r.target?t.parts[r.target]:t.getPart(r[2]),n=e[o.name]||(e[o.name]=[]);e[o.name].push(r)}function Co(t,e,r,o=P){let n=[],i=[],s=[],u=[],a=0,c=[],l={},h=0,p=0,m,d,f,g;for(f of t)if(f.scribeIndex=n.length,f.scribeEvents=n,n.push(f),!e.includes(f[1])){for(;f[0]>=a+m;){let y=se(i.length+1,a,m,d,r,h,c,l,g,o);cr(i,u,y),i.push(y),h=y.key,a=a+m,c=[],l={};let b=-1;for(;s[++b];)ko(r,l,s[b]),C(s[b])<a+m&&s.splice(b--,1)}switch(f[1]){case"note":{ko(r,l,f),C(f)>a+m&&s.push(f),p<C(f)&&(p=C(f));break}case"sequence":{f.events===t.events&&(g=f),p<C(f)&&(p=C(f));break}case"meter":m=f[2],d=f[3],f[0]!==a&&console.log("TODO");default:c.push(f)}}for(;s.length;){let y=se(i.length+1,a,m,d,r,h,c,l,g,o);cr(i,u,y),i.push(y),a=a+m,c=[],l={};let b=-1;for(;f=s[++b];)ko(r,l,f),C(f)<a+m&&s.splice(b--,1)}for(;a<p-m;){let y=se(i.length+1,a,m,d,r,h,c,l,g,o);cr(i,u,y),i.push(y),a=a+m,c=[],l={}}m||(m=n.length?C(n[n.length-1]):1);let x=se(i.length+1,a,m,d,r,h,c,l,g,o);return cr(i,u,x),i.push(x),i}var $o=Symbol("scribe-id"),up={},Mo=0;function ct(t){for(;t.event;)t=t.event;return t[$o]?t[$o]:(t[$o]=++Mo,up[Mo]=t,Mo)}var ut=1.1;function pp(t){return parseFloat(t.dataset.beat)}function lp(t){return parseFloat(t.dataset.duration)}function hp(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function $i(t,e,r,o,n){let i=r[0],s=r.length===1?o%(n*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],u=r.length===1?o%(n*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[r[r.length-1]];return`M${s}, ${-t*s-.5*ut}
        L${u},${-t*u-.5*ut}
        L${u},${-t*u+.5*ut}
        L${s}, ${-t*s+.5*ut}
        Z`}function Go(t,e,r,o,n,i,s){if(s<.0833)return;let u=n-1,a;for(;r[++u];)r[u]<=s?a?a.push(u):a=[u]:a&&(t.appendChild(v("path",{class:`beam-path-${4/s} beam-path`,d:$i(i,o,a,e[u-1],s)})),Go(t,e,r,o,a[0],i,s/2),a=void 0);a&&(t.appendChild(v("path",{class:`beam-path-${4/s} beam-path`,d:$i(i,o,a,e[u-1],s)})),Go(t,e,r,o,a[0],i,s/2),a=void 0)}function Mi(t){let e=t.dataset.beam,r=t.parentElement,o=Array.from(r.querySelectorAll('.top-note[data-beam="'+e+'"]')),n=o.map(pp),i=o.map(lp),s=t.viewBox.baseVal,u=s.y<-.5?s.y+.5:s.height-1,a=o.map(gt),c=a[0].x,l=a[a.length-1].x,h=a.map(p=>(p.x-c)/(l-c));hp(t),Go(t,n,i,h,0,-u,.25)}var fp=/â™®|(bb|ğ„«)|(##|ğ„ª)|(b|â™­)|(#|â™¯)|(âˆ†)|(-)|(Ã¸)|(Â°)|(\+)|(\d+)/g,mp={0:`<span class="glyph glyph-natural">${Ct}</span>`,1:`<span class="glyph glyph-doubleflat">${Zt}</span>`,2:`<span class="glyph glyph-doublesharp">${_t}</span>`,3:`<span class="glyph glyph-flat">${Jt}</span>`,4:`<span class="glyph glyph-sharp">${Qt}</span>`,5:'<span class="glyph glyph-major">âˆ†</span>',6:'<span class="glyph glyph-minor">-</span>',7:'<span class="glyph glyph-halfdim">Ã¸</span>',8:'<span class="glyph glyph-dim">Â°</span>',9:'<span class="glyph glyph-aug">+</span>'};function dp(){let t=arguments.length-2;if(arguments[--t])return`<span class="glyph glyph-number">${arguments[t]}</span>`;for(;t--;)if(arguments[t])return mp[t];return""}function ae(t){return t.replace(fp,dp)}function $(t,e){return e.toFixed(t).replace(/\.?0+$/,"")}var ur=Math.abs,gp={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},wp={2:_t,1:Qt,0:Ct,"-1":Jt,"-2":Zt},xp={treble:Wt,"treble-down":Kt,"treble-up":Vt,alto:Xt,bass:Yt,drum:Ie,percussion:Ie},yp={"1.33":co,"0.67":ao,"0.33":so,"0.17":io,"0.08":no},Ep=/^([A-G][â™­â™¯]?)([âˆ†\-Ã¸+Â°â™­â™¯\d]*)([a-zA-Z]*)([â™­â™¯]?\d+)?(?:\/([A-G][â™­â™¯]?))?$/;function bp(t){let e=-1,r="";for(;t[++e];)r+=(r?" ":"")+ct(t[e].event);return r}function vp(t,e,r,o,n,i){return ae(e)+(r||o||n?'<span class="chord-ext">'+(r?ae(r):"")+(o?"<sub>"+o+"</sub>":"")+(n?ae(n):"")+"</span>":"")+(i?'<span class="glyph glyph-slash">'+po+'</span><span class="chord-bass">'+ae(i)+"</span>":"")}var Oo=D(rt("type"),{barrepeat:t=>v("span",{class:"barrepeat",html:G["barRepeat"+t.count],data:{beat:0,duration:t.duration}}),clef:t=>v("span",{class:`${t.clef}-clef clef`,html:xp[t.clef]}),chord:t=>v("abbr",{class:"chord chord-abbr",title:"",html:t.name.replace(Ep,vp),data:{beat:$(4,t.beat),duration:$(4,t.duration),event:ct(t.event)}}),timesig:t=>t.stave.getTimeSigHTML?v("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,ct(t.event))):v("span",{class:"timesig",html:`<sup>${G["timeSig"+t.numerator]}</sup>
                <sub>${G["timeSig"+t.denominator]}</sub>`,data:{event:ct(t.event)}}),symbolcoda:t=>v("p",{html:uo,class:"coda"}),barcount:t=>v("span",{html:t.text,class:"barcount"}),text:t=>v("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:$(4,t.beat),duration:$(4,t.duration),event:ct(t.event)}}),acci:t=>v("span",{class:(gp[t.value]||"acci")+(t.clump?" acci-"+t.clump:"")+(t.cluster?" acci-cluster":""),html:wp[t.value]||Ct,data:{beat:t.beat&&$(4,t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&ct(t.event)}}),accent:t=>{let e=t.dynamic>=P.marcatoThreshold,r=t.stave.type==="drum"||t.stave.type==="percussion";return v("span",{class:`${t.stemup?"up":"down"}-accent accent${e?" marcato-accent":""}`,html:r?e?t.stemup?je:We:t.stemup?He:ze:e?t.stemup?We:je:t.stemup?ze:He,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name,event:ct(t.event)}})},ledge:t=>v("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${ur(t.rows)}`:`0 -0.5 5 ${ur(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>v("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${R(t.pitch)})`,data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name,beam:t.beam&&t.beam.id,event:ct(t.event)}}),beam:(t,e)=>v("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${ur(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${$(4,t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(ur(t.range)+ut)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*ut} L1,${t.range-.5*ut} L1,${t.range+.5*ut} L0,${.5*ut} Z"></path>`,data:{beat:$(4,t.beat),pitch:t.pitch,part:t.part.name,beam:t.id,events:bp(t)}}),tie:t=>v("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name,event:ct(t.event)}}),tuplet:t=>v("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:G["tuplet"+t.divisor],data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>v("span",{class:"rest",html:yp[t.duration.toFixed(2)]||G["rest"+(t.duration+"").replace(".","")]||"",data:{beat:$(4,t.beat),pitch:t.pitch,duration:$(4,t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});var Gi=globalThis||window,ce={pink:"#FE267E",grey:"#81868f"},Rp=Gi.DEBUG&&Gi.DEBUG.scribe!==!1?function(e,r,o="",n=""){console.log("%cScribe %c"+e+" %c"+r+" %c"+o+" %c"+n,"color: "+ce.pink+"; font-weight: 300;","color: "+ce.grey+"; font-weight: 300;","color: "+ce.pink+"; font-weight: 300;","color: "+ce.grey+"; font-weight: 300;","color: "+ce.pink+"; font-weight: 300;")}:U,Oi=Rp;var Sp=globalThis||window;function Ap(t){return t[0]<=0&&t[1]==="meter"}function Dp(t){return t[0]<=0&&t[1]==="key"}function Np(t,e){let r=Oo(e);return r&&t.push(r),t}function Tp(t,e){return t.push(v("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:W(e.key),stave:e.stave.type},children:e.symbols.reduce(Np,[])})),t}function Ui(t,e,r,o,n,i=1/0,s=0,u=0,a=P){let c=t.events;!c.find(Ap)&&n&&c.unshift([0,"meter",n[2],n[3]]),!c.find(Dp)&&o&&c.unshift([0,"key",o]);let p=_e[r||"treble"],m=[];s&&m.push("transpose",s),u&&m.push("displace",u);let d=new Et(c,t.sequences,m),f=Co(d,e,p,a),g=f.reduce(Tp,[]),y=f[0].key,b=p.createSignatureSymbols(y),O=v("div",{class:`${p.type}-stave signature-stave stave`,children:b.map(Oo),data:{key:W(y)}}),F=v("div",{id:"side",class:"side",data:{key:W(y)}}),B=24;for(;B--;)F.appendChild(O.cloneNode(!0));return g.unshift(F),g}var Ut=[v("span",{html:eo,style:"width: min-content;"}),v("span",{html:ro,style:"width: min-content;"}),v("span",{html:oo,style:"width: min-content;"})];function Fp(t){t.remove()}function pr(t,e=t){e.append.apply(e,Ut);let r=gt(Ut[0]).width,o=gt(Ut[1]).width,n=gt(Ut[2]).width,i=window.getComputedStyle(Ut[0]),s=ci(i.fontSize);Sp.DEBUG&&Oi("post render font-size",s,"heads",`${r}, ${o}, ${n}`),Ut.forEach(Fp);let u=e.querySelector(".side");if(!u)return;let a=u.dataset.key,l={"Gâ™­":6,"Câ™¯":5,"Dâ™­":5,"Gâ™¯":4,"Aâ™­":4,"Dâ™¯":3,"Eâ™­":3,"Bâ™­":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6}[a];return`--head-1-size: ${$(6,r/s)}; --head-2-size: ${$(6,o/s)}; --head-4-size: ${$(6,n/s)}; --signature-width: ${(2.25+l*.625+.625).toFixed(4)}em;`}function ue(t,e=t){e.querySelectorAll(".beam").forEach(Mi)}var Li=Object.assign,Bp=Object.defineProperties,kp=new URL("shadow.css",import.meta.url),lr=A.of(),qi=new ResizeObserver(t=>{for(let e of t)ue(E(e.target).shadowRoot)}),ww=Bp(Ar("scribe-music",{shadow:`
        <link rel="stylesheet" href="${kp}" />
    `,construct:function(t,e){let r=t.querySelector("link");lr.value&&(r.href=lr.value),e.data=A.of(),e.clef=A.of("treble"),e.key=A.of("C"),e.meter=A.of(),e.beat=A.of(0),e.duration=A.of(1/0),e.transpose=A.of(0),e.excludes=A.of([]),e.swingAsStraight8ths=A.of(!1),e.swingAsStraight16ths=A.of(!1),e.debug=A.of(!1),e.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(t,e){if(e.isSafari&&this.classList.add("safari"),qi.observe(this,{box:"content-box"}),!this.src){let r=this.textContent.trim();e.data.value=bt(this.type,r)}return A.frame(()=>{if(!e.data.value)return;let r=e.data.value&&Ui(Q.from(e.data.value),e.excludes.value,e.clef.value,e.key.value,e.meter.value,e.duration.value,e.transpose.value,e.beat.value,Li({},P,{swingAsStraight8ths:e.swingAsStraight8ths.value,swingAsStraight16ths:e.swingAsStraight16ths.value}));if(t.querySelectorAll(".side, .bar, style").forEach(n=>n.remove()),t.append.apply(t,r),!r)return;let o=e.style=v("style",`:host { ${pr(this,t)} }`);t.appendChild(o),ue(this,t),setTimeout(()=>{o.textContent=`:host { ${pr(this,t)} }`,ue(this,t)},2e3)})},load:function(t,{style:e}){e.textContent=`:host { ${pr(this,t)} }`,ue(this,t)},disconnect:function(){qi.unobserve(this)}},{clef:{attribute:function(t){this.clef=t},get:function(){return E(this).clef.value},set:function(t){if(!_e[t]){console.warn('<scribe-music> Attempt to set invalid clef="'+t+'" ignored');return}E(this).clef.value=t}},key:{attribute:function(t){this.key=t===""?"C":t},get:function(){return E(this).key.value},set:function(t){let e=E(this);if(typeof t!="string"||!/^[A-G][#bâ™¯â™­]?$/.test(t)){console.warn('<scribe-music> Attempt to set invalid key="'+t+'" ignored');return}e.key.value=t.replace(/[#b]$/,r=>r==="#"?"â™¯":"â™­")}},meter:{attribute:function(t){this.meter=t===""?"4/4":t},get:function(){return Yn(E(this).meter.value)},set:function(t){E(this).meter.value=Li([0],Xn(t))}},beat:{attribute:function(t){this.beat=t},get:function(){return E(this).beat.value},set:function(t){E(this).beat.value=typeof t=="number"?t:parseFloat(t)}},duration:{attribute:function(t){this.duration=t},get:function(){return E(this).duration.value},set:function(t){E(this).duration.value=typeof t=="number"?t:parseFloat(t)}},transpose:{attribute:function(t){this.transpose=t},get:function(){return E(this).transpose.value},set:function(t){E(this).transpose.value=typeof t=="number"?Math.round(t):parseInt(t,10)}},type:{attribute:function(t){this.type=t},writable:!0,value:"application/json"},src:{attribute:function(t){this.src=t},get:function(){return E(this).src},set:function(t){let e=E(this);e.src=t;let r=new URL(t,window.location);if(window.location.origin===r.origin&&window.location.pathname===r.pathname){let o=this.getRootNode().getElementById(r.hash.slice(1));if(!o)throw new Error('<scribe-music> src script "'+t+'" not found in document');this.data=JSON.parse(o.textContent)}else Vn(this.type,r.href).then(o=>this.data=o)},default:null},data:{get:function(){return E(this).data.value},set:function(t){E(this).data.value=t},default:null},swing:{attribute:function(t){E(this).swingAsStraight8ths.value=t!==null}},shuffle:{attribute:function(t){E(this).swingAsStraight16ths.value=t!==null}},debug:{attribute:function(t){this.debug=t!==null},get:function(){return E(this).debug.value},set:function(t){E(this).debug.value=!!t}},excludes:{attribute:function(t){return E(this).excludes.value=t.split(/\s+/)}}},"stephband.band/scribe/"),{stylesheet:{set:t=>lr.value=t,get:()=>lr.value}});export{ww as default};
//# sourceMappingURL=element.js.map
