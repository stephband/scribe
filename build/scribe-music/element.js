/* Scribe 
   0.4.36
   By stephband */

var kr=Object.defineProperty;var Nr=(t,e)=>{for(var n in e)kr(t,n,{get:e[n],enumerable:!0})};var $,ot;function Gr(t,e){let n=-1;for(;t[++n]&&t[n]!==e;);for(;t[n++];)t[n-1]=t[n]}function ze(t){let e=0;for(;t[--e];)t[e].stop&&t[e].stop(),t[e]=void 0}function Rt(t,e){let n=0;for(;e[--n]&&e[n]!==t;);for(e[n]=t,n=-1;t[++n]&&t[n]!==e;);t[n]=e}function ft(t){let e=-1,n;for(;n=t[++e];)t[e]=void 0,n.invalidate(t)}function Xe(t,e){let n=0;for(;t[--n];)if(t[n]===e)return!0}var v=class t{static isSignal(e){return e instanceof t}static of(e){return new qe(e)}static from(e,n){if(e.then){let o=t.of();return e.then(r=>o.value=r),o}return e.pipe?e.pipe(new He):new Zt(e,n)}static compute(e,n){return new Zt(e,n)}static fromProperty(e,n){return new Ue(e,n)}static frame(e){return new te(e)}static tick(e){return new _t(e)}static temporal(e,n){return new Ie(e,n)}static evaluate(e,n,o=e){let r=$;$=e,r||(ot=!1);let i=n.apply(o);return $=r,i}static get hasInvalidDependency(){return ot}static get evaluating(){return $}constructor(e){e&&(this.name=e)}valueOf(){return this.value}toString(){return this.value+""}toJSON(){return this.value}},qe=class extends v{#t;constructor(e){super(),this.#t=e}get value(){return $&&Rt(this,$),this.#t}set value(e){this.#t!==e&&(this.#t=e,ft(this))}},He=class extends v{#t;constructor(e){super(),this.#t=e}get value(){return $&&Rt(this,$),this.#t}push(e){this.#t!==e&&(this.#t=e,ft(this))}},Ue=class extends v{#t;#e;constructor(e,n){super(e),this.object=n}evaluate(){return this.object[this.name]}get value(){return $&&Rt(this,$),this.#t?this.#e:(this.#e=v.evaluate(this,this.evaluate,this),ot||(this.#t=!0),this.#e)}set value(e){if(this.#e===e)return;let{object:n,name:o}=this;n[o]=e,e=n[o],this.#e!==e&&(this.#e=e,ft(this))}invalidate(e){this.#t&&(e&&!Xe(this,e)||(this.#t=!1,ze(this),ft(this)))}},Zt=class extends v{#t;#e;#n;#o;constructor(e,n){super(),this.#t=e,this.#e=n}get value(){return $&&Rt(this,$),this.#n?this.#o:(this.#o=v.evaluate(this,this.#t,this.#e),ot||(this.#n=!0),this.#o)}invalidate(e){this.#n&&(e&&!Xe(this,e)||(this.#n=!1,ze(this),ft(this)))}},Ie=class extends v{#t=0;constructor(e,n){super(e),this.object=n}getTime(){return window.performance.now()}evaluate(){return this.object[this.name]}get value(){return v.evaluating&&(Rt(this,$),this.getTime()<this.#t&&(ot=!0)),this.evaluate()}set value(e){console.warn("Dont really want to be setting value of TimedSignal"),console.trace(),this.object[this.name]!==e&&(this.object[this.name]=e,invalidateUntil(this.getTime()))}invalidateUntil(e){let o=this.getTime()>=this.#t;this.#t=e,o&&ft(this)}},Yt=class extends v{constructor(e){if(super(),$){let n=0;for(;$[--n]&&$[n]!==this;);$[n]=this}e&&(this.evaluate=e,(v.evaluate(this,this.evaluate)||ot)&&this.cue())}invalidate(e){this.constructor.observers.indexOf(this)===-1&&(e&&!Xe(this,e)||(ze(this),this.cue()))}stop(){let e=0,n;for(;n=this[--e];){let i=-1;this[e]=void 0,n.stop?n.stop():Gr(n,this)}let o=this.constructor.observers,r=o.indexOf(this);if(r!==-1){if(o===We)throw new Error("Attempt to remove observer while observers is rendering");o.splice(r,1)}return this}valueOf(){return this}toString(){return"[object Signal]"}toJSON(){}},We;function _n(t){let e=-1,n;for(We=t;n=t[++e];)!v.evaluate(n,n.evaluate)&&!ot&&t.splice(e--,1);return We=void 0,t}var to=Promise.resolve();function eo(){_n(_t.observers).length&&to.then(eo)}var _t=class extends Yt{static observers=[];cue(){let e=this.constructor.observers;e.length||to.then(eo),e.push(this)}};function no(){_n(te.observers).length&&requestAnimationFrame(no)}var te=class extends Yt{static observers=[];cue(){let e=this.constructor.observers;e.length||window.requestAnimationFrame(no),e.push(this)}};function Mr(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function rt(t){return t===window?Mr():t.getClientRects()[0]||t.getBoundingClientRect()}function N(t){return t}function C(t,e){return function(){let o=t.apply(this,arguments),r=e[o]||e.default;if(!r)throw new Error('overload() no function defined for key "'+o+'"');return r.apply(this,arguments)}}var oo=globalThis||window,ro;function dt(t){var e=new Map;return function(o){if(oo.DEBUG&&!ro&&o===void 0&&(ro=!0,console.warn("cache() called with undefined. Not illegal, but potentially bad.")),oo.DEBUG&&arguments.length>1&&console.warn("cache() called with "+arguments.length+" arguments. Accepts exactly 1."),e.has(o))return e.get(o);var r=t(o);return e.set(o,r),r}}var io=globalThis||window,Or=Array.prototype;function $r(t,e){return typeof t=="function"?t.apply(null,e):t}function ee(t,e,n){n=n||t.length;var o=n===1?e?t:dt(t):dt(function(r){return ee(function(){var i=[r];return i.push.apply(i,arguments),t.apply(null,i)},e,n-1)});return function r(i){return arguments.length===0?r:arguments.length===1?o(i):arguments.length>=n?t.apply(null,arguments):$r(o(i),Or.slice.call(arguments,1))}}if(typeof io<"u"&&io.DEBUG){let t=ee,e=function(){var o=function(){};try{Object.defineProperty(o,"length",{value:2})}catch{return!1}return o.length===2}(),n=function(r,i,a,u){return u.toString=function(){return/function\s*[\w\d]*\s*\([,\w\d\s]*\)/.exec(a.toString())+" { ["+r+"] }"},e&&Object.defineProperty(u,"length",{value:i}),u};ee=function(r,i,a){return a=a||r.length,n("curried",a,r,t(r,i,a))}}var X=ee;function O(){}var Pr=C(N,{is:O,tag:O,data:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},dataset:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},html:function(t,e,n){e.innerHTML=n},text:function(t,e,n){e.textContent=n},style:C((t,e,n)=>typeof n,{string:(t,e,n)=>e.style=n,object:(t,e,n)=>Object.assign(e.style,n)}),children:function(t,e,n){e.innerHTML="",e.append.apply(e,n)},href:function(t,e,n){e instanceof SVGElement?e.setAttribute("href",n):e.href=n},points:V,cx:V,cy:V,r:V,x:V,y:V,dx:V,dy:V,transform:V,preserveAspectRatio:V,viewBox:V,default:function(t,e,n){t in e?e[t]=n:e.setAttribute(t,n)}});function V(t,e,n){e.setAttribute(t,n)}function Lr(t,e){for(var n=Object.keys(e),o=n.length;o--;)e[n[o]]!==void 0&&Pr(n[o],t,e[n[o]]);return t}var ne=X(Lr,!0);var je="http://www.w3.org/2000/svg",so=document.createElement("template"),Ve=(t,e)=>e&&typeof e;function ao(t,e=""){let n=document.createRange();return n.selectNode(t),n.createContextualFragment(e)}var q=C(Ve,{string:function(t,e){let n=document.createElementNS(je,t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElementNS(je,t);return typeof e.length=="number"?n.append.apply(n,e):ne(n,e),n},default:t=>document.createElementNS(je,t)}),qr=C(Ve,{string:function(t,e){let n=document.createElement(t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElement(t);return typeof e.length=="number"?n.append.apply(n,e):ne(n,e),n},default:t=>document.createElement(t)}),Hr=C(N,{comment:function(t,e){return document.createComment(e||"")},fragment:C(Ve,{string:function(t,e,n){return n?ao(n,e):(so.innerHTML=e,so.content.cloneNode(!0))},object:function(t,e,n){let o=n?ao(n):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):ne(o,e),o},default:()=>document.createDocumentFragment()}),circle:q,ellipse:q,g:q,glyph:q,image:q,line:q,rect:q,use:q,path:q,pattern:q,polygon:q,polyline:q,svg:q,tspan:q,text:q,default:qr}),b=Hr;function Ke(t,e,n){let o;typeof n!="string"&&n.input!==void 0&&n.index!==void 0&&(o=n,n=o.input.slice(n.index+n[0].length+(n.consumed||0)));let r=t.exec(n);if(!r)return;let i=e(r);return o&&(o.consumed=(o.consumed||0)+r.index+r[0].length+(r.consumed||0)),i}var Eu=X(Ke,!0);function Ur(t,e,n){throw n.input!==void 0&&n.index!==void 0&&(n=n.input),new Error('Cannot parse string "'+(n.length>128?n.length.slice(0,128)+"â€¦":n)+'"')}function Ir(t,e,n){let o=-1;for(;++o<n.length;)e=n[o]!==void 0&&t[o]?t[o](e,n):e;return t.done?t.done(e,n):t.close?t.close(e,n):e}function Wr(t,e,n,o){let r=Ke(t,i=>Ir(e,n,i),o);return r===void 0?e.catch?e.catch(n,o):Ur(t,e,o):r}var co=X(Wr,!0);var uo=Symbol("internals");function Je(t,e,n){return e[uo]=e.attachInternals&&!e.getAttribute("is")?e.attachInternals():{shadowRoot:n}}function x(t){return t[uo]}var lo=Object.defineProperties;var Qe={},zr={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return x(this).form}},labels:{get:function(){return x(this).labels}},validity:{get:function(){return x(this).validity}},validationMessage:{get:function(){return x(this).validationMessage}},willValidate:{get:function(){return x(this).willValidate}},checkValidity:{value:function(){return x(this).checkValidity()}},reportValidity:{value:function(){return x(this).reportValidity()}}},Ze=!1,Xr=co(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w-]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() â€“ name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null),po={once:!0};function jr(t){return t.sheet?Promise.resolve({target:t}):new Promise((e,n)=>{t.addEventListener("load",e,po),t.addEventListener("error",n,po)})}function Vr(t){t.stop()}function Kr(t){if(Qe[t])return Qe[t];let e=document.createElement(t).constructor;if(e===HTMLUnknownElement)throw new Error("Cannot define customised built-in - constructor for <"+t+"> is HTMLUnknownElement");return Qe[t]=e}function Jr(t,e){if(t.hasOwnProperty(e)){let n=t[e];delete t[e],t[e]=n}return t}function ho(t,e){let n=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(e.stylesheet){let o=b("link",{rel:"stylesheet",href:e.stylesheet});n.append(o)}return n}function Qr(t,e){return typeof e=="string"?e[0]==="#"?t.appendChild(document.getElementById(e.slice(1)).content.clone(!0)):t.innerHTML=e:t.appendChild(e.content.clone(!0)),t}function Zr(t){let e=t.isUpgraded;return t.isUpgraded=!0,!e}function fo(t,e){return Array.from(t.querySelectorAll('[is="'+e+'"]')).filter(Zr)}var Yr=C((t,e)=>typeof e,{object:(t,e)=>e,function:(t,e)=>({value:e}),default:(t,e)=>{throw new TypeError("element() does not accept property descriptor of type "+typeof e)}});function Ye(t,e={},n={},o=""){let{name:r,tag:i}=Xr(t),a=typeof i=="string"?Kr(i):HTMLElement,u=[],s={},l,h;for(l in n)h=Yr(l,n[l]),h.attribute&&u.push(l),(h.set||h.get||"value"in h)&&(s[l]=h),n[l]=h;function p(){let c=Reflect.construct(a,arguments,p),d=e.mode||typeof e.shadow=="string"?ho(c,e):void 0;e.shadow&&Qr(d,e.shadow);let g=Je(p,c,d);return i&&(Ze=!0),e.construct&&e.construct.call(c,d,g),Object.keys(s).reduce(Jr,c),c}if(p.prototype=Object.create(a.prototype,s),n.value&&(p.formAssociated=!0,lo(p.prototype,zr),(e.enable||e.disable)&&(p.prototype.formDisabledCallback=function(c){let d=x(this);return c?e.disable&&e.disable.call(this,d.shadowRoot,d):e.enable&&e.enable.call(this,d.shadowRoot,d)}),e.reset&&(p.prototype.formResetCallback=function(){let c=x(this);return e.reset.call(this,c.shadowRoot,c)}),e.restore&&(p.prototype.formStateRestoreCallback=function(){let c=x(this);return e.restore.call(this,c.shadowRoot,c)})),u.length&&(p.observedAttributes=u,p.prototype.attributeChangedCallback=function(c,d,g){return n[c].attribute.call(this,g)}),e.connect&&(p.prototype.connectedCallback=function(){let c=x(this),d=c.shadowRoot;if(c.stopable=e.connect.call(this,d,c),!d)return;let g=d.querySelectorAll('link[rel="stylesheet"]');if(g.length){let f=b("style","*:not(slot), slot:not([name]) { display: none !important; }");d.prepend(f);let m;c.loadPromise?m=c.loadPromise.then(()=>new Promise(requestAnimationFrame)):m=c.loadPromise=Promise.all(Array.from(g,jr)),m.finally(()=>{f.remove(),e.load&&e.load.call(this,d,c)})}else e.load&&e.load.call(this,d,c)}),p.prototype.disconnectedCallback=function(){let c=x(this);c.stopable&&(c.stopable.stop?c.stopable.stop():c.stopable.forEach(Vr)),e.disconnect&&e.disconnect.call(this,c.shadowRoot,c)},window.console&&window.console.log("%c<"+(i?i+" is="+r:r)+">%c "+o,"color:#3a8ab0;font-weight:600;","color:#888888;font-weight:400;"),window.customElements.define(r,p,i&&{extends:i}),i&&!Ze){let c=document.createElement("div");if(c.style.position="fixed",c.style.left="-1000px",c.style.top="-1000px",c.innerHTML="<"+i+' is="'+r+'"></'+i+">",document.body.append(c),c.remove(),Ze)p.polyfillByRoot=O;else{let d=function(f){let m={};Object.keys(s).forEach(R=>{f[R]!==void 0&&(m[R]=f[R])}),lo(f,s);let w=e.mode||e.shadow?ho(f,e):void 0,y=Je(p,f,w);e.construct&&e.construct.call(f,w,y),Object.assign(f,m);let E=-1,M;for(;M=u[++E];){let R=f.attributes[M];R&&n[M].attribute.call(f,R.value)}e.connect&&e.connect.call(f,w,y)},g=function(f){fo(f,r).forEach(d),new MutationObserver(()=>fo(f,r).forEach(d)).observe(f,{childList:!0,subtree:!0})};p.polyfillByRoot=g,g(document)}}else p.polyfillByRoot=O;return p}var mt=t=>typeof t;var _r=Object.defineProperties,mo=C(mt,{function:t=>t(),object:t=>t.stop()}),it=class extends N{#t;stop(){if(this.status==="done")return this;this.status="done";let e=this.#t;return this.#t=void 0,e&&e.forEach(mo),this}done(e){return this.status==="done"?(mo(listener),this):((this.#t||(this.#t=[])).push(e),this)}};_r(it.prototype,{status:{writable:!0}});function ti(t){throw new TypeError("Stream cannot be created .from() "+typeof t)}function H(t,e){if(e===void 0)return;let n=-1;for(;t[++n];)t[n].push(e);return t}function ei(t){it.prototype.stop.apply(t);let e=-1,n;for(;n=t[++e];)t[e]=void 0,n.stop&&(an(n,t),n[-1]||n.stop());return t}function an(t,e){let n=0;for(;t[--n]&&t[n]!==e;);for(;t[n--];)t[n+1]=t[n]}function go(t,e){let n=-1;for(;t[++n]&&t[n]!==e;);for(;t[n++];)t[n-1]=t[n]}function ni(t,e){an(e,t),go(t,e)}var Ft=class extends it{stop(){if(this.status==="done")return this;let e;for(;e=this[-1];){let n=-1;for(;this[n--];)this[n+1]=this[n];go(e,this),e.stop&&!e[0]&&e.stop(e)}return super.stop()}},oe=class extends Ft{constructor(e){super(),this.push=e}},re=class extends Ft{constructor(e,n){super(),this.fn=e,this.value=n,this.i=0}push(e){let n=this.fn;this.value=n(this.value,e,this.i++,this)}},L=class extends Ft{start(){if(this.status)return this;let e=0,n;t:for(;n=this[--e];){let o=-1;for(;n[++o];)if(n[o]===this)continue t;n[o]=this,o===0&&n.start&&n.start()}return this}stop(){if(this.status==="done")return this;super.stop();let e=-1,n;for(;n=this[++e];)this[e]=void 0,n.stop&&(an(n,this),n[-1]||n.stop());return this}pipe(e){if(e.stop){let o=0;for(;e[--o]&&e[o]!==this;);e[o]=this}if(e.start&&!(e[0]||e.status==="running"))return e;let n=-1;for(;this[++n]&&this[n]!==e;);return this[n]=e,n||this.start(),e}each(e){return this.pipe(new oe(e))}buffer(...e){return this.pipe(new gt(e))}filter(e){return this.pipe(new tn(e))}flatMap(e){return this.pipe(new en(e))}map(e){return this.pipe(new se(e))}reduce(e,n){return this.pipe(new re(e,n)).value}scan(e,n){return this.pipe(new on(e,n))}slice(e,n){return this.pipe(new rn(e,n))}split(e){return this.pipe(new sn(e))}[Symbol.asyncIterator]=async function*(){let e=[],n=r=>e.push(r);function o(r,i){n=r}for(this.each(r=>n(r)).done(()=>n=O);n!==O;)yield e.length?e.shift():await new Promise(o)};static from=C(mt,{function:e=>new se(e),object:e=>typeof e.pipe=="function"?e:typeof e.then=="function"?new _e(e):typeof e.length=="number"?new gt(Array.from(e)):ti(e)});static of(...e){return e.length<2?new ie(e[0]):new gt(e)}static buffer(e){return new gt(e)}static value(e){return new ie(e)}static merge(...e){return new nn(e)}static push=H;static stop=ei;static unpipe=ni;static each(e){return new oe(e)}static reduce(e,n){return new re(e,n)}},_e=class extends L{constructor(e){super(),this.promise=e}start(){return this.promise.then(e=>H(this,e)).finally(()=>this.stop()),this}},ie=class extends L{constructor(e){super(),this.value=e}start(){return this.value!==void 0&&(H(this,this.value),this.status==="done")?this:super.start()}push(e){return this.value=e,H(this,e)}},gt=class extends L{constructor(e){super(),this.values=e||[]}start(){let e=this.values;if(!e)return super.start();let n=-1;for(;n++<e.length;)if(H(this,e[n]),this.status==="done")return this;return this.values=void 0,super.start()}push(e){return this.value=e,this.values?this.values.push(this.value):H(this,this.value)}},tn=class extends L{constructor(e){super(),this.fn=e}push(e){let n=this.fn;return n(e)&&H(this,e)}},en=class extends L{constructor(e){super(),this.fn=e}push(e){let n=this.fn,o=n(e);if(o!==void 0)if(isIterable(o))for(let r of o)H(this,r);else o.pipe?(console.warn("FlatMapping pipeables is dodgy. Map to arrays for the moment please."),this.done(o.each(r=>H(this,r)))):o.then&&o.then(r=>H(this,r))}},se=class extends L{constructor(e){super(),this.fn=e}push(e){let n=this.fn,o=n(e);return o!==void 0&&H(this,o)}},nn=class extends L{constructor(e){super(),this.inputs=e}push(e){return H(this,e)}pipe(e){let n=-1,o;for(;o=this.inputs[++n];)L.from(o).pipe(this);return L.prototype.pipe.call(this,e)}},on=class extends L{constructor(e,n){super(),this.fn=e,this.value=n}push(e){let n=this.fn;this.value=n(this.value,e),H(this,this.value)}},rn=class extends L{constructor(e,n=1/0){super(),this.index=-e,this.indexEnd=n-e}push(e){++this.index>0&&H(this,e),this.index===this.indexEnd&&this.stop()}},sn=class extends L{constructor(e){super(),this.chunk=[],typeof e=="number"?this.n=e:this.fn=e}fn(){return this.chunk.length===this.n}push(e){let n=this.chunk;this.fn(e)?(H(this,n),this.chunk=[]):n.push(e)}};var Ku={fullscreenchange:dt(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},oi=0;window.addEventListener("click",t=>oi=t.timeStamp);function cn(t){return function(){return arguments[t]}}function un(t){return t}function st(){}function K(){return this}var wo=Object.create,ri=Object.freeze,xo=ri(wo(wo(Object.prototype,{at:{value:st},shift:{value:st},push:{value:st},forEach:{value:st},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:K},find:{value:st},findIndex:{value:function(){return-1}},flat:{value:K},flatMap:{value:K},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:K},reduce:{value:cn(1)},sort:{value:K},each:{value:K},pipe:{value:un},start:{value:K},stop:{value:K},done:{value:K},valueOf:{value:function(){return null}}}),{length:{value:0}}));function ln(t,e){return(e%t+t)%t}var yo=t=>ln(12,t);var ii=/^([A-G][â™­â™¯#b]?)(-?\d)$/,si=/^[A-G][â™­â™¯#b]?/,ai=/-?\d$/,ci=/[Hh]z$/,Tt={C:0,"Câ™¯":1,"C#":1,"Dâ™­":1,Db:1,D:2,"Dâ™¯":3,"D#":3,"Eâ™­":3,Eb:3,E:4,F:5,"Fâ™¯":6,"F#":6,"Gâ™­":6,Gb:6,G:7,"Gâ™¯":8,"G#":8,"Aâ™­":8,Ab:8,A:9,"Aâ™¯":10,"A#":10,"Bâ™­":10,Bb:10,B:11},pn={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Low Bass Drum",36:"High Bass Drum",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Floor Tom",42:"Closed Hi-hat",43:"High Floor Tom",44:"Pedal Hi-hat",45:"Low Tom",46:"Open Hi-hat",47:"Low Mid Tom",48:"High Mid Tom",49:"Crash Cymbal 1",50:"High Tom",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Eo(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in pn)Tt[Eo(pn[t])]=parseInt(t,10);var ui=69;function li(t,e=440){var n=ui+12*Math.log(t/e)/Math.log(2);return Math.fround(n)}function D(t){if(typeof t=="number")return t;if(ci.test(t))return li(parseFloat(t));let e=ii.exec(t);return e?(parseInt(e[2],10)+1)*12+Tt[e[1]]:Tt[Eo(t)]}function A(t){return typeof t=="number"?yo(t):Tt[si.exec(t)[0]]}var ae=["C","Câ™¯","D","Eâ™­","E","F","Fâ™¯","G","Gâ™¯","A","Bâ™­","B"];function Z(t){return I(t)+ce(t)}function I(t){return ae[yo(t)]}function ce(t){return typeof t=="number"?Math.floor(t/12)-1:Number(Tt[(ai.exec(name)||xo)[0]])}function bo(t){let e=D(t);return pn[e]||""}function hn(t){var e={};return function(o){return o in e?e[o]:e[o]=t(o)}}function ue(t){return function(n,...o){var r=t[n]||t.default;return r&&r.apply(this,o)}}var pi={xml:"application/xml",html:"text/html",svg:"image/svg+xml"};function fn(t,e){if(e){var n=pi[t.toLowerCase()]||t,o;try{o=new window.DOMParser().parseFromString(e,n)}catch{return}if(!o||o.getElementsByTagName("parsererror").length)throw new Error("Invalid "+t.toUpperCase()+": "+e);return o}}function vo(t){return fn("html",t)}function Do(t){return fn("svg",t)}var et=Object.assign,wt={headers:function(t){return{}},body:N},hi=ue({"application/x-www-form-urlencoded":function(t){return et(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})},"application/json":function(t){return et(t,{"Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"})},"multipart/form-data":function(t){return et(t,{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"})},"audio/wav":function(t){return et(t,{"Content-Type":"audio/wav","X-Requested-With":"XMLHttpRequest"})},"image/png":function(t){return et(t,{"Content-Type":"image/png","X-Requested-With":"XMLHttpRequest"})},"image/jpg":function(t){return et(t,{"Content-Type":"image/jpg","X-Requested-With":"XMLHttpRequest"})},"image/jpeg":function(t){return et(t,{"Content-Type":"image/jpeg","X-Requested-With":"XMLHttpRequest"})},default:function(t){return et(t,{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"})}}),fi=ue({"application/json":function(t){return t instanceof FormData?di(t):JSON.stringify(t)},"application/x-www-form-urlencoded":function(t){return t instanceof FormData?Co(t):Ao(t)},"multipart/form-data":function(t){return t instanceof FormData?t:mi(t)},default:N});function di(t){return JSON.stringify(Array.from(t.entries()).reduce(function(e,n){return e[n[0]]=n[1],e},{}))}function Co(t){return new URLSearchParams(t).toString()}function Ao(t){return Object.keys(t).reduce((e,n)=>(e.append(n,t[n]),e),new URLSearchParams)}function mi(t){throw new Error("TODO: dataToFormData(data)")}function gi(t,e){return e instanceof FormData?t+"?"+Co(e):t+"?"+Ao(e)}function wi(t,e,n,o){let r=typeof n=="string"?n:n&&n["Content-Type"]||"application/json",i=hi(r,et(wt.headers&&e?wt.headers(e):{},typeof n=="string"?{}:n)),a={method:t,mode:"cors",headers:i,credentials:"same-origin",signal:o&&o.signal};return t!=="GET"&&(a.body=fi(r,wt.body?wt.body(e):e)),a}function le(t){return t.blob()}function xi(t){return t.json().catch(e=>{throw new Error("Cannot parse JSON "+t.url+". "+e.message)})}function So(t){return t.formData()}function yi(t){return t.text()}function Ei(t){return t.text().then(e=>/^\s*<!DOCTYPE html>/.test(e)?vo(e):b("fragment",e))}function bi(t){return t.text().then(e=>/^\s*<\?xml/.test(e)?Do(e):(console.warn("Untested SVG fragment parsing in request.js!"),b("fragment",e)))}var vi={"text/plain":yi,"text/html":Ei,"image/svg+xml":bi,"application/json":xi,"multipart/form-data":So,"application/x-www-form-urlencoded":So,audio:le,"audio/wav":le,"audio/m4a":le,"application/zip":le};function Di(t){if(wt.onresponse&&(t=wt.onresponse(t)),!t.ok)throw new Error(t.statusText+"");let e=t.headers.get("Content-Type");if(!e)return;let n=e.replace(/\;.*$/,"");return vi[n](t)}function Bo(t="GET",e,n={},o="application/json"){t=t.toUpperCase(),t==="GET"&&n&&(e=gi(e,n));let r=wi(t,n,o,arguments[4]);return fetch(e,r).then(Di)}function Ro(t){return Bo("GET",t)}var Si={chord:3,note:3,key:1,meter:2,rate:1,lyric:2},Ci=/^[ABCDEFG][bâ™­#â™¯]{0,1}-?\d$/,Fo=/^[ABCDEFG][bâ™­#â™¯]{0,1}/;function dn(t){let e=t.trim().split(/\s+/),n=[],o=-1;for(;e[++o]!==void 0;){let r=Number(e[o]),i=e[++o];Ci.test(i)?(i="note",--o):Fo.test(i)&&(i="chord",--o);let a=[r,i],u=Si[i];if(u===void 0)throw new TypeError('Unrecognised type "'+i+'" in sequence data');if(i==="chord"){let s=Fo.exec(e[++o])[0],l=e[o].slice(s.length)||e[++o],h=Number(e[++o]);a.push(s,l,h)}else for(;u--;){let s=Number(e[++o]);a.push(Number.isNaN(s)?e[o]:s)}n.push(a)}return n}function Ai(t){let e=t.files[Object.keys(t.files)[0]];return at(e.type,e.content)}function Bi(t){let e=t.settings.find(matches({id:13324}))||t.settings[0];return at("abc",e.abc)}function at(t,e){if(typeof e=="object")return e.files?Ai(e):e.settings?Bi():Array.isArray(e)?{id:0,events:e}:e;if(t==="sequence"||t==="text/plain")return{events:dn(e)};{let n=JSON.parse(e);return Array.isArray(n)?{id:0,events:n}:n}}var Ri=hn(Ro);var To=C((t,e)=>typeof e,{string:function(t,e){return Ri(e).then(n=>at(t,n)).catch(n=>console.error(n))},default:function(t,e,n,o){e[t]=o}});var Fi=/^(\d+)\/(\d+)$/;function ko(t){let e=Fi.exec(t),n=parseInt(e[1],10),o=4/parseInt(e[2],10);return{1:"meter",2:n*o,3:o}}function No(t){let e=t[2],n=t[3],o=e/n,r=4/n;return o+"/"+r}var G={};Nr(G,{accentDown:()=>fe,accentUp:()=>he,acciDoubleFlat:()=>$t,acciDoubleSharp:()=>qt,acciFlat:()=>Pt,acciNatural:()=>xt,acciParensLeft:()=>Ii,acciParensRight:()=>Wi,acciSharp:()=>Lt,augmentationDot:()=>ls,barLine:()=>Ps,barRepeat1:()=>Ls,barRepeat2:()=>qs,barRepeat4:()=>Hs,barRepeatBegin:()=>zs,barRepeatDots:()=>Vs,barRepeatEnd:()=>Xs,barRepeatEndBegin:()=>js,barRepeatLowerDot:()=>Ws,barRepeatSlash:()=>Us,barRepeatUpperDot:()=>Is,chordAugmented:()=>sa,chordBassSlash:()=>Sn,chordBracketLeft:()=>pa,chordBracketRight:()=>ha,chordDiminished:()=>ra,chordGlyphs:()=>fa,chordHalfDiminished:()=>ia,chordMajorSeventh:()=>aa,chordMinor:()=>ca,chordParensLeftTall:()=>ua,chordParensRightTall:()=>la,clefAlto:()=>Mt,clefBass:()=>Ot,clefDrum:()=>pe,clefTreble:()=>kt,clefTrebleDown:()=>Nt,clefTrebleUp:()=>Gt,coda:()=>Dn,graceNoteStemDown:()=>Ds,graceNoteStemUp:()=>vs,head1:()=>mn,head2:()=>gn,head4:()=>wn,headBracketLeft:()=>Ht,headBracketRight:()=>Ut,headCircle:()=>Ji,headCircleX:()=>Qi,headDiamond:()=>Xi,headDiamondWide:()=>ji,headPlus:()=>Ki,headSlashHorizontalEnds:()=>_i,headSlashVerticalEnds:()=>Yi,headSlashed2:()=>zi,headTriangleUp:()=>Zi,headX:()=>Vi,marcatoDown:()=>me,marcatoUp:()=>de,metDot:()=>bs,metNote05Down:()=>Es,metNote05Up:()=>ws,metNote1Down:()=>ys,metNote1Up:()=>gs,metNote2Down:()=>xs,metNote2Up:()=>ms,note0125Down:()=>us,note0125Up:()=>rs,note025Down:()=>cs,note025Up:()=>os,note05Down:()=>as,note05Up:()=>ns,note1Down:()=>ss,note1Up:()=>es,note2Down:()=>is,note2Up:()=>ts,rest0125:()=>xn,rest01875:()=>Ts,rest025:()=>yn,rest0375:()=>ks,rest05:()=>En,rest075:()=>Ns,rest1:()=>bn,rest15:()=>Gs,rest2:()=>vn,rest3:()=>Ms,rest4:()=>Os,rest6:()=>$s,staccatoDown:()=>hs,staccatoUp:()=>ps,tailDown0125:()=>Fs,tailDown025:()=>Bs,tailDown05:()=>Cs,tailUp0125:()=>Rs,tailUp025:()=>As,tailUp05:()=>Ss,tenutoDown:()=>ds,tenutoUp:()=>fs,textBeam16Long:()=>Da,textBeam16Short:()=>va,textBeam8Long:()=>ba,textBeam8Short:()=>Ea,textDot:()=>Sa,textNote16Long:()=>ya,textNote16Short:()=>xa,textNote8Long:()=>wa,textNote8Short:()=>ga,textNoteLong:()=>ma,textNoteShort:()=>da,textTie:()=>Ca,textTuplet3Long:()=>Ta,textTuplet3Short:()=>Ba,textTupletBeginLong:()=>Fa,textTupletBeginShort:()=>Aa,textTupletEndLong:()=>ka,textTupletEndShort:()=>Ra,timeSig0:()=>Ti,timeSig1:()=>ki,timeSig2:()=>Ni,timeSig3:()=>Gi,timeSig4:()=>Mi,timeSig5:()=>Oi,timeSig6:()=>$i,timeSig7:()=>Pi,timeSig8:()=>Li,timeSig9:()=>qi,timeSigCommon:()=>Hi,timeSigCutCommon:()=>Ui,tuplet0:()=>Ks,tuplet1:()=>Js,tuplet2:()=>Qs,tuplet3:()=>Zs,tuplet4:()=>Ys,tuplet5:()=>_s,tuplet6:()=>ta,tuplet7:()=>ea,tuplet8:()=>na,tuplet9:()=>oa});var kt="&#xE050;",Nt="&#xE052;",Gt="&#xE053;",Mt="&#xE05C;",Ot="&#xE062;",pe="&#xE069;",Ti="&#xE080;",ki="&#xE081;",Ni="&#xE082;",Gi="&#xE083;",Mi="&#xE084;",Oi="&#xE085;",$i="&#xE086;",Pi="&#xE087;",Li="&#xE088;",qi="&#xE089;",Hi="&#xE08A;",Ui="&#xE08B;",$t="&#xE264;",Pt="&#xE260;",xt="&#xE261;",Lt="&#xE262;",qt="&#xE263;",Ii="&#xE26A;",Wi="&#xE26B;",mn="&#xE0A4;",gn="&#xE0A3;",wn="&#xE0A2;",Ht="&#xE0F5;",Ut="&#xE0F6;",zi="&#xE0D0;",Xi="&#xE0DB;",ji="&#xE0DC;",Vi="&#xE0A9;",Ki="&#xE0AF;",Ji="&#xE0E8;",Qi="&#xE0B3;",Zi="&#xE0BE;",Yi="&#xE100;",_i="&#xE101;",ts="&#xE1D3;",es="&#xE1D5;",ns="&#xE1D7;",os="&#xE1D9;",rs="&#xE1DB;",is="&#xE1D4;",ss="&#xE1D6;",as="&#xE1D8;",cs="&#xE1DA;",us="&#xE1DC;",ls="&#xE1E7;",he="&#xE4A0;",fe="&#xE4A1;",ps="&#xE4A2;",hs="&#xE4A3;",fs="&#xE4A4;",ds="&#xE4A5;",de="&#xE4AC;",me="&#xE4AD;",ms="&#xECA3;",gs="&#xECA5;",ws="&#xECA7;",xs="&#xECA4;",ys="&#xECA6;",Es="&#xECA8;",bs="&#xECB7;",vs="&#xE560;",Ds="&#xE561;",Ss="&#xE240;",Cs="&#xE241;",As="&#xE242;",Bs="&#xE243;",Rs="&#xE244;",Fs="&#xE245;",xn="&#xE4E8;",Ts="&#xE4E8;&#xE1E7;",yn="&#xE4E7;",ks="&#xE4E7;&#xE1E7;",En="&#xE4E6;",Ns="&#xE4E6;&#xE1E7;",bn="&#xE4E5;",Gs="&#xE4E5;&#x200A;&#xE1E7;",vn="&#xE4E4;",Ms="&#xE4E4;&#x200A;&#xE1E7;",Os="&#xE4E3;",$s="&#xE4E3;&#x200A;&#xE1E7;",Ps="&#xE030",Ls="&#xE500;",qs="&#xE501;",Hs="&#xE502;",Us="&#xE504;",Is="&#xE503;",Ws="&#xE505;",zs="&#xE040",Xs="&#xE041",js="&#xE042",Vs="&#xE043",Dn="&#xE048",Ks="&#xE880;",Js="&#xE881;",Qs="&#xE882;",Zs="&#xE883;",Ys="&#xE884;",_s="&#xE885;",ta="&#xE886;",ea="&#xE887;",na="&#xE888;",oa="&#xE889;",ra="&#xE870;",ia="&#xE871;",sa="&#xE872;",aa="&#xE873;",ca="&#xE874;",ua="&#xE875;",la="&#xE876;",pa="(",ha=")",Sn="&#xE87B;",fa={"âˆ†â™¯11":"î¡³îµ¢11","âˆ†":"î¡³",7:"7","-7":"î¡´7","-â™­6":"î¡´îµ 6","7susâ™­9":"7susîµ¢",Ã¸:"î¡±","7â™¯11":"7îµ¢11","-âˆ†":"î¡´î¡³","âˆ†â™­6":"î¡³îµ 6","-â™­9":"î¡´îµ 9",Ã¸7:"î¡±7","âˆ†â™¯5":"î¡³îµ¢5","7alt":"7alt","Â°":"î¡°",dim:"î¡°","7â™­9":"7îµ ","+7":"î¡²7"},da="&#xE1F0;",ma="&#xE1F1;",ga="&#xE1F2;",wa="&#xE1F3;",xa="&#xE1F4;",ya="&#xE1F5;",Ea="&#xE1F7;",ba="&#xE1F8;",va="&#xE1F9;",Da="&#xE1FA;",Sa="&#xE1FC;",Ca="&#xE1FD;",Aa="&#xE1FE",Ba="&#xE1FF",Ra="&#xE200",Fa="&#xE201",Ta="&#xE202",ka="&#xE203";function Cn(t){return function(){return arguments[t]}}function J(){return this}var Go=Object.create,Na=Object.freeze,ge=Na(Go(Go(Object.prototype,{at:{value:O},shift:{value:O},push:{value:O},forEach:{value:O},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:J},find:{value:O},findIndex:{value:function(){return-1}},flat:{value:J},flatMap:{value:J},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:J},reduce:{value:Cn(1)},sort:{value:J},each:{value:J},pipe:{value:N},start:{value:J},stop:{value:J},done:{value:J},valueOf:{value:function(){return null}}}),{length:{value:0}}));function j(t){return Math.pow(10,t/20)}var Ga=/^\s*([+-]?\d*\.?\d+)([^\s]*)\s*$/;function ct(t){return function(n){if(typeof n=="number")return n;var o=Ga.exec(n);if(!o||!t[o[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+n+'" (accepted units '+Object.keys(t).join(", ")+")");return o?t.catch(parseFloat(o[1]),o[2]):t.catch(parseFloat(n))}return t[o[2]||""](parseFloat(o[1]))}}var Mo={fff:j(-5),ff:j(-10),f:j(-15),mf:j(-20),mp:j(-25),p:j(-30),pp:j(-35),ppp:j(-40)},yt=ct({"":parseFloat,db:j,dB:j,catch:t=>{if(!Mo[t])throw new Error('Sequence: dynamic "'+t+'" not recognised');return Mo[t]}});var Ma=/b|#/g,Oa={b:"â™­","#":"â™¯"};function $a(t){return Oa[t]}function An(t){switch(t[1]){case"chord":t[2]=A(t[2]),t[3]=t[3].replaceAll(Ma,$a);break;case"lyric":console.warn('Old data contains "lyric" event, should be "text"'),t[1]="text";break;case"key":t[2]=A(t[2]);break;case"note":t[2]=D(t[2]),t[3]=yt(t[3]);break}return t}var Pa=Object.assign,we=Object.defineProperty,xe={writable:!0};function La(t){let e=[],n=-1;for(;t[++n]!==void 0;)e.push(t[n]);return e}function Et(t){return t.toFixed(4).replace(/\.?0+$/,"")}var bt=class t{constructor(){Pa(this,An(arguments)),we(this,"event",xe),we(this,"events",xe),we(this,"index",xe),we(this,"target",xe)}toJSON(){return La(this)}toString(){let e=Et(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+I(this[2])+" "+this[3]+" "+Et(this[4]);break;case"key":e+=" "+I(this[2]);break;case"note":e+=" "+Z(this[2])+" "+this[3]+" "+Et(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+Et(this[4])+" "+this[5];break;case"rate":e+=" "+Et(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+Et(this[4]);break;case"start":case"stop":e+=" "+Z(this[2])+" "+this[3];break;default:let n=1;for(;this[++n]!==void 0;)e+=this[n]}return e}static of(...e){return new t(...e)}static from(e,n,o){let r=new t(...e);return r.event=e,r.events=n,r.index=o,r}static isChordEvent=Bn;static isNoteEvent=ye;static isSequenceEvent=qa};function Bn(t){return t[1]==="chord"}function ye(t){return t[1]==="note"}function qa(t){return t[1]==="sequence"}function Ha(t,e){return e[t]}var ut=X(Ha,!0);var Oo=C(ut(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function T(t){return t[0]+Oo(t)}function vt(t,e){return(e%t+t)%t}function Y(t){return vt(12,t)}function $o(t,e){return t>e?1:t<e?-1:0}var U=[0,2,4,5,7,9,11];function Ua(t,e,n){return n.indexOf(t)===e}function Po(t,e){return t.map(n=>Y(n+e)).filter(Ua).sort($o)}var kn=[{name:"C",symbol:"Câˆ†",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Dâ™­",symbol:"Dâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"Dâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"Eâ™­",symbol:"Eâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"Eâˆ†",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"Fâˆ†",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Fâ™¯",symbol:"Fâ™¯âˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"Gâˆ†",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"Aâ™­",symbol:"Aâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"Aâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"Bâ™­",symbol:"Bâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"Bâˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function Dt(t){return Po(U,t)}var{abs:dp}=Math,Ia={"":[0,4,7],"âˆ†":[0,4,7,11],"âˆ†7":[0,4,7,11],"âˆ†â™¯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-6":[0,3,7,9],"-13":[0,3,7,9],"-â™­6":[0,3,7,8],"7susâ™­9":[0,1,5,7,10],Ã¸:[0,3,6,10],"-âˆ†":[0,3,7,11],"7â™¯11":[0,4,6,7,10],"âˆ†â™­6":[0,4,7,8],"-â™­9":[0,1,3,7],Ã¸7:[0,2,3,6,10],"âˆ†â™¯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"Â°":[0,3,6,9],"7â™­9":[0,1,4,7,10],"7â™¯9":[0,3,4,7,10],"7â™­13":[0,4,7,8,10],"13â™­9":[0,1,4,7,9],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},Wa=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),za=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],mp={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function Fn(t){let e=new Float32Array(12),n=A(t+2),o=7;for(;o--;)n=A(n+5),e[n]=1;return e}function Tn(t,e,n){let o=t.length;for(;o--;)t[o]*=1-n+n*e[o];return t}var Rn={note:(t,e,n=1)=>{let o=D(e[2]),r=Fn(o);return Tn(t,r,n*(1-o/192))},chord:(t,e,n=1)=>{let o=A(e[2]),r=Ia[e[3].replace(/\(|\)/g,"")];if(!r)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=r.map(s=>A(o+s)),a=i.length,u;for(;a--;)u=Fn(i[a]),Tn(t,u,n/i.length*Wa[r[a]]);return t}};function be(t,e,n){let o=t[e],r=o[0],i=ye(o)?Fn(D(o[2])):Bn(o)?Rn.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(n!==void 0){let u=Float32Array.from({length:12},(s,l)=>za[(l+12-n)%12]);Tn(i,u,.3)}let a=e;for(;o=t[--a];){let u=Rn[o[1]];if(!u)continue;let s=T(o);if(s>r)u(i,o,.5);else if(o[1]==="note"&&r-s<3){if(1-(r-s)/3>1)throw new Error("Influence should never be > 1 "+r+" "+s);u(i,o,.25*(1-(r-o[0])/3))}}for(a=e;(o=t[++a])&&o[0]-r<2;){if(!ye(o))continue;let u=Rn[o[1]];if(u){if(1-(o[0]-r)/2>1)throw new Error("Influence should never be > 1 "+r+" "+stopBeat);u(i,o,.3*(1-(o[0]-r)/2))}}return i}var Ee=[0,7,5,2,10,9,3,4,8,11,1,6];function ve(t){let e=Ee.length,n=0,o;for(;e--;)t[Ee[e]]>n&&(n=t[Ee[e]],o=Ee[e]);return o}var qo=/^([A-G])([b#â™­â™¯ð„«ð„ª])?(-?\d)?$/,Ho=/b|â™­/,Uo=/#|â™¯/;var De=/b|â™­|#|â™¯/g;var Se={"-2":"ð„«","-1":"â™­",0:"",1:"â™¯",2:"ð„ª"},Lo=["Fâ™¯","Câ™¯","Gâ™¯","Dâ™¯","Aâ™¯","Eâ™¯","Bâ™¯","Bâ™­","Eâ™­","Aâ™­","Dâ™­","Gâ™­","Câ™­","Fâ™­"];function Ce(t,e){let n=Lo.indexOf(t.pitch),o=Lo.indexOf(e.pitch);return n>o?1:n<o?-1:0}var Io={"-2":"ð„«","-1":"â™­",0:"",1:"â™¯",2:"ð„ª"};function Wo(t,e){let n=kn[t],o=A(e),r=n.spellings[Y(o)];return ae[Y(o-r)]+Io[r]}function zo(t,e){let n=kn[t],o,r,i;if(typeof e=="string"){let[s,l,h,p]=qo.exec(e)||[e];p&&(o=D(e),r=n.spellings[Y(o)],i=ce(o-r))}else o=e,r=n.spellings[Y(o)],i=ce(o-r);let a=ae[Y(o-r)],u=Io[r];return a+u+i}var P={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,marcatoThreshold:yt("-6dB"),accentThreshold:yt("-12dB"),ghostThreshold:yt("-30dB"),headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};var Xa=globalThis||window;var{floor:Xo,round:Mp}=Math,B=class{constructor(){}pitched=!0;rows=ge;getHeadHTML(e,n,o){let r=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${r}">${G[r]}</span>`}getNoteHTML(e,n,o){return n<P.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${Ht}</span>
            ${this.getHeadHTML(e,n,o)}
            <span class="post" data-glyph="headBracketRight">${Ut}</span>`:this.getHeadHTML(e,n,o)}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return Xo(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,n){let o=D(this.minPitch),r=D(this.maxPitch),i=D(e)+n;return i>=o&&i<=r?i:void 0}parts=[{name:"main"}];getPart(e){return this.parts[0]}getRow(e,n){let r=(typeof n=="string"?n:Z(n)).replace(De,""),i=this.rows.indexOf(r);if(Xa.DEBUG&&i===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+n+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getPitch(e){let n=this.rows[e];return n?n.split(/\s+/)[0]:void 0}getSpelling(e,n){return n[1]==="chord"?Wo(e,n[2]):zo(e,n[2])}createKeySymbols(e){let n=[],o=A(e),r=Dt(o);return n.push.apply(n,r.map((i,a)=>i-U[a]&&{type:"acci",pitch:I(U[a])+Se[i-U[a]],value:i-U[a],part:this.parts[0]}).filter(i=>!!i).sort(Ce)),n}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let n=Xo(e*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};function Nn(t){if(t=typeof t=="number"?t+"":t.trim(),typeof t=="string")return t.toLowerCase().replace(/^[\W_]+/,"").replace(/[\W_]+$/,"").replace(/[\W_]+/g,"-")}var ja=globalThis||window;function S(t){return Nn(bo(t))}var lt=class extends B{type="drum";pitched=!1;rows=["","","",S(55)+" "+S(52),S(57),S(49),S(51)+" "+S(53)+" "+S(59),S(42)+" "+S(46),S(50)+" "+S(56),S(48)+" "+S(47),S(38)+" "+S(40),S(45)+" "+S(31)+" "+S(39)+" "+S(54),S(43),S(41),S(35)+" "+S(36),"",S(44),"","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#e={31:!0,35:!0,36:!0,37:!0,38:!0,40:!0,41:!0,42:!0,43:!0,45:!0,47:!0,48:!0,50:!0,56:!0};getNoteHTML(e,n,o){let r=D(e),i=this.#t[r],a=this.#e[r],u=i?`<span class="head" data-glyph="${i}">${G[i]}</span>`:this.getHeadHTML(e,n,o);return a&&n<P.ghostThreshold?`
            <span class="pre" data-glyph="headBracketLeft">${Ht}</span>
            ${u}
            <span class="post" data-glyph="headBracketRight">${Ut}</span>
            `:u}parts=[{name:"drums",beam:"drums-beam",stemup:!1},{name:"cymbals",beam:"cymbals-beam",stemup:!0}];getPart(e){return[35,36,37,38,40,41,43,44,45,47,48,50].includes(D(e))?this.parts[0]:this.parts[1]}getRow(e,n){let o=typeof n=="string"?n:S(n);if(!o)throw new Error("Number not found for pitch "+n);let r=this.rows.findIndex(i=>i.includes(o));if(ja.DEBUG&&r===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return r===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),r>-1?r:void 0}getSpelling(e,n){return n[1]==="note"?S(n[2]):super.getSpelling(e,n[2])}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let n=floor(e*this.rows.length),o=n<4?4:n>17?17:n;return this.pitches[o]}};var It=class extends lt{type="percussion";rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}};var Va=globalThis||window,jo=Object.assign,Wt=class extends B{type="piano";rows=["rh-A6 soprano-A6 alto-A6","rh-G6 soprano-G6 alto-G6","rh-F6 soprano-F6 alto-F6","rh-E6 soprano-E6 alto-E6","rh-D6 soprano-D6 alto-D6","rh-C6 soprano-C6 alto-C6","rh-B5 soprano-B5 alto-B5","rh-A5 soprano-A5 alto-A5","rh-G5 soprano-G5 alto-G5","rh-F5 soprano-F5 alto-F5","rh-E5 soprano-E5 alto-E5","rh-D5 soprano-D5 alto-D5","rh-C5 soprano-C5 alto-C5","rh-B4 soprano-B4 alto-B4","rh-A4 soprano-A4 alto-A4","rh-G4 soprano-G4 alto-G4","rh-F4 soprano-F4 alto-F4","rh-E4 soprano-E4 alto-E4","rh-D4 soprano-D4 alto-D4","rh-C4 soprano-C4 alto-C4","rh-B3 soprano-B3 alto-B3","lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4","lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4","lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4","lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4","lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4","lh-D4 tenor-D4 bass-D4","lh-C4 tenor-C4 bass-C4","lh-B3 tenor-B3 bass-B3","lh-A3 tenor-A3 bass-A3","lh-G3 tenor-G3 bass-G3","lh-F3 tenor-F3 bass-F3","lh-E3 tenor-E3 bass-E3","lh-D3 tenor-D3 bass-D3","lh-C3 tenor-C3 bass-C3","lh-B2 tenor-B2 bass-B2","lh-A2 tenor-A2 bass-A2","lh-G2 tenor-G2 bass-G2","lh-F2 tenor-F2 bass-F2","lh-E2 tenor-E2 bass-E2","lh-D2 tenor-D2 bass-D2","lh-C2 tenor-C2 bass-C2","lh-B1 tenor-B1 bass-B1","lh-A1 tenor-A1 bass-A1","lh-G1 tenor-G1 bass-G1","lh-F1 tenor-F1 bass-F1","lh-E1 tenor-E1 bass-E1"];getTimeSigHTML(e,n,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${G["timeSig"+e]}</sup>
            <sub>${G["timeSig"+n]}</sub>
        </span>`}staffs=["bass","treble"];parts=[{},{name:"lh",staff:"bass",topRow:29,centerRow:33,bottomRow:38},{name:"rh",staff:"treble",topRow:9,centerRow:13,bottomRow:18},{name:"soprano",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!0},{name:"alto",staff:"treble",topRow:9,centerRow:13,bottomRow:18,stemup:!1},{name:"tenor",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!0},{name:"bass",staff:"bass",topRow:29,centerRow:33,bottomRow:38,stemup:!1}];getRow(e,n){n=typeof n=="string"?n:Z(n);let o=e.name+"-"+n.replace(De,""),r=this.rows.findIndex(i=>i.includes(o));if(Va.DEBUG&&r===-1)throw new Error('Pitch "'+o+'" is not supported by '+this.constructor.name);return r===-1&&console.warn('Pitch "'+o+'" is not supported by '+this.constructor.name),r>-1?r:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#â™­â™¯ð„«ð„ª]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let n=[],o=A(e),i=Dt(o).map((a,u)=>a-U[u]&&{type:"acci",pitch:I(U[u])+Se[a-U[u]],value:a-U[u]}).filter(a=>!!a).sort(Ce);return n.push.apply(n,i.map(a=>jo({part:this.parts[1]},a))),n.push.apply(n,i.map(a=>jo({part:this.parts[2]},a))),n}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var Gn=class extends B{type="treble-up";clef=Gt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},Mn=class extends B{type="treble";clef=kt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},On=class extends B{type="treble-down";clef=Nt;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},$n=class extends B{type="alto";clef=Mt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Pn=class extends B{type="bass";clef=Ot;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};B.treble=new Mn;B["treble-up"]=new Gn;B["treble-down"]=new On;B.alto=new $n;B.bass=new Pn;B.piano=new Wt;B.drum=new lt;B.percussion=new It;B.create=t=>(console.warn("Deprecated: Stave.create(type). Use Stave[type]."),B[t]);var Ae=B;var Vo=t=>t*Math.PI/180;var Ko=ct({deg:Vo,rad:N,turn:t=>t*2*Math.PI,catch:function(t){throw new Error('Cannot parse value "'+t+'"')}});var Ka=/px$/,Ja=/deg$|turn$|rad$/;function Qa(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function Be(t,e){var n=Qa(t,e);return typeof n=="string"?Ka.test(n)?parseFloat(n):Ja.test(n)?Ko(n):n:n}var Re,Fe;function Za(){if(!Re){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",Re=Be("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return Re}function Ya(){return Fe||(Fe=Be("font-size",document.documentElement)),Fe}window.addEventListener("resize",()=>{Re=void 0,Fe=void 0});var _a=C(mt,{number:N,string:ct({px:N,em:t=>Za()*t,rem:t=>Ya()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),Jo=_a;var Qo=C((t,e)=>e[1],{note:(t,e)=>(e[2]=D(e[2])+t,e),chord:(t,e)=>(e[2]=A(A(e[2])+t),e[5]!==void 0&&(e[5]=A(A(e[2])+t)),e),key:(t,e)=>(e[2]=A(A(e[2])+t),e),default:N});var tc={displace:(t,e,n)=>(n[0]-=t[++e],e),rate:(t,e,n)=>{switch(n[0]/=t[++e],n[1]){case"chord":case"note":case"sequence":n[4]/=t[e];break;case"text":n[3]/=t[e];break}return e},quantize:(t,e,n)=>{},transpose:(t,e,n)=>(Qo(t[e+1],n),e+1)};function zt(t,e){let n=-1,o;for(;o=t[++n];)n=tc[o](t,n,e);return e}var Zo=Object.assign,Yo=[],ec={done:!0,value:void 0},_o={key:2,meter:1,default:0},nc={};function tr(t){return _o[t[1]]||_o.default}function oc(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:tr(e)-tr(t)}function rc(t,e){return t.find(n=>n.id===e)}var Xt=class t{constructor(e,n=Yo,o=Yo){e.sort(oc),this.events=e,this.sequences=n,this.transforms=o;let r=-1,i;for(;(i=e[++r])&&zt(o,Zo(nc,i))[0]<0;);this.n=r-1}next(){let{events:e,sequences:n,transforms:o,n:r}=this,i=e[r+1],a=i&&zt(o,bt.from(i,e,r+1)),u,s=-1,l=0,h=a?a[0]:1/0,p;for(;u=this[++s];){let c=u.value;c||((c=u.next().value)&&(zt(this.transforms,c),c[0]+=u.startBeat,c.target=(c.target||0)+u.target),(u.done||c[0]>=u.stopBeat)&&++l),c&&c[0]<u.stopBeat&&c[0]<h&&(p=u,h=c[0]),l&&(this[s]=this[s+l])}if(p)return this.value=p.value,p.value=void 0,this;if(!a)return Zo(this,ec);if(this.n+=1,this.value=a,bt.isSequenceEvent(i)){let c=this.sequences,d=rc(c,i[2]);if(!d)throw new Error('Sequence id "'+i[2]+'" not found');let g=new t(d.events,d.sequences?d.sequences.concat(c):c,i.slice(5));g.startBeat=a[0],g.stopBeat=a[0]+a[4],g.target=a[3];let f=-1;for(;this[++f];);this[f]=g}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};function ic(t,e){let n;for(n in t)if(t[n]!==e[n])return!1;return!0}var Lh=X(ic,!0);function sc(t,e,n){let o=t(e),r=t(n);return r===o?0:o>r?1:-1}var er=X(sc,!0);var{abs:ac,EPSILON:cc}=Math;function Te(t,e){return Math.round(e/t)*t}function Q(t,e,n=cc){return e!==void 0&&(e===t||ac(t-e)<n)}function pt(t,e,n){return Q(t,e,n)||e<t}function uc(t,e,n){return Q(t,e,n)||e>t}function St(t,e,n){return e!==void 0&&t!==void 0&&!pt(t,e,n)}function ke(t,e,n){return e!==void 0&&t!==void 0&&!uc(t,e,n)}var{pow:lc}=Math,pc=1/24,hc=[2,3,4,5,6,7,9],fc=1/12,nr=.25,or=.2,Ln={},Ct=0;function rr(t,e){return Math.cos(2*Math.PI*e/t)}function ir(t,e,n,o,r){let i=t/e,a=0,u=0,s=0,l,h;for(o[r-1]&&St(n+.5*i,T(o[r-1]),pc)&&(s=1),--r;o[++r]!==void 0&&o[r][0]-n<i/4;)s=1;for(--r;o[++r]!==void 0&&o[r][0]-n<t-i/4;){if(l=Math.round((o[r][0]-n)/i),h=1<<l,l<e&&h>s){if(e>4&&h>s<<1)return;s+=h}a+=rr(i,o[r][0]-n),u+=1,!(o[r][0]+o[r][4]-n>t)&&(a+=or*rr(i,o[r][0]+o[r][4]-n),u+=or)}if(!(e>4&&l!==e-1)&&u)return Ln.score=a/(u+1),Ln.rhythm=s,Ln}function dc(t,e,n,o,r,i,a){let u=n[o-1]&&T(n[o-1])>r+.125?r:e*Math.floor((n[o][0]-r)/e)+r,s=i.length;for(;e/i[--s]<fc;);++s;let l,h;for(;l=i[--s];)h=ir(e,l,u,n,o),h&&h.score>=Ct&&h.score&&(Ct=h.score,t.beat=u,t.duration=e,t.divisor=l,t.rhythm=h.rhythm),n[o][0]>=u+.5*e&&u+1.5*e<a&&(h=ir(e,l,u+.5*e,n,o),h&&h.score>=Ct&&(Ct=h.score,t.beat=u+.5*e,t.duration=e,t.divisor=l,t.rhythm=h.rhythm));return t}function sr(t,e,n){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let r={};Ct=nr;let i=1/8;for(;(i*=2)&&i<=n;)dc(r,i,t,o,e,hc,e+n);return Ct>nr&&r}function ar(t,e){return e<lc(2,t)-1}function qn(t){return 2**Math.ceil(Math.log2(t))}function cr(t){return 2**Math.floor(Math.log2(t))}function Hn(t){return t>0&&(t&t-1)===0}function Un(t,e,n){if(Q(0,n,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(Q(0,vt(o,n),t/2))return o;return o}function jt(t,e){let n=-1,o=0;for(;t[++n]!==void 0;);for(;arguments[++o]!==void 0;)t[n++]=arguments[o];return t}function At(t){let e=-1;for(;t[++e]!==void 0;);return e}function In(t){return t[At(t)-1]}function Wn(t,e){let n=[],o=-1;for(;e[++o]!==void 0;)n.push(t(e[o],o));return n}var Me=Object.assign,{abs:Ff,ceil:mc,floor:Ge,min:hr,max:fr,pow:Tf,sqrt:ur,round:kf}=Math,z=1/16,Vt=1/24,gc=er(ut("row"));function lr(t,e,n,o){return t+e/o.length}function dr(t,e){return fr(t,T(e))}function wc(t,e){return D(t[2])<D(e[2])?1:-1}function mr(t,e,n,o){if(!o.length)return[];let r=[],i=-1,a;for(;a=o[++i];){let p=a.scribeEvents,c=a.scribeIndex,d=be(p,c,e),g=ve(d),f=t.getSpelling(g,a),m=t.getRow(n,f);r.push({type:"note",pitch:f,dynamic:a[3],part:n,row:m,stave:t,event:a})}r.sort(gc),r[0].top=!0,r[r.length-1].bottom=!0;let u=r[0].row,s=r[r.length-1].row,l=n.stemup===void 0?gr(t,n,u,s):n.stemup,h=0;for(i=-1;r[++i];)r[i].stemup=l,i>0&&r[i].row-r[i-1].row===1?r[i].clusterdown=++h:h=0;for(h=0,i=r.length-1;i--;)r[i+1].row-r[i].row===1?r[i].clusterup=++h:h=0;return r}function xc(t,e,n){let o=-1,r=0,i,a;for(;n[++o];)a=t.getRow(e,n[o]),a!==void 0&&a>r&&(r=a,i=n[o]);return{row:r,pitch:i}}function yc(t,e,n){let o=-1,r=128,i,a;for(;n[++o];)a=t.getRow(e,n[o]),a!==void 0&&a<r&&(r=a,i=n[o]);return{row:r,pitch:i}}function gr(t,e,n,o){let r=e.centerRow||t.centerRow,i=n-r;return o-r+i>0}function wr(t,e,n){let{row:o}=xc(t,e,n),{row:r}=yc(t,e,n);return gr(t,e,o,r)}function Ec(t,e,n){let o=[],r=-1,i;for(;i=n[++r];)i.type==="note"&&o.push(i.pitch);return wr(t,e,o)}var pr=0;function nt(t,e,n,o){let r=-1;for(;o[++r]&&o[r].beat===o.beat;);if(!o[r])return t;let i=o[0].beat,u=In(o).beat-i,s=n.stemup===void 0?wr(e,n,Wn(ut("pitch"),o)):n.stemup;if(n.beam){let E;for(r=-1;E=o[++r];)E.stemup=s,E.beam=o;return t.push(Me(o,{duration:u,stemup:s,range:0,id:++pr})),t}let l=[],h;for(r=-1;h=o[++r];){let E=e.getRow(n,h.pitch);if(E===void 0)continue;let M;for(;o[++r]&&Q(o[r].beat,h.beat,Vt);)M=e.getRow(n,o[r].pitch),M!==void 0&&(s?M<E&&(E=M):M>E&&(E=M));--r,l.push(E)}let p=l.length-1,c=l.slice(0,Ge(.5*l.length)).reduce(lr,0),d=l.slice(mc(.5*l.length)).reduce(lr,0),g=Array.from(l,(E,M)=>(.2+.1*p)*M*(d-c)/p),f=g[g.length-1]-g[0],m=s?-50:50,w;for(r=l.length;r--;)w=g[r]-l[r],m=s?w>m?w:m:w<m?w:m;for(r=l.length;r--;)g[r]-=m+l[0];let y=-1;for(r=-1;h=o[++r];){for(++y,h.stemup=s,h.beam=o,h.stemHeight=s?1-.125*(g[r]-l[r]+l[0]):1+.125*(g[r]-l[r]+l[0]);o[++r]&&Q(o[r].beat,h.beat,z);)o[r].stemup=s,o[r].beam=o,o[r].stemHeight=h.stemHeight;--r}return t.push(Me(o,{pitch:o[0].pitch,y:g[0],duration:u,stemup:s,range:f,id:++pr})),t}function Ne(t,e){let n=2*qn(e);for(;(n/=2)>t/2;){if(1.75*n===e)return 1.75*n;if(1.5*n===e)return 1.5*n;if(n<=e)return n}return t}function bc(t,e,n){n=n||1/0;let o=4*qn(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=n)return o;return t}function xr(t,e,n,o,r,i){let u=cr(e.divisor),s=Ge(r/e.divisor)*e.divisor,l=Un(.125,u,r-s);if(i<o){if(t.indexOf(i-r)!==-1)return i-r;let p=Ge(i/e.divisor)*e.divisor;if(r===s){if(t.indexOf(p-r)!==-1)return p-r;let c=s+e.divisor<i&&s+e.divisor;return c?c-r:Ne(.125,i-r)}if(Q(i,p,z)){let c=s+e.divisor<i&&s+e.divisor;return c&&t.indexOf(c-r)!==-1?c-r:l}}let h=Ge(o/e.divisor)*e.divisor;if(r===s){if(t.indexOf(o-r)!==-1)return o-r;if(t.indexOf(h-r)!==-1)return h-r;let p=s+e.divisor<o&&s+e.divisor;return p?p-r:bc(.125,o-r,i-r)}else if(Q(o,h,z)){if(t.indexOf(o-r)!==-1)return o-r;let p=s+e.divisor<o&&s+e.divisor;return p&&t.indexOf(p-r)!==-1?p-r:l}else{let p=4*l;return(r-s)%p/l===1?r+2*l===i?2*l:(r+3*l>=i&&console.log("Next event beat is inside quaduplet"),l<1?o>=r+l*3/2?3*l:o>=r+l?l:Ne(.125,o-r):o>=r+l*3?l*3:o>=r+l*2?l*2:o>r+l?l:Ne(.125,o-r)):o>r+l?l:Ne(.125,o-r)}}function vc(t,e,n,o,r,i){return{type:"rest",beat:i,duration:xr(t,e,i,r,i,r),stave:n,part:o}}function zn(t,e,n,o,r,i,a){for(;St(i,a,z);){let u=vc(e,n,o,r,a,i);t.push(u),i+=u.duration}return a}function Dc(t,e,n,o,r,i){let{pitch:a,event:u,row:s}=o,l=Uo.test(a)?1:Ho.test(a)?-1:void 0,h=a[0]+a.slice(-1);if(l!==e[h])return e[h]=l,{type:"acci",beat:n,pitch:a,row:s,clump:r,cluster:i,part:t,event:u,value:l||0}}function Sc(t,e,n){let o=-1,r,i=0,a;for(;r=t[++o];)r.type==="acci"&&r.beat===e&&r.row<n&&r.row>i&&(i=r.row,a=o);return t[a]}function yr(t,e,n,o,r,i){let a=-1,u=0,s,l,h,p=!!i.find(c=>c.stemup?c.clusterup%2===1:c.clusterdown%2===1);for(;s=i[++a];)ke(e.beat,s.event[0],z)||(h=Sc(t,r,s.row),u=h&&h.row-s.row<6&&h.cluster===p?h.clump+1:0,l=Dc(n,o,r,s,u,p),l&&t.push(l))}function Er(t,e,n,o,r,i){let a=-1/0,u=-1,s,l;for(;s=r[++u];)s.dynamic>a&&(a=s.dynamic,l=s.event);if(r.length&&a>=i.accentThreshold){let h=r[0].stemup?r[r.length-1]:r[0];t.push({type:"accent",beat:o,pitch:h.pitch,dynamic:a,stemup:h.stemup,stave:e,part:n,event:l})}}function br(t,e,n,o,r){let i=r[0].row,a=r[0].pitch,u=i-(n.topRow||e.topRow)+1;u<0&&t.push({type:"ledge",beat:o,pitch:a,part:n,rows:u});let s=r[r.length-1].row,l=r[r.length-1].pitch;u=s-(n.bottomRow||e.bottomRow),u>0&&t.push({type:"ledge",beat:o,pitch:l,part:n,rows:u})}function Cc(t,e,n){let{beat:o,duration:r,divisor:i}=n,a=e.stemup===void 0?Ec(t,e,n):e.stemup,u=-1,s;for(;s=n[++u];)s.type==="note"&&!s.beam&&(s.stemup=a);let l=o+.5*r,h=D(t.topPitch)-12,p,c=At(n);for(;(s=n[--c])&&s.beat>l;);for(++c;(s=n[--c])&&s.beat+s.duration>l;){let y=D(s.pitch);(!p||y>p)&&(p=y)}let d=h;for(c=-1;(s=n[++c])&&s.beat<o+z;){let y=D(s.pitch);(!d||y>d)&&(d=y)}let g=h;for(c=At(n);(s=n[--c])&&s.beat>o+r-r/i-z;){let y=D(s.pitch);(!g||y>g)&&(g=y)}let f=Math.ceil((d+g)/2),m=Z(f);f>p&&(p=f),n.pitch=Z(p),n.stemup=a;let w=g-d;n.angle=w<0?4*ur(-w):-4*ur(w)}function Ac(t,e,n,o,r,i,a,u,s,l,h,p,c,d,g){(u.swingAsStraight8ths&&l===1||u.swingAsStraight16ths&&l===.5)&&h===3&&(p===4||p===5)&&(h=2);let f=l/h,m=s+l,w={type:"tuplet",beat:s,duration:l,divisor:h,rhythm:p,part:i,stave:n},y;for(Hn(h)||t.push(w);ke(m,s,Vt);){for(;(y=d[++g])&&pt(s+.5*f,y[0]-e.beat,Vt);)c.push(y);if(--g,!c.length){t.push({type:"rest",beat:s,duration:f,stave:n,part:i}),s+=f;continue}let E=mr(n,o,i,c);br(t,n,i,s,E),yr(t,e,i,r,s,E),Er(t,n,i,s,E,u);let M=hr(c.reduce(dr,0)-e.beat,y?y[0]-e.beat:e.duration,w.beat+w.duration),R=fr(f,Te(f,M-s)),F=-1;for(;E[++F];)t.push(Me(E[F],{beat:s,duration:R}));for(jt(w,...E),St(.5,R,Vt)?a&&(nt(t,n,i,a),a=void 0):a||(a={type:"beam",beat:s,part:i}),a&&jt(a,...E),F=c.length;F--;){let W=T(c[F])-e.beat;pt(s+R+.5*f,W,Vt)?c.splice(F,1):t.push({type:"tie",beat:s,pitch:E[F].pitch,duration:R,stemup:E[F].stemup,part:i,event:c[F]})}s+=R}return a&&nt(t,n,i,a),Cc(n,i,w),g}function Xn(t,e,n,o=0,r={},i,a,u=P){let s=[],{headDurations:l,restDurations:h}=u,p=0,c=-1,d,g,f;for(;(d=a[++c])&&pt(p,d[0]+d[4]-e.beat,z););for(--c;ke(e.duration,p,z);){f&&e.divisions.find(W=>Q(p,W,z))&&(nt(t,n,i,f),f=void 0);let m=sr(a,e.beat+p,e.duration-p);if(m&&!Hn(m.divisor)){St(p,m.beat-e.beat,z)&&zn(t,u.restDurations,e,n,i,p,m.beat-e.beat),f&&ar(m.divisor,m.rhythm)&&(nt(t,n,i,f),f=void 0),c=Ac(t,e,n,o,r,i,f,u,m.beat-e.beat,m.duration,m.divisor,m.rhythm,s,a,c),p=m.beat-e.beat+m.duration;continue}for(;(d=a[++c])&&pt(p,d[0]-e.beat,z);)s.push(d);if(--c,n.pitched&&s.sort(wc),!s.length){if(!d){f&&(nt(t,n,i,f),f=void 0),zn(t,u.restDurations,e,n,i,p,e.duration);break}let W=Te(.125,d[0]-e.beat);if(W<=p){console.log(`Problem at bar ${e.count}, moving to next bar ${p} ${W}`),e.error="Stop beat has ended up less than beat";break}f&&(vr(e.divisions,p,W)||W-p>=.5)&&(nt(t,n,i,f),f=void 0),zn(t,h,e,n,i,p,W),p=W;continue}let w=mr(n,o,i,s);br(t,n,i,p,w),yr(t,e,i,r,p,w),Er(t,n,i,p,w,u);let y=s[0][0]-e.beat,E=hr(e.duration,s.reduce(dr,0)-e.beat),M=d&&Te(.125,d[0])-e.beat,R=xr(l,e,y,E,p,M),F=-1;for(;w[++F];)t.push(Me(w[F],{beat:p,duration:R}));for(R>=1?f&&(nt(t,n,i,f),f=void 0):f||(f={type:"beam",beat:p,part:i}),f&&jt(f,...w),F=s.length;F--;){let W=T(s[F])-e.beat;pt(p+R,W,z)||W-(p+R)<.125+1/16*(T(s[F])-s[F][0])?s.splice(F,1):t.push({type:"tie",beat:p,pitch:w[F].pitch,duration:R,stemup:w[F].stemup,part:i,event:s[F]})}p+=R}return f&&nt(t,n,i,f),t}var Bc={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function Rc(t,e){return Bc[t+","+e]||ge}function vr(t,e,n){let o=-1;for(;t[++o]&&t[o]<=e;);return n>t[o]?t[o]:void 0}var Fc=[];function Dr(t,e){return Dt(e).reduce((o,r,i)=>{let a=r-U[i];if(a!==0){let u=I(U[i]),s=10;for(;s--;)o[u+s]=a}return o},t),t}function Tc(t,e,n,o,r,i,a){let u=-1,s;for(;s=i[++u];)switch(s[1]){case"key":{let l=A(s[2]);Dr(r,l),e.key=l;break}case"meter":{t.push({type:"timesig",beat:0,numerator:s[3]===1.5?s[2]/.5:s[2]/s[3],denominator:s[3]===1.5?8:4/s[3],stave:n,event:s});break}case"symbol":{t.push({type:"symbol"+s[2],stave:n});break}case"chord":{let l=s[0]-e.beat,h=be(i,u,o),p=ve(h),c=n.getSpelling(p,s);c==="Câ™­"&&a.spellChordRootCFlatAsB&&(c="B"),c==="Eâ™¯"&&a.spellChordRootESharpAsF&&(c="F"),c==="Bâ™¯"&&a.spellChordRootBSharpAsC&&(c="C"),c==="Fâ™­"&&a.spellChordRootFFlatAsE&&(c="E"),t.push({type:"chord",beat:l,duration:s[0]+s[4]>e.beat+e.duration?e.duration-l:s[4],root:c,extension:s[3],event:s,stave:n});break}case"text":{let l=s[0]-e.beat;t.push({type:"text",beat:l,duration:s[0]+s[3]>e.beat+e.duration?e.duration-l:s[3],value:s[2],event:s,stave:n});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(Fc.includes(s[1]))return;console.log('Scribe: ignoring event type "'+s[1]+'"')}}return t}function Kt(t,e,n,o,r,i,a,u,s,l=P){let h=[];if(s){let m=T(s);m>e&&m<=e+n&&a.push(s)}let p=Dr({},i),c={type:"bar",beat:e,duration:n,key:i,divisor:o||4,divisions:Rc(n,o),stave:r,count:t,symbols:h};Tc(h,c,r,i,p,a,P);let d=r.parts.reduce((m,w)=>w.centerRow?m.add(w.centerRow):m,new Set);d.size||d.add(r.centerRow);let g;for(g of r.parts){let m=u[g.name];!m||!m.length||(d.delete(g.centerRow||r.centerRow),Xn(h,c,r,i,p,g,m,l))}let f;for(f of d)Xn(h,c,r,i,p,{centerRow:f},[],l);return c}function kc(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function Nc(t){let e=t.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(e,kc)}function ht(t,e){t.symbols=t.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function Oe(t,e,n){let o=Nc(n);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&n.symbols.filter(r=>r.type!=="clef"&&r.type!=="timesig").find(r=>r.type!=="rest")?(ht(t[t.length-2],1),ht(t[t.length-1],1),ht(n,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(ht(n,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,ht(t[t.length-1],2),ht(n,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,ht(n,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function jn(t,e,n){let o=n.target?t.parts[n.target]:t.getPart(n[2]),r=e[o.name]||(e[o.name]=[]);e[o.name].push(n)}function Vn(t,e,n,o=P){let r=[],i=[],a=[],u=[],s=0,l=[],h={},p=0,c=0,d,g,f,m;for(f of t)if(f.scribeIndex=r.length,f.scribeEvents=r,r.push(f),!e.includes(f[1])){for(;f[0]>=s+d;){let y=Kt(i.length+1,s,d,g,n,p,l,h,m,o);Oe(i,u,y),i.push(y),p=y.key,s=s+d,l=[],h={};let E=-1;for(;a[++E];)jn(n,h,a[E]),T(a[E])<s+d&&a.splice(E--,1)}switch(f[1]){case"note":{jn(n,h,f),T(f)>s+d&&a.push(f),c<T(f)&&(c=T(f));break}case"sequence":{f.events===t.events&&(m=f),c<T(f)&&(c=T(f));break}case"meter":d=f[2],g=f[3],f[0]!==s&&console.log("TODO");default:l.push(f)}}for(;a.length;){let y=Kt(i.length+1,s,d,g,n,p,l,h,m,o);Oe(i,u,y),i.push(y),s=s+d,l=[],h={};let E=-1;for(;f=a[++E];)jn(n,h,f),T(f)<s+d&&a.splice(E--,1)}for(;s<c-d;){let y=Kt(i.length+1,s,d,g,n,p,l,h,m,o);Oe(i,u,y),i.push(y),s=s+d,l=[],h={}}d||(d=r.length?T(r[r.length-1]):1);let w=Kt(i.length+1,s,d,g,n,p,l,h,m,o);return Oe(i,u,w),i.push(w),i}var Kn=Symbol("scribe-id"),Gc={},Jn=0;function _(t){for(;t.event;)t=t.event;return t[Kn]?t[Kn]:(t[Kn]=++Jn,Gc[Jn]=t,Jn)}var tt=1.1;function Mc(t){return parseFloat(t.dataset.beat)}function Oc(t){return parseFloat(t.dataset.duration)}function $c(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function Sr(t,e,n,o,r){let i=n[0],a=n.length===1?o%(r*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],u=n.length===1?o%(r*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[n[n.length-1]];return`M${a}, ${-t*a-.5*tt}
        L${u},${-t*u-.5*tt}
        L${u},${-t*u+.5*tt}
        L${a}, ${-t*a+.5*tt}
        Z`}function Qn(t,e,n,o,r,i,a){if(a<.0833)return;let u=r-1,s;for(;n[++u];)n[u]<=a?s?s.push(u):s=[u]:s&&(t.appendChild(b("path",{class:`beam-path-${4/a} beam-path`,d:Sr(i,o,s,e[u-1],a)})),Qn(t,e,n,o,s[0],i,a/2),s=void 0);s&&(t.appendChild(b("path",{class:`beam-path-${4/a} beam-path`,d:Sr(i,o,s,e[u-1],a)})),Qn(t,e,n,o,s[0],i,a/2),s=void 0)}function Cr(t){let e=t.dataset.beam,n=t.parentElement,o=Array.from(n.querySelectorAll('.top-note[data-beam="'+e+'"]')),r=o.map(Mc),i=o.map(Oc),a=t.viewBox.baseVal,u=a.y<-.5?a.y+.5:a.height-1,s=o.map(rt),l=s[0].x,h=s[s.length-1].x,p=s.map(c=>(c.x-l)/(h-l));$c(t),Qn(t,r,i,p,0,-u,.25)}var Pc=/â™®|(bb|ð„«)|(##|ð„ª)|(b|â™­)|(#|â™¯)/g,Lc={0:`<span class="glyph glyph-natural">${xt}</span>`,1:`<span class="glyph glyph-doubleflat">${$t}</span>`,2:`<span class="glyph glyph-doublesharp">${qt}</span>`,3:`<span class="glyph glyph-flat">${Pt}</span>`,4:`<span class="glyph glyph-sharp">${Lt}</span>`};function qc(){let t=arguments.length-2;for(;t--;)if(arguments[t])return Lc[t];return""}function Zn(t){return t.replace(Pc,qc)}function k(t,e){return e.toFixed(t).replace(/\.?0+$/,"")}var $e=Math.abs,Hc={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Uc={2:qt,1:Lt,0:xt,"-1":Pt,"-2":$t},Ic={treble:kt,"treble-down":Nt,"treble-up":Gt,alto:Mt,bass:Ot,drum:pe,percussion:pe},Wc={"1.33":vn,"0.67":bn,"0.33":En,"0.17":yn,"0.08":xn},zc=/^(âˆ†|-|Ã¸|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function Xc(t){let e=-1,n="";for(;t[++e];)n+=(n?" ":"")+_(t[e].event);return n}var Yn=C(ut("type"),{barrepeat:t=>b("span",{class:"barrepeat",html:G["barRepeat"+t.count],data:{beat:0,duration:t.duration}}),clef:t=>b("span",{class:`${t.clef}-clef clef`,html:Ic[t.clef]}),chord:t=>{let e=zc.exec(t.extension);return b("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+Zn(t.root)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+Zn(e[3])+"</sup>":"")+"</span>"+(t.bass?Sn+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:k(4,t.beat),duration:k(4,t.duration),event:_(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?b("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,_(t.event))):b("span",{class:"timesig",html:`<sup>${G["timeSig"+t.numerator]}</sup>
                <sub>${G["timeSig"+t.denominator]}</sub>`,data:{event:_(t.event)}}),symbolcoda:t=>b("p",{html:Dn,class:"coda"}),barcount:t=>b("span",{html:t.text,class:"barcount"}),text:t=>b("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:k(4,t.beat),duration:k(4,t.duration),event:_(t.event)}}),acci:t=>b("span",{class:(Hc[t.value]||"acci")+(t.clump?" acci-"+t.clump:"")+(t.cluster?" acci-cluster":""),html:Uc[t.value]||xt,data:{beat:t.beat&&k(4,t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&_(t.event)}}),accent:t=>{let e=t.dynamic>=P.marcatoThreshold,n=t.stave.type==="drum"||t.stave.type==="percussion";return b("span",{class:`${t.stemup?"up":"down"}-accent accent${e?" marcato-accent":""}`,html:n?e?t.stemup?de:me:t.stemup?he:fe:e?t.stemup?me:de:t.stemup?fe:he,data:{beat:k(4,t.beat),pitch:t.pitch,part:t.part.name,event:_(t.event)}})},ledge:t=>b("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${$e(t.rows)}`:`0 -0.5 5 ${$e(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:k(4,t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>b("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${D(t.pitch)})`,data:{beat:k(4,t.beat),pitch:t.pitch,duration:k(4,t.duration),part:t.part.name,beam:t.beam&&t.beam.id,event:_(t.event)}}),beam:(t,e)=>b("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${$e(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${k(4,t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${($e(t.range)+tt)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*tt} L1,${t.range-.5*tt} L1,${t.range+.5*tt} L0,${.5*tt} Z"></path>`,data:{beat:k(4,t.beat),pitch:t.pitch,part:t.part.name,beam:t.id,events:Xc(t)}}),tie:t=>b("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:k(4,t.beat),pitch:t.pitch,duration:k(4,t.duration),part:t.part.name,event:_(t.event)}}),tuplet:t=>b("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:G["tuplet"+t.divisor],data:{beat:k(4,t.beat),pitch:t.pitch,duration:k(4,t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>b("span",{class:"rest",html:Wc[t.duration.toFixed(2)]||G["rest"+(t.duration+"").replace(".","")]||"",data:{beat:k(4,t.beat),pitch:t.pitch,duration:k(4,t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});var Ar=globalThis||window,Jt={pink:"#FE267E",grey:"#81868f"},jc=Ar.DEBUG&&Ar.DEBUG.scribe!==!1?function(e,n,o="",r=""){console.log("%cScribe %c"+e+" %c"+n+" %c"+o+" %c"+r,"color: "+Jt.pink+"; font-weight: 300;","color: "+Jt.grey+"; font-weight: 300;","color: "+Jt.pink+"; font-weight: 300;","color: "+Jt.grey+"; font-weight: 300;","color: "+Jt.pink+"; font-weight: 300;")}:O,Br=jc;var Vc=globalThis||window;function Kc(t){return t[0]<=0&&t[1]==="meter"}function Jc(t){return t[0]<=0&&t[1]==="key"}function Qc(t,e){let n=Yn(e);return n&&t.push(n),t}function Zc(t,e){return t.push(b("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:I(e.key),stave:e.stave.type},children:e.symbols.reduce(Qc,[])})),t}function Rr(t,e,n,o,r,i=1/0,a=0,u=0,s=P){let l=t.events;!l.find(Kc)&&r&&l.unshift([0,"meter",r[2],r[3]]),!l.find(Jc)&&o&&l.unshift([0,"key",o]);let c=Ae[n||"treble"],d=[];a&&d.push("transpose",a),u&&d.push("displace",u);let g=new Xt(l,t.sequences,d),f=Vn(g,e,c,s),m=f.reduce(Zc,[]),y=f[0].key,E=c.createSignatureSymbols(y),M=b("div",{class:`${c.type}-stave signature-stave stave`,children:E.map(Yn),data:{key:I(y)}}),R=b("div",{id:"side",class:"side",data:{key:I(y)}}),F=24;for(;F--;)R.appendChild(M.cloneNode(!0));return m.unshift(R),m}var Bt=[b("span",{html:mn,style:"width: min-content;"}),b("span",{html:gn,style:"width: min-content;"}),b("span",{html:wn,style:"width: min-content;"})];function Yc(t){t.remove()}function Pe(t,e=t){e.append.apply(e,Bt);let n=rt(Bt[0]).width,o=rt(Bt[1]).width,r=rt(Bt[2]).width,i=window.getComputedStyle(Bt[0]),a=Jo(i.fontSize);Vc.DEBUG&&Br("post render font-size",a,"heads",`${n}, ${o}, ${r}`),Bt.forEach(Yc);let s=e.querySelector(".side").dataset.key,h={"Gâ™­":6,"Câ™¯":5,"Dâ™­":5,"Gâ™¯":4,"Aâ™­":4,"Dâ™¯":3,"Eâ™­":3,"Bâ™­":2,F:1,C:0,G:1,D:2,A:3,E:4,B:5,"Fâ™¯":6}[s];return`--head-1-size: ${k(6,n/a)}; --head-2-size: ${k(6,o/a)}; --head-4-size: ${k(6,r/a)}; --signature-width: ${(2.25+h*.625+.625).toFixed(4)}em;`}function Qt(t,e=t){e.querySelectorAll(".beam").forEach(Cr)}var Fr=Object.assign,_c=Object.defineProperties,tu=new URL("shadow.css",import.meta.url),Le=v.of(),Tr=new ResizeObserver(t=>{for(let e of t)Qt(x(e.target).shadowRoot)}),pm=_c(Ye("scribe-music",{shadow:`
        <link rel="stylesheet" href="${tu}" />
    `,construct:function(t,e){let n=t.querySelector("link");Le.value&&(n.href=Le.value),e.data=v.of(),e.clef=v.of("treble"),e.key=v.of("C"),e.meter=v.of(),e.beat=v.of(0),e.duration=v.of(1/0),e.transpose=v.of(0),e.excludes=v.of([]),e.swingAsStraight8ths=v.of(!1),e.swingAsStraight16ths=v.of(!1),e.debug=v.of(!1),e.isSafari=navigator.userAgent.includes("AppleWebKit/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Gecko/")},connect:function(t,e){if(e.isSafari&&this.classList.add("safari"),Tr.observe(this,{box:"content-box"}),!this.src){let n=this.textContent.trim();e.data.value=at(this.type,n)}return v.frame(()=>{if(!e.data.value)return;let n=e.data.value&&Rr(e.data.value,e.excludes.value,e.clef.value,e.key.value,e.meter.value,e.duration.value,e.transpose.value,e.beat.value,Fr({},P,{swingAsStraight8ths:e.swingAsStraight8ths.value,swingAsStraight16ths:e.swingAsStraight16ths.value}));if(t.querySelectorAll(".side, .bar, style").forEach(r=>r.remove()),t.append.apply(t,n),!n)return;let o=e.style=b("style",`:host { ${Pe(this,t)} }`);t.appendChild(o),Qt(this,t),setTimeout(()=>{o.textContent=`:host { ${Pe(this,t)} }`,Qt(this,t)},2e3)})},load:function(t,{style:e}){e.textContent=`:host { ${Pe(this,t)} }`,Qt(this,t)},disconnect:function(){Tr.unobserve(this)}},{clef:{attribute:function(t){this.clef=t},get:function(){return x(this).clef.value},set:function(t){if(!Ae[t]){console.warn('<scribe-music> Attempt to set invalid clef="'+t+'" ignored');return}x(this).clef.value=t}},key:{attribute:function(t){this.key=t===""?"C":t},get:function(){return x(this).key.value},set:function(t){let e=x(this);if(typeof t!="string"||!/^[A-G][#bâ™¯â™­]?$/.test(t)){console.warn('<scribe-music> Attempt to set invalid key="'+t+'" ignored');return}e.key.value=t.replace(/[#b]$/,n=>n==="#"?"â™¯":"â™­")}},meter:{attribute:function(t){this.meter=t===""?"4/4":t},get:function(){return No(x(this).meter.value)},set:function(t){x(this).meter.value=Fr([0],ko(t))}},beat:{attribute:function(t){this.beat=t},get:function(){return x(this).beat.value},set:function(t){x(this).beat.value=typeof t=="number"?t:parseFloat(t)}},duration:{attribute:function(t){this.duration=t},get:function(){return x(this).duration.value},set:function(t){x(this).duration.value=typeof t=="number"?t:parseFloat(t)}},transpose:{attribute:function(t){this.transpose=t},get:function(){return x(this).transpose.value},set:function(t){x(this).transpose.value=typeof t=="number"?Math.round(t):parseInt(t,10)}},type:{attribute:function(t){this.type=t},writable:!0,value:"application/json"},src:{attribute:function(t){this.src=t},get:function(){return x(this).src},set:function(t){let e=x(this);e.src=t;let n=new URL(t,window.location);if(window.location.origin===n.origin&&window.location.pathname===n.pathname){let o=this.getRootNode().getElementById(n.hash.slice(1));if(!o)throw new Error('<scribe-music> src script "'+t+'" not found in document');this.data=JSON.parse(o.textContent)}else To(this.type,n.href).then(o=>this.data=o)},default:null},data:{get:function(){return x(this).data.value},set:function(t){x(this).data.value=t},default:null},swing:{attribute:function(t){x(this).swingAsStraight8ths.value=t!==null}},shuffle:{attribute:function(t){x(this).swingAsStraight16ths.value=t!==null}},debug:{attribute:function(t){this.debug=t!==null},get:function(){return x(this).debug.value},set:function(t){x(this).debug.value=!!t}},excludes:{attribute:function(t){return x(this).excludes.value=t.split(/\s+/)}}},"stephband.band/scribe/"),{stylesheet:{set:t=>Le.value=t,get:()=>Le.value}});export{pm as default};
//# sourceMappingURL=element.js.map
