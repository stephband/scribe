{
  "version": 3,
  "sources": ["https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/signal.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/rect.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/id.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/overload.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/cache.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/curry.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/noop.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/assign.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/create.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/exec.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/capture.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/element/internals.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/element.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/to-type.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/stream/stopable.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/stream/stream.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/events.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/arg.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/id.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/noop.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/self.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/nothing.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/mod.js", "https://cdn.jsdelivr.net/gh/stephband/fn/modules/slugify.js", "https://cdn.jsdelivr.net/gh/stephband/midi@1.1.2/modules/note.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/to-gain.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/parse-value.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/parse/parse-gain.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/mod.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/number/mod-12.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/pitch.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/object/mirror.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/types.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/curves.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/get.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/hsid.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/chords.js", "https://cdn.jsdelivr.net/gh/stephband/midi@1.1.2/modules/control.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/params.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/keys.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/transforms.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/matches.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/event/transpose.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/transform.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/sequence-iterator.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/sequence.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/events/address.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/events/deserialise.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/events/serialise.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/lexicons/io.sound.sequence.json", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/lexicons/io.sound.credit.json", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/modules/record.js", "https://cdn.jsdelivr.net/gh/soundio/sequence@0.2.27/module.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/cache-by-key.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/choose.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/parse.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/request.js", "../../modules/parse/parse-sequence-text.js", "../../modules/parse.js", "../../modules/request-data.js", "../../modules/timesig.js", "../../modules/glyphs.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/arg.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/self.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/nothing.js", "../../modules/number/mod-12.js", "../../modules/event/to-duration.js", "../../modules/event/to-stop-beat.js", "../../modules/scale.js", "../../modules/keys.js", "../../modules/pitch.js", "../../modules/config.js", "../../modules/stave/stave.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/slugify.js", "../../modules/stave/drum.js", "../../modules/stave/percussion.js", "../../modules/stave/piano.js", "../../modules/stave.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/to-rad.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/parse-angle.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/style.js", "https://cdn.jsdelivr.net/gh/stephband/dom@1.4.1/modules/parse-length.js", "https://cdn.jsdelivr.net/gh/stephband/fn@1.5.x/modules/by.js", "../../modules/number/float.js", "../../modules/tuplet.js", "../../modules/number/power-of-2.js", "../../modules/number/grain-pow-2.js", "../../modules/object/push.js", "../../modules/object/length-of.js", "../../modules/object/last.js", "../../modules/object/map.js", "../../modules/part.js", "../../modules/bar.js", "../../modules/create-bars.js", "../../modules/event.js", "../../modules/beam.js", "../../modules/html.js", "../../modules/number/truncate.js", "../../modules/create-element.js", "../../modules/log.js", "../../modules/render.js", "../../scribe-music/element.js"],
  "sourcesContent": ["\nconst DEBUG  = false;//window.DEBUG && window.DEBUG.signal !== false;\nconst assign = Object.assign;\n\nlet evaluatingSignal;\nlet hasInvalidDependency;\nlet id = 0;\n\n\nfunction removeInput(signal, input) {\n    // Remove input from stream\n    let i = 0;\n    while (signal[--i] && signal[i] !== input);\n    while (signal[i--]) signal[i + 1] = signal[i];\n}\n\nfunction removeOutput(signal, output) {\n    // Remove output from signal\n    let o = -1;\n    while (signal[++o] && signal[o] !== output);\n    while (signal[o++]) signal[o - 1] = signal[o];\n}\n\nfunction clearInputs(signal) {\n    let n = 0;\n    while (signal[--n]) {\n        // -------------------------- Experimental -----------------------------\n        // Stop inputs? An input with a stop method – an observer – can only have\n        // become a dependency if it were constructed during a render (they don't\n        // evaluate synchronously so they don't become dependencies otherwise).\n        // Therefore also, it can only have one output, this. Therefore it is\n        // safe to stop it. I am right about this am I not?\n        if (signal[n].stop) signal[n].stop();\n        // ---------------------------------------------------------------------\n        signal[n] = undefined;\n    }\n}\n\nfunction setDependency(signal, dependent) {\n    // Set signal as an input of dependent\n    let n = 0;\n    while (dependent[--n]) if (dependent[n] === signal) break;\n    dependent[n] = signal;\n\n    // Set dependent as an output of signal\n    n = -1;\n    while (signal[++n]) if (signal[n] === dependent) break;\n    signal[n] = dependent;\n\n    if (DEBUG) console.log(\n        '%cSignal%c connect%c ' + signal.constructor.name + '#' + signal.id + ' - ' + dependent.constructor.name + '#' + dependent.id,\n        'color: #718893; font-weight: 300;',\n        'color: #3896BF; font-weight: 300;',\n        'color: #718893; font-weight: 300;'\n    );\n}\n\nfunction invalidateDependents(signal) {\n    if (DEBUG) {\n        console.log(\n            '%cSignal%c invalidate%c ' + signal.constructor.name + '#' + signal.id + (signal.name ? ' \"' + signal.name + '\"' : ''),\n            'color: #718893; font-weight: 300;',\n            'color: #3896BF; font-weight: 300;',\n            'color: #718893; font-weight: 300;'\n        );\n    }\n\n    let n = -1;\n    let dependent;\n    while (dependent = signal[++n]) {\n        signal[n] = undefined;\n        dependent.invalidate(signal);\n    }\n}\n\nexport function hasInput(signal, input) {\n    // Check if input exists in the -ve indexes\n    let n = 0;\n    while (signal[--n]) if (signal[n] === input) return true;\n}\n\n\n/**\nSignal\n\nA signal is an object that represents a value that may change. A signal has\nessentially one property, `.value`. A state signal can have its `.value`\nwritten, a compute signal's `.value` may only be read.\n\nThe `Signal` constructor is not called directly, but calling `Signal.of(value)`\ncreates a state signal, and `Signal.from(fn)` creates a compute signal.\n**/\n\nexport default class Signal {\n    /**\n    Signal.isSignal(object)\n\n    Returns `true` where `object` is an instance of `Signal`.\n\n    This guarantees that `object` has a gettable `value` property. This is not\n    true of an Observer, which is not really a signal at all – it cannot\n    have dependencies – but is only evaluated as one when invalidated.\n    **/\n\n    static isSignal(object) {\n        return object instanceof Signal;\n    }\n\n    /**\n    Signal.of()\n    Signal.of(value)\n\n    Creates a state signal that has essentially one property, `.value`.\n    When `.value` is set the signal becomes invalid, stale, out of date,\n    irrelevant, historic, old, and any signals that depend on it are invalidated.\n    **/\n\n    static of(value) {\n        return new ValueSignal(value);\n    }\n\n    /**\n    Signal.from(fn)\n    Signal.from(promise)\n    Signal.from(stream)\n\n    Creates a compute signal from a function, where `fn` computes a value by\n    reading other signals' values. This signal is then invalidated when any of\n    the read signals are invalidated.\n\n    Creates a state signal from a promise or stream that invalidates\n    dependencies as the promise or streams' values resolve.\n    **/\n\n    static from(fn, context) {\n        // Promise\n        if (fn.then) {\n            const signal = Signal.of();\n            fn.then((value) => signal.value = value);\n            return signal;\n        }\n\n        // Pipeable\n        if (fn.pipe) {\n            return fn.pipe(new PushSignal());\n        }\n\n        // Function\n        return new ComputeSignal(fn, context);\n    }\n\n    static compute(fn, context) {\n        return new ComputeSignal(fn, context);\n    }\n\n    static fromProperty(name, object) {\n        // Function\n        return new PropertySignal(name, object);\n    }\n\n    /**\n    Signal.frame(fn, initial)\n    Returns an observe signal, a form of compute signal that calls `fn` once\n    immediately, and then on every animation frame following the invalidation\n    of any signal read during the execution of `fn`.\n    **/\n\n    static frame(fn) {\n        // Add to signals called on invalidation\n        return new FrameSignal(fn);\n    }\n\n    /**\n    Signal.tick(fn, initial)\n    Returns an observe signal, a form of compute signal that calls `fn` once\n    immediately, and then on every tick following the invalidation of any signal\n    read during the execution of `fn`.\n    **/\n\n    static tick(fn) {\n        // Add to signals called on invalidation\n        return new TickSignal(fn);\n    }\n\n    /**\n    Signal.temporal(name, object)\n    Creates a signal with an `.invalidateUntil(time)` method that maintains\n    invalidity until `time` is reached.\n    **/\n\n    static temporal(name, object) {\n        return new TimedSignal(name, object);\n    }\n\n    /**\n    Signal.evaluate(object, fn[, context])\n\n    A function for building objects that behave as compute or observe signals.\n\n    Evaluates `object` as a signal by applying it to `fn` and returning the\n    result. Signals read during `fn()` have `object` registered as a dependent,\n    so `object.invalidate()` is called when any of those signals are invalidated.\n    It's the same function as that used internally to evaluate signals.\n\n    Typically `object.invalidate()` would cue a `Signal.evaluate(object, fn)` at\n    some point in the future. (It is ill-advised to `Signal.evaluate(object, fn)`\n    synchronously inside `.invalidate()`, although this should only lead to\n    wasted cycles, not bad results... errm, in most cases, at least.)\n    **/\n\n    static evaluate(signal, fn, context = signal) {\n        // Make signal the evaluating signal for the duration of this\n        // synchronous evaluation of fn()\n        const previous = evaluatingSignal;\n        evaluatingSignal = signal;\n\n        // Clear the decks\n        if (!previous) hasInvalidDependency = false;\n\n        /*if (window.DEBUG && window.DEBUG.signal !== false) console.group(\n            '%cSignal%c evaluate%c ' + evaluatingSignal.constructor.name + '#' + evaluatingSignal.id + (evaluatingSignal.name ? ' \"' + evaluatingSignal.name + '\"' : ''),\n            'color: #718893; font-weight: 300;',\n            'color: #3896BF; font-weight: 300;',\n            'color: #718893; font-weight: 300;'\n        );*/\n\n        const value = fn.apply(context);\n\n        /*if (window.DEBUG && window.DEBUG.signal !== false) console.groupEnd();*/\n\n        evaluatingSignal = previous;\n\n        // Call synchronous updates\n        //if (!evaluatingSignal) handlers.forEach(call);\n\n        return value;\n    }\n\n    static get hasInvalidDependency() {\n        return hasInvalidDependency;\n    }\n\n    /*\n    Signal.evaluating\n    The signal that is currently being evaluated, or undefined. This is exposed\n    so that Data() can make a better call about when to create signals (if there\n    is no evaluating signal, it needn't make a signal when a property is\n    accessed). Deliberately undocumented.\n    */\n\n    static get evaluating() {\n        return evaluatingSignal;\n    }\n\n    constructor(name) {\n        if (name) this.name = name;\n\n        if (DEBUG) {\n            this.id = ++id;\n            console.log(\n                '%cSignal%c create%c ' + this.constructor.name + '#' + this.id + (this.name ? ' \"' + this.name + '\"' : ''),\n                'color: #718893; font-weight: 300;',\n                'color: #3896BF; font-weight: 300;',\n                'color: #718893; font-weight: 300;'\n            );\n        }\n    }\n\n    /**\n    .valueOf()\n\n    Enables direct use in some expressions like addition or string concatenation.\n    This may prove to be less useful than we think. For one thing, logging a\n    signal object now evaluates it, affecting the outcome.\n    **/\n\n    valueOf() {\n        return this.value;\n    }\n\n    /*\n    .toString()\n    .toJSON()\n\n    Treat `.value` as the value to output?\n    */\n\n    toString() {\n        return this.value + '' ;\n    }\n\n    toJSON() {\n        return this.value;\n    }\n}\n\n\n/*\nValueSignal(value)\n*/\n\nclass ValueSignal extends Signal {\n    #value;\n\n    constructor(value) {\n        super();\n        this.#value = value;\n    }\n\n    /**\n    .value\n\n    Getting `.value` gets value from the cache.\n\n    Setting `.value`, assuming the newly set value differs from the previous\n    value, updates the cache and invalidates dependent signals.\n    **/\n\n    get value() {\n        // If there is a signal currently evaluating then it becomes a\n        // dependency of this signal, irrespective of state of #value\n        if (evaluatingSignal) setDependency(this, evaluatingSignal);\n        return this.#value;\n    }\n\n    set value(value) {\n        // Don't update for no change in value\n        if(this.#value === value) return;\n\n        // Set cached value\n        this.#value = value;\n\n        // Invalidate dependents. If a dependent updates synchronously here\n        // we may be in trouble but #valid is true and #value is set so\n        // that's ok I think?\n        invalidateDependents(this);\n    }\n}\n\n\n/*\nPushSignal(value)\nAn consumer interface that allows you to terminate a Stream in a signal.\n\n```js\nStream.of(1).pipe(new PushSignal())\n```\n*/\n\nclass PushSignal extends Signal {\n    #value;\n\n    constructor(value) {\n        super();\n        this.#value = value;\n    }\n\n    /**\n    .value\n    Getting `.value` gets value from the cache.\n    **/\n    get value() {\n        // If there is a signal currently evaluating then it becomes a\n        // dependency of this signal, irrespective of state of #value\n        if (evaluatingSignal) setDependency(this, evaluatingSignal);\n        return this.#value;\n    }\n\n    /**\n    .push(value)\n    Updates the cache with `value` and invalidates dependent signals.\n    **/\n    push(value) {\n        // Don't update for no change in value\n        if(this.#value === value) return;\n\n        // Set cached value\n        this.#value = value;\n\n        // Invalidate dependents.\n        invalidateDependents(this);\n    }\n}\n\n\n/*\nPropertySignal(value)\nWraps a property in a signal. TODO: is this really needed?\n*/\n\nclass PropertySignal extends Signal {\n    // Privates\n    #valid;\n    #value;\n\n    constructor(name, object) {\n        super(name);\n        this.object = object;\n    }\n\n    evaluate() {\n        return this.object[this.name];\n    }\n\n    /**\n    .value\n    Getting `.value` gets a cached value or, if the signal is invalid,\n    evaluates (and caches) value from `fn()`. During evaluation this signal is\n    registered as dependent on other signals whose value is got.\n    **/\n\n    get value() {\n        // If there is a signal currently evaluating then it becomes a\n        // dependency of this signal, irrespective of state of #value\n        if (evaluatingSignal) setDependency(this, evaluatingSignal);\n        if (this.#valid) return this.#value;\n        this.#value = Signal.evaluate(this, this.evaluate, this);\n        if (!hasInvalidDependency) this.#valid = true;\n        return this.#value;\n    }\n\n    set value(value) {\n        // Don't update for no change in value.\n        if(this.#value === value) return;\n\n        const { object, name } = this;\n\n        // Set value on object and update value from object in case target is\n        // doing something funky with property descriptors that return a\n        // different value from the value set.\n        object[name] = value;\n        value = object[name];\n\n        // Don't invalidate for no change in value.\n        if(this.#value === value) return;\n\n        // Set cache by reading value back off the object in case object is\n        // doing something funky with property descriptors that return a\n        // different value from the value that was set. Rare, but it can happen.\n        this.#value = value;\n\n        // Invalidate dependents. If a dependent updates synchronously here\n        // we may be in trouble but #valid is true and #value is set so\n        // that's ok I think?\n        invalidateDependents(this);\n    }\n\n    /*\n    .invalidate(signal)\n    Invalidates this signal and calls `.invalidate(this)` on all dependent\n    signals. The `signal` parameter is the signal causing the invalidation; it\n    may be `undefined`: where it exists it is verified as a current input of\n    this before this is invalidated.\n    */\n\n    invalidate(signal) {\n        if (!this.#valid) return;\n\n        // Verify that signal has the right to invalidate this to protect us\n        // against the case where a dependent is left on another signal due to\n        // an old evaluation\n        if (signal && !hasInput(this, signal)) return;\n\n        this.#valid = false;\n\n        // Clear inputs\n        clearInputs(this);\n\n        // Invalidate dependents. If a dependent updates synchronously here\n        // we may be in trouble, as it would evaluate and cache this signal\n        // and overwrite dependents before we have finished invalidating\n        // this set of dependents.\n        invalidateDependents(this);\n    }\n}\n\n\n/*\nComputeSignal(value)\n*/\n\nclass ComputeSignal extends Signal {\n    // Privates\n    #fn;\n    #context;\n    #valid;\n    #value;\n\n    constructor(fn, context) {\n        super();\n        this.#fn      = fn;\n        this.#context = context;\n    }\n\n    /**\n    .value\n    Getting `.value` gets a cached value or, if the signal is invalid,\n    evaluates (and caches) value from `fn()`. During evaluation this signal is\n    registered as dependent on other signals whose value is got.\n    **/\n\n    get value() {\n        // If there is a signal currently evaluating then it becomes a\n        // dependency of this signal, irrespective of state of #value\n        if (evaluatingSignal) setDependency(this, evaluatingSignal);\n        if (this.#valid) return this.#value;\n        this.#value = Signal.evaluate(this, this.#fn, this.#context);\n        if (!hasInvalidDependency) this.#valid = true;\n        return this.#value;\n    }\n\n    /*\n    .invalidate(signal)\n    Invalidates this signal and calls `.invalidate(this)` on all dependent\n    signals. The `signal` parameter is the signal causing the invalidation; it\n    may be `undefined`: where it exists it is verified as a current input of\n    this before this is invalidated.\n    */\n\n    invalidate(signal) {\n        if (!this.#valid) return;\n\n        // Verify that signal has the right to invalidate this to protect us\n        // against the case where a dependent is left on another signal due to\n        // an old evaluation\n        if (signal && !hasInput(this, signal)) return;\n\n        this.#valid = false;\n\n        // Clear inputs\n        clearInputs(this);\n\n        // Invalidate dependents. If a dependent updates synchronously here\n        // we may be in trouble, as it would evaluate and cache this signal\n        // and overwrite dependents before we have finished invalidating\n        // this set of dependents.\n        invalidateDependents(this);\n    }\n}\n\n\n/**\nTimedSignal(name, object)\nA signal that wraps an AudioParam and remains invalid until a specified time in\nthe future. This ensures that any FrameSignal signals that depend on it keep\nrendering until automation completes.\n**/\n\nexport class TimedSignal extends Signal {\n    #validTime = 0;\n\n    constructor(name, object) {\n        super(name);\n        this.object = object;\n    }\n\n    getTime() {\n        return window.performance.now();\n    }\n\n    evaluate() {\n        return this.object[this.name];\n    }\n\n    /**\n    .value\n    Getting `.value` gets the object's value. If there's an evaluating signal,\n    it becomes dependent on this ParamSignal. The signal remains invalid until\n    the `.getTime()` reaches `.invalidateUntil(time)` time.\n    **/\n    get value() {\n        // If there is a signal currently evaluating then it becomes a\n        // dependency of this signal\n        if (Signal.evaluating) {\n            setDependency(this, evaluatingSignal);\n\n            // This is a timed signal, therefore may remain invalid following an\n            // evaluation. We can't invalidate the graph while evaluating, but\n            // the invalid state must prevent dependents from becoming valid...\n            // ...so set a flag marking the current evaluation as invalid\n            if (this.getTime() < this.#validTime) hasInvalidDependency = true;\n        }\n\n        // Get the current value from the audio param\n        return this.evaluate();\n    }\n\n    // DEPRECATE\n    set value(value) {\n        console.warn('Dont really want to be setting value of TimedSignal');\n        console.trace();\n\n        // Don't update for no change in value.\n        if(this.object[this.name] === value) return;\n\n        // Update value and invalidate until now\n        this.object[this.name] = value;\n        invalidateUntil(this.getTime());\n    }\n\n    /**\n    .invalidateUntil(time)\n    Sets a time at which this signal becomes valid. Until this time is reached\n    the signal remains invalid, causing dependent observer signals to keep\n    observing.\n    **/\n    invalidateUntil(time) {\n        // Don't do anything if the #validTime isn't changing ... Hmmm ... see\n        // below. I think this condition suffers the same problem.\n        //if (time === this.#validTime) return;\n\n        const currentTime = this.getTime();\n        const isValid     = currentTime >= this.#validTime;\n\n        // Update the #validTime\n        this.#validTime = time;\n\n        // If we are moving into a valid state do nothing ... Hmmmmmm ...\n        // This condition interferes with being able to invalidate a time in the\n        // past, which we may want to do for example for latency compensation.\n        // If we are calling .invalidateUntil(), I think we can assume something\n        // has changed and we need to invalidate unless we were already invalid.\n        //if (currentTime > time) return;\n\n        // If we are moving out of a valid state invalid dependents\n        if (isValid) invalidateDependents(this);\n    }\n}\n\n\n/*\nObserver(evaluate)\nAn Observer is a signal that schedules it's own evaluation. It calls `evaluate`\non construction and again on every cue following an invalidation of any signal\nread by `evaluate`. Internal only, sub-classed by `TickSignal` and `FrameSignal`.\n*/\n\nclass Observer extends Signal {\n    constructor(fn) {\n        super();\n\n        if (DEBUG) {\n            this.id = ++id;\n            console.log(\n                '%cSignal%c create%c ' + this.constructor.name + '#' + this.id + (this.name ? ' \"' + this.name + '\"' : ''),\n                'color: #718893; font-weight: 300;',\n                'color: #3896BF; font-weight: 300;',\n                'color: #718893; font-weight: 300;'\n            );\n        }\n\n        // Check we are not currently evaluating. This would be bad because an\n        // evaluation is ephemereal – it may run again, leaving this signal in\n        // memory yet superseded by the one created in the latest evaluation.\n        if (evaluatingSignal) {\n            // ------------------------ Experimental ---------------------------\n            // We can set this as an input of evaluatingSignal. this will never\n            // invalidate evaluatingSignal – it has no mechanism to do so – but\n            // when evaluatingSignal is invalidated this will be stopped.\n            let n = 0;\n            while (evaluatingSignal[--n]) if (evaluatingSignal[n] === this) break;\n            evaluatingSignal[n] = this;\n            // -----------------------------------------------------------------\n\n            // The old way was to throw an error.\n            // Make recovery possible? I'm not convinced this works in all cases\n            // but it works where an observer is instantiated inside an observer\n            //evaluatingSignal = undefined;\n            //throw new Error('Illegal nested ' + this.constructor.name + ' – cannot instantiate observer during signal evaluation');\n        }\n\n        // If no fn passed in we do not want to evaluate the signal immediately.\n        // This provides for a sub-class to define .evaluate() and launch it\n        // when it likes, as in Literal's Renderer.\n        if (!fn) return;\n\n        // Set fn as evaluation function\n        this.evaluate = fn;\n\n        // An initial, synchronous evaluation binds this observer to changes\n        if (Signal.evaluate(this, this.evaluate) || hasInvalidDependency) this.cue();\n    }\n\n    invalidate(input) {\n        // Static observers list\n        const observers = this.constructor.observers;\n\n        // If the observer is already cued do nothing\n        if (observers.indexOf(this) !== -1) return;\n\n        // Verify that input signal has the right to invalidate this\n        if (input && !hasInput(this, input)) return;\n\n        // Clear inputs\n        clearInputs(this);\n\n        this.cue();\n    }\n\n    stop() {\n        // Remove this from signal graph\n        let n = 0, input;\n        while (input = this[--n]) {\n            let m = -1;\n            this[n] = undefined;\n            // --------------------- Experimental ------------------------------\n            // A stopable signal has no output\n            if (input.stop) input.stop();\n            // -----------------------------------------------------------------\n            else removeOutput(input, this);\n        }\n\n        // Remove from observers if cued\n        const observers = this.constructor.observers;\n        const i = observers.indexOf(this);\n        if (i !== -1) {\n            // You cannot do this during a render cycle\n            if (observers === rendering) throw new Error('Attempt to remove observer while observers is rendering');\n            observers.splice(i, 1);\n        }\n        return this;\n    }\n\n    valueOf()  { return this; }\n    toString() { return '[object Signal]' ; }\n    toJSON()   { return; }\n}\n\nlet rendering;\n\nfunction render(observers) {\n    let n = -1, signal;\n\n    rendering = observers;\n    while (signal = observers[++n]) {\n        // Evaluate the signal, if it returns false-y, and nothing has flagged\n        // it as having invalid dependencies...\n        if (!Signal.evaluate(signal, signal.evaluate) && !hasInvalidDependency) {\n            // ...remove the signal from observers and decrement n\n            observers.splice(n--, 1);\n        }\n    }\n    rendering = undefined;\n    return observers;\n}\n\n\n/*\nTickSignal\nA TickSignal is a signal that calls `fn` on construction and again on every\ntick following an invalidation of any signal read by `fn`. Use `Signal.tick(fn)`.\n*/\n\nconst promise = Promise.resolve();\n\nfunction tick() {\n    const observers = render(TickSignal.observers);\n\n    // Where observers remain schedule the next tick\n    if (observers.length) promise.then(tick);\n}\n\nexport class TickSignal extends Observer {\n    static observers = [];\n\n    cue() {\n        const observers = this.constructor.observers;\n\n        // If no observers are cued, cue tick() on the next tick\n        if (!observers.length) promise.then(tick);\n\n        // Add this observer to observers\n        observers.push(this);\n    }\n}\n\n\n/*\nFrameSignal\n\nA FrameSignal is an observer signal that calls `fn` on construction and again\non every animation frame following an invalidation of any signal read by `fn`.\nAdditionally where the return value of `fn()` is truthy the signal remains\nactive and will evaluate on following frames until `fn()` is false-y.\n\nUse `Signal.frame(fn)` to create a FrameSignal signal.\n*/\n\nfunction frame() {\n    const observers = render(FrameSignal.observers);\n\n    // Where observers remain schedule the next frame\n    if (observers.length) requestAnimationFrame(frame);\n}\n\nexport class FrameSignal extends Observer {\n    static observers = [];\n\n    cue() {\n        const observers = this.constructor.observers;\n\n        // If no observers are cued, cue frame() on the next frame\n        if (!observers.length) window.requestAnimationFrame(frame);\n\n        // Add this observer to observers\n        observers.push(this);\n    }\n}\n", "\n/**\nrect(node)\n\nReturns a `DOMRect` object describing the draw rectangle of `node`.\n(If `node` is `window` a preudo-DOMRect object is returned).\n**/\n\nfunction windowBox() {\n\treturn {\n\t\tx:      0,\n\t\ty:      0,\n\t\tleft:   0,\n\t\ttop:    0,\n\t\tright:  window.innerWidth,\n\t\tbottom: window.innerHeight,\n\t\twidth:  window.innerWidth,\n\t\theight: window.innerHeight\n\t};\n}\n\nexport default function rect(node) {\n\treturn node === window ?\n\t\twindowBox() :\n        // In Safari SVG shapes dont get a .getClientRects()[0] so fallback to\n        // .getBoundingClientRect()\n\t\tnode.getClientRects()[0] || node.getBoundingClientRect() ;\n}\n", "/**\nid(value)\nReturns `value`.\n**/\n\nexport default function id(value) { return value; }\n", "/**\noverload(fn, object)\n\nReturns an overloaded.\n\nTakes a `fn` that returns a string key, and an `object` of key:function\npairs. The returned function calls `fn` with all arguments to get a key,\nthen calls the function at `object[key]` with all arguments.\n\nWhere `fn` returns `undefined`, `object.default` is called if it is defined\nin `object`, otherwise `overload` throws a 'no function defined for key' error.\n\n```\nvar handleEvent = overload(get('type'), {\n    click:   (e) => {...},\n    input:   (e) => {...},\n    default: (e) => {...}\n});\n```\n*/\n\n\nexport default function overload(fn, map) {\n    return function overload() {\n        const key     = fn.apply(this, arguments);\n        const handler = (map[key] || map.default);\n\n        if (!handler) {\n            throw new Error('overload() no function defined for key \"' + key + '\"');\n        }\n\n        return handler.apply(this, arguments);\n    };\n}\n", "\nconst global = globalThis || window;\n\n/**\ncache(fn)\nReturns a function that caches the output values of `fn(input)` against input\nvalues in a map, such that for each input value `fn` is only ever called once.\n*/\n\nlet warned;\n\nexport default function cacheByObject(fn) {\n    var map = new Map();\n\n    return function cache(object) {\n        if (global.DEBUG && !warned && object === undefined) {\n            warned = true;\n            console.warn('cache() called with undefined. Not illegal, but potentially bad.');\n        }\n\n        if (global.DEBUG && arguments.length > 1) {\n            console.warn('cache() called with ' + arguments.length + ' arguments. Accepts exactly 1.');\n        }\n\n        if (map.has(object)) {\n            return map.get(object);\n        }\n\n        var value = fn(object);\n        map.set(object, value);\n        return value;\n    };\n}\n", "\nconst global = globalThis || window;\n\n/**\ncurry(fn [, muteable, arity])\nReturns a function that wraps `fn` and makes it partially applicable.\n*/\n\nimport cache from './cache.js';\n\nconst A = Array.prototype;\n\nfunction applyFn(fn, args) {\n    return typeof fn === 'function' ? fn.apply(null, args) : fn ;\n}\n\nfunction curry(fn, muteable, arity) {\n    arity = arity || fn.length;\n\n    var memo = arity === 1 ?\n        // Don't cache if `muteable` flag is true\n        muteable ? fn : cache(fn) :\n\n        // It's ok to always cache intermediate memos, though\n        cache(function(object) {\n            return curry(function() {\n                var args = [object];\n                args.push.apply(args, arguments);\n                return fn.apply(null, args);\n            }, muteable, arity - 1) ;\n        }) ;\n\n    return function partial(object) {\n        return arguments.length === 0 ?\n            partial :\n        arguments.length === 1 ?\n            memo(object) :\n        arguments.length >= arity ?\n            fn.apply(null, arguments) :\n        // This is bad, I think. We don't want [[fn],[fn]].map(get(0)) to be firing the fns\n        //arguments.length > arity ?\n        //    applyFn(fn.apply(null, A.splice.call(arguments, 0, arity)), arguments) :\n        applyFn(memo(object), A.slice.call(arguments, 1)) ;\n    };\n}\n\n//function curry(fn, muteable, arity) {\n//    arity = arity || fn.length;\n//    return function curried() {\n//        return arguments.length >= arity ?\n//            fn.apply(null, arguments) :\n//            curried.bind(null, ...arguments) ;\n//    };\n//}\n\nif (typeof global !== 'undefined' && global.DEBUG) {\n    const _curry = curry;\n\n    // Feature test\n\tconst isFunctionLengthDefineable = (function() {\n\t\tvar fn = function() {};\n\n\t\ttry {\n\t\t\t// Can't do this on Safari - length non configurable :(\n\t\t\tObject.defineProperty(fn, 'length', { value: 2 });\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn fn.length === 2;\n\t})();\n\n    const setFunctionProperties = function setFunctionProperties(text, parity, fn1, fn2) {\n        // Make the string representation of fn2 display parameters of fn1\n        fn2.toString = function() {\n            return /function\\s*[\\w\\d]*\\s*\\([,\\w\\d\\s]*\\)/.exec(fn1.toString()) + ' { [' + text + '] }';\n        };\n\n        // Where possible, define length so that curried functions show how\n        // many arguments they are yet expecting\n        if (isFunctionLengthDefineable) {\n            Object.defineProperty(fn2, 'length', { value: parity });\n        }\n\n        return fn2;\n    };\n\n    // Make curried functions log a pretty version of their partials\n    curry = function curry(fn, muteable, arity) {\n        arity  = arity || fn.length;\n        return setFunctionProperties('curried', arity, fn, _curry(fn, muteable, arity));\n    };\n}\n\n\nexport default curry;\n", "/**\nnoop()\nDoes nothing, returns undefined.\n**/\n\nexport default function noop() {}\n", "/**\nassign(node, properties)\n\nAssigns each property of `properties` to `node`, as a property where that\nproperty exists in `node`, otherwise as an attribute.\n\nIf `properties` has a property `'children'` it must be an array of nodes;\nthey are appended to 'node'.\n\nThe property `'html'` is aliased to `'innerHTML'`. The property `'text'`\nis aliased to `'textContent'`. The property `'tag'` is treated as an alias\nof `'tagName'` (which is ignored, as `node.tagName` is read-only). The\nproperty `'is'` is also ignored.\n*/\n\nimport curry from 'fn/curry.js';\nimport id from 'fn/id.js';\nimport noop from 'fn/noop.js';\nimport overload from 'fn/overload.js';\n\nconst assignProperty = overload(id, {\n\t// Ignore read-only properties or attributes\n\tis: noop,\n\ttag: noop,\n\n\tdata: function(name, node, object) {\n\t\t// Strip undefined\n\t\tfor (name in object) {\n\t\t\tif (object[name] === undefined) {\n\t\t\t\tdelete object[name];\n\t\t\t}\n\t\t}\n\n\t\tObject.assign(node.dataset, object);\n\t},\n\n\tdataset: function(name, node, object) {\n        // Strip undefined\n        for (name in object) {\n            if (object[name] === undefined) {\n                delete object[name];\n            }\n        }\n\n\t\tObject.assign(node.dataset, object);\n\t},\n\n\thtml: function(name, node, content) {\n\t\tnode.innerHTML = content;\n\t},\n\n\ttext: function(name, node, content) {\n\t\tnode.textContent = content;\n\t},\n\n\tstyle: overload((name, node, content) => typeof content, {\n\t\tstring: (name, node, content) => node.style = content,\n\t\tobject: (name, node, content) => Object.assign(node.style, content)\n\t}),\n\n\tchildren: function(name, node, content) {\n\t\t// Empty the node and append children\n\t\tnode.innerHTML = '';\n\t\tnode.append.apply(node, content);\n\t},\n\n\t// SVG elements have a read-only properties, and must be set as string\n\t// attributes. Todo: explore the SVG property API to make these take\n\t// advantage of it\n    href: function(name, node, content) {\n        if (node instanceof SVGElement) {\n            node.setAttribute('href', content);\n        }\n        else {\n            node.href = content;\n        }\n    },\n\n\tpoints:    setAttribute,\n    cx:        setAttribute,\n    cy:        setAttribute,\n    r:         setAttribute,\n\tx:         setAttribute,\n\ty:         setAttribute,\n\tdx:        setAttribute,\n\tdy:        setAttribute,\n\ttransform: setAttribute,\n    preserveAspectRatio: setAttribute,\n    viewBox:   setAttribute,\n\n\tdefault: function(name, node, content) {\n\t\tif (name in node) {\n\t\t\tnode[name] = content;\n\t\t}\n\t\telse {\n\t\t\tnode.setAttribute(name, content);\n\t\t}\n\t}\n});\n\nfunction setAttribute(name, node, content) {\n\tnode.setAttribute(name, content);\n}\n\nexport function assign(node, attributes) {\n\tvar names = Object.keys(attributes);\n\tvar n = names.length;\n\n    // Avoid setting undefined\n    while (n--) if (attributes[names[n]] !== undefined) {\n        assignProperty(names[n], node, attributes[names[n]]);\n    }\n\n\treturn node;\n}\n\nexport default curry(assign, true);\n", "\nimport id       from 'fn/id.js';\nimport overload from 'fn/overload.js';\nimport assign   from './assign.js';\n\nconst svgNamespace = 'http://www.w3.org/2000/svg';\n\nconst template      = document.createElement('template');\nconst typeofContent = (type, content) => (content && typeof content);\n\n// Constructors\n\nfunction createContextFragment(context, html = '') {\n    const range = document.createRange();\n    range.selectNode(context);\n    return range.createContextualFragment(html);\n}\n\nconst createSVG = overload(typeofContent, {\n    string: function(tag, html) {\n        const node = document.createElementNS(svgNamespace, tag);\n        node.innerHTML = html;\n        return node;\n    },\n\n    object: function(tag, object) {\n        const node = document.createElementNS(svgNamespace, tag);\n\n        // Is it array-like?\n        if (typeof object.length === 'number') {\n            // Be careful here in case object is a live NodeList, which will\n            // mutate as you iterate over it. Applying object to .append()\n            // appears to not have this problem, and will work on arrays.\n            node.append.apply(node, object);\n        }\n        else {\n            assign(node, object);\n        }\n\n        return node;\n    },\n\n    default: (tag) => document.createElementNS(svgNamespace, tag)\n});\n\nconst createHTML = overload(typeofContent, {\n    string: function(tag, html) {\n        const node = document.createElement(tag);\n        node.innerHTML = html;\n        return node;\n    },\n\n    object: function(tag, object) {\n        const node = document.createElement(tag);\n\n        // Is it array-like?\n        if (typeof object.length === 'number') {\n            // Be careful here in case object is a live NodeList, which will\n            // mutate as you iterate over it. Applying object to .append()\n            // appears to not have this problem, and will work on arrays.\n            node.append.apply(node, object);\n        }\n        else {\n            assign(node, object);\n        }\n\n        return node;\n    },\n\n    default: (tag) => document.createElement(tag)\n});\n\n/**\ncreate(tag, content)\n\nConstructs and returns a new DOM node.\n\n- If `tag` is `\"text\"` a text node is created.\n- If `tag` is `\"fragment\"` a fragment is created.\n- If `tag` is `\"comment\"` a comment is created.\n- If `tag` is any other string the element `<tag></tag>` is created.\n\nWhere a comment or text node is created `content` must be a string, as is set as\ntextContent. For fragments and other nodes:\n\n- If `content` is a string it is set as innerHTML.\n- If `content` is array-like its items are appended to node. Note that where\n`content` is a NodeList, this removes nodes from whatever the NodeList belongs\nto.\n- If `content` is an object its properties are assigned as node properties or\nattributes.\n\n##### `create(tag, content, context)`\n\nWhere `tag` is `fragment` there is an optional third parameter `context`, which\nmust be an element. The fragment parser is run in the context of this element.\n\n```\ncreate('fragment', '<li>', create('ul'));\n```\n**/\n\nconst create = overload(id, {\n    comment: function(tag, text) {\n        return document.createComment(text || '');\n    },\n\n    fragment: overload(typeofContent, {\n        string: function(tag, html, context) {\n            if (context) {\n                return createContextFragment(context, html);\n            }\n\n            template.innerHTML = html;\n            return template.content.cloneNode(true);\n        },\n\n        object: function(tag, object, context) {\n            // If there is context, create a context-aware fragment\n            const fragment = context ?\n                createContextFragment(context) :\n                document.createDocumentFragment() ;\n\n            // Is object array-like?\n            if (typeof object.length === 'number') {\n                // Be careful here in case object is a live NodeList, which will\n                // mutate as you iterate over it. Applying object to .append()\n                // appears to not have this problem, and will work on arrays.\n                fragment.append.apply(fragment, object);\n            }\n            else {\n                assign(fragment, object);\n            }\n\n            return fragment;\n        },\n\n        default: () => document.createDocumentFragment()\n    }),\n\n    /*text: function (tag, text) {\n        return document.createTextNode(text || '');\n    },*/\n\n    circle:   createSVG,\n    ellipse:  createSVG,\n    g:        createSVG,\n    glyph:    createSVG,\n    image:    createSVG,\n    line:     createSVG,\n    rect:     createSVG,\n    use:      createSVG,\n    path:     createSVG,\n    pattern:  createSVG,\n    polygon:  createSVG,\n    polyline: createSVG,\n    svg:      createSVG,\n    tspan:    createSVG,\n    text:     createSVG,\n\n    default:  createHTML\n});\n\nexport default create;\n\n", "\n/**\nexec(regex, fn, string)\nCalls `fn` with the result of `regex.exec(string)` if that result is not null,\nand returns the resulting value.\n**/\n\nimport curry from './curry.js';\n\nexport function exec(regex, fn, string) {\n    let data;\n\n    // If string looks like a regex result, get rest of string\n    // from latest index\n    if (typeof string !== 'string' && string.input !== undefined && string.index !== undefined) {\n        data = string;\n        string = data.input.slice(\n            string.index\n            + string[0].length\n            + (string.consumed || 0)\n        );\n    }\n\n    // Look for tokens\n    const tokens = regex.exec(string);\n    if (!tokens) { return; }\n\n    const output = fn(tokens);\n\n    // If we have a parent tokens object update its consumed count\n    if (data) {\n        data.consumed = (data.consumed || 0)\n            + tokens.index\n            + tokens[0].length\n            + (tokens.consumed || 0) ;\n    }\n\n    return output;\n}\n\nexport default curry(exec, true);\n", "\nimport curry from './curry.js';\nimport { exec } from './exec.js';\n\nfunction error(regex, reducers, string) {\n    if (string.input !== undefined && string.index !== undefined) {\n        string = string.input;\n    }\n\n    throw new Error('Cannot parse string \"' + (string.length > 128 ? string.length.slice(0, 128) + '…' : string) + '\"');\n}\n\nfunction reduce(reducers, acc, tokens) {\n    let n = -1;\n\n    while (++n < tokens.length) {\n        acc = (tokens[n] !== undefined && reducers[n]) ? reducers[n](acc, tokens) : acc ;\n    }\n\n    // Call the optional done fn\n    return reducers.done ? reducers.done(acc, tokens) :\n        // Support the old .close() name\n        reducers.close ? reducers.close(acc, tokens) :\n        // Return the result\n        acc ;\n}\n\n/**\ncapture(regex, reducers, accumulator, string)\nParse `string` with `regex`, calling functions in `reducers` to modify\nand return `accumulator`.\n\nReducers is an object of functions keyed by the index of their capturing\ngroup in the regexp result (`0` corresponding to the entire regex match,\nthe first capturing group being at index `1`). Reducer functions are\ncalled in capture order for all capturing groups that captured something.\nReducers may also define the function 'done', which is called at the end\nof every capture. All reducer functions are passed the paremeters\n`(accumulator, tokens)`, where `tokens` is the regexp result, and are expected\nto return a value that is passed as an accumulator to the next reducer function.\n\nReducers may also define a function `'catch'`, which is called when a match\nhas not been made (where `'catch'` is not defined an error is thrown).\n\n```js\nconst parseValue = capture(/^\\s*(-?\\d*\\.?\\d+)(\\w+)?\\s*$/, {\n    // Create a new accumulator object each call\n    0: () => ({}),\n\n    1: (acc, tokens) => {\n        acc.number = parseFloat(tokens[1]);\n        return acc;\n    },\n\n    2: (acc, tokens) => {\n        acc.unit = tokens[2];\n        return acc;\n    }\n}, null);\n\nconst value = parseValue('36rem');    // { number: 36, unit: 'rem' }\n```\n*/\n\nexport function capture(regex, reducers, acc, string) {\n    const output = exec(regex, (tokens) => reduce(reducers, acc, tokens), string);\n\n    // If tokens is undefined exec has failed to apply regex to string\n    return output === undefined ?\n        // If there is a catch function, call it, otherwise error out\n        reducers.catch ?\n            reducers.catch(acc, string) :\n            error(regex, reducers, string) :\n\n        // Return the accumulator\n        output ;\n}\n\nexport default curry(capture, true);\n", "\n\nimport create from '../create.js';\n\nconst $internals = Symbol('internals');\n\n// TODO: No longer needed polyfill for Safari... ??\n/*\nfunction attachInternals(element) {\n    var internals;\n\n    // Use native attachInternals where it exists and we have the right to use\n    // it - you cannot attachInternals to customised built-ins\n    if (element.attachInternals && !element.getAttribute('is')) {\n        return element.attachInternals();\n        //if (internals.setFormValue) return internals;\n    }\n    else {\n        internals = {\n            shadowRoot: elem.shadowRoot\n        };\n    }\n\n    // Otherwise polyfill it with a pseudo internals object, actually a hidden\n    // input that we put inside element (but outside the shadow DOM). We may\n    // not yet put this in the DOM however – it violates the spec to give a\n    // custom element children before it's contents are parsed. Instead we\n    // wait until connectCallback.\n    //internals.polyfillInput = create('input', { type: 'hidden', name: elem.name });\n    //elem.appendChild(internals.polyfillInput);\n    // Polyfill internals object setFormValue\n    //internals.setFormValue = function(value) {\n    //    this.input.value = value;\n    //};\n\n    return internals;\n}\n\nexport function createInternals(Element, element, shadow) {\n    return (element[$internals] = Element.formAssociated ?\n        attachInternals(element) :\n        { shadowRoot: shadow }\n    );\n}\n*/\n\nexport function createInternals(Element, element, shadow) {\n    return element[$internals] = (element.attachInternals && !element.getAttribute('is')) ?\n        element.attachInternals() :\n        { shadowRoot: shadow } ;\n}\n\nexport function getInternals(element) {\n    return element[$internals];\n}\n", "\n/**\nelement(tag, lifecycle, properties, stylesheet, message)\n\nRegisters a custom element `tag` and returns its constructor.\n\n- `tag`: A string in the form `'custom-name'`, `'<custom-name>'`,\n`'tag is=\"custom-name\"'` or `'<tag is=\"custom-name\">'`\n- `lifecycle`: `{\n    mode:       'open' or 'closed'\n    focusable:  true or false\n    shadow:     html string or '#template-id' or fragment\n\n    // Styleheet\n    stylesheet: optional string path to stylesheet for shadow DOM\n\n    // Lifecycle handlers\n    construct:  called during element construction\n    connect:    called when element added to DOM\n    load:       called when stylesheet loaded\n    disconnect: called when element removed from DOM\n\n    // Form elements\n    enable:     called when form element enabled\n    disable:    called when form element disabled\n    reset:      called when form element reset\n    restore:    called when form element restored\n}`\n- `properties`: `{\n    name: {\n        construct: fn called before lifecycle.construct\n        attribute: fn called on `element.setAttribute('name', ...)`\n        set:       fn called on setting property 'name'\n        get:       fn called on getting property 'name'\n    }\n}`\n- `stylesheet`: url of a stylesheet to load in to the shadow DOM\n- `message`: optional debug message to logged when element is registered\n\nThe name form `'tag is=\"element-name\"'` creates customised built-in elements in\nbrowsers that support the feature. Safari does not, but support is somewhat\npolyfilled. Mileage will vary.\n\n#### Lifecycle\n\nLifecycle handlers are called with the element as `this` and with the parameters\n`shadow` and `internals`.\n\nOn initialisation the `construct` handler is called. Set up the shadow root and\ndefine event handlers here. Children and attributes must not be inspected or\nassigned at this point: doing so will throw an error when constructed via\n`document.createElement()`.\n\nFollowing that, attribute handlers in `properties` are called for attributes\ndeclared in the HTML. The HTML parser normally calls these in source order.\n\nThen the `connect` handler is called when the element is placed in the DOM, or\nif it is already in the DOM and is being upgraded.\n\nBoth `load` and `slotchange` are asynchronous. Things get a little tricky here.\nThe order of `load` callbacks and `'slotchange'` listeners cannot be guaranteed\nin Safari. When there is an empty cache `slotchange` comes first, as it always\ndoes in other browsers, otherwise `load` happens first.\n\nWhere there is a stylesheet loading, most browsers call `'slotchange'` listeners\n(asynchronously) before `load` – except Safari, where if the stylesheet is\nalready cached `load` is called before `'slotchange'` listeners. (TODO: I would\nlike to guarantee `slotchange` before `load`, but it is not clear how to delay\n`load`... if there is no slotted content, `slotchange` may not be called at\nall...)\n\nFinally, `connect` and `disconnect` are called whenever the element is inserted\ninto or removed from the DOM.\n\nThe effects of the `mode` option are subtle. In 'closed' mode, the element is\nnot given a publicly accessible `shadowRoot` property, and events that traverse\nthe shadow boundary are retargeted (as they are in 'open' mode) but also have\ntheir `path` list truncated.\n\n### Properties\n\nWhere the `properties` object contains a definition for a `value` property, work\nis done to give the element form field behaviour. The constructor is assigned\nthe property `formAssociated` which signals to the browser that it constructs\nform fields. Where they are not defined in `properties` the prototype is\nassigned default handlers for the standard properties `type`, `name`, `form`,\n`labels`, `validity`, `validationMessage`, `willValidate`, `checkValidity`\nand `reportValidity`. Form behaviour is also mildly polyfilled in browsers\nwithout support by inserting a hidden input inside the element but outside the\nshadow DOM. Mileage will vary. Managing focus can be problematic without browser\nsupport.\n*/\n\nimport capture  from 'fn/capture.js';\nimport id       from 'fn/id.js';\nimport noop     from 'fn/noop.js';\nimport overload from 'fn/overload.js';\nimport create   from './create.js';\nimport { createInternals, getInternals } from './element/internals.js';\n\n\nconst define         = Object.defineProperties;\nconst nothing        = {};\nconst constructors   = {};\nconst formProperties = {\n    // These properties echo those provided by native form controls. They are\n    // not strictly required, but provided for consistency with standard form\n    // elements.\n\n    //type: { value: 'text' },\n\n    name: {\n        set: function(name) { return this.setAttribute('name', name); },\n        get: function()     { return this.getAttribute('name') || ''; }\n    },\n\n    form:              { get:   function() { return getInternals(this).form; }},\n    labels:            { get:   function() { return getInternals(this).labels; }},\n    validity:          { get:   function() { return getInternals(this).validity; }},\n    validationMessage: { get:   function() { return getInternals(this).validationMessage; }},\n    willValidate:      { get:   function() { return getInternals(this).willValidate; }},\n    checkValidity:     { value: function() { return getInternals(this).checkValidity(); }},\n    reportValidity:    { value: function() { return getInternals(this).reportValidity(); }}\n};\n\n\nlet supportsCustomisedBuiltIn = false;\n\n\n// Capture name and tag from <element-name> or <tag is=\"element-name\">, syntax\n// brackets and quotes optional\nconst parseNameTag = capture(/^\\s*<?([a-z][\\w]*-[\\w-]+)>?\\s*$|^\\s*<?([a-z][\\w]*)\\s+is[=\\s]*[\"']?([a-z][\\w]*-[\\w-]+)[\"']?>?\\s*$/, {\n    1: (data, captures) => ({\n        name: captures[1]\n    }),\n\n    2: (data, captures) => ({\n        name: captures[3],\n        tag:  captures[2]\n    }),\n\n    catch: function(data, name) {\n        throw new SyntaxError('dom element() – name must be of the form \\'element-name\\' or \\'tag is=\"element-name\"\\' (' + name + ')')\n    }\n}, null);\n\nconst onceEvent = { once: true };\n\nfunction toLoadPromise(element) {\n    return !!element.sheet ?\n        // Link has already loaded\n        Promise.resolve({ target: element }) :\n        // Wait for load\n        new Promise((resolve, reject) => {\n            element.addEventListener('load', resolve, onceEvent);\n            element.addEventListener('error', reject, onceEvent);\n        }) ;\n}\n\nfunction stop(object) {\n    object.stop();\n}\n\nfunction getElementConstructor(tag) {\n    if (constructors[tag]) return constructors[tag];\n\n    const constructor = document.createElement(tag).constructor;\n    if (constructor === HTMLUnknownElement) {\n        throw new Error('Cannot define customised built-in - constructor for <' + tag + '> is HTMLUnknownElement');\n    }\n\n    return constructors[tag] = constructor;\n}\n\nfunction transferProperty(element, key) {\n    if (element.hasOwnProperty(key)) {\n        const value = element[key];\n        delete element[key];\n        element[key] = value;\n    }\n    return element;\n}\n\nfunction createShadow(elem, options) {\n    // Create a shadow root. Shadows may be 'open' or 'closed'. Closed shadows\n    // are not exposed via element.shadowRoot, and events propagating from\n    // inside of them report the element as target. Default to 'closed'.\n    const shadow = elem.attachShadow({\n        mode:           options.mode || 'closed',\n        delegatesFocus: options.focusable || false\n    });\n\n    if (options.stylesheet) {\n        const link = create('link', { rel: 'stylesheet', href: options.stylesheet });\n        shadow.append(link);\n    }\n\n    return shadow;\n}\n\nfunction fillShadowFromTemplate(shadow, template) {\n    // It's a string\n    if (typeof template === 'string') {\n        // It's an id of a template\n        if (template[0] === '#') {\n            shadow.appendChild(\n                document.getElementById(template.slice(1))\n                .content.clone(true)\n            );\n        }\n        // It's html\n        else {\n            shadow.innerHTML = template;\n        }\n    }\n    // It's a <template>\n    else {\n        shadow.appendChild(template.content.clone(true));\n    }\n\n    return shadow;\n}\n\nfunction isNotUpgraded(element) {\n    /* Detect marked as upgraded, mark if not */\n    const upgraded = element.isUpgraded;\n    element.isUpgraded = true;\n    return !upgraded;\n}\n\nfunction findByIs(root, name) {\n    return Array\n    .from(root.querySelectorAll('[is=\"' + name + '\"]'))\n    .filter(isNotUpgraded);\n}\n\nconst createDescriptor = overload((name, options) => typeof options, {\n    object:   (name, descriptor) => descriptor,\n    function: (name, fn) => ({ value: fn }),\n    default:  (name, options) => {\n        throw new TypeError('element() does not accept property descriptor of type ' + typeof options);\n    }\n});\n\nexport default function element(definition, lifecycle = {}, properties = {}, log = '') {\n    const { name, tag } = parseNameTag(definition);\n\n    // Get the element constructor or the base HTMLElement constructor\n    const constructor = typeof tag === 'string' ?\n        getElementConstructor(tag) :\n        HTMLElement ;\n\n    // Split properties into attributes and property descriptors\n    const attributes  = [];\n    const descriptors = {};\n\n    let propname, descriptor;\n    for (propname in properties) {\n        descriptor = createDescriptor(propname, properties[propname]);\n\n        // Add name to list of observed attributes\n        if (descriptor.attribute) attributes.push(propname);\n\n        // Add descriptor to properties to be defined\n        if (descriptor.set || descriptor.get || 'value' in descriptor) descriptors[propname] = descriptor;\n\n        // Override property descriptor\n        properties[propname] = descriptor;\n    }\n\n    // Declare constructor\n    function Element() {\n        // Construct an instance from Constructor using Element prototype\n        const element = Reflect.construct(constructor, arguments, Element);\n\n        // Make shadow if mode or shadow have been set\n        const shadow = (lifecycle.mode || (typeof lifecycle.shadow === 'string')) ?\n            createShadow(element, lifecycle) :\n            undefined ;\n\n        // Fill shadow with template\n        if (lifecycle.shadow) fillShadowFromTemplate(shadow, lifecycle.shadow);\n\n        // Get access to the internals object. If form associated, internals is\n        // the form control API internals object. We're gonna be rude and\n        // extend it.\n        const internals = createInternals(Element, element, shadow);\n\n        // Flag support for custom built-ins. We know this when tag exists and\n        // Element constructor is called\n        if (tag) supportsCustomisedBuiltIn = true;\n        if (lifecycle.construct) lifecycle.construct.call(element, shadow, internals);\n\n        // At this point, if properties have been set before the element was\n        // upgraded they already exist on the element itself, where we have\n        // just upgraded it's protytype to define those properties. Those\n        // definitions will never be reached. Either:\n        //\n        // 1. Define properties on the instance instead of the prototype, as in\n        //    Object.defineProperties(element, descriptors) here in the\n        //    constructor. Won't actually solve the problem.\n        //\n        // 2. Take a great deal of care when authoring not to set properties\n        //    before an element is upgraded. We can't impose a restriction like\n        //    that on Joe Bloggs front end developer.\n        //\n        // 3. Copy defined properties to their prototype handlers and delete\n        //    them on the instance.\n        //\n        // Let's go with 3. I'm not happy we have to do this, though.\n        Object.keys(descriptors).reduce(transferProperty, element);\n\n        return element;\n    }\n\n    // Set prototype and define properties\n    Element.prototype = Object.create(constructor.prototype, descriptors);\n\n    // Prefetch stylesheet ??\n    /*if (stylesheet) {\n        toPrefetchPromise(stylesheet);\n        log = window.DEBUG ?\n            log + ' – stylesheet ' + stylesheet :\n            log ;\n    }*/\n\n    if (properties.value) {\n        // Flag the Element class as formAssociated\n        Element.formAssociated = true;\n\n        // Define standard form properties\n        define(Element.prototype, formProperties);\n\n        if (lifecycle.enable || lifecycle.disable) {\n            Element.prototype.formDisabledCallback = function(disabled) {\n                const internals = getInternals(this);\n                return disabled ?\n                    lifecycle.disable && lifecycle.disable.call(this, internals.shadowRoot, internals) :\n                    lifecycle.enable && lifecycle.enable.call(this, internals.shadowRoot, internals) ;\n            };\n        }\n\n        if (lifecycle.reset) {\n            Element.prototype.formResetCallback = function() {\n                const internals = getInternals(this);\n                return lifecycle.reset.call(this, internals.shadowRoot, internals);\n            };\n        }\n\n        if (lifecycle.restore) {\n            Element.prototype.formStateRestoreCallback = function() {\n                const internals = getInternals(this);\n                return lifecycle.restore.call(this, internals.shadowRoot, internals);\n            };\n        }\n    }\n\n    // Attributes\n    if (attributes.length) {\n        Element.observedAttributes = attributes;\n        Element.prototype.attributeChangedCallback = function(name, old, value) {\n            return properties[name].attribute.call(this, value) ;\n        };\n    }\n\n    // Lifecycle\n    if (lifecycle.connect) {\n        Element.prototype.connectedCallback = function() {\n            const internals = getInternals(this);\n            const shadow    = internals.shadowRoot;\n\n            // Connect\n            internals.stopable = lifecycle.connect.call(this, shadow, internals);\n\n            // Avoid flash of unstyled content in shadow DOMs that must load assets.\n            // Now, it's debatable whether this code should be here or in the constructor.\n            // Whether links in the shadow may have already emitted load events by connect\n            // time. They'd have to have done it synchronously, so I don't think so.\n            if (!shadow) return;\n\n            const links = shadow.querySelectorAll('link[rel=\"stylesheet\"]');\n\n            if (links.length) {\n                // Hide all content other than the default slot until stylesheets\n                // have loaded. We keep the default slot visible as that content\n                // was visible before upgrade and we do not want it to momentarily\n                // disappear.\n                const style = create('style', '*:not(slot), slot:not([name]) { display: none !important; }');\n                shadow.prepend(style);\n\n                let promise;\n                if (!internals.loadPromise) {\n                    // Wait for stylesheets to load\n                    promise = internals.loadPromise = Promise.all(Array.from(links, toLoadPromise));\n                }\n                else {\n                    // Insert an animation frame to avoid flash on reconnect\n                    promise = internals.loadPromise.then(() => new Promise(requestAnimationFrame));\n                }\n\n                promise.finally(() => {\n                    if (window.DEBUG) window.console.log('%c<' + (tag ? tag + ' is=' + name + '' : name) + '>%c load \\n' + Array.from(links).map((link) => link.href.replace(/https?:\\/\\//, '')).join('\\n'), 'color:#3a8ab0;font-weight:400;', 'color:#888888;font-weight:400;');\n                    // Remove hide style\n                    style.remove();\n                    // and call the load() callback\n                    if (lifecycle.load) lifecycle.load.call(this, shadow, internals);\n                });\n            }\n            else if (lifecycle.load) {\n                lifecycle.load.call(this, shadow, internals);\n            }\n        }\n    }\n\n    Element.prototype.disconnectedCallback = function() {\n        const internals = getInternals(this);\n        if (internals.stopable) {\n            // Support a stopable...\n            if (internals.stopable.stop) { internals.stopable.stop(); }\n            // or an array of stopables\n            else { internals.stopable.forEach(stop); }\n        }\n        if (lifecycle.disconnect) lifecycle.disconnect.call(this, internals.shadowRoot, internals);\n    };\n\n    // Log registration to console\n    window.console &&\n    window.console.log('%c<' + (tag ? tag + ' is=' + name + '' : name) + '>%c ' + log, 'color:#3a8ab0;font-weight:600;', 'color:#888888;font-weight:400;');\n\n    // Define the element\n    window.customElements.define(name, Element, tag && { extends: tag });\n\n\n    // Safari partial polyfill.\n    // Where tag is supplied, element should have been registered as a customised\n    // built-in and the constructor would have run if any were in the DOM already.\n    // However, Safari does not support customised built-ins. Here we attempt to\n    // go some way towards filling in support by searching for elements and\n    // assigning their intended APIs to them.\n    if (tag && !supportsCustomisedBuiltIn) {\n        // It may be there were none in the DOM, in which case we must run a\n        // test. Not ideal.\n        const div = document.createElement('div');\n        div.style.position = 'fixed';\n        div.style.left = '-1000px';\n        div.style.top  = '-1000px';\n        div.innerHTML = '<' + tag + ' is=\"' + name + '\"></' + tag + '>';\n        document.body.append(div);\n        div.remove();\n\n        if (!supportsCustomisedBuiltIn) {\n            if (window.DEBUG) {\n                console.warn('Browser does not support customised built-in elements, polyfilling <' + tag + ' is=\"' + name + '\">');\n            }\n\n            function upgrade(element) {\n                // Store values of properties we are about to define\n                const store = {};\n                Object.keys(descriptors).forEach((key) => {\n                    if (element[key] !== undefined) store[key] = element[key];\n                });\n\n                // Define properties on element\n                define(element, descriptors);\n\n                // Construct an instance from Constructor using the Element prototype\n                const shadow = lifecycle.mode || lifecycle.shadow ?\n                    createShadow(element, lifecycle) :\n                    undefined ;\n\n                // Get access to the internals object\n                const internals = createInternals(Element, element, shadow);\n\n                // Run constructor\n                lifecycle.construct && lifecycle.construct.call(element, shadow, internals);\n\n                if (window.DEBUG) {\n                    // Assign stored properties back onto element\n                    try {\n                        Object.assign(element, store);\n                    }\n                    catch(e) {\n                        console.warn(e.message, tag, Object.keys(store));\n                    }\n                }\n                else {\n                    Object.assign(element, store);\n                }\n\n                // Detect and run attributes\n                let n = -1, name;\n                while (name = attributes[++n]) {\n                    // elements.attributes is sometimes undefined... why?\n                    const attribute = element.attributes[name];\n                    if (attribute) properties[name].attribute.call(element, attribute.value);\n                }\n\n                // Run connected callback\n                lifecycle.connect && lifecycle.connect.call(element, shadow, internals);\n            }\n\n            function polyfillByRoot(root) {\n                findByIs(root, name).forEach(upgrade)\n                const observer = new MutationObserver(() => findByIs(root, name).forEach(upgrade));\n                observer.observe(root, { childList: true, subtree: true });\n            }\n\n            // Expose on element for use in shadow DOMs\n            Element.polyfillByRoot = polyfillByRoot;\n\n            // Run on document automatically\n            polyfillByRoot(document);\n        }\n        else {\n            Element.polyfillByRoot = noop;\n        }\n    }\n    else {\n        Element.polyfillByRoot = noop;\n    }\n\n    return Element;\n}\n\nexport { getInternals };\n", "/**\ntoType(object)\nReturns `typeof object`.\n*/\n\nexport default (object) => typeof object;\n", "\nimport id       from '../id.js';\nimport overload from '../overload.js';\nimport toType   from '../to-type.js';\n\n\nconst define = Object.defineProperties;\nconst call = overload(toType, {\n    function: (fn) => fn(),\n    object:   (object) => object.stop()\n});\n\n\n/** Stopable() **/\n\nexport default class Stopable extends id {\n    #stopables;\n\n    /**\n    .stop()\n    Stops the stream, passing any parameters up to the head of the stream. The\n    head determines whether the stream stops immediately or asynchronously.\n    **/\n    stop() {\n        // Check we are not already done\n        if (this.status === 'done') return this;\n\n        // Set status\n        this.status = 'done';\n\n        // Call done functions and stopables\n        const stopables = this.#stopables;\n        this.#stopables = undefined;\n        if (stopables) stopables.forEach(call);\n\n        // Make it chain-able\n        return this;\n    }\n\n    /**\n    .done(fn)\n    Cues `fn` to be called when the stream is stopped. If `fn` is an object, it\n    must have a `.stop()` method, which is called when this is stopped.\n    **/\n    done(fn) {\n        // Is stream already stopped? Call listener immediately.\n        if (this.status === 'done') {\n            call(listener);\n            return this;\n        }\n\n        // Add to done handlers\n        const stopables = this.#stopables || (this.#stopables = []);\n        stopables.push(fn);\n\n        // Make it chain-able\n        return this;\n    }\n}\n\ndefine(Stopable.prototype, {\n    status: { writable: true }\n});\n", "\nimport noop       from '../noop.js';\nimport overload   from '../overload.js';\nimport toType     from '../to-type.js';\nimport Stopable   from './stopable.js';\n\n\nconst assign = Object.assign;\nconst create = Object.create;\n\n\nfunction throwTypeError(source) {\n    throw new TypeError('Stream cannot be created .from() ' + typeof source);\n}\n\nfunction push(stream, value) {\n    if (value === undefined) return;\n    let n = -1;\n    while (stream[++n]) stream[n].push(value);\n    return stream;\n}\n\nfunction stop(stream) {\n    // Call done functions and listeners\n    Stopable.prototype.stop.apply(stream);\n\n    // Loop through outputs, propagate stop() down the pipe\n    let o = -1, output;\n    while (output = stream[++o]) {\n        // Remove output from stream\n        stream[o] = undefined;\n        // If output is not stop-able it never got stream as an input\n        if (!output.stop) continue;\n        // Remove stream from output's inputs\n        removeInput(output, stream);\n        // If output has no inputs left, stop it\n        if (!output[-1]) output.stop();\n    }\n\n    return stream;\n}\n\nfunction removeInput(stream, input) {\n    // Remove input from stream\n    let i = 0;\n    while (stream[--i] && stream[i] !== input);\n    while (stream[i--]) stream[i + 1] = stream[i];\n}\n\nfunction removeOutput(stream, output) {\n    // Remove output from stream\n    let o = -1;\n    while (stream[++o] && stream[o] !== output);\n    while (stream[o++]) stream[o - 1] = stream[o];\n}\n\nfunction unpipe(output, input) {\n    // Remove link between streams without stopping them\n    removeInput(input, output);\n    removeOutput(output, input);\n}\n\n\n/* Consumer() */\n\nexport class Consumer extends Stopable {\n    /**\n    .stop()\n    Stops the stream.\n    **/\n    stop() {\n        if (this.status === 'done') return this;\n\n        // Loop through inputs, notify them we are detaching\n        let input;\n        while (input = this[-1]) {\n            // Remove input from this\n            let i = -1;\n            while (this[i--]) this[i + 1] = this[i];\n\n            // Remove this from input's outputs\n            removeOutput(input, this);\n\n            // If input is stop-able and has no other outputs, stop it\n            if (input.stop && !input[0]) input.stop(input);\n        }\n\n        // Set status and call done(fn) handlers\n        return super.stop();\n    }\n}\n\n\n/* Each(fn) */\n\nclass Each extends Consumer {\n    constructor(fn) {\n        super();\n        this.push = fn;\n    }\n}\n\n\n/* Reduce() */\n\nclass Reduce extends Consumer {\n    constructor(fn, accumulator) {\n        super();\n        this.fn    = fn;\n        this.value = accumulator;\n        this.i     = 0;\n    }\n\n    push(value) {\n        const fn = this.fn;\n        this.value = fn(this.value, value, this.i++, this);\n    }\n}\n\n\n/**\nStream(start)\nCreates a stream from a `start` function, called when a consumer is first\nattached, with two arguments, `start(push, stop)`. `push(value)` is called to\nwrite `value` to the stream and `stop()` is called to stop the stream.\n**/\n\nexport default class Stream extends Consumer {\n    /**\n    .start()\n    **/\n    start() {\n        // If this is 'running' or 'done' we need do nothing here\n        if (this.status) return this;\n\n        // Loop through inputs\n        let i = 0, input;\n        inputloop: while (input = this[--i]) {\n            // Loop through input's outputs\n            let o = -1;\n            // If input already has this as an output skip set up\n            while (input[++o]) if (input[o] === this) continue inputloop;\n            // Set this as input's output\n            input[o] = this;\n            // If input is start-able and this is its first consumer, start it,\n            // otherwise assume it is running\n            if (o === 0 && input.start) input.start();\n        }\n\n        return this;\n    }\n\n    stop() {\n        if (this.status === 'done') return this;\n\n        super.stop();\n\n        // Loop through outputs, propagate stop() down the pipe\n        let o = -1, output;\n        while (output = this[++o]) {\n            // Remove output from this\n            this[o] = undefined;\n            // If output is not stop-able it never got this as an input\n            if (!output.stop) continue;\n            // Remove this from output's inputs\n            removeInput(output, this);\n            // If output has no inputs left, stop it\n            if (!output[-1]) output.stop();\n        }\n\n        return this;\n    }\n\n    /**\n    .pipe(stream)\n    Sets up this stream to pipe values into `stream` when started. Starts\n    immediately where `stream` is already running. Returns `stream`.\n    **/\n    pipe(output) {\n        // If output is stop-able set this as its input\n        if (output.stop) {\n            // Guard against this piping twice to output\n            let i = 0;\n            while (output[--i]) if (output[i] === this) break;\n            output[i] = this;\n        }\n\n        // If output is start-able and is not already running wait to start this\n        if (output.start && !(output[0] || output.status === 'running')) {\n            return output;\n        }\n\n        // Start piping right away\n        let o = -1;\n        while (this[++o]) if (this[o] === output) break;\n        this[o] = output;\n        // If output is the first consumer to be added start this\n        if (!o) this.start();\n\n        // Return output\n        return output;\n    }\n\n    /**\n    .each(fn)\n    Consumes the stream, calling `fn(value)` for each piped value. Returns the\n    stream.\n    **/\n    each(fn) {\n        // Start the Consumer immediately\n        return this.pipe(new Each(fn));\n    }\n\n    /**\n    .buffer(...values)\n    Inserts a buffer of values into the start of a stream. Although the buffer\n    is not hot, before it is started .push() may be used to add values to the\n    buffer.\n    **/\n    buffer(...values) {\n        return this.pipe(new BufferStream(values));\n    }\n\n    /**\n    .filter(fn)\n    Filters out values where `fn(value)` is falsy.\n    **/\n    filter(fn) {\n        return this.pipe(new Filter(fn));\n    }\n\n    /**\n    .flatMap(fn)\n    **/\n    flatMap(fn) {\n        return this.pipe(new FlatMap(fn));\n    }\n\n    /**\n    .map(fn)\n    Maps each value in a stream to `fn(value)` and pipes non-`undefined` results\n    downstream.\n    **/\n    map(fn) {\n        return this.pipe(new Map(fn));\n    }\n\n    /**\n    .reduce(fn, initial)\n    Consume the stream, calling `fn(accumulator, value)` for each value in it.\n    Returns the accumulator.\n    **/\n    reduce(fn, accumulator) {\n        return this.pipe(new Reduce(fn, accumulator)).value;\n    }\n\n    /**\n    .scan(fn, initial)\n    Calls `fn(current, value)` for each `value` in the stream. Where `fn`\n    returns a value it is pushed downstream, and `current` assumes that value\n    on the next iteration. Where `fn` returns `undefined` nothing is pushed and\n    `current` remains unchanged.\n    **/\n    scan(fn, initial) {\n        return this.pipe(new Scan(fn, initial));\n    }\n\n    /**\n    .slice(n, m)\n    Returns a stream of the nth to mth values of stream.\n    **/\n    slice(n, m) {\n        return this.pipe(new Slice(n, m));\n    }\n\n    /**\n    .split(n)\n    **/\n    split(n) {\n        return this.pipe(new Split(n));\n    }\n\n    /* Experimental async iterator support for `for await (x of stream)`\n       loops. */\n    [Symbol.asyncIterator] = async function*() {\n        // Buffer for synchronous values\n        const values = [];\n        let push = (value) => values.push(value);\n\n        function setResolve(res, rej) {\n            push = res;\n        }\n\n        this\n        .each((value) => push(value))\n        .done(() => push = noop);\n\n        while (push !== noop) {\n            yield values.length ?\n                // Yield collected synchronous value\n                values.shift() :\n                // Yield next asynchronous value\n                await new Promise(setResolve) ;\n        }\n    }\n\n    static from = overload(toType, {\n        /**\n        Stream.from(fn)\n        Create a pushable map stream from function `fn`.\n        **/\n        function: (fn) => new Map(fn),\n\n        object: (object) =>\n            /**\n            Stream.from(stream)\n            Treat a pipe-able as a stream directly.\n            **/\n            typeof object.pipe === 'function' ? object :\n\n            /**\n            Stream.from(promise)\n            Create a read-only stream from a promise. The stream is stopped when\n            the promise resolves or rejects.\n            **/\n            typeof object.then === 'function' ? new PromiseStream(object) :\n\n            /**\n            Stream.from(array)\n            Create a pushable buffer stream from an array or array-like object.\n            **/\n            typeof object.length === 'number' ? new BufferStream(Array.from(object)) :\n\n            // object cannot be made into stream\n            throwTypeError(object)\n    });\n\n    /**\n    Stream.of(...values)\n    Create a pushable value or buffer stream from parameter values.\n    **/\n    static of(...values) {\n        return values.length < 2 ?\n            new Value(values[0]) :\n            new BufferStream(values) ;\n    }\n\n    /**\n    Stream.buffer(...values)\n    Create a pushable buffer stream with initial buffer of arguments.\n    **/\n    static buffer(values) {\n        return new BufferStream(values);\n    }\n\n    /**\n    Stream.value(value)\n    Create a pushable value stream with initial `value`.\n    **/\n    static value(value) {\n        return new Value(value);\n    }\n\n    /**\n    Stream.merge(stream1, stream2, ...)\n    Creates a stream by merging values from any number of input streams into a\n    single output stream. Values are emitted in the time order they are received\n    from inputs.\n\n    ```js\n    Stream.merge(stream1, stream2).each((value) => {\n        // value is from stream1 or stream 2\n    });\n    ```\n    **/\n    static merge(...inputs) {\n        return new Merge(inputs);\n    }\n\n    /**\n    Stream.push(stream, value)\n    Pushes `value` to `stream`'s outputs (even on streams that have no `.push()`\n    method). For use in sub-classing Stream.\n    **/\n    static push = push;\n\n    /**\n    Stream.stop(stream)\n    Stops stream, calling `.done()` handlers, setting status to `'done'` and\n    stopping dependent streams. For internal use when sub-classing Stream.\n    **/\n    static stop = stop;\n\n    /*\n    Stream.input(stream, output)\n    Remove output stream from `stream` and vice-versa, without stopping either\n    stream. Normally `stream.stop()` should be used to stop the flow of a pipe -\n    this function is used when making dynamic graphs of streams that need to\n    stay alive.\n    */\n    static unpipe = unpipe;\n\n    static each(fn) {\n        return new Each(fn);\n    }\n\n    static reduce(fn, accumulator) {\n        return new Reduce(fn, accumulator);\n    }\n}\n\n\n/**\nPromiseStream(promise)\n**/\n\nclass PromiseStream extends Stream {\n    constructor(promise) {\n        super();\n        this.promise = promise;\n    }\n\n    start() {\n        this.promise\n        .then((value) => push(this, value))\n        .finally(() => this.stop());\n        return this;\n    }\n}\n\n\n/*\nValue(value)\nA Value stream represents a persistent value. Streams piped from a value stream\nare given its current value. A Value stream may be pushed to before it is piped.\n*/\n\nclass Value extends Stream {\n    constructor(value) {\n        super();\n        this.value = value;\n    }\n\n    start() {\n        if (this.value !== undefined) {\n            push(this, this.value);\n            // If stream was stopped as a result of a push, don't continue pushing\n            if (this.status === 'done') return this;\n        }\n\n        // Start streams that are piped to this buffer stream\n        return super.start();\n    }\n\n    push(value) {\n        this.value = value;\n        return push(this, value);\n    }\n}\n\n\n/*\nBufferStream(values)\nA BufferStream may be pushed to before it is piped, as it starts life with an\narray buffer of values.\n*/\n\nclass BufferStream extends Stream {\n    constructor(values) {\n        super();\n        this.values = values || [];\n    }\n\n    start() {\n        const values = this.values;\n        if (!values) return super.start();\n\n        // Loop over values\n        let n = -1;\n        while(n++ < values.length) {\n            // Push values to stream\n            push(this, values[n]);\n            // If stream was stopped as a result of a push, don't continue pushing\n            if (this.status === 'done') return this;\n        }\n\n        // Throw away values buffer\n        this.values = undefined;\n\n        // Start streams that are piped to this buffer stream\n        return super.start();\n    }\n\n    push(value) {\n        this.value = value;\n        return this.values ?\n            this.values.push(this.value) :\n            push(this, this.value) ;\n    }\n}\n\n\n/* Filter() */\n\nclass Filter extends Stream {\n    constructor(fn) {\n        super();\n        this.fn = fn;\n    }\n\n    push(value) {\n        const fn = this.fn;\n        return fn(value) && push(this, value);\n    }\n}\n\n\n/* FlatMap() */\n\nclass FlatMap extends Stream {\n    constructor(fn) {\n        super();\n        this.fn = fn;\n    }\n\n    push(value) {\n        const fn     = this.fn;\n        const values = fn(value);\n\n        if (values === undefined) { return; }\n\n        // Flatten array or array-like\n        if (isIterable(values)) {\n            for (const value of values) {\n                push(this, value);\n            }\n        }\n        // Flatten stream\n        else if (values.pipe) {\n            console.warn('FlatMapping pipeables is dodgy. Map to arrays for the moment please.');\n            // Todo: support flattening of streams. This method is crude -\n            // it does not preserve order, for one thing. Should streams be\n            // made iterable? CAN streams be made iterable? They'd have to\n            // be async...\n            this.done(values.each((value) => push(this, value)));\n            // This causes problems if you try\n            // stream.scan(...).flatMap(...)\n            //values.pipe(this[0]);\n        }\n        // Flatten promise\n        else if (values.then) {\n            values.then((value) => push(this, value));\n        }\n    }\n}\n\n\n/* Map() */\n\nclass Map extends Stream {\n    constructor(fn) {\n        super();\n        this.fn = fn;\n    }\n\n    push(value) {\n        const fn     = this.fn;\n        const result = fn(value);\n        // Reject undefined\n        return result !== undefined && push(this, result);\n    }\n}\n\n\n/*\nMerge()\n*/\n\nclass Merge extends Stream {\n    constructor(inputs) {\n        super();\n        this.inputs = inputs;\n    }\n\n    push(value) {\n        return push(this, value);\n    }\n\n    pipe(output) {\n        let n = -1, input;\n        while (input = this.inputs[++n]) Stream.from(input).pipe(this);\n        return Stream.prototype.pipe.call(this, output)\n    }\n}\n\n\n/* Scan() */\n\nclass Scan extends Stream {\n    constructor(fn, accumulator) {\n        super();\n        this.fn    = fn;\n        this.value = accumulator;\n    }\n\n    push(value) {\n        const fn = this.fn;\n        this.value = fn(this.value, value);\n        push(this, this.value);\n    }\n}\n\n\n/* Slice() */\n\nclass Slice extends Stream {\n    constructor(n, m = Infinity) {\n        if (window.DEBUG && (typeof n !== 'number' || n < 0)) {\n            throw new Error('Stream: .slice() requires a positive integer (' + n + ')');\n        }\n\n        if (window.DEBUG && (typeof m !== 'number' || m < 1)) {\n            throw new Error('Stream: .slice() requires a non-zero positive integer (n, ' + n + ')');\n        }\n\n        super();\n        this.index = -n;\n        this.indexEnd = m - n;\n    }\n\n    push(value) {\n        if (++this.index > 0) push(this, value);\n        if (this.index === this.indexEnd) this.stop();\n    }\n}\n\n\n/* Split(input, fn) */\n\nclass Split extends Stream {\n    constructor(fn) {\n        super();\n        this.chunk = [];\n\n        if (typeof fn === 'number') this.n = fn;\n        else this.fn = fn;\n    }\n\n    fn() {\n        return this.chunk.length === this.n;\n    }\n\n    push(value) {\n        const chunk = this.chunk;\n\n        if (this.fn(value)) {\n            // Emit complete chunk and create a new chunk\n            push(this, chunk);\n            this.chunk = [];\n        }\n        else {\n            // Push to existing chunk\n            chunk.push(value);\n        }\n    }\n}\n", "\n/**\nevents(type, element)\nevents(type, element, initial)\n\nReturns a mappable stream of events heard on `element`.\n\n```js\nevents('click', element)\n.map((e) => e.target.id)\n```\n\nThe first parameter may alternatively be an options object, in which case it\nmust have a `.type` property.\n\n```js\nevents({ type: 'click' }, element)\n.map((e) => e.target.id)\n```\n\nThe object may contain a number of other properties that select the events\nreceived. It supports the standard addEventListener options, for passive and\ncapture phase event binding.\n\n```js\nevents({ type: 'scroll', passive: true, capture true }, window)\n.map((e) => window.scrollTop)\n```\n\nAnd a `.select` property, a CSS selector, that filters events to those with\ntargets that match or have a `closest()` ancestor that matches the selector.\n\n```js\nevents({ type: 'click', select: '[name=\"button\"]' }, element)\n.map((e) => e.target.id)\n```\n\nHowever, if you need to delegate events it is recommended to use the\n`delegate()` function, which has the added benefit of direct access to the\ndelegated target.\n\n```js\nevents('click', element)\n.each(delegate({\n    '[name=\"button\"]': (target, e) => console.log(target.id),\n    '[name=\"remove\"]': (target, e) => document.getElementById(target.value).remove(),\n    ...\n}))\n```\n\nStopping an event stream removes its event listeners.\n\n```js\nevents('click', element).stop()\n```\n\nPass in an `initial` object to have the event stream start synchronously\nwith the initial object when consumed.\n\n```js\nevents(type, element, initial)\n```\n**/\n\nimport cache  from 'fn/cache.js';\nimport Stream from 'fn/stream/stream.js';\n\nconst assign  = Object.assign;\nconst rspaces = /\\s+/;\nconst types   = {\n    fullscreenchange: cache(() => (\n        'fullscreenElement' in document ? 'fullscreenchange' :\n        'webkitFullscreenElement' in document ? 'webkitfullscreenchange' :\n        'mozFullScreenElement' in document ? 'mozfullscreenchange' :\n        'msFullscreenElement' in document ? 'MSFullscreenChange' :\n        'fullscreenchange'\n    ))\n};\n\n\n// DOM click events may be simulated on inputs when their labels are\n// clicked. The tell-tale is they have the same timeStamp. Track click\n// timeStamps.\nvar clickTimeStamp = 0;\n\nwindow.addEventListener('click', (e) => clickTimeStamp = e.timeStamp);\n\nfunction listen(listener, type) {\n    listener.node.addEventListener(types[type] ? types[type]() : type, listener, listener.options);\n    return listener;\n}\n\nfunction unlisten(listener, type) {\n    listener.node.removeEventListener(types[type] ? types[type]() : type, listener);\n    return listener;\n}\n\nclass Events extends Stream {\n    constructor(type, options, node, initialEvent) {\n        super();\n\n        // Potential hard-to-find error here if type has repeats, ie 'click click'.\n        // Lets assume nobody is dumb enough to do this, I dont want to have to\n        // check for that every time.\n        this.types        = type.split(rspaces);\n        this.options      = options;\n        this.node         = node;\n        this.select       = options && options.select;\n        this.modifiers    = options && options.modifiers;\n        this.initialEvent = initialEvent;\n    }\n\n    handleEvent(e) {\n        // Ignore clicks with the same timeStamp as previous clicks –\n        // they are likely simulated by the browser, eg. clicks on labels\n        // cause simulated clicks to be emitted from inputs\n        if (e.type === 'click' && e.timeStamp <= clickTimeStamp) return;\n\n        // Inspect modifier keys\n        if (this.modifiers) {\n            const modifiers = typeof this.modifiers === 'string' ?\n                this.modifiers.split(/\\s+/) :\n                this.modifiers ;\n\n            let n = modifiers.length;\n            while (n--) if (!e[modifiers[n] + 'Key']) return;\n        }\n\n        // If there is a selector and the target doesn't match, shoofty\n        // outta here\n        if (this.select) {\n            const selectedTarget = e.target.closest(this.select);\n            if (!selectedTarget) return;\n            e.selectedTarget = selectedTarget;\n        }\n\n        Stream.push(this, e);\n    }\n\n    start() {\n        this.types.reduce(listen, this);\n\n        if (this.initialEvent) {\n            this.handleEvent(this.initialEvent);\n            delete this.initialEvent;\n        };\n\n        return this;\n    }\n\n    stop() {\n        this.types.reduce(unlisten, this);\n        return super.stop();\n    }\n}\n\nexport default function events(type, node, initialEvent) {\n    let options;\n    if (typeof type === 'object') {\n        options = type;\n        type    = options.type;\n    }\n\n    return new Events(type, options, node, initialEvent);\n}\n", "/**\narg(n)\n\nReturns a function that returns `argument[n]`.\n\n```js\n```\n**/\n\nexport default function arg(n) {\n    return function arg() {\n        return arguments[n];\n    };\n}\n", "/**\nid(value)\nReturns `value`.\n**/\n\nexport default function id(value) { return value; }\n", "/**\nnoop()\nDoes nothing, returns undefined.\n**/\n\nexport default function noop() {}\n", "/**\nself()\nReturns `this`.\n*/\n\nexport default function self() { return this; }\n", "\n/**\nnothing\nA frozen array-like and stream-like object that contains no value.\n**/\n\nimport arg  from './arg.js';\nimport id   from './id.js';\nimport noop from './noop.js';\nimport self from './self.js';\n\nconst create = Object.create;\nconst freeze = Object.freeze;\n\nexport default freeze(create(create(Object.prototype, {\n    // Array methods\n    at:        { value: noop },\n    shift:     { value: noop },\n    push:      { value: noop },\n    forEach:   { value: noop },\n    join:      { value: function() { return ''; } },\n    every:     { value: function() { return true; } },\n    filter:    { value: self },\n    find:      { value: noop },\n    findIndex: { value: function() { return -1; } },\n    flat:      { value: self },\n    flatMap:   { value: self },\n    includes:  { value: function() { return false; } },\n    indexOf:   { value: function() { return -1; } },\n    map:       { value: self },\n    reduce:    { value: arg(1) },\n    sort:      { value: self },\n\n   // Stream methods\n    each:      { value: self },\n    pipe:      { value: id },\n    start:     { value: self },\n    stop:      { value: self },\n    done:      { value: self },\n\n    // Primitive coercion\n    valueOf:   { value: function() { return null; } }\n}), {\n    length: { value: 0 }\n}));\n", "/**\nmod(divisor, n)\nJavaScript's modulus operator (`%`) uses Euclidean division, but for\nstuff that cycles through 0 the symmetrics of floored division are often\nare more useful. This function implements floored division.\n**/\n\nexport default function mod(d, n) {\n    return ((n % d) + d) % d ;\n}\n", "/**\nslugify(string)\n\nReplaces any series of non-word characters with a `'-'` and lowercases the rest.\n\n```js\nslugify('Party on #mydudes!') // 'party-on-mydudes'\n```\n**/\n\nexport default function slugify(string) {\n    // Accept a number or string\n    if (typeof string === 'number') string = string + '';\n    if (typeof string !== 'string') return;\n\n    return string\n        .trim()\n        .toLowerCase()\n        // Normalize unicode (NFKC)\n        .normalize('NFKC')\n        // Replace characters that are problematic with hyphens\n        .replace(/[\\/\\?#\\[\\]@!$&'()*+,;=\\\\\\s\\._]+/g, '-')\n        // Strip hyphens from start/end\n        .replace(/^-+/, '')\n        .replace(/-+$/, '');\n}\n", "\nimport nothing from '../../fn/modules/nothing.js';\nimport mod     from '../../fn/modules/mod.js';\nimport slugify from '../../fn/modules/slugify.js';\n\n\n/**\nnormaliseNoteName(name)\n\nReplaces the characters `'b'` and `'#'` with the unicode musical characters `'♭'`\nand `'♯'` respectively.\n\n```js\nnormaliseNoteName('Eb6');      // 'E♭6'\n```\n*/\n\nconst rTextSymbol    = /b|#/g;\nconst unicodeSymbols = { 'b': '♭', '#': '♯' };\nconst mod12          = (n) => mod(12, n);\n\nfunction replaceSymbol($0) {\n    return unicodeSymbols[$0];\n}\n\nexport function normaliseNoteName(name) {\n    return name.replace(rTextSymbol, replaceSymbol);\n}\n\n\n/**\ntoNoteNumber(name)\n\nGiven a note name, returns a value in the range 0-127.\n\n```js\ntoNoteNumber('D6');     // 86\n```\n*/\n\nconst rnotename   = /^([A-G][♭♯#b]?)(-?\\d)$/;\nconst rnoteroot   = /^[A-G][♭♯#b]?/;\nconst rnoteoctave = /-?\\d$/;\nconst rhz         = /[Hh]z$/;\n\n/* noteNumbers exported because used by Scribe */\nexport const noteNumbers = {\n    'C':  0, 'C♯': 1, 'C#': 1, 'D♭': 1, 'Db': 1, 'D': 2, 'D♯': 3, 'D#': 3, 'E♭': 3, 'Eb': 3, 'E': 4,\n    'F':  5, 'F♯': 6, 'F#': 6, 'G♭': 6, 'Gb': 6, 'G': 7, 'G♯': 8, 'G#': 8, 'A♭': 8, 'Ab': 8, 'A': 9,\n    'A♯': 10, 'A#': 10, 'B♭': 10, 'Bb': 10, 'B': 11\n};\n\nconst drumNames = {\n    // Roland extension to General MIDI\n    27: 'High Q',\n    28: 'Slap',\n    29: 'Scratch push',\n    30: 'Scratch pull',\n    31: 'Sticks',\n    32: 'Square click',\n    33: 'Metronome click',\n    34: 'Metronome bell',\n    // General MIDI\n    35: 'Low bass drum',\n    36: 'High bass drum',\n    37: 'Side stick',\n    38: 'Snare drum 1',\n    39: 'Hand clap',\n    40: 'Snare drum 2',\n    41: 'Low floor tom',\n    42: 'Closed hi-hat',\n    43: 'High floor tom',\n    44: 'Pedal hi-hat',\n    45: 'Low tom',\n    46: 'Open hi-hat',\n    47: 'Low mid tom',\n    48: 'High mid tom',\n    49: 'Crash cymbal 1',\n    50: 'High tom',\n    51: 'Ride cymbal 1',\n    52: 'Chinese cymbal',\n    53: 'Ride Bell',\n    54: 'Tambourine',\n    55: 'Splash cymbal',\n    56: 'Cowbell',\n    57: 'Crash cymbal 2',\n    58: 'Vibra Slap',\n    59: 'Ride cymbal 2',\n    60: 'High bongo',\n    61: 'Low bongo',\n    62: 'Mute high conga',\n    63: 'Open high conga',\n    64: 'Low conga',\n    65: 'High timbale',\n    66: 'Low timbale',\n    67: 'High agogo',\n    68: 'Low agogo',\n    69: 'Cabasa',\n    70: 'Maracas',\n    71: 'Short whistle',\n    72: 'Long whistle',\n    73: 'Short guiro',\n    74: 'Long guiro',\n    75: 'Claves',\n    76: 'High wood block',\n    77: 'Low wood block',\n    78: 'Mute cuica',\n    79: 'Open cuica',\n    80: 'Mute triangle',\n    81: 'Open triangle',\n    // Roland extension to General MIDI\n    82: 'Shaker',\n    83: 'Jingle bell',\n    84: 'Belltree',\n    85: 'Castanets',\n    86: 'Mute surdo',\n    87: 'Open surdo'\n};\n\nfor (let n in drumNames) {\n    noteNumbers[slugify(drumNames[n])] = parseInt(n, 10);\n}\n\n\n\n/**\nfrequencyToNote(n, ref = 440)\nReturns note number as a 32bit float from frequency float `n`.\n**/\n\nconst A4 = 69;\n\nexport function frequencyToFloat(freq, ref = 440) {\n    var number = A4 + 12 * Math.log(freq / ref) / Math.log(2);\n\n    // Rounded it to nearest 32-bit value to avoid floating point errors\n    // and return whole semitone numbers where possible.\n    return Math.fround(number);\n}\n\n\n/**\nfloatToFrequency(n, ref = 440)\nReturns frequency from note number float `n`.\n**/\n\nexport function floatToFrequency(n, ref = 440) {\n    return ref * Math.pow(2, (n - A4) / 12);\n}\n\n\n/**\ntoNoteNumber(n)\nReturns note number from a frequency string, note name or drum name.\n\n```js\ntoNoteNumber('A4');       // 69\ntoNoteNumber('440Hz');    // 69\ntoNoteNumber('Cabasa');   // 69\n```\n**/\n\nexport function toNoteNumber(name) {\n    // Name is a number\n    if (typeof name === 'number') return name;\n\n    // Name is a frequency string post-fixed with 'Hz'\n    if (rhz.test(name)) return frequencyToFloat(parseFloat(name));\n\n    const r = rnotename.exec(name);\n\n    return r ?\n        // Name is a pitch string\n        (parseInt(r[2], 10) + 1) * 12 + noteNumbers[r[1]] :\n        // Name is a GM drum string\n        noteNumbers[slugify(name)] ;\n}\n\nexport function toRootNumber(name) {\n    return typeof name === 'number' ?\n        mod12(name) :\n        noteNumbers[rnoteroot.exec(name)[0]] ;\n}\n\n\n/* noteNames exported because used by Scribe, but TODO a toNoteName that returns\na name without an octave. */\nexport const noteNames = [\n    'C', 'C♯', 'D', 'E♭', 'E', 'F', 'F♯', 'G', 'G♯', 'A', 'B♭', 'B'\n];\n\n/**\ntoNoteName(n)\nReturns note name from a value in the range 0-127.\n```js\ntoNoteName(69);       // 'A4'\n```\n*/\n\nexport function toNoteName(n) {\n    return toRootName(n) + toNoteOctave(n);\n}\n\n\n/**\ntoNoteRootName(n)\nWhere `n` is a note number, returns the root name, one of 'C', 'C♯', 'D', 'E♭',\n'E', 'F', 'F♯', 'G', 'G♯', 'A', 'B♭', 'B'.\n*/\n\nexport function toRootName(n) {\n    return noteNames[mod12(n)];\n}\n\n\n/**\ntoNoteOctave(note)\nGiven `n` as a note name or number, returns the numerical octave.\n\n```js\ntoNoteOctave(69);     // 4\n```\n*/\n\nexport function toNoteOctave(n) {\n    return typeof n === 'number' ?\n        Math.floor(n / 12) - 1 :\n        noteNumbers[(rnoteoctave.exec(name) || nothing)[0]] ;\n}\n\n/**\ntoDrumName(n)\nReturns a standard General MIDI drum name for note number or note name `n`.\n**/\n\nexport function toDrumName(n) {\n    const number = toNoteNumber(n);\n    return drumNames[number] || '';\n}\n", "/**\ntoLevel(dB)\nConverts a dB ratio to a unit gain.\n**/\n\nexport default function toGain(n) {\n    return Math.pow(10, n / 20);\n}\n", "import curry from './curry.js';\n\n/**\nparseValue(units, string)\n\nParse `string` as a value with a unit (such as `\"3px\"`). Parameter `units` is an\nobject of functions keyed by the unit postfix. It may also have a `catch`\nfunction.\n\n```js=\nconst parseUnitValue = parseValue({\n    px: function(n) {\n        return n;\n    },\n\n    catch: function(string) {\n        throw new Error('Cannot parse px value');\n    }\n});\n```\n**/\n\n// Be generous in what we accept, space-wise, but exclude spaces between the\n// number and the unit\nconst runit = /^\\s*([+-]?\\d*\\.?\\d+)([^\\s]*)\\s*$/;\n\nexport default function parseValue(units) {\n    return function parseValue(string) {\n        // Allow number to pass through\n        if (typeof string === 'number') return string;\n\n        var entry = runit.exec(string);\n\n        if (!entry) {\n            if (!units.catch) throw new Error('Cannot parse value \"' + string + '\" (accepted units ' + Object.keys(units).join(', ') + ')');\n            return units.catch(string);\n        }\n\n        if (!units[entry[2] || '']) {\n            if (!units.catch) throw new Error('Cannot parse value \"' + string + '\" (accepted units ' + Object.keys(units).join(', ') + ')');\n            return units.catch(parseFloat(entry[1]), entry[2]);\n        }\n\n        return units[entry[2] || ''](parseFloat(entry[1]));\n    };\n}\n", "import toGain     from 'fn/to-gain.js';\nimport parseValue from 'fn/parse-value.js';\n\nconst dynamics = {\n    // Arbitrary map\n    'fff': toGain(-4.5),\n    'ff':  toGain(-9),\n    'f':   toGain(-13.5),\n    'mf':  toGain(-18),\n    'mp':  toGain(-22.5),\n    'p':   toGain(-27),\n    'pp':  toGain(-31.5),\n    'ppp': toGain(-36)\n};\n\nexport default parseValue({\n    '': parseFloat,\n    db: toGain,\n    dB: toGain,\n    catch: (string) => {\n        if (!dynamics[string]) throw new Error('Sequence: dynamic \"' + string + '\" not recognised');\n        return dynamics[string];\n    }\n});\n", "/**\nmod(divisor, n)\nJavaScript's modulus operator (`%`) uses Euclidean division, but for\nstuff that cycles through 0 the symmetrics of floored division are often\nare more useful. This function implements floored division.\n**/\n\nexport default function mod(d, n) {\n    return ((n % d) + d) % d ;\n}\n", "\nimport mod from 'fn/mod.js';\n\n/* mod12()\nFinds the modulus `n % 12`, but using floored division (the JS operator uses\neuclidean division).\n*/\n\nexport default function mod12(n) {\n    return mod(12, n);\n}\n", "export const rflatsharp = /b{1,2}|#{1,2}/g;\n\nconst flatsharps = {\n    'b': '♭',\n    '#': '♯',\n    'bb': '𝄫',\n    '##':  '𝄪'\n};\n\nexport function toUnicode(char) {\n    return flatsharps[char];\n}\n", "\nfunction toObject(object, [key, value]) {\n    object[value] = key;\n    return object;\n}\n\nexport default function mirror(object) {\n    return Object\n    .entries(object)\n    .reduce(toObject, {});\n}\n", "import mirror from '../object/mirror.js';\n\nexport const TYPENUMBERS = {\n    sequence: 1,\n    note:     2,\n    param:    3,\n    rate:     4,\n    key:      5,\n    meter:    6,\n    chord:    7,\n    text:     8,\n    start:    9,\n    stop:     10,\n    clef:     11\n};\n\nexport const TYPENAMES = mirror(TYPENUMBERS);\n\nexport const TYPEBYTES = {\n    2:  16, // note    4 pitch     4 dynamic  8 duration\n    5:  1,  // key     1 root\n    6:  4,  // meter   2 duration  2 divisor\n    7:  18, // chord   1 root      8 hsid     8 duration  1 bass\n    9:  8,  // start   4 pitch     4 dynamic\n    10: 8,  // stop    4 pitch     4 dynamic\n    11: 1   // clef    1 clef\n}\n\n/**\ntoTypeName(value)\nConverts a type name or number to a type name string.\n**/\nexport function toTypeName(value) {\n    if (typeof value === 'string') return value;\n    if (value in TYPENAMES) return TYPENAMES[value];\n    throw new Error(`Type ${ value } not recognised`);\n}\n", "import mirror from '../object/mirror.js';\n\nexport const CURVENUMBERS = {\n    \"step\":        0,\n    \"linear\":      1,\n    \"exponential\": 2,\n    \"target\":      3,\n    \"curve\":       4,\n    \"hold\":        5,\n    \"cancel\":      6\n};\n\nexport const CURVENAMES = mirror(CURVENUMBERS);\n\nexport const CURVEBYTES = {\n    0: 4,    // step        Float32\n    1: 4,    // linear      Float32\n    2: 4,    // exponential Float32\n    3: 12,   // target      Float32, Float64\n    //4: 10, // curve       Float64, Int16, n * Float32\n    5: 0,    // hold        no data\n    6: 0     // cancel      no data\n\n    // TODO: Unknown event types. We either do this or we make pluggable schemas\n    // for unknown events?\n    // 8:  1  // Int8 bytes, Int8 * n values\n    // 9:  1  // Int8 bytes, Uint8 * n values\n    // 10: 2  // Int8 bytes, Int16 * n values\n    // 11: 2  // Int8 bytes, Uint16 * n values\n    // 12: 4  // Int8 bytes, Float32 * n values\n    // 13: 8  // Int8 bytes, Float64 * n values\n    // 14: 8  // Float32 Float32\n    // 15: 12 // Float32 Float64\n};\n\n/**\ntoCurveName(value)\nConverts a curve name or number to a curve name string.\n**/\nexport function toCurveName(value) {\n    return typeof value === 'number' ?\n        (CURVENAMES[value] || 'step') :\n        value;\n}\n", "\n/**\nget(name, object)\nGet property `name` of `object`.\n*/\n\nimport curry from './curry.js';\n\nexport function get(key, object) {\n    // Todo? Support WeakMaps and Maps and other map-like objects with a\n    // get method - but not by detecting the get method\n    return object[key];\n}\n\nexport default curry(get, true);\n", "\nimport cache from 'fn/cache.js';\n\n\nconst DEBUG = globalThis.DEBUG;\nconst { floor, log } = Math;\n\n\n/**\nIn JavaScript Float64 numbers safely represent up to 53-bit integers, giving\nus a 2^53 space to identify harmonic structures. If we consider harmonic\nstructures to be composed of stacked intervals up to 36 semitones, that allows\nfor:\n\n- Max interval 35 semitones\n- Max notes 11 (10 intervals)\n- Max id 36^10 = 3656158440062976\n**/\n\nconst BASE         = 36;                            // 36\nconst MAX_INTERVAL = BASE - 1;                      // 35\n\n// How many times you can multiply BASE by itself before exceeding\n// MAX_SAFE_INTEGER, plus 1 (for the root note)\nconst MAX_LENGTH   = floor(log(Number.MAX_SAFE_INTEGER) / log(BASE)) + 1; // 11\n\n\n/**\nhsidFrom(notes)\nGenerates an integer id from an ascending collection of note numbers. Using base\n36 maths, no interval between note numbers can be greater than 35. 10 intervals\n(11 notes) can be encoded in the `Number.MAX_SAFE_INTEGER` space. A single note\nalways has an id of `0`, and simple intervals map so that a semitone `[0, 1]`\nhas id `1`, a second `[0, 2]` has id `2` and so on.\n**/\n\nexport function hsidFrom(numbers) {\n    // If numbers contains a single note return 0, or no notes return -1\n    if (numbers.length < 2) return numbers.length ? 0 : -1;\n\n    // If numbers contains more than 11 notes throw an error\n    if (numbers.length > MAX_LENGTH) {\n        throw new Error(`Cannot generate harmonic id, more than 11 notes ` + numbers);\n    }\n\n    let id = 0, n = 0, m = 1;\n    while (++n < numbers.length) {\n        const interval = numbers[n] - numbers[n - 1];\n\n        // Validate interval range to 1-31 semitones\n        if (interval < 1 || interval > MAX_INTERVAL) {\n            throw new Error(`Cannot generate harmonic id, interval out of range 1-${ MAX_INTERVAL } ` + numbers);\n        }\n\n        // Pack interval directly into 5-bit number width\n        id += interval * m;\n        m *= BASE;\n    }\n\n    return id;\n}\n\nexport function hsidOf() {\n    return hsidFrom(arguments);\n}\n\n\n/**\nhsidToNumbers(hsid)\nUnpacks a harmonic structure id to an ascending collection of note numbers.\nReturns a Uint8Array.\n**/\n\nexport const hsidToNumbers = cache((hsid) => {\n    if (DEBUG && typeof hsid !== 'number') throw new Error(`hsidToNumbers() takes number, called with ${ typeof hsid }`)\n\n    // If id is -ve it's an empty array\n    if (hsid === -1) return Uint8Array.of();\n\n    // Single note hsid always results in [0]\n    if (hsid === 0) return Uint8Array.of(0);\n\n    // Calculate length of output array from BASE-bit magnitude of hsid\n    let length = 2;\n    while (hsid >= BASE ** (length - 1)) ++length;\n\n    // Create integer tones array and unpack hsid to tones\n    const numbers = new Uint8Array(length);\n    numbers[0] = 0;\n    let i = 1;\n    while (hsid > 0) {\n        const interval = hsid % BASE;\n        numbers[i] = numbers[i - 1] + interval;\n        hsid = floor(hsid / BASE);\n        ++i;\n    }\n\n    return numbers;\n});\n", "\nimport get     from 'fn/get.js';\nimport mod12   from '../number/mod-12.js';\nimport mirror  from '../object/mirror.js';\nimport { rflatsharp, toUnicode } from '../pitch.js';\nimport { hsidOf, hsidFrom, hsidToNumbers } from './hsid.js';\n\n\nconst DEBUG = globalThis.DEBUG;\n\n\n/*\nChord symbols\n\nChords are identified by HSIDs with a maximum range of 12 (1 octave). These\nserve as maximal harmonic identifiers for each symbol, in some cases as mode\nidentifiers. That is to say, a group of notes should be considered 'of a chord'\nif all of them are found in its identity – that doesn't mean that all the\nnotes of the identity need to be present in the group.\n\nHere be dragons. Chord maps are created from an ordered list of entries. Entry\norder is important to `getChordFrom(numbers)`, which chooses the first entry\nwith the highest matching ratio of notes (up to a limit of 6 notes ie. any\nchord identifier with over 6 notes is treated as if it has 6, evening out the\nscores between whole tone (6-note), major, minor (7-note) and diminished (8-note)\nscales).\n\nIt's fragile, but it is efficient. There is a full suite of tests for various\ngroups of notes in test/chord.js. Consult it before changing anything.\n\nChord extensions containing `/{n}` number tags are slash chords. The tag should\nbe replaced with the chord bass note name, while the number denotes the interval\nfrom the bass note to the root note of the chord (within the range 1-12), which\nshould be prepended to the symbol as usual.\n*/\n\nconst CHORDENTRIES = [\n    // Chords without 7ths\n    ['',          hsidOf(0, 2, 4, 7)],              // Before '+' so that 0,2,4 shows identifies with this\n    ['+',         hsidOf(0, 2, 4, 8)],\n    ['sus',       hsidOf(0, 2, 5, 7)],\n    ['sus♭9',     hsidOf(0, 1, 5, 7)],\n    ['-',         hsidOf(0, 2, 3, 7)],\n    ['°',         hsidOf(0, 2, 3, 6)],\n    ['/{4}',      hsidOf(0, 3, 8, 10)],             // C/E   1st inversion\n    ['/{7}',      hsidOf(0, 5, 7, 9)],              // C/G   2nd inversion\n    ['/{8}',      hsidOf(0, 4, 8, 11)],             // C/A♭\n    ['-/{3}',     hsidOf(0, 4, 9, 11)],             // C-/E♭ 1st inversion\n    ['-/{7}',     hsidOf(0, 5, 7, 8)],              // C-/G  2nd inversion\n    ['/{11}',     hsidOf(0, 1, 5, 8)],              // C/B                       - must come after -/{7}\n    ['/{1}',      hsidOf(0, 3, 6, 11)],             // C/D♭\n    ['7/{4}',     hsidOf(0, 3, 6, 8)],              // C7/E\n//    ['7/{7}',     hsidOf(0, 3, 5, 9)],              // C7/G\n    ['ø',         hsidOf(0, 3, 6, 10)],\n    ['∆6',        hsidOf(0, 4, 7, 9)],\n    ['∆',         hsidOf(0, 2, 4, 7, 9, 11)],       // 1st mode major (ionian)   - must come before ∆♯11\n    ['∆6/9',      hsidOf(0, 2, 4, 7, 9)],\n    ['∆♯11',      hsidOf(0, 2, 4, 6, 7, 9, 11)],    // 4th mode major lydian)\n    ['7sus',      hsidOf(0, 2, 5, 7, 10)],          // - must come before 7 to classify 0,2,7,10 (Gm/C) as 7sus\n    ['7',         hsidOf(0, 2, 4, 7, 10)],          // 5th mode major (myxolydian)\n    ['7sus♭9',    hsidOf(0, 1, 5, 7, 10)],\n    ['13',        hsidOf(0, 2, 4, 7, 9, 10)],\n    ['13sus',     hsidOf(0, 2, 5, 7, 9, 10)],\n    ['-6',        hsidOf(0, 2, 3, 5, 7, 9)],\n    ['-7',        hsidOf(0, 2, 3, 5, 7, 9, 10)],    // 2nd mode major (dorian)\n    ['-11',       hsidOf(0, 2, 3, 5, 10)],\n    ['7♯11',      hsidOf(0, 2, 4, 6, 7, 9, 10)],    // 4th mode melodic minor\n    ['-∆',        hsidOf(0, 2, 3, 5, 7, 9, 11)],    // 1st mode melodic minor\n    ['7♭13',      hsidOf(0, 2, 4, 5, 7, 8, 10)],    // 5th mode melodic minor\n    ['13sus♭9',   hsidOf(0, 1, 3, 5, 7, 9, 10)],    // 2nd mode melodic minor\n    ['+7',        hsidOf(0, 2, 4, 6, 8, 10)],       // Whole tone                - this must come before 7alt, ø9 and ∆♯4♯5\n    ['°7',        hsidOf(0, 2, 3, 5, 6, 8, 9, 11)], // Whole step / half step\n    ['7♯9',       hsidOf(0, 3, 4, 6, 7, 9, 10)],    // Hendrix chord             - must come before 7alt and 7♭9\n    ['7alt',      hsidOf(0, 1, 3, 4, 6, 8, 10)],    // 7th mode melodic minor    - before 7♭9 if F♯ triad / C is to be classified as 7alt, after if it is to be classified as 7♭9\n    ['7♭9',       hsidOf(0, 1, 3, 4, 6, 7, 10)],    // Half step / whole step no 13th\n    ['13♭9',      hsidOf(0, 1, 3, 4, 6, 7, 9, 10)], // Half step / whole step    - must come before 7♭9♭13\n    ['7♭9♭13',    hsidOf(0, 1, 4, 5, 7, 8, 10)],    // 5th mode harmonic minor\n    ['-♭6',       hsidOf(0, 2, 3, 5, 7, 8, 10)],    // 6th mode major (aoelian)  - must come after 13sus♭9\n    ['-♭9',       hsidOf(0, 1, 3, 5, 7, 8, 10)],    // 3rd mode major (phrygian) - must come after -♭6\n    ['ø9',        hsidOf(0, 2, 3, 5, 6, 8, 10)],    // 6th mode melodic minor\n    ['∆♯4♯5',     hsidOf(0, 2, 4, 6, 8, 9, 11)],    // 3rd mode melodic minor\n    ['-∆♭6',      hsidOf(0, 2, 3, 5, 7, 8, 11)],    // 1st mode harmonic minor\n    ['∆♯5',       hsidOf(0, 2, 4, 8, 11)],          // 3rd mode harmonic minor\n    ['∆♭6',       hsidOf(0, 2, 4, 5, 7, 8, 11)],    // 1st mode harmonic major\n];\n\nexport const CHORDNUMBERS = Object.fromEntries(CHORDENTRIES);\nexport const CHORDNAMES   = mirror(CHORDNUMBERS);\n\n/**\ntoHSID(value)\nConverts a chord name or harmonic structure of note numbers to an HSID.\n**/\n\nconst rparenthesis = /[()]/g;\n\nexport function toHSID(value) {\n    return typeof value === 'string' ?\n            CHORDNUMBERS[\n                value\n                .replaceAll(rparenthesis, '')\n                .replaceAll(rflatsharp, toUnicode)\n            ] :\n        typeof value === 'object' ?\n            hsidFrom(value) :\n        value ;\n}\n\n\nexport function toChordName(value) {\n    const hsid = toHSID(value);\n    return CHORDNAMES[hsid] || '';\n}\n\n\n/**\ngetChordOf()\ngetChordFrom()\nExperimental chord identification.\n**/\n\nconst CHORDIDS = CHORDENTRIES.map(get(1));\nconst results = [];\n\nfunction scoreNumbers(chord, numbers) {\n    const r = numbers[0];\n    let n = numbers.length, score = 0;\n    results.length = 0;\n    while (n--) {\n        const number = mod12(numbers[n] - r);\n        if (results.includes(number)) continue;\n        if (!chord.includes(number)) return -1;\n        results.push(number);\n    }\n\n    return results.length / Math.min(6, chord.length);\n}\n\nexport function getChordFrom(numbers) {\n    // A chord must have more than 2 notes, otherwise it's an interval\n    if (numbers.length < 3) return;\n\n    // If numbers is a chord identifier, fast out\n    const chordHSID = hsidFrom(numbers);\n    if (CHORDNAMES[chordHSID]) return CHORDNAMES[chordHSID];\n\n    let hsid, s = 0, h;\n    // Loop in the order of HSIDs declared in CHORDENTRIES, find the first of\n    // the highest scoring matches\n    for (hsid of CHORDIDS) {\n        const chord = hsidToNumbers(hsid);\n        const score = scoreNumbers(chord, numbers);\n        if (score <= s) continue;\n        s = score;\n        h = hsid;\n    }\n\n    return h && CHORDNAMES[h];\n}\n\nexport function getChordOf() {\n    return getChordFrom(arguments);\n}\n", "\n/**\ntoControlName(n)\n\nReturns a shorthand controller name from a value in the range `0`-`127`. Not all\ncontollers have a standardised name, and this library implements only the\nmore common ones. Where a name is not found, returns the controller number as a\nstring.\n\n    toControlName(7);       // 'volume'\n\ttoControlName(64);      // 'sustain'\n\ttoControlName(98);      // '98'\n\nStandardised controller names are defined at\n[midi.org/specifications-old/](https://www.midi.org/specifications-old/item/table-3-control-change-messages-data-bytes-2).\n*/\n\nexport const names = {\n    /*\n    0: Bank Select (MSB)\n    1: Modulation Wheel\n    2: Breath Controller\n    3: Undefined\n    4: Foot Controller\n    5: Portamento Time\n    6: Data Entry (MSB)\n    7: Channel Volume\n    8: Balance\n    9: Undefined\n    10: Pan\n    11: Expression Controller\n    12: Effect Control 1\n    13: Effect Control 2\n    14-15: Undefined\n    16-19: General Purpose Controllers 1-4\n    20-31: Undefined\n    32: Bank Select (LSB)\n    33-63: LSBs for CCs 1-31\n    64: Sustain Pedal (Damper)\n    65: Portamento On/Off\n    66: Sostenuto\n    67: Soft Pedal\n    68: Legato Footswitch\n    69: Hold 2\n    70: Sound Controller 1 (Sound Variation)\n    71: Sound Controller 2 (Timbre/Harmonic Content)\n    72: Sound Controller 3 (Release Time)\n    73: Sound Controller 4 (Attack Time)\n    74: Sound Controller 5 (Brightness)\n    75-79: Sound Controllers 6-10\n    80-83: General Purpose Controllers 5-8\n    84-90: Undefined\n    91: Effects 1 Depth (Reverb)\n    92: Effects 2 Depth (Tremolo)\n    93: Effects 3 Depth (Chorus)\n    94: Effects 4 Depth (Detune)\n    95: Effects 5 Depth (Phaser)\n    96: Data Increment\n    97: Data Decrement\n    98: Non-Registered Parameter Number (LSB)\n    99: Non-Registered Parameter Number (MSB)\n    100: Registered Parameter Number (LSB)\n    101: Registered Parameter Number (MSB)\n    102-119: Undefined\n    120: All Sound Off\n    121: Reset All Controllers\n    122: Local Control On/Off\n    123: All Notes Off\n    124: Omni Mode Off\n    125: Omni Mode On\n    126: Mono Mode On (Poly Off)\n    127: Poly Mode On (Mono Off)\n    */\n\t0:   'bank',\n\t1:   'modulation',\n\t2:   'breath',\n\t4:   'foot',\n\t5:   'portamento',\n\t7:   'volume',\n\t8:   'balance',\n\t10:  'pan',\n\t11:  'expression',\n\t64:  'sustain',\n\t65:  'portamento',\n\t66:  'sostenuto',\n\t67:  'soft',\n\t68:  'legato',\n\t69:  'hold',\n    71:  'harmonics',\n    72:  'release',\n    73:  'attack',\n    74:  'brightness',\n\t91:  'reverb',\n\t92:  'tremolo',\n\t93:  'chorus',\n\t94:  'detune',\n\t95:  'phaser',\n\t120: 'sound-off',\n\t121: 'reset',\n\t122: 'local',\n\t123: 'notes-off',\n\t124: 'omni-off',\n\t125: 'omni-on',\n\t126: 'monophonic',\n\t127: 'polyphonic'\n};\n\nexport const numbers = Object.entries(names).reduce((numbers, [number, name]) => {\n    numbers[name] = parseInt(number, 10);\n    return numbers;\n}, {});\n\n\nexport function toControlName(n) {\n\treturn names[n] || ('' + n);\n}\n\n\n/**\ntoControlNumber(name)\n\nReturns a value in the range `0`-`127` from a shorthand controller `name`.\n\n    toControlNumber('volume')   // 7\n\ttoControlNumber('sustain')  // 64\n\ttoControlNumber('98')       // 98\n*/\n\nexport function toControlNumber(name) {\n\treturn numbers[name] || +name;\n}\n", "\nimport { names } from 'midi/control.js';\n\nconst assign = Object.assign;\n\nexport const PARAMNAMES = assign({}, names, {\n    3:   'mute',\n    6:   'gain',\n    9:   'angle',\n    12:  'distance',\n    13:  'azimuth',\n    14:  'mix',\n    15:  'phase',\n    16:  'frequency',\n    17:  'Q',\n    18:  'depth',\n    19:  'cutoff',\n    20:  'type',\n    21:  'delay',\n    22:  'feedback',\n    //20 - 63 are basically free, although 32 to 63 are reserved as fine-grained add-ons for 0-31\n    128: 'stop',\n    129: 'start',\n    130: 'record',\n    131: 'pitch',\n    132: 'rate',\n    133: 'meter',\n    134: 'key',\n    135: 'touch'\n});\n\nexport const PARAMNUMBERS = Object.entries(PARAMNAMES)\n    .reduce((object, [key, value]) => {\n        object[value] = parseInt(key, 10);\n        return object;\n    }, {});\n\n/**\ntoParamName(value)\nConverts a param name or number to a param name string.\n**/\nexport function toParamName(value) {\n    return typeof value === 'number' ?\n        (PARAMNAMES[value] || value) :\n        value;\n}\n", "\nimport mod    from 'fn/mod.js';\nimport mirror from '../object/mirror.js';\nimport { rflatsharp, toUnicode }    from '../pitch.js';\nimport { toRootName, toRootNumber } from 'midi/note.js';\n\nexport const KEYNUMBERS = {\n    \"F𝄫\": -15,\n    \"C𝄫\": -14,\n    \"G𝄫\": -13,\n    \"D𝄫\": -12,\n    \"A𝄫\": -11,\n    \"E𝄫\": -10,\n    \"B𝄫\": -9,\n    \"F♭\": -8,\n    \"C♭\": -7,\n    \"G♭\": -6,\n    \"D♭\": -5,\n    \"A♭\": -4,\n    \"E♭\": -3,\n    \"B♭\": -2,\n    \"F\":  -1,\n    \"C\":   0,\n    \"G\":   1,\n    \"D\":   2,\n    \"A\":   3,\n    \"E\":   4,\n    \"B\":   5,\n    \"F♯\":  6,\n    \"C♯\":  7,\n    \"G♯\":  8,\n    \"D♯\":  9,\n    \"A♯\":  10,\n    \"E♯\":  11,\n    \"B♯\":  12,\n    \"F𝄪\":  13,\n    \"C𝄪\":  14,\n    \"G𝄪\":  15,\n    \"D𝄪\":  16,\n    \"A𝄪\":  17,\n    \"E𝄪\":  18,\n    \"B𝄪\":  19\n};\n\nexport const KEYNAMES = mirror(KEYNUMBERS);\n\nexport function toKeyName(value) {\n    if (typeof value === 'number') {\n        if (value in KEYNAMES) return KEYNAMES[value];\n        throw new Error(`Key ${ value } not recognised`);\n    }\n\n    return KEYNAMES[toKeyNumber(value)] ;\n}\n\nexport function toKeyNumber(value) {\n    if (typeof value === 'number') return value;\n    const name = value.replaceAll(rflatsharp, toUnicode);\n    if (name in KEYNUMBERS) return KEYNUMBERS[name];\n    throw new Error(`Key \"${ value }\" not recognised`);\n}\n\nexport function keyToRootNumber(value) {\n    const n = toKeyNumber(value);\n    return mod(12, n * 7);\n}\n\nexport function rootToKeyNumber(value) {\n    const name = toRootName(value);\n    return KEYNUMBERS[name];\n}\n", "import mirror from '../object/mirror.js';\n\nexport const TRANSFORMNUMBERS = {\n    displace:  1,\n    rate:      2,\n    gain:      3,\n    quantize:  4,\n    transpose: 5\n};\n\nexport const TRANSFORMNAMES = mirror(TRANSFORMNUMBERS);\n\nexport const TRANSFORMBYTES = {\n    1: 9, // name (1) + time (8)\n    2: 5, // name (1) + rate (4)\n    3: 5, // name (1) + gain (4)\n    4: 5, // name (1) + TBD (4)\n    5: 2  // name (1) + transposition (1)\n};\n\nexport const TRANSFORMLENGTHS = {\n    1: 1, // displace   time\n    2: 1, // rate       rate\n    3: 1, // gain       gain\n    4: 1, // quantize   TBD\n    5: 1  // transpose  value\n};\n\n/**\ntoTransformName(value)\nConverts a transform name or number to a transform name string.\n**/\nexport function toTransformName(value) {\n    return typeof value === 'number' ?\n        (TRANSFORMNAMES[value] || value) :\n        value;\n}\n", "\nimport { toNoteName, toNoteNumber, toRootName, toRootNumber } from 'midi/note.js';\nimport parseGain from './parse/parse-gain.js';\nimport mod12     from './number/mod-12.js';\nimport { rflatsharp, toUnicode } from './pitch.js';\nimport { toTypeName }  from './event/types.js';\nimport { toCurveName } from './event/curves.js';\nimport { toHSID, toChordName } from './event/chords.js';\nimport { toParamName } from './event/params.js';\nimport { toKeyNumber, toKeyName } from './event/keys.js';\nimport { toTransformName, TRANSFORMNUMBERS, TRANSFORMLENGTHS } from './event/transforms.js';\n\n\nconst DEBUG    = globalThis.DEBUG;\nconst define   = Object.defineProperty;\nconst writable = { writable: true };\n\n\nfunction arrayify(event) {\n    const array = [];\n    let n = -1;\n    while (event[++n] !== undefined) array.push(event[n]);\n    return array;\n}\n\nfunction stringify(number) {\n    return number.toFixed(4).replace(/\\.?0+$/, '');\n}\n\nfunction getEvent(event) {\n    let e;\n    while (e = event.event) event = e;\n    return event;\n}\n\nexport default class Event {\n    constructor(beat, type) {\n        this[0] = beat;\n        this[1] = toTypeName(type);\n\n        // Normalise event data\n        switch (this[1]) {\n            case \"chord\":\n                // Root number\n                this[2] = toRootNumber(arguments[2]);\n                // Harmonic structure id - handle number or name string\n                this[3] = toHSID(arguments[3]);\n                // Duration\n                this[4] = arguments[4] || 0;\n                // Chord bass\n                if (arguments[5]) this[5] = arguments[5] || 0;\n                break;\n            case \"text\":\n                // String\n                this[2] = arguments[2];\n                // Duration\n                this[3] = arguments[3];\n                break;\n            case \"key\":\n                // Key root number\n                this[2] = toKeyNumber(arguments[2]);\n                break;\n            case \"note\":\n                // Note number\n                this[2] = toNoteNumber(arguments[2]);\n                // Gain\n                this[3] = parseGain(arguments[3]);\n                // Duration\n                this[4] = arguments[4] || 0;\n                break;\n            case \"rate\":\n                // Rate\n                this[2] = arguments[2];\n                // Curve - handle number or string\n                this[3] = toCurveName(arguments[3]);\n                // Duration\n                if (this[3] === 'target' || this[3] === 'curve') this[4] = arguments[4] || 0 ;\n                break;\n            case \"param\":\n                // Name - handle number or string\n                this[2] = toParamName(arguments[2]);\n                // Value\n                this[3] = arguments[3];\n                // Curve - handle number or string\n                this[4] = toCurveName(arguments[4]);\n                // Duration\n                if (this[4] === 'target' || this[4] === 'curve') this[5] = arguments[5] || 0 ;\n                break;\n            case \"sequence\":\n                // Id\n                this[2] = arguments[2];\n                // Target\n                this[3] = arguments[3];\n                // Duration\n                this[4] = arguments[4] || 0;\n                // Transforms\n                let n = 5;\n                while(arguments[n] !== undefined) {\n                    // Convert transform name from number to string\n                    this[n] = toTransformName(arguments[n]);\n\n                    // Get transform number for looking up parameter count\n                    const number = TRANSFORMNUMBERS[this[n]];\n\n                    // Copy parameters without conversion\n                    const m = n + TRANSFORMLENGTHS[number];\n                    while (n++ < m) this[n] = arguments[n] || 0;\n                }\n                break;\n            case \"start\":\n            case \"stop\":\n                // Note number\n                this[2] = toNoteNumber(arguments[2]);\n                // Gain\n                this[3] = parseGain(arguments[3]);\n                break;\n\n            default:\n                this[2] = arguments[2];\n                this[3] = arguments[3];\n        }\n\n        define(this, 'event',  writable);\n        define(this, 'events', writable);\n        define(this, 'index',  writable);\n        define(this, 'target', writable);\n    }\n\n    move(n) {\n        const event = getEvent(this);\n        event[0] = this[0] = this[0] + n;\n        return this;\n    }\n\n    transpose(n) {\n        const event = getEvent(this);\n\n        switch (this[1]) {\n            case \"chord\":\n            case \"key\":\n                event[2] = this[2] = mod12(this[2] + n);\n                break;\n            case \"note\":\n            case \"start\":\n            case \"stop\":\n                event[2] = this[2] = this[2] + n;\n                break;\n            case \"sequence\":\n                console.log('TODO: transpose sequence');\n                break;\n        }\n\n        return this;\n    }\n\n    // Enable event object to be spread by making it iterable\n    *[Symbol.iterator]() {\n        let i = -1;\n        while (this[++i] !== undefined) yield this[i];\n    }\n\n    toJSON() {\n        return arrayify(this);\n    }\n\n    toString() {\n        // Beat and type\n        let string = stringify(this[0]) + ' ' + this[1];\n\n        // Stringify rest of data based on event type\n        switch (this[1]) {\n            case \"chord\":\n                string += ' ' + toRootName(this[2])\n                    // Extension\n                    + ' ' + toChordName(this[3])\n                    // Duration\n                    + ' ' + stringify(this[4]);\n                break;\n            case \"key\":\n                string += ' ' + toKeyName(this[2]);\n                break;\n            case \"note\":\n                string += ' ' + toNoteName(this[2])\n                    // Gain\n                    + ' ' + this[3]\n                    // Duration\n                    + ' ' + stringify(this[4]) ;\n                break;\n            case \"param\":\n                string += ' ' + this[2]\n                    // Value\n                    + ' ' + this[3]\n                    // Duration\n                    + ' ' + stringify(this[4])\n                    // Curve\n                    + ' ' + this[5] ;\n                break;\n            case \"rate\":\n                string += ' ' + stringify(this[2]);\n                break;\n            case \"sequence\":\n                string += ' ' + this[2]\n                    // Target address\n                    + ' ' + this[3]\n                    // Duration\n                    + ' ' + stringify(this[4]);\n                break;\n            case \"start\":\n            case \"stop\":\n                string += ' ' + toNoteName(this[2])\n                    // Gain\n                    + ' ' + this[3] ;\n                break;\n            // Handle \"meter\" and other events\n            default:\n                let n = 1;\n                while (this[++n] !== undefined) string += this[n];\n        }\n\n        return string;\n    }\n\n    static of(...data) {\n        return new Event(...data);\n    }\n\n    static from(data, index, events) {\n        if (DEBUG && index  !== undefined && typeof index  !== 'number') throw new Error('Event() cannot create event with index ' + index);\n        if (DEBUG && events !== undefined && typeof events !== 'object') throw new Error('Event() cannot create event with events ' + events);\n\n        const event = new Event(...data) ;\n        event.event  = data; // Dodgy, what if we are making event from arguments object?\n        event.events = events;\n        event.index  = index;\n        return event;\n    }\n\n    static isChord    = isChordEvent;\n    static isNote     = isNoteEvent;\n    static isSequence = isSequenceEvent;\n}\n\nexport function isChordEvent(event) {\n    return event[1] === 'chord';\n}\n\nexport function isNoteEvent(event) {\n    return event[1] === 'note';\n}\n\nexport function isSequenceEvent(event) {\n    return event[1] === 'sequence';\n}\n", "/**\nmatches(selector, object)\n\nFor filtering and pattern matching. Returns true where all the properties\nof `selector` object are strictly equal to the same properties of `object`.\nNote that `object` may have more properties than `selector`.\n\n```\nconst vegetarian = menu.filter(matches({ vegetable: true }));\n```\n**/\n\nimport curry from './curry.js';\n\nexport function matches(object, item) {\n\tlet property;\n\tfor (property in object) {\n\t\tif (object[property] !== item[property]) { return false; }\n\t}\n\treturn true;\n}\n\nexport default curry(matches, true);\n", "\nimport id       from 'fn/id.js';\nimport overload from 'fn/overload.js';\nimport { toNoteNumber, toRootNumber } from 'midi/note.js';\nimport { rootToKeyNumber, keyToRootNumber } from './keys.js';\n\nexport default overload((n, event) => event[1], {\n    note: (n, event) => {\n        // TODO: do not n GM drum string names\n        event[2] = toNoteNumber(event[2]) + n;\n        return event;\n    },\n\n    chord: (n, event) => {\n        // Root note\n        event[2] = toRootNumber(toRootNumber(event[2]) + n);\n        // Pedal note\n        if (event[5] !== undefined) event[5] = toRootNumber(toRootNumber(event[2]) + n);\n        return event;\n    },\n\n    key: (n, event) => {\n        event[2] = rootToKeyNumber(keyToRootNumber(event[2]) + n);\n        return event;\n    },\n\n    default: id\n});\n", "\nimport { toNoteNumber, toRootNumber } from 'midi/note.js';\nimport parseGain from './parse/parse-gain.js';\nimport transpose from './event/transpose.js';\nimport mod12 from './number/mod-12.js';\n\n\nconst types = {\n    displace: (transforms, n, event) => {\n        event[0] -= transforms[++n];\n        return n;\n    },\n\n    rate: (transforms, n, event) => {\n        // Transform beat\n        event[0] /= transforms[++n];\n\n        // Transform duration\n        switch (event[1]) {\n            case \"chord\":\n            case \"note\":\n            case \"sequence\":\n                event[4] /= transforms[n];\n                break;\n            case \"text\":\n                event[3] /= transforms[n];\n                break;\n        }\n\n        return n;\n    },\n\n    gain: (transforms, n, event) => {\n        ++n;\n\n        // Transform gain\n        switch (event[1]) {\n            case \"note\":\n                event[3] *= parseGain(transforms[n]);\n                break;\n        }\n\n        return n;\n    },\n\n    quantize: (transforms, n, event) => {\n        // TODO: Quantise!\n    },\n\n    transpose: (transforms, n, event) => {\n        transpose(transforms[n + 1], event);\n        return n + 1;\n    }\n};\n\n\nexport default function transform(transforms, event) {\n    let n = -1, type;\n    while (type = transforms[++n]) n = types[type](transforms, n, event);\n    return event;\n}\n", "\nimport Event, { isSequenceEvent } from './event.js';\nimport transform from './transform.js';\n\nconst assign = Object.assign;\n\nconst nothing = [];\n\nconst done = {\n    done: true,\n    value: undefined\n};\n\nconst priorities = {\n    // The higher the priority, the earlier an event is ordered when\n    // sorting events\n    key: 2,\n    meter: 1,\n    default: 0\n};\n\nconst temp = {};\n\n\nfunction priority(event) {\n    return priorities[event[1]] || priorities.default;\n}\n\nfunction byPriority(b, a) {\n        // a is before b\n    return a[0] < b[0] ? 1 :\n        // a is after b\n        a[0] > b[0] ? -1 :\n        // a and b are at the same time, prioritise by event type\n        priority(a) - priority(b) ;\n}\n\nexport function insert(array, object) {\n    let n = -1;\n    while (array[++n] && byPriority(array[n], object) < 1);\n    array.splice(n, 0, object);\n    return n;\n}\n\nfunction slice(n, event) {\n    const array = [];\n    let i = n - 1;\n    while (event[++i] !== undefined) array.push(event[i]);\n    return array;\n}\n\nfunction getSequence(sequences, id) {\n    return sequences.find((sequence) => sequence.id === id);\n}\n\nexport default class SequenceIterator {\n    constructor(events, sequences = nothing, transforms = nothing) {\n        // Sort events by beat and type\n        events.sort(byPriority);\n\n        // Assign properties\n        this.events     = events,\n        this.sequences  = sequences;\n        this.transforms = transforms;\n\n        // Set n to index before first event falling on or after beat\n        let n = -1, event;\n        while ((event = events[++n]) && transform(transforms, assign(temp, event))[0] < 0);\n        this.n = n - 1;\n    }\n\n    next() {\n        const { events, sequences, transforms, n } = this;\n        const event = events[n + 1];\n        const value = event && transform(transforms, Event.from(event, n + 1, events));\n\n        let iterator;\n        let i = -1, j = 0;\n        let b = value ? value[0] : Infinity ;\n        let x;\n        while (iterator = this[++i]) {\n            let value = iterator.value;\n\n            if (!value) {\n                // Get next value from iterator and transform it for current context\n                if (value = iterator.next().value) {\n                    transform(this.transforms, value);\n                    value[0] += iterator.startBeat;\n                    value.target = (value.target || 0) + iterator.target;\n                }\n\n                // If done or beyond stop beat, mark iterator for removal\n                if (iterator.done || value[0] >= iterator.stopBeat) ++j;\n            }\n\n            // Select iterator/value with earliest beat\n            if (value && value[0] < iterator.stopBeat && value[0] < b) {\n                x = iterator;\n                b = value[0];\n            }\n\n            // Remove marked iterators by reassigning remaining iterators\n            if (j) this[i] = this[i + j];\n        }\n\n        if (x) {\n            // Make this iterator value the child iterator's transformed value\n            this.value = x.value;\n            // Mark child iterator as consumed\n            x.value = undefined;\n            return this;\n        }\n\n        // We're out of events TODO: we may not be out of iterators??\n        if (!value) return assign(this, done);\n\n        // Advance index and assign event as this.value\n        this.n += 1;\n        this.value = value;\n\n        // If it is a sequence event spawn a new iterator\n        if (isSequenceEvent(event)) {\n            const sequences = this.sequences;\n            const sequence  = getSequence(sequences, event[2]);\n            if (!sequence) throw new Error('Sequence id \"' + event[2] + '\" not found');\n\n            const iterator = new SequenceIterator(\n                sequence.events,\n                // Join parent sequences to sequences\n                sequence.sequences ?\n                    sequence.sequences.concat(sequences) :\n                    sequences ,\n                // Transforms\n                slice(5, event)\n            );\n\n            // Store info about the event on the iterator object\n            iterator.startBeat = value[0];\n            iterator.stopBeat  = value[0] + value[4];\n            iterator.target    = value[3];\n\n            // Add iterator (indexed as -n) directly to this\n            let i = -1;\n            while (this[++i]);\n            this[i] = iterator;\n        }\n\n        // Return iterator\n        return this;\n    }\n\n    static from(sequence) {\n        return new SequenceIterator(sequence.events, sequence.sequences);\n    }\n\n    [Symbol.iterator]() {\n        return this;\n    }\n}\n", "\nimport matches from 'fn/matches.js';\nimport { toNoteNumber } from 'midi/note.js';\nimport SequenceIterator, { insert } from './sequence-iterator.js';\nimport Event     from './event.js';\n\n\nconst assign = Object.assign;\n\n\nfunction toJSON(object) {\n    return object.toJSON();\n}\n\nfunction toPriority(event) {\n    return event[0] + '|' + priority(event);\n}\n\nexport default class Sequence {\n    constructor(events, sequences) {\n        this.events = events.map(Event.from);\n        if (sequences) this.sequences = sequences.map(Sequence.from);\n    }\n\n    create() {\n        const event = new Event(...arguments);\n        insert(this.events, event);\n        return event;\n    }\n\n    delete(beat, type) {\n        if (type === 'note' && arguments[2] !== undefined) {\n            arguments[2] = toNoteNumber(arguments[2]);\n        }\n\n        const i = this.events.findIndex(matches(arguments));\n        if (i > -1) this.events.splice(i, 1);\n        return this;\n    }\n\n    find(beat, type) {\n        if (type === 'note' && arguments[2] !== undefined) {\n            arguments[2] = toNoteNumber(arguments[2]);\n        }\n\n        return this.events.find(matches(arguments));\n    }\n\n    get(id) {\n        return this.sequences && this.sequences.find(matches({ id }));\n    }\n\n    select(beat, type) {\n        return this.events.filter(matches({ 0: beat, 1: type }));\n    }\n\n    static of(...events) {\n        return new Sequence(events);\n    }\n\n    static from(data) {\n        const { events, sequences, ...props } = data;\n        return data.length ?\n            new Sequence(data) :\n            assign(new Sequence(events, sequences), props) ;\n    }\n\n    [Symbol.iterator]() {\n        return new SequenceIterator(this.events, this.sequences);\n    }\n}\n", "\nimport { CURVENAMES, CURVENUMBERS } from '../event/curves.js';\nimport { PARAMNAMES, PARAMNUMBERS } from '../event/params.js';\nimport { TYPENAMES, TYPENUMBERS }   from '../event/types.js';\n\nexport const ROUTEBITS = 2;\nexport const PARAMBITS = 10;\nexport const CURVEBITS = 4;\n\nexport const ROUTEMASK = (1 << ROUTEBITS) - 1;\nexport const PARAMMASK = (1 << PARAMBITS) - 1;\nexport const CURVEMASK = (1 << CURVEBITS) - 1;\n\n\n/**\npackAddress(route, name, curve)\nPacks route, name, and curve into a 16-bit address.\nFormat: [RR][NNNNNNNNNN][CCCC] - route(2 bits), name(10 bits), curve(4 bits)\n**/\nexport function packAddress(route, name, curve) {\n    return (route << 14) | (name << 4) | curve;\n}\n\n/**\nunpackAddress(address)\nUnpacks a 16-bit address into route, param, and curve components.\nReturns an object: { route, param, curve }\n**/\nexport function unpackAddress(address) {\n    return {\n        route: address >> 14,\n        param: (address >> CURVEBITS) & PARAMMASK,\n        curve: address & CURVEMASK\n    };\n}\n\n/**\ntoRoute(address)\nExtracts the 2-bit route from packed address.\n**/\nexport function toRoute(address) {\n    return address >> 14;\n}\n\n/**\ntoParamNumber(address)\nExtracts the 10-bit param/name number from packed address.\n**/\nexport function toParamNumber(address) {\n    return (address >> CURVEBITS) & PARAMMASK;\n}\n\n/**\ntoCurveNumber(address)\nExtracts the 4-bit curve number from packed address.\n**/\nexport function toCurveNumber(address) {\n    return address & CURVEMASK;\n}\n\n/**\ntoParamName(address)\nExtracts the param name string from packed address (for route 1).\n**/\nexport function toParamName(address) {\n    const nameNumber = toParamNumber(address);\n    return PARAMNAMES[nameNumber] || nameNumber;\n}\n\n/**\ntoCurveName(address)\nExtracts the curve name string from packed address.\n**/\nexport function toCurveName(address) {\n    const curveNumber = toCurveNumber(address);\n    return CURVENAMES[curveNumber];\n}\n", "\nimport { TYPENUMBERS, TYPEBYTES } from '../event/types.js';\nimport { TRANSFORMNUMBERS } from '../event/transforms.js';\nimport { CURVENUMBERS, CURVEBYTES }     from '../event/curves.js';\nimport { toRoute, toParamNumber, toCurveNumber } from './address.js';\nimport Event from '../event.js';\n\n\n/**\ndeserialise(buffer)\nDeserialises a Uint8Array binary format to an array of Sequence events.\nEvent structure: Float64 beat | Int16 address | data...\nAddress structure: 2-bit route | 10-bit name | 4-bit curve\n**/\n\nexport default function deserialise(buffer) {\n    const view   = new DataView(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n    const events = [];\n\n    let offset = 0;\n    while (offset < buffer.length) {\n        // Read beat (float64)\n        const beat = view.getFloat64(offset, true);\n        offset += 8;\n\n        // Read address (uint16)\n        const address = view.getUint16(offset, true);\n        offset += 2;\n\n        const route = toRoute(address);\n        const param = toParamNumber(address);\n\n        // Read event data based on route\n        switch (route) {\n            // Route 0: sequence control event\n            case 0:\n                switch (param) {\n                    case TYPENUMBERS['note']:\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            view.getFloat32(offset, true),      // pitch\n                            view.getFloat32(offset + 4, true),  // dynamic\n                            view.getFloat64(offset + 8, true)   // duration\n                        ));\n                        offset += 16;\n                        break;\n\n                    case TYPENUMBERS['meter']:\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            view.getFloat16(offset, true),      // duration\n                            view.getFloat16(offset + 2, true)   // divisor\n                        ));\n                        offset += 4;\n                        break;\n\n                    case TYPENUMBERS['chord']:\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            buffer[offset],                      // root\n                            view.getFloat64(offset + 1, true),   // hsId (harmonic structure id)\n                            view.getFloat64(offset + 9, true),   // duration\n                            buffer[offset + 17]                  // bass\n                        ));\n                        offset += 18;\n                        break;\n\n                    case TYPENUMBERS['key']:\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            view.getInt8(offset)\n                        ));\n                        offset += 1;\n                        break;\n\n                    case TYPENUMBERS['clef']:\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            buffer[offset]\n                        ));\n                        offset += 1;\n                        break;\n\n                    // id | target | duration | bytelength | transforms...\n                    case TYPENUMBERS['sequence']: {\n                        const id       = view.getUint16(offset, true);\n                        const target   = view.getUint16(offset + 2, true);\n                        const duration = view.getFloat64(offset + 4, true);\n                        const bytes    = buffer[offset + 12];\n                        const params   = [beat, param, id, target, duration];\n                        offset += 13;\n\n                        // Read transforms\n                        let o = 0;\n                        while (o < bytes) {\n                            const number = buffer[offset + o];\n                            o += 1;\n                            params.push(number);\n\n                            // Read parameters based on transform number\n                            switch(number) {\n                                case TRANSFORMNUMBERS['displace']:\n                                    params.push(view.getFloat64(offset + o, true));\n                                    o += 8;\n                                    break;\n\n                                case TRANSFORMNUMBERS['rate']:\n                                case TRANSFORMNUMBERS['gain']:\n                                case TRANSFORMNUMBERS['quantize']:\n                                    params.push(view.getFloat32(offset + o, true));\n                                    o += 4;\n                                    break;\n\n                                case TRANSFORMNUMBERS['transpose']:\n                                    params.push(view.getInt8(offset + o));\n                                    o += 1;\n                                    break;\n\n                                default:\n                                    throw new Error(`Unknown transform number: ${ number }`);\n                            }\n                        }\n\n                        events.push(Event.from(params));\n                        offset += bytes;\n                        break;\n                    }\n\n                    // duration | bytelength | string...\n                    case TYPENUMBERS['text']: {\n                        const duration = view.getFloat64(offset, true);\n                        const bytes    = buffer[offset + 8];\n                        offset += 9;\n\n                        // Get string data\n                        const data = buffer.subarray(offset, offset + bytes);\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            new TextDecoder().decode(data),\n                            duration\n                        ));\n                        offset += bytes;\n                        break;\n                    }\n\n                    case TYPENUMBERS['start']:\n                    case TYPENUMBERS['stop']:\n                        events.push(Event.of(\n                            beat,\n                            param,\n                            view.getFloat32(offset, true),      // pitch\n                            view.getFloat32(offset + 4, true)   // dynamic\n                        ));\n                        offset += 8;\n                        break;\n\n                    default: {\n                        // Default handler for route 0 events with variable-length encoding (rate, etc.)\n                        const curveNumber = toCurveNumber(address);\n\n                        switch (curveNumber) {\n                            case CURVENUMBERS['step']:\n                            case CURVENUMBERS['linear']:\n                            case CURVENUMBERS['exponential']:\n                                // step/linear/exponential: value(4) only\n                                events.push(Event.of(beat, param, view.getFloat32(offset, true), curveNumber));\n                                offset += 4;\n                                break;\n\n                            case CURVENUMBERS['target']:\n                                // target: value(4) + timeConstant(8)\n                                events.push(Event.of(\n                                    beat,\n                                    param,\n                                    view.getFloat32(offset, true),\n                                    curveNumber,\n                                    view.getFloat64(offset + 4, true)\n                                ));\n                                offset += 12;\n                                break;\n\n                            case CURVENUMBERS['curve']:\n                                // curve: duration(8) + bytelength(2) + arraydata(n * 4)\n                                const duration = view.getFloat64(offset, true);\n                                const bytes    = view.getUint16(offset + 8, true);\n                                offset += 10;\n\n                                if (bytes < 8) throw new Error(`Invalid bytes count ${ bytes } (must hold at least 2 * Float32 bytes)`);\n                                if (bytes % 4 !== 0) throw new Error(`Invalid bytes count ${ bytes } (must hold n * Float32 bytes)`);\n\n                                // Copy bytes to new aligned buffer and create Float32Array\n                                const slice = buffer.slice(offset, offset + bytes);\n                                const values = new Float32Array(slice.buffer);\n                                offset += bytes;\n\n                                events.push(Event.of(beat, param, values, curveNumber, duration));\n                                break;\n\n                            default: // hold/cancel\n                                events.push(Event.of(beat, param, undefined, curveNumber));\n                                break;\n                        }\n                        break;\n                    }\n                }\n\n                break;\n\n            // Route 1: param event\n            case 1: {\n                const number = toCurveNumber(address);\n\n                switch (number) {\n                    case CURVENUMBERS['step']:\n                    case CURVENUMBERS['linear']:\n                    case CURVENUMBERS['exponential']:\n                        // step/linear/exponential: value(4) only\n                        events.push(Event.of(beat, 'param', param, view.getFloat32(offset, true), number));\n                        offset += 4;\n                        break;\n\n                    case CURVENUMBERS['target']:\n                        // target: value(4) + timeConstant(8)\n                        events.push(Event.of(\n                            beat,\n                            'param',\n                            param,\n                            view.getFloat32(offset, true),\n                            number,\n                            view.getFloat64(offset + 4, true)\n                        ));\n                        offset += 12;\n                        break;\n\n                    case CURVENUMBERS['curve']:\n                        // curve: duration(8) + bytelength(2) + arraydata(n * 4)\n                        const duration = view.getFloat64(offset, true);\n                        const bytes    = view.getUint16(offset + 8, true);\n                        offset += 10;\n\n                        if (bytes < 8) throw new Error(`Invalid bytes count ${ bytes } (must hold at least 2 * Float32 bytes)`);\n                        if (bytes % 4 !== 0) throw new Error(`Invalid bytes count ${ bytes } (must hold n * Float32 bytes)`);\n\n                        // Copy bytes to new aligned buffer and create Float32Array\n                        const slice = buffer.slice(offset, offset + bytes);\n                        const values = new Float32Array(slice.buffer);\n                        offset += bytes;\n\n                        events.push(Event.of(beat, 'param', param, values, number, duration));\n                        break;\n\n                    // hold/cancel\n                    default:\n                        events.push(Event.of(beat, 'param', param, undefined, number));\n                        break;\n                }\n                break;\n            }\n\n            default:\n                throw new Error(`Cannot deserialise unknown address ${ route }.${ param }.${ toCurveNumber(address) }`);\n                break;\n        }\n    }\n\n    return events;\n}\n", "\nimport Event                        from '../event.js';\nimport { packAddress }              from './address.js';\nimport { CURVENUMBERS, CURVEBYTES } from '../event/curves.js';\nimport { TYPENUMBERS, TYPEBYTES }   from '../event/types.js';\nimport { TRANSFORMNUMBERS, TRANSFORMBYTES, TRANSFORMLENGTHS } from '../event/transforms.js';\nimport { CHORDNUMBERS }             from '../event/chords.js';\nimport { KEYNUMBERS, toKeyNumber }  from '../event/keys.js';\nimport { PARAMNUMBERS }             from '../event/params.js';\n\n\n/**\nserialise(events)\nSerialises an array of events to a Uint8Array binary format.\nEvent structure: Float64 beat | Int16 address | data...\nAddress structure: 2-bit route | 10-bit name | 4-bit curve\n**/\n\n// Maximum string bytes for text events\n// length field stores string bytes only (0-255)\nconst MAX_TEXT_BYTES = 255;\n\nfunction truncateUTF8(bytes, maxLength) {\n    if (bytes.length <= maxLength) return bytes;\n\n    // Walk backwards from maxLength to find start of last complete character\n    // UTF-8 continuation bytes have pattern 10xxxxxx (0x80-0xBF)\n    let i = maxLength;\n    while (i > 0 && (bytes[i] & 0xC0) === 0x80) i--;\n    return bytes.slice(0, i);\n}\n\nfunction getEventBytes(event) {\n    const type = event[1];\n    const t    = TYPENUMBERS[type];\n\n    let bytes = 10; // beat 8 | address 2\n    if (t in TYPEBYTES) return bytes + TYPEBYTES[t];\n\n    let i;\n    switch(type) {\n        case 'text': {\n            const encoded   = new TextEncoder().encode(event[2]);\n            const truncated = truncateUTF8(encoded, MAX_TEXT_BYTES);\n            return bytes + 8 + 1 + truncated.length; // duration(8) + length(1) + string(N)\n        }\n\n        case 'sequence': {\n            bytes += 13; // id 2 | target 2 | duration 8 | byteslength 1\n            i = 4;\n            while (event[++i] !== undefined) {\n                const n = TRANSFORMNUMBERS[event[i]];\n                bytes += TRANSFORMBYTES[n];\n                i += TRANSFORMLENGTHS[n];\n            }\n            return bytes;\n        }\n\n        case 'param':\n            i = 4;\n        case 'rate':\n            if (i === undefined) i = 3;\n\n        default: {\n            // Different curves take up different bytelengths\n            const number = typeof event[i] === 'string' ?\n                (CURVENUMBERS[event[i]] || 0) :\n                (event[i] || 0);\n\n            // For curve type, always include length field (array is at i-1)\n            return number === CURVENUMBERS['curve'] ?\n                bytes + 8 + 2 + event[i - 1].length * 4 :\n                bytes + CURVEBYTES[number] ;\n        }\n    }\n}\n\nfunction getAddressFromEvent(event) {\n    const type = event[1];\n\n    switch (type) {\n        case 'param': {\n            const p = typeof event[2] === 'string' ? (PARAMNUMBERS[event[2]] || 0) : event[2];\n            const c = typeof event[4] === 'string' ? (CURVENUMBERS[event[4]] || 0) : event[4];\n            // Param event route 1\n            return packAddress(1, p, c);\n        }\n\n        case 'rate': {\n            const t = TYPENUMBERS[type];\n            const c = typeof event[3] === 'string' ? (CURVENUMBERS[event[3]] || 0) : (event[3] || 0);\n            // Param event route 0\n            return packAddress(0, t, c);\n        }\n\n        default: {\n            const number = TYPENUMBERS[type];\n            if (number === undefined) throw new Error(`Event type ${ type } not recognised`);\n            // Other sequence targeted events route 0\n            return packAddress(0, number, 0);\n        }\n    }\n}\n\nexport default function serialise(events) {\n    // First pass: calculate total size\n    let bytes = 0;\n    for (const event of events) bytes += getEventBytes(event);\n\n    // Allocate buffer\n    const buffer = new Uint8Array(bytes);\n    const view   = new DataView(buffer.buffer);\n\n    // Second pass: write events\n    let n = -1, event, offset = 0;\n    while(event = events[++n]) {\n        // Make sure event is a normalised event object\n        if (!(event instanceof Event)) event = Event.from(event);\n\n        // Write beat Float64\n        view.setFloat64(offset, event[0], true);\n        offset += 8;\n\n        // Write address Uint16\n        const address = getAddressFromEvent(event);\n        view.setUint16(offset, address, true);\n        offset += 2;\n\n        // Write event-specific data\n        switch(event[1]) {\n            case 'note':\n                view.setFloat32(offset, event[2], true);      // pitch\n                view.setFloat32(offset + 4, event[3], true);  // dynamic\n                view.setFloat64(offset + 8, event[4], true);  // duration\n                offset += 16;\n                break;\n\n            case 'param':\n            case 'rate': {\n                const i = event[1] === 'rate' ? 2 : 3;\n                const number = typeof event[i + 1] === 'string' ?\n                    (CURVENUMBERS[event[i + 1]] || 0) :\n                    (event[i + 1] || 0);\n\n                switch (number) {\n                    case CURVENUMBERS['step']:\n                    case CURVENUMBERS['linear']:\n                    case CURVENUMBERS['exponential']:\n                        // step/linear/exponential: value(4) only\n                        view.setFloat32(offset, event[i], true);\n                        offset += 4;\n                        break;\n\n                    case CURVENUMBERS['target']:\n                        // target: value(4) + timeConstant(8)\n                        view.setFloat32(offset, event[i], true);\n                        view.setFloat64(offset + 4, event[i + 2] || 0, true);\n                        offset += 12;\n                        break;\n\n                    case CURVENUMBERS['curve']:\n                        // curve: duration(8) + byteslength(2) + values(n * 4)\n                        view.setFloat64(offset, event[i + 2] || 0, true);\n                        offset += 8;\n\n                        const values = event[i];\n                        const bytes  = values.length * 4;\n\n                        // Write length as Uint16\n                        view.setUint16(offset, bytes, true);\n                        offset += 2;\n\n                        // Write Float32 values if present\n                        let n = -1;\n                        while (values[++n] !== undefined) {\n                            view.setFloat32(offset + n * 4, values[n], true);\n                        }\n\n                        offset += bytes;\n                        break;\n\n                    // hold/cancel: no data, no offset change\n                }\n\n                break;\n            }\n\n            case 'meter':\n                view.setFloat16(offset, event[2], true);      // duration\n                view.setFloat16(offset + 2, event[3], true);  // divisor\n                offset += 4;\n                break;\n\n            case 'chord': {\n                const rootId = typeof event[2] === 'number' ? event[2] : 0;\n                buffer[offset] = rootId;                      // root\n                const hsId   = typeof event[3] === 'string' ? (CHORDNUMBERS[event[3]] || 0) : event[3];\n                view.setFloat64(offset + 1, hsId, true);      // hsid\n                view.setFloat64(offset + 9, event[4], true);  // duration\n                const bassId = typeof event[5] === 'number' ? event[5] : 0;\n                buffer[offset + 17] = bassId;                 // bass\n                offset += 18;\n                break;\n            }\n\n            case 'key': {\n                view.setInt8(offset, toKeyNumber(event[2]));\n                offset += 1;\n                break;\n            }\n\n            case 'sequence': {\n                view.setUint16(offset, event[2], true);       // id\n                view.setUint16(offset + 2, event[3], true);   // target\n                view.setFloat64(offset + 4, event[4], true);  // duration\n                offset += 12;\n\n                // Write length byte (transform bytes only)\n                const bytesIndex = offset;\n                offset += 1;\n\n                // Write transforms\n                let i = 4;\n                while (event[++i] !== undefined) {\n                    const name = event[i];\n                    const n = typeof name === 'string' ?\n                        TRANSFORMNUMBERS[name] :\n                        name;\n\n                    if (n === undefined) throw new Error(`Transform name \"${ name }\" not recognised`);\n\n                    buffer[offset] = n;\n                    offset += 1;\n\n                    // Write parameters based on transform number\n                    switch(n) {\n                        case TRANSFORMNUMBERS['displace']:\n                            view.setFloat64(offset, event[i + 1], true);\n                            offset += 8;\n                            break;\n\n                        case TRANSFORMNUMBERS['rate']:\n                        case TRANSFORMNUMBERS['gain']:\n                        case TRANSFORMNUMBERS['quantize']:\n                            view.setFloat32(offset, event[i + 1], true);\n                            offset += 4;\n                            break;\n\n                        case TRANSFORMNUMBERS['transpose']:\n                            view.setInt8(offset, event[i + 1]);\n                            offset += 1;\n                            break;\n\n                        default:\n                            throw new Error(`Transform number ${ n } not recognised`);\n                    }\n\n                    i += TRANSFORMLENGTHS[n];\n                }\n\n                // Fill in bytes length\n                buffer[bytesIndex] = offset - bytesIndex - 1;\n                break;\n            }\n\n            case 'text': {\n                const encoded = new TextEncoder().encode(event[2]);\n                const truncated = truncateUTF8(encoded, MAX_TEXT_BYTES);\n                view.setFloat64(offset, event[3], true);        // duration\n                buffer[offset + 8] = truncated.length;          // length byte (string bytes only)\n                buffer.set(truncated, offset + 9);              // string bytes\n                offset += 9 + truncated.length;\n                break;\n            }\n\n            case 'start':\n            case 'stop':\n                view.setFloat32(offset, event[2], true);      // pitch\n                view.setFloat32(offset + 4, event[3], true);  // dynamic\n                offset += 8;\n                break;\n\n            // TODO: This does not really deserve to be here. We could make\n            // the remaining curve types in the last 4 bits of address identify\n            // data signatures for unknown events ... but then we need to tell\n            // the event how to be encoded ... not great. For now, we'll spec it\n            // here.\n            case 'clef':\n                const clefId = typeof event[2] === 'number' ? event[2] : 0;\n                buffer[offset] = clefId;\n                offset += 1;\n                break;\n        }\n    }\n\n    return buffer;\n}\n", "{\n  \"$type\": \"com.atproto.lexicon.schema\",\n  \"lexicon\": 1,\n  \"id\": \"io.sound.sequence\",\n  \"defs\": {\n    \"main\": {\n      \"type\": \"record\",\n      \"description\": \"A sequence of timed events. Full documentation at https://github.com/soundio/sequence/.\",\n      \"key\": \"any\",\n      \"record\": {\n        \"type\": \"object\",\n        \"required\": [\"events\"],\n        \"properties\": {\n          \"id\": {\n            \"type\": \"integer\",\n            \"description\": \"Identifies this sequence for playback by a \\\"sequence\\\" event.\",\n            \"maximum\": 65535\n          },\n          \"url\": {\n            \"type\": \"string\",\n            \"format\": \"uri\",\n            \"description\": \"Canonical location of this sequence. May be an `at://` URI or an `https://` URL to a JSON endpoint.\"\n          },\n          \"name\": {\n            \"type\": \"string\",\n            \"description\": \"Name of the sequence\",\n            \"maxLength\": 1280,\n            \"maxGraphemes\": 640\n          },\n          \"version\": {\n            \"type\": \"integer\",\n            \"description\": \"Version number for the byte array encoding of the events field.\"\n          },\n          \"events\": {\n            \"type\": \"bytes\",\n            \"description\": \"Serialised and binary encoded array of events of the form `[beat, type, data...]`, where `data` parameters depend on `type` and the byte layout of the serialised data conforms to the Sequence spec at https://github.com/soundio/sequence.\",\n            \"maxLength\": 524288\n          },\n          \"sequences\": {\n            \"type\": \"array\",\n            \"description\": \"A collection of sequences that may be played back by \\\"sequence\\\" events.\",\n            \"items\": {\n              \"type\": \"ref\",\n              \"ref\": \"io.sound.sequence\"\n            }\n          },\n          \"credits\": {\n            \"type\": \"array\",\n            \"description\": \"Attribution for composers, arrangers, etc\",\n            \"maxLength\": 60,\n            \"items\": {\n              \"type\": \"ref\",\n              \"ref\": \"io.sound.credit\"\n            }\n          },\n          \"bskyPostRef\": {\n            \"type\": \"ref\",\n            \"ref\": \"com.atproto.repo.strongRef\",\n            \"description\": \"Strong reference to a Bluesky post. Useful to keep track of comments off-platform.\"\n          },\n          \"publishedAt\": {\n            \"type\": \"string\",\n            \"format\": \"datetime\",\n            \"description\": \"Timestamp of the time of publication.\"\n          },\n          \"updatedAt\": {\n            \"type\": \"string\",\n            \"format\": \"datetime\",\n            \"description\": \"Timestamp of the time of last edit.\"\n          },\n          \"tags\": {\n            \"type\": \"array\",\n            \"description\": \"Array of strings used to tag the sequence.\",\n            \"items\": {\n              \"type\": \"string\",\n              \"maxLength\": 1280,\n              \"maxGraphemes\": 128\n            }\n          }\n        }\n      }\n    }\n  }\n}\n", "{\n  \"$type\": \"com.atproto.lexicon.schema\",\n  \"lexicon\": 1,\n  \"id\": \"io.sound.credit\",\n  \"defs\": {\n    \"main\": {\n      \"type\": \"object\",\n      \"description\": \"Attribution for a creative work\",\n      \"required\": [\"name\", \"role\"],\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"description\": \"Name of the credited person\",\n          \"maxLength\": 640,\n          \"maxGraphemes\": 320\n        },\n        \"role\": {\n          \"type\": \"string\",\n          \"description\": \"Role: composer, lyricist, arranger, etc\",\n          \"maxLength\": 64,\n          \"maxGraphemes\": 32,\n          \"knownValues\": [\"composer\", \"arranger\", \"lyricist\", \"transcriber\", \"orchestrator\", \"adapter\", \"artist\", \"producer\"]\n        },\n        \"url\": {\n          \"type\": \"string\",\n          \"format\": \"uri\",\n          \"description\": \"URL to credited person's profile or website\"\n        }\n      }\n    }\n  }\n}\n", "\nimport id            from 'fn/id.js';\nimport get           from 'fn/get.js';\nimport overload      from 'fn/overload.js';\nimport Sequence      from './sequence.js';\nimport deserialise   from './events/deserialise.js';\nimport serialise     from './events/serialise.js';\nimport ioSoundSequence from '../lexicons/io.sound.sequence.json' with { type: 'json' };\nimport ioSoundCredit   from '../lexicons/io.sound.credit.json' with { type: 'json' };\n\n\nconst assign         = Object.assign;\nconst sequenceSchema = ioSoundSequence.defs.main.record;\nconst creditSchema   = ioSoundCredit.defs.main;\n\n\n// Lexicon validation\n\n// RFC 3339 / ISO 8601 with uppercase T and required timezone\nconst rdatetime = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(Z|[+-]\\d{2}:\\d{2})$/;\n\n// Basic structure check: at://authority[/collection[/rkey]]\nconst raturi = /^at:\\/\\/[^/\\s]+(\\/([\\w.-]+)(\\/[\\w.-]+)?)?$/;\n\n// Handle validation: max 253 chars, specific format\nconst rhandle = /^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/;\n\n// NSID validation: max 317 chars, specific format\nconst rnsid = /^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/;\n\n// Check for disallowed TLDs\nconst disallowedTlds = ['alt', 'arpa', 'example', 'internal', 'invalid', 'local', 'localhost', 'onion'];\n\n// Grapheme counter using Intl.Segmenter\nconst graphemeSegmenter = new Intl.Segmenter(undefined, { granularity: 'grapheme' });\nfunction countGraphemes(str) {\n    return [...graphemeSegmenter.segment(str)].length;\n}\n\n// Byte counter using TextEncoder\nconst textEncoder = new TextEncoder();\nfunction countBytes(str) {\n    return textEncoder.encode(str).byteLength;\n}\n\n// String format validators\nconst validateFormat = overload(id, {\n    datetime: (format, name, value) => {\n        if (!rdatetime.test(value)) throw new Error(`Record \"${ name }\" invalid datetime format \"${ value }\"`);\n        if (value.includes('t') || (value.endsWith('z') && !value.endsWith('Z'))) throw new Error(`Record \"${ name }\" datetime must use uppercase T and Z`);\n    },\n\n    uri: (format, name, value) => {\n        if (countBytes(value) > 8192) throw new Error(`Record \"${ name }\" URI exceeds 8KB maximum`);\n        try { new URL(value); } catch(e) { throw new Error(`Record \"${ name }\" ${ e.message }`); }\n    },\n\n    'at-uri': (format, name, value) => {\n        if (countBytes(value) > 8192) throw new Error(`Record \"${ name }\" AT URI exceeds 8KB maximum`);\n        if (!value.startsWith('at://')) throw new Error(`Record \"${ name }\" AT URI must start with at://`);\n        if (!raturi.test(value)) throw new Error(`Record \"${ name }\" invalid AT URI format`);\n    },\n\n    handle: (format, name, value) => {\n        if (value.length > 253) throw new Error(`Record \"${ name }\" handle exceeds 253 characters`);\n        if (!rhandle.test(value)) throw new Error(`Record \"${ name }\" invalid handle format`);\n\n        // Check for disallowed TLDs\n        const tld = value.split('.').pop().toLowerCase();\n        if (disallowedTlds.includes(tld)) throw new Error(`Record \"${ name }\" handle has disallowed TLD \"${ tld }\"`);\n    },\n\n    nsid: (format, name, value) => {\n        if (value.length > 317) throw new Error(`Record \"${ name }\" NSID \"${ value }\" exceeds 317 characters`);\n        if (!rnsid.test(value)) throw new Error(`Record \"${ name }\" Invalid NSID format \"${ value }\"`);\n    }\n});\n\nconst validateRule = overload(get('type'), {\n    boolean: (rule, name, value) => {\n        if (typeof value !== 'boolean') throw new Error(`Record \"${ name }\" not of type \"boolean\"`);\n        if (rule.const !== undefined && value !== rule.const) throw new Error(`Record \"${ name }\" must be ${ rule.const }`);\n    },\n\n    integer: (rule, name, value) => {\n        if (!Number.isInteger(value)) throw new Error(`Record \"${ name }\" not of type \"integer\" but type \"${ typeof value }\"`);\n        if (rule.minimum !== undefined && value < rule.minimum) throw new Error(`Record \"${ name }\" is ${ value }, minimum ${ rule.minimum }`);\n        if (rule.maximum !== undefined && value > rule.maximum) throw new Error(`Record \"${ name }\" is ${ value }, maximum ${ rule.maximum }`);\n        if (rule.enum && !rule.enum.includes(value)) throw new Error(`Record \"${ name }\" must be one of [${ rule.enum.join(', ') }]`);\n    },\n\n    string: (rule, name, value) => {\n        if (typeof value !== 'string') throw new Error(`Record \"${ name }\" not of type \"string\"`);\n        if (rule.minLength && countBytes(value) < rule.minLength) throw new Error(`Record \"${ name }\" has ${ countBytes(value) } bytes, minimum ${ rule.minLength }`);\n        if (rule.maxLength && countBytes(value) > rule.maxLength) throw new Error(`Record \"${ name }\" has ${ countBytes(value) } bytes, maximum ${ rule.maxLength }`);\n        if (rule.minGraphemes && countGraphemes(value) < rule.minGraphemes) throw new Error(`Record \"${ name }\" has ${ countGraphemes(value) } graphemes, minimum ${ rule.minGraphemes }`);\n        if (rule.maxGraphemes && countGraphemes(value) > rule.maxGraphemes) throw new Error(`Record \"${ name }\" has ${ countGraphemes(value) } graphemes, maximum ${ rule.maxGraphemes }`);\n        if (rule.format) validateFormat(rule.format, name, value);\n    },\n\n    bytes: (rule, name, value) => {\n        if (!(value && typeof value === 'object' && '$bytes' in value)) throw new Error(`Record \"${ name }\" not of type \"bytes\"`);\n        if (typeof value.$bytes !== 'string') throw new Error(`Record \"${ name }\".$bytes must be a string`);\n        const approxBytes = value.$bytes.length * 0.75;\n        if (rule.minLength && approxBytes < rule.minLength) throw new Error(`Record \"${ name }\" has ${ Math.floor(approxBytes) } bytes, minimum ${ rule.minLength }`);\n        if (rule.maxLength && approxBytes > rule.maxLength) throw new Error(`Record \"${ name }\" has ${ Math.floor(approxBytes) } bytes, maximum ${ rule.maxLength }`);\n    },\n\n    array: (rule, name, value) => {\n        if (!Array.isArray(value)) throw new Error(`Record \"${ name }\" not of type \"array\"`);\n        if (rule.minLength && value.length < rule.minLength) throw new Error(`Record \"${ name }\" has ${ value.length } items, minimum ${ rule.minLength }`);\n        if (rule.maxLength && value.length > rule.maxLength) throw new Error(`Record \"${ name }\" has ${ value.length } items, maximum ${ rule.maxLength }`);\n        if (rule.items) value.forEach((item, index) => {\n            validateRule(rule.items, `${ name }[${ index }]`, item);\n        });\n    },\n\n    object: (rule, name, value) => {\n        if (typeof value !== 'object' || value === null || Array.isArray(value)) throw new Error(`Record \"${ name }\" not of type \"object\"`);\n        validateObject(rule, value);\n    },\n\n    ref: (rule, name, value) => {\n        switch (rule.ref) {\n            case 'io.sound.sequence': validateObject(sequenceSchema, value); break;\n            case 'io.sound.credit':   validateObject(creditSchema, value); break;\n            default: console.log(`External schema ref ${ rule.ref } not validated`);\n        }\n    }\n});\n\nfunction validateRequired(required = [], data) {\n    let name;\n    for (name of required) if (!(name in data)) {\n        throw new Error(`Record missing required \"${ name }\" property`);\n    }\n}\n\nfunction validateObject(schema, data) {\n    const { type, required, properties } = schema;\n    if (type !== 'object') throw new Error(`Attempting to validate object with schema of type \"${ type }\"`);\n\n    validateRequired(required, data);\n\n    let name, rule;\n    for (name in data) {\n        // Skip properties with no validation rule\n        if (!(name in properties)) continue;\n        rule = properties[name];\n        validateRule(rule, name, data[name]);\n    }\n}\n\n\n/**\nVERSION\n**/\n\nexport const VERSION = 0;\n\n\n/**\nvalidateRecord(record)\nValidates an 'io.sound.sequence' record.\n**/\n\nexport function validateRecord(record) {\n    return validateObject(sequenceSchema, record);\n}\n\n\n/**\ntoRecord(sequence)\nCreates an ATProto record object that conforms to the io.sound.sequence\nlexicon.\n**/\n\nexport function toRecord(sequence) {\n    const { events, sequences, ...record } = sequence;\n\n    // Create record object from sequence\n    assign(record, {\n        version: VERSION,\n        events: { $bytes: serialise(events).toBase64() }\n    });\n\n    // Validate against schema\n    validateRecord(record);\n\n    // Assign sequences property if it exists\n    if (sequences) record.sequences = sequences.map(toRecord);\n\n    return record;\n}\n\n\n/**\nfromRecord(record)\nCreates a Sequence from an ATProto record object conforming to the\nio.sound.sequence lexicon.\n**/\n\nexport function fromRecord(record) {\n    const { version, events, sequences, ...props } = record;\n    if (version !== VERSION) throw new Error(`Cannot decode record version ${ version } with decoder version ${ VERSION }`);\n    const bytes = Uint8Array.fromBase64(events.$bytes);\n    return assign(new Sequence(deserialise(bytes), sequences), props);\n};\n", "import Event       from './modules/event.js';\nimport Sequence    from './modules/sequence.js';\nimport { toRecord, fromRecord, validateRecord, VERSION } from './modules/record.js';\n\nconst assign = Object.assign;\n\n\n/**\nSequence.version\nVersion number for the revision of the sequence spec this Sequence object\nimplements.\n**/\n\n/**\nSequence.fromRecord(record);\n**/\n\n/**\nSequence.toRecord(sequence);\n**/\n\n// The Sequence() constructor delegates to Sequence.from() to recursively\n// instantiate nested sequences, so Sequence.from() must be overridden to\n// provide deserialisation of nested records' events.\n\nconst fromData = Sequence.from;\n\nSequence.from = function from(data) {\n    return data.events && typeof data.events.$bytes === 'string' ?\n        fromRecord(data) :\n        fromData(data) ;\n};\n\nassign(Sequence, {\n    version: VERSION,\n    toRecord,\n    fromRecord,\n    validateRecord\n});\n\n\n/**\n.toRecord()\n**/\n\nassign(Sequence.prototype, {\n    toRecord: function() {\n        return toRecord(this);\n    }\n});\n\n\nexport { Event, Sequence };\n", "/**\ncacheByKey(fn)\nReturns a function that caches the output values of `fn(input)` against input\nvalues, which are registered as keys in an object, such that for each input\nkey `fn` is only ever called once.\n*/\n\nlet warned;\n\nexport default function cacheByKey(fn) {\n    var map = {};\n\n    return function cache(input) {\n        /*if (window.DEBUG && !warned && input === undefined) {\n            warned = true;\n            console.warn('cacheByKey() called with undefined. Not illegal, but potentially bad.');\n        }\n\n        if (window.DEBUG && typeof input !== 'string' && typeof input !== 'number') {\n            console.warn('cacheByKey() called with non-primitive input, coerced to string \"' + input + '\"');\n        }*/\n\n        if (window.DEBUG && arguments.length > 1) {\n            console.warn('cacheByKey() called with ' + arguments.length + ' arguments. Accepts exactly 1.');\n        }\n\n        return input in map ?\n            map[input] :\n            map[input] = fn(input) ;\n    };\n}\n", "/**\nchoose(map)\nReturns a function that takes its first argument as a key and uses it\nto select a function in `map` which is invoked with the remaining arguments.\n\nWhere `map` has a function `default`, that function is run when a key\nis not found, otherwise unfound keys will error.\n\n```\nvar fn = choose({\n    'fish':  function fn1(a, b) {...},\n    'chips': function fn2(a, b) {...}\n});\n\nfn('fish',  a, b);      // Calls fn1(a, b)\nfn('chips', a, b);      // Calls fn2(a, b)\nfn('mayonnaise', a, b); // Error\n```\n\nIt's worth pointing out that the `this` context is also applied to `fn1` and\n`fn2`, making `choose(map)` suitable for creating object methods.\n*/\n\nexport default function choose(map) {\n    return function choose(key, ...params) {\n        var fn = map[key] || map.default;\n        return fn && fn.apply(this, params) ;\n    };\n}\n", "\nvar mimetypes = {\n    xml:  'application/xml',\n    html: 'text/html',\n    svg:  'image/svg+xml'\n};\n\nexport default function parse(type, string) {\n    if (!string) { return; }\n\n    // Accept 'svg' or 'SVG' or 'image/svg+xml'\n    var mimetype = mimetypes[type.toLowerCase()] || type;\n    var xml;\n\n    // Cludged from jQuery source...\n    try {\n        xml = (new window.DOMParser()).parseFromString(string, mimetype);\n    }\n    catch (e) {\n        return;\n    }\n\n    if (!xml || xml.getElementsByTagName(\"parsererror\").length) {\n        throw new Error(\"Invalid \" + type.toUpperCase() + \": \" + string);\n    }\n\n    return xml;\n}\n\n/**\nparseHTML(string)\nReturns an HTML document parsed from `string`, or undefined.\n*/\n\nexport function parseHTML(string) {\n    return parse('html', string);\n}\n\n/**\nparseSVG(string)\nReturns an SVG document parsed from `string`, or undefined.\n*/\n\nexport function parseSVG(string) {\n    return parse('svg', string);\n}\n\n/**\nparseXML(string)\nReturns an XML document parsed from `string`, or undefined.\n*/\n\nexport function parseXML(string) {\n    return parse('xml', string);\n}\n", "import choose  from 'fn/choose.js';\nimport id      from 'fn/id.js';\n\nimport create  from './create.js';\nimport { parseHTML, parseSVG } from './parse.js';\n\nconst assign = Object.assign;\n\n/*\nconfig\n\n```{\n    headers:    fn(data),    // Must return an object with properties to add to the header\n    body:       fn(data),    // Must return an object to send as data\n    onresponse: function(response)\n}```\n*/\n\nexport const config = {\n    // Takes data, returns headers\n    headers: function(data) { return {}; },\n\n    // Takes data (can be FormData object or plain object), returns data\n    body: id,\n\n    // Takes response, returns response\n    /*onresponse: function(response) {\n        // If redirected, navigate the browser away from here. Can get\n        // annoying when receiving 404s, maybe not a good default...\n        if (response.redirected) {\n            window.location = response.url;\n            return;\n        }\n\n        return response;\n    }*/\n};\n\nconst createHeaders = choose({\n    'application/x-www-form-urlencoded': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'application/x-www-form-urlencoded',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'application/json': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": \"application/json; charset=utf-8\",\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'multipart/form-data': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'multipart/form-data',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'audio/wav': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'audio/wav',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'image/png': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'image/png',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'image/jpg': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'image/jpg',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'image/jpeg': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'image/jpeg',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    },\n\n    'default': function(headers) {\n        return assign(headers, {\n            \"Content-Type\": 'application/x-www-form-urlencoded',\n            \"X-Requested-With\": \"XMLHttpRequest\"\n        });\n    }\n});\n\nconst createBody = choose({\n    'application/json': function(data) {\n        return data instanceof FormData ?\n            formDataToJSON(data) :\n            JSON.stringify(data);\n    },\n\n    'application/x-www-form-urlencoded': function(data) {\n        return data instanceof FormData ?\n            formDataToQuery(data) :\n            dataToQuery(data) ;\n    },\n\n    'multipart/form-data': function(data) {\n        return data instanceof FormData ?\n            data :\n            dataToFormData(data) ;\n    },\n\n    default: id\n});\n\nfunction formDataToJSON(formData) {\n    return JSON.stringify(\n        // formData.entries() is an iterator, not an array\n        Array\n        .from(formData.entries())\n        .reduce(function(output, entry) {\n            output[entry[0]] = entry[1];\n            return output;\n        }, {})\n    );\n}\n\nfunction formDataToQuery(data) {\n    return new URLSearchParams(data).toString();\n}\n\nfunction dataToQuery(data) {\n    return Object.keys(data).reduce((params, key) => {\n        params.append(key, data[key]);\n        return params;\n    }, new URLSearchParams());\n}\n\nfunction dataToFormData(data) {\n    throw new Error('TODO: dataToFormData(data)');\n}\n\nfunction urlFromData(url, data) {\n    // Form data\n    return data instanceof FormData ?\n        url + '?' + formDataToQuery(data) :\n        url + '?' + dataToQuery(data) ;\n}\n\nexport function createOptions(method, data, head, controller) {\n    const contentType =\n        typeof head === 'string' ? head :\n        head && head['Content-Type'] ||\n        'application/json' ;\n\n    const headers = createHeaders(contentType, assign(\n        config.headers && data ? config.headers(data) : {},\n        typeof head === 'string' ? {} : head\n    ));\n\n    const options = {\n        method:  method,\n        mode: \"cors\",\n        headers: headers,\n        credentials: 'same-origin',\n        signal: controller && controller.signal\n    };\n\n    if (method !== 'GET') {\n        options.body = createBody(contentType, config.body ? config.body(data) : data);\n    }\n\n    return options;\n}\n\nfunction respondBlob(response) {\n    return response.blob();\n}\n\nfunction respondJSON(response) {\n    return response.json().catch((e) => {\n        throw new Error('Cannot parse JSON ' + response.url + '. ' + e.message + '');\n    });\n}\n\nfunction respondForm(response) {\n    return response.formData();\n}\n\nfunction respondText(response) {\n    return response.text();\n}\n\nfunction respondDOM(response) {\n    return response.text().then((text) => (\n        // Is it a document?\n        /^\\s*<!DOCTYPE html>/.test(text) ?\n            parseHTML(text) :\n            create('fragment', text)\n    ));\n}\n\nfunction respondSVG(response) {\n    return response.text().then((text) => (\n        // Is it a document?\n        /^\\s*<\\?xml/.test(text) ?\n            parseSVG(text) :\n            // TODO: untested, don't know if this works on partial SVG\n            // fragments, I think probably not, I think we need to maybe\n            // make a <defs> instead. You have been warned.\n            (console.warn('Untested SVG fragment parsing in request.js!'),\n            create('fragment', text))\n    ));\n}\n\nconst responders = {\n    'text/plain':                        respondText,\n    'text/html':                         respondDOM,\n    'image/svg+xml':                     respondSVG,\n    'application/json':                  respondJSON,\n    'multipart/form-data':               respondForm,\n    'application/x-www-form-urlencoded': respondForm,\n    'audio':                             respondBlob,\n    'audio/wav':                         respondBlob,\n    'audio/m4a':                         respondBlob,\n    'application/zip':                   respondBlob\n};\n\nfunction respond(response) {\n    if (config.onresponse) {\n        response = config.onresponse(response);\n    }\n\n    if (!response.ok) {\n        throw new Error(response.statusText + '');\n    }\n\n    // Get mimetype from Content-Type, remembering to hoik off any\n    // parameters first\n    const contentType = response.headers.get('Content-Type');\n\n    if(!contentType) { return; }\n    const mimetype = contentType.replace(/\\;.*$/, '');\n\n    if (window.DEBUG && !responders[mimetype]) {\n        console.warn('request() has no built-in response parser for mimetype \"' + mimetype + '\"');\n    }\n\n    return responders[mimetype](response);\n}\n\n\n/**\nrequest(method, url, data, mimetype | headers)\n\nUses `fetch()` to send a request to `url`. Where `type` is `\"GET\"`, `data` is\nserialised and appended to the URL, otherwise it is sent as a request body.\nThe 4th parameter may be a content type string or a headers object (in which\ncase it must have a `'Content-Type'` property).\n**/\n\nexport default function request(method = 'GET', url, data = {}, contenttype = 'application/json') {\n    method = method.toUpperCase();\n\n    // If this is a GET and there is data, append data to the URL query string\n    if (method === 'GET' && data) {\n        url = urlFromData(url, data);\n    }\n\n    // param[4] is an optional abort controller\n    const options = createOptions(method, data, contenttype, arguments[4]);\n\n    return fetch(url, options).then(respond);\n}\n\n/**\nrequestGet(url)\nA shortcut for `request('get', url, null, 'application/json')`\n**/\n\nexport function requestGet(url) {\n    return request('GET', url);\n}\n\n/**\nrequestPatch(url, data)\nA shortcut for `request('patch', url, data, 'application/json')`\n**/\n\nexport function requestPatch(url, data) {\n    return request('PATCH', url, data, 'application/json');\n}\n\n/**\nrequestPost(url, data)\nA shortcut for `request('post', url, data, 'application/json')`\n**/\n\nexport function requestPost(url, data) {\n    return request('POST', url, data, 'application/json');\n}\n\n/**\nrequestDelete(url, data)\nA shortcut for `request('delete', url, data, 'application/json')`\n**/\n\nexport function requestDelete(url, data) {\n    return request('DELETE', url, data, 'application/json');\n}\n\n// Expose to console in DEBUG mode\nif (window.DEBUG) {\n\twindow.dom ? (window.dom.request = request) : (window.dom = { request });\n}\n", "const lengths = {\n    /* Length of data following 'type' */\n    chord: 3, /* chord duration, not used, chords can be either 2 or 3 long */\n    note:  3, /* pitch gain duration */\n    key:   1, /* A-G */\n    meter: 2, /* duration division */\n    rate:  1, /* rate */\n    lyric: 2, /* string, duration */\n};\n\nconst rnote = /^[ABCDEFG][b♭#♯]{0,1}-?\\d$/;\nconst rroot = /^[ABCDEFG][b♭#♯]{0,1}/;\n\n\nexport default function parseSequenceText(source) {\n    const data   = source.trim().split(/\\s+/);\n    const events = [];\n\n    let n = -1;\n    while (data[++n] !== undefined) {\n        let time  = Number(data[n]);\n        let type  = data[++n];\n\n        // Automatically detect type. If type has been omitted, it will match\n        // a value for note pitch or chord. Set type, rewind n.\n        if (rnote.test(type)) {\n            type = 'note';\n            --n;\n        }\n        else if (rroot.test(type)) {\n            type = 'chord';\n            --n;\n        }\n\n        let event = [time, type];\n        let m = lengths[type];\n        if (m === undefined) {\n            throw new TypeError('Unrecognised type \"' + type + '\" in sequence data');\n        }\n\n        if (type === 'chord') {\n            // Detect and parse chord root/extension written as one\n            // parameter \"C7\" or as two \"C\", \"7\"\n            let root      = rroot.exec(data[++n])[0];\n            let extension = data[n].slice(root.length) || data[++n];\n            let duration  = Number(data[++n]);\n            event.push(root, extension, duration);\n        }\n        else {\n            // Push values into event, converting to number where possible\n            while (m--) {\n                let value = Number(data[++n]);\n                event.push(Number.isNaN(value) ? data[n] : value);\n            }\n        }\n\n        events.push(event);\n    }\n\n    return events;\n}\n", "\n//import parseABC          from './parse/parse-abc.js';\nimport parseSequenceText from './parse/parse-sequence-text.js';\n\n\n/* Parse data\n  (TODO: Yeah, API requests need tidied up) */\n\nfunction fromGist(gist) {\n    // Get first file\n    const file = gist.files[Object.keys(gist.files)[0]];\n    return parseSource(file.type, file.content);\n}\n\nfunction fromTheSession(object) {\n    // Get first file\n    const song = object.settings.find(matches({ id: 13324 })) || object.settings[0];\n    return parseSource('abc', song.abc);\n}\n\nexport default function parseSource(type, source) {\n    // source is an object\n    if (typeof source === 'object') {\n        // source is json from api.github.com/gists/\n        return source.files ? fromGist(source) :\n        // source is from thesession.org\n        source.settings ? fromTheSession() :\n        // source is an events array\n        Array.isArray(source) ? { id: 0, events: source } :\n        // source is a sequence object\n        source ;\n    }\n    // Data is ABC\n/*\n    else if (type === 'abc' || type === 'text/x-abc') {\n        // Strip space following line breaks\n        const music = parseABC(source.replace(/\\n\\s+/g, '\\n'));\n        return music.sequences[0];\n    }\n*/\n    // Data is step sequence text\n    else if (type === 'sequence' || type === 'text/plain') {\n        return { events: parseSequenceText(source) };\n    }\n    // Data is JSON\n    else {\n        const events = JSON.parse(source);\n        return Array.isArray(events) ?\n            { id: 0, events } :\n            events ;\n    }\n}\n", "\nimport cache          from 'fn/cache-by-key.js';\nimport overload       from 'fn/overload.js';\nimport { requestGet } from 'dom/request.js';\nimport parse          from './parse.js';\n\nconst requestData = cache(requestGet);\nconst rpath       = /^\\.*\\/|^https?:\\/\\//;\n\n/**\nrequestData(type, url)\n**/\n\nexport default overload((type, value) => typeof value, {\n    string: function(type, url) {\n        if (window.DEBUG && !rpath.test(url)) {\n            throw new TypeError('URL not supported \"' + url + '\"');\n        }\n\n        return requestData(url)\n        .then((source) => parse(type, source))\n        .catch((error) => console.error(error));\n    },\n\n    default: function(name, internals, type, value) {\n        internals[name] = value;\n    }\n});\n", "\nconst rtimesig = /^(\\d+)\\/(\\d+)$/;\n\nexport function timesigToMeter(string) {\n    const groups = rtimesig.exec(string);\n    const num = parseInt(groups[1], 10);\n    const div = 4 / parseInt(groups[2], 10);\n    // Returns an object that can be assigned to a meter event\n    return { 1: 'meter', 2: num * div, 3: div };\n}\n\nexport function meterToTimesig(meter) {\n    const dur = meter[2];\n    const div = meter[3];\n    const num = dur / div;\n    const den = 4 / div;\n    return num + '/' + den;\n}\n", "\nexport const clefTreble      = '&#xE050;';\nexport const clefTrebleDown  = '&#xE052;';\nexport const clefTrebleUp    = '&#xE053;';\nexport const clefAlto        = '&#xE05C;';\nexport const clefBass        = '&#xE062;';\nexport const clefDrum        = '&#xE069;';\n\nexport const timeSig0         = '&#xE080;';\nexport const timeSig1         = '&#xE081;';\nexport const timeSig2         = '&#xE082;';\nexport const timeSig3         = '&#xE083;';\nexport const timeSig4         = '&#xE084;';\nexport const timeSig5         = '&#xE085;';\nexport const timeSig6         = '&#xE086;';\nexport const timeSig7         = '&#xE087;';\nexport const timeSig8         = '&#xE088;';\nexport const timeSig9         = '&#xE089;';\nexport const timeSigCommon    = '&#xE08A;';\nexport const timeSigCutCommon = '&#xE08B;';\n\nexport const acciDoubleFlat  = '&#xE264;';\nexport const acciFlat        = '&#xE260;';\nexport const acciNatural     = '&#xE261;';\nexport const acciSharp       = '&#xE262;';\nexport const acciDoubleSharp = '&#xE263;';\nexport const acciParensLeft  = '&#xE26A;';\nexport const acciParensRight = '&#xE26B;';\n\n// https://w3c.github.io/smufl/latest/tables/noteheads.html\nexport const head1                   = '&#xE0A4;';\nexport const head2                   = '&#xE0A3;';\nexport const head4                   = '&#xE0A2;';\nexport const headBracketLeft         = '&#xE0F5;';\nexport const headBracketRight        = '&#xE0F6;';\nexport const headSlashed2            = '&#xE0D0;';\nexport const headDiamond             = '&#xE0DB;';\nexport const headDiamondWide         = '&#xE0DC;';\nexport const headX                   = '&#xE0A9;';\nexport const headPlus                = '&#xE0AF;';\nexport const headCircle              = '&#xE0E8;';\nexport const headCircleX             = '&#xE0B3;';\nexport const headTriangleUp          = '&#xE0BE;';\nexport const headSlashVerticalEnds   = '&#xE100;';\nexport const headSlashHorizontalEnds = '&#xE101;';\n\n// https://w3c.github.io/smufl/latest/tables/individual-notes.html\nexport const note2Up      = '&#xE1D3;';\nexport const note1Up      = '&#xE1D5;';\nexport const note05Up     = '&#xE1D7;';\nexport const note025Up    = '&#xE1D9;';\nexport const note0125Up   = '&#xE1DB;';\nexport const note2Down    = '&#xE1D4;';\nexport const note1Down    = '&#xE1D6;';\nexport const note05Down   = '&#xE1D8;';\nexport const note025Down  = '&#xE1DA;';\nexport const note0125Down = '&#xE1DC;';\nexport const augmentationDot = '&#xE1E7;';\n\nexport const accentUp     = '&#xE4A0;';\nexport const accentDown   = '&#xE4A1;';\nexport const staccatoUp   = '&#xE4A2;';\nexport const staccatoDown = '&#xE4A3;';\nexport const tenutoUp     = '&#xE4A4;';\nexport const tenutoDown   = '&#xE4A5;';\nexport const marcatoUp    = '&#xE4AC;';\nexport const marcatoDown  = '&#xE4AD;';\n\n// https://w3c.github.io/smufl/latest/tables/metronome-marks.html\nexport const metNote2Up    = '&#xECA3;';\nexport const metNote1Up    = '&#xECA5;';\nexport const metNote05Up   = '&#xECA7;';\nexport const metNote2Down  = '&#xECA4;';\nexport const metNote1Down  = '&#xECA6;';\nexport const metNote05Down = '&#xECA8;';\nexport const metDot        = '&#xECB7;';\n\nexport const graceNoteStemUp   = '&#xE560;';\nexport const graceNoteStemDown = '&#xE561;';\n\nexport const tailUp05     = '&#xE240;'\nexport const tailDown05   = '&#xE241;'\nexport const tailUp025    = '&#xE242;'\nexport const tailDown025  = '&#xE243;'\nexport const tailUp0125   = '&#xE244;'\nexport const tailDown0125 = '&#xE245;'\n\n// 200A is a unicode HAIR SPACE, it's needed to seperate rest from dot in Jazz.\n// TODO: do other fonts need it tho?\nexport const rest0125  = '&#xE4E8;';\nexport const rest01875 = '&#xE4E8;&#xE1E7;';\nexport const rest025   = '&#xE4E7;';\nexport const rest0375  = '&#xE4E7;&#xE1E7;';\nexport const rest05    = '&#xE4E6;';\nexport const rest075   = '&#xE4E6;&#xE1E7;';\nexport const rest1     = '&#xE4E5;';\nexport const rest15    = '&#xE4E5;&#x200A;&#xE1E7;';\nexport const rest2     = '&#xE4E4;';\nexport const rest3     = '&#xE4E4;&#x200A;&#xE1E7;';\nexport const rest4     = '&#xE4E3;';\nexport const rest6     = '&#xE4E3;&#x200A;&#xE1E7;';\n\n// These are only supported in Bravura, Petaluma font...\n/*export const braceBegin = '&#xE000';\nexport const braceEnd   = '&#xE001';\nexport const bracket    = '&#xE002';\nexport const bracketTop       = '&#xE003';\nexport const bracketBottom    = '&#xE004';\nexport const bracketEndTop    = '&#xE005';\nexport const bracketEndBottom = '&#xE006';*/\n\nexport const barLine    = '&#xE030';\nexport const barRepeat1 = '&#xE500;';\nexport const barRepeat2 = '&#xE501;';\nexport const barRepeat4 = '&#xE502;';\nexport const barRepeatSlash = '&#xE504;';\nexport const barRepeatUpperDot = '&#xE503;';\nexport const barRepeatLowerDot = '&#xE505;';\n\n// These are only supported in Bravura, Leipzig, Petaluma...\n/*export const barLineDouble = '&#xE031';\nexport const barLineEnd    = '&#xE032';\nexport const barLineBegin  = '&#xE033';\nexport const barLineHeavy  = '&#xE034';*/\n// Not supported by Ash, Broadway, use a fallback font with support\nexport const barRepeatBegin = '&#xE040';\nexport const barRepeatEnd   = '&#xE041';\nexport const barRepeatEndBegin = '&#xE042';\nexport const barRepeatDots = '&#xE043';\n\nexport const coda = '&#xE048';\n\nexport const tuplet0   = '&#xE880;';\nexport const tuplet1   = '&#xE881;';\nexport const tuplet2   = '&#xE882;';\nexport const tuplet3   = '&#xE883;';\nexport const tuplet4   = '&#xE884;';\nexport const tuplet5   = '&#xE885;';\nexport const tuplet6   = '&#xE886;';\nexport const tuplet7   = '&#xE887;';\nexport const tuplet8   = '&#xE888;';\nexport const tuplet9   = '&#xE889;';\n\n// Not supported by any font\n/*export const beamBegin   = '&#xE8E0;';\nexport const beamEnd     = '&#xE8E1;';\nexport const tieBegin    = '&#xE8E2;';\nexport const tieEnd      = '&#xE8E3;';\nexport const slurBegin   = '&#xE8E4;';\nexport const slurEnd     = '&#xE8E5;';\nexport const phraseBegin = '&#xE8E6;';\nexport const phraseEnd   = '&#xE8E7;';*/\n\nexport const chordDiminished      = '&#xE870;';\n// Not supported in Jazz, Ash, Broadway, Leipzig\n/*export const chordDiminishedSmall = '&#xF4D8;';*/\nexport const chordHalfDiminished  = '&#xE871;';\nexport const chordAugmented       = '&#xE872;';\nexport const chordMajorSeventh    = '&#xE873;';\nexport const chordMinor           = '&#xE874;';\nexport const chordParensLeftTall  = '&#xE875;';\nexport const chordParensRightTall = '&#xE876;';\nexport const chordBracketLeft     = '(';\nexport const chordBracketRight    = ')';\nexport const chordBassSlash       = '&#xE87B;';\n\nexport const chordGlyphs = {\n    \"∆♯11\": \"\\uE873\\uED6211\",\n    \"∆\": \"\\uE873\",\n    \"7\": \"7\",\n    \"-7\": \"\\uE8747\",\n    \"-♭6\": \"\\uE874\\uED606\",\n    \"7sus♭9\": \"7sus\\uED62\",\n    \"ø\": \"\\uE871\",\n    \"7♯11\": \"7\\uED6211\",\n    \"-∆\": \"\\uE874\\uE873\",\n    \"∆♭6\": \"\\uE873\\uED606\",\n    \"-♭9\": \"\\uE874\\uED609\",\n    \"ø7\": \"\\uE8717\",\n    \"∆♯5\": \"\\uE873\\uED625\",\n    \"7alt\": \"7alt\",\n    \"°\": \"\\uE870\",\n    \"dim\": \"\\uE870\",\n    \"7♭9\": \"7\\uED60\",\n    \"+7\": \"\\uE8727\",\n};\n\n/* These glyphs are not aligned to centted baseline as other musical symbols\n   are - these are intended for use in paragraph text content */\n\nexport const textNoteShort        = '&#xE1F0;';\nexport const textNoteLong         = '&#xE1F1;';\nexport const textNote8Short       = '&#xE1F2;';\nexport const textNote8Long        = '&#xE1F3;';\nexport const textNote16Short      = '&#xE1F4;';\nexport const textNote16Long       = '&#xE1F5;';\nexport const textBeam8Short       = '&#xE1F7;';\nexport const textBeam8Long        = '&#xE1F8;';\nexport const textBeam16Short      = '&#xE1F9;';\nexport const textBeam16Long       = '&#xE1FA;';\nexport const textDot              = '&#xE1FC;';\nexport const textTie              = '&#xE1FD;';\nexport const textTupletBeginShort = '&#xE1FE';\nexport const textTuplet3Short     = '&#xE1FF';\nexport const textTupletEndShort   = '&#xE200';\nexport const textTupletBeginLong  = '&#xE201';\nexport const textTuplet3Long      = '&#xE202';\nexport const textTupletEndLong    = '&#xE203';\n\n\n\n", "/**\narg(n)\n\nReturns a function that returns `argument[n]`.\n\n```js\n```\n**/\n\nexport default function arg(n) {\n    return function arg() {\n        return arguments[n];\n    };\n}\n", "/**\nself()\nReturns `this`.\n*/\n\nexport default function self() { return this; }\n", "\n/**\nnothing\nA frozen array-like and stream-like object that contains no value.\n**/\n\nimport arg  from './arg.js';\nimport id   from './id.js';\nimport noop from './noop.js';\nimport self from './self.js';\n\nconst create = Object.create;\nconst freeze = Object.freeze;\n\nexport default freeze(create(create(Object.prototype, {\n    // Array methods\n    at:        { value: noop },\n    shift:     { value: noop },\n    push:      { value: noop },\n    forEach:   { value: noop },\n    join:      { value: function() { return ''; } },\n    every:     { value: function() { return true; } },\n    filter:    { value: self },\n    find:      { value: noop },\n    findIndex: { value: function() { return -1; } },\n    flat:      { value: self },\n    flatMap:   { value: self },\n    includes:  { value: function() { return false; } },\n    indexOf:   { value: function() { return -1; } },\n    map:       { value: self },\n    reduce:    { value: arg(1) },\n    sort:      { value: self },\n\n   // Stream methods\n    each:      { value: self },\n    pipe:      { value: id },\n    start:     { value: self },\n    stop:      { value: self },\n    done:      { value: self },\n\n    // Primitive coercion\n    valueOf:   { value: function() { return null; } }\n}), {\n    length: { value: 0 }\n}));\n", "\nimport mod from 'fn/mod.js';\n\n/* mod12()\nFinds the modulus `n % 12`, but using floored division (the JS operator uses\neuclidean division).\n*/\n\nexport default function mod12(n) {\n    return mod(12, n);\n}\n", "\nimport get      from 'fn/get.js';\nimport overload from 'fn/overload.js';\n\nexport default overload(get(1), {\n    chord:    (event) => event[4],\n    lyric:    (event) => event[3],\n    note:     (event) => event[4],\n    sequence: (event) => event[4],\n    // Return 0 duration as default\n    default:  (event) => 0\n});\n", "\nimport toDuration from './to-duration.js';\n\nexport default function toStopBeat(event) {\n    return event[0] + toDuration(event);\n}\n", "\nexport const major = Uint8Array.of(0,2,4,5,7,9,11);\n", "\nimport cache                     from 'fn/cache.js';\nimport overload                  from 'fn/overload.js';\nimport { toNoteNumber, toRootNumber, toRootName } from 'midi/note.js';\nimport { isChordEvent, isNoteEvent } from 'sequence/modules/event.js';\nimport { keyToRootNumber, rootToKeyNumber } from 'sequence/modules/event/keys.js';\nimport { hsidToNumbers }         from 'sequence/modules/event/hsid.js';\nimport { toHSID }                from 'sequence/modules/event/chords.js';\nimport toStopBeat                from './event/to-stop-beat.js';\nimport mod12                     from './number/mod-12.js';\nimport { major }                 from './scale.js';\n\n\nconst { abs } = Math;\n\nconst degreeWeights = Float32Array.of(\n//  Root b9   9    min3 maj3 11   #11  5    b6   13   7    maj7\n    1,   0.9, 0.8, 1,   1,   0.8, 0.8, 1,   0.9, 1,   1,   1\n);\n\nconst modulationWeights = [\n    // Influence of ...\n    // Cycle of  Minor   Major\n    // fourths   thirds  thirds\n    1,                          // Root\n    (1/6       + 0     + 0),    // b9\n    (4/6       + 0     + 0),    // 9\n    (3/6       + 1/9   + 0),    // min3\n    (2/6       + 0     + 1/5),  // maj3\n    (5/6       + 0     + 0),    // 11\n    (0         + 1/11  + 0),    // #11\n    (5/6       + 0     + 0),    // 5\n    (2/6       + 0     + 1/5),  // b6\n    (3/6       + 1/8   + 0),    // 13\n    (4/6       + 0     + 0),    // 7\n    (1/6       + 0     + 0)     // maj7\n];\n\nconst factors = {\n    3: [10/16, 13/16, 10/16],\n    4: [10/16, 13/16, 10/16, 12/16]\n};\n\n\nexport const keyToNumbers = cache((key) => {\n    const root = keyToRootNumber(key);\n    return major\n    .map((n) => mod12(n + root))\n    .sort();\n});\n\nfunction keysContainingNote(number) {\n    const keys = new Float32Array(12);\n    let n = toRootNumber(number + 2);\n    let i = 7;\n    while (i--) {\n        n = toRootNumber(n + 5);\n        keys[n] = 1;\n    }\n    return keys;\n}\n\nfunction multiplyWeights(weights1, weights2, factor) {\n//const a = Array.from(weights1, (weight) => weight === 0 ? '     ' : weight.toFixed(3)).join(' ');\n\n    let n = weights1.length;\n    while (n--) weights1[n] *= (1 - factor) + factor * weights2[n];\n/*\nconsole.log('x weights', factor, '\\n'\n    + Array.from({ length: 12 }, (n, i) => (toRootName(i) + '       ').slice(0, 5)).join(' ') + '\\n'\n    + a + '\\n'\n    + Array.from(weights2, (weight) => weight === 0 ? '     ' : weight.toFixed(3)).join(' ') + '\\n'\n    + Array.from(weights1, (weight) => weight === 0 ? '     ' : weight.toFixed(3)).join(' ')\n);\n*/\n    return weights1;\n}\n\nconst types = {\n    note: (weights, event, influence = 1) => {\n        const number = toNoteNumber(event[2]);\n        const probs  = keysContainingNote(number);\n\n        return multiplyWeights(weights, probs, influence\n            // Weight bass notes more importantly than treble notes\n            * (1 - number / 192)\n        );\n    },\n\n    chord: (weights, event, influence = 1) => {\n        const r       = toRootNumber(event[2]);\n        const numbers = hsidToNumbers(event[3]);\n\n        let n = numbers.length, probs;\n        while (n--) {\n            probs = keysContainingNote(r + numbers[n]);\n            multiplyWeights(weights, probs, (influence / numbers.length)\n                // Weight notes based on chord degree\n                * degreeWeights[numbers[n]]\n            );\n        }\n\n        return weights;\n    }\n}\n\nexport function keyWeightsForEvent(events, n, key = 0) {\n    let event = events[n];\n\n    const KEYROOT = keyToRootNumber(key);\n    const beat    = event[0];\n    const weights =\n        isNoteEvent(event)  ? keysContainingNote(toNoteNumber(event[2])) :\n        isChordEvent(event) ? types.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1), event) :\n        0 ;\n\n    // Weight by influence of current key\n    if (KEYROOT !== undefined) {\n        const probs = Float32Array.from({ length: 12 }, (n, i) => modulationWeights[(i + 12 - KEYROOT) % 12]);\n        multiplyWeights(weights, probs, 0.3);\n    }\n\n    // Weight by influence of surrounding events\n    let m = n;\n    while (event = events[--m]) {\n        const fn = types[event[1]];\n        if (!fn) continue;\n\n        const stopBeat = toStopBeat(event);\n\n        // Events that are playing concurrently\n        if (stopBeat > beat) {\n//console.log('STOPBEAT', event[1]);\n            // Fairly influential 0.5\n            fn(weights, event, 0.5);\n        }\n        // Notes that recently stopped\n        else if (event[1] === 'note' && beat - stopBeat < 3) {\n            if ((1 - (beat - stopBeat) / 3) > 1) throw new Error('Influence should never be > 1 ' + beat + ' ' + stopBeat);\n//console.log('RECENT NOTE', event[2], 0.25 * (1 - (beat - stopBeat) / 3));\n            // Weight by distance from stopBeat to beat\n            fn(weights, event, 0.25 * (1 - (beat - event[0]) / 3));\n        }\n    }\n\n    m = n;\n    // Events in the future\n    while ((event = events[++m]) && event[0] - beat < 2) {\n        if (!isNoteEvent(event)) continue;\n\n        const fn = types[event[1]];\n        if (!fn) continue;\n        if ((1 - (event[0] - beat) / 2) > 1) throw new Error('Influence should never be > 1 ' + beat + ' ' + stopBeat);\n//console.log('FUTURE NOTE', event[2], 0.3 * (1 - (event[0] - beat) / 2));\n        // Weight by distance to startBeat from beat\n        fn(weights, event, 0.3 * (1 - (event[0] - beat) / 2));\n    }\n\n    return weights;\n}\n\n\n// Order search from keys with more accidentals to fewer accidentals so that if\n// we see two keys weighted the same we end up with the one with fewer accidentals\nconst order = [0,7,5,2,10,9,3,4,8,11,1,6];\n\nconst keys  = [0,-5,2,-3,4,-1,6,1,-4,3,-2,5];\n\nexport function chooseKeyFromWeights(weights) {\n    let n = order.length;\n    let value = 0, root;\n    while(n--) if (weights[order[n]] > value) {\n        value = weights[order[n]];\n        root  = order[n];\n    }\n    return keys[root];\n}\n", "\n\nexport const rrootname    = /^([A-G])([b#♭♯𝄫𝄪])?/;\nexport const rpitch       = /^([A-G])([b#♭♯𝄫𝄪])?(-?\\d)?$/;\nexport const rflat        = /b|♭/;\nexport const rsharp       = /#|♯/;\nexport const rdoubleflat  = /bb|𝄫/;\nexport const rdoublesharp = /##|𝄪/;\nexport const rflatsharp   = /b|♭|#|♯/g;\nexport const raccidental  = /(♮)|(bb|𝄫)|(##|𝄪)|(b|♭)|(#|♯)/g;\n\nexport const accidentalChars = {\n    '-2': '𝄫',\n    '-1': '♭',\n    '0':  '',\n    '1':  '♯',\n    '2':  '𝄪'\n};\n\nconst fathercharles = [\n    // Father Charles Goes Down And Ends Battle,\n    'F♯', 'C♯', 'G♯', 'D♯', 'A♯', 'E♯', 'B♯',\n    // Battle Ends And Down Goes Charles Father\n    'B♭', 'E♭', 'A♭', 'D♭', 'G♭', 'C♭', 'F♭'\n];\n\nexport function byFatherCharlesPitch(a, b) {\n    const ai = fathercharles.indexOf(a.pitch);\n    const bi = fathercharles.indexOf(b.pitch);\n    return ai > bi ? 1 : ai < bi ? -1 : 0;\n}\n", "import parseGain from 'sequence/modules/parse/parse-gain.js';\n\nexport default {\n    // Spelling\n    spellChordRootCFlatAsB:  true,\n    spellChordRootBSharpAsC: true,\n    spellChordRootESharpAsF: true,\n    spellChordRootFFlatAsE:  true,\n\n    // Swing and shuffle interpretation\n    swingAsStraight8ths:  true,\n    swingAsStraight16ths: true,\n\n    // Accent thresholds\n    marcatoThreshold: parseGain('-6dB'),\n    accentThreshold:  parseGain('-12dB'),\n    ghostThreshold:   parseGain('-30dB'),\n\n    // Allowed head durations\n    headDurations: [\n        1/8, 6/32, /*7/32,*/\n        1/4, 6/16, /*7/16,*/\n        1/2, 6/8,  /*7/8, */\n        1,   6/4,  /*7/4, */\n        2,   6/2,  /*7/2, */\n        4,   6,    /*7,   */\n        8\n    ],\n\n    // Allowed rest durations\n    restDurations: [\n        1/8, 6/32, // 7/32,\n        1/4, 6/16, // 7/16,\n        1/2, 6/8,  // 7/8,\n        1,   6/4,  // 7/4,\n        2,   3,    // 7/2\n        4,   6,\n        8\n    ]\n}\n", "\nimport nothing          from 'fn/nothing.js';\nimport { noteNames, toNoteName, toNoteNumber, toNoteOctave, toRootName, toRootNumber } from 'midi/note.js';\nimport { rootToKeyNumber } from 'sequence/modules/event/keys.js';\nimport mod12            from '../number/mod-12.js';\nimport { keyToNumbers } from '../keys.js';\nimport { rpitch, rflatsharp, byFatherCharlesPitch, accidentalChars } from '../pitch.js';\nimport config           from '../config.js';\nimport { major }        from '../scale.js';\nimport * as glyphs      from \"../glyphs.js\";\n\n\nconst accidentals = {\n    '-2': '𝄫',\n    '-1': '♭',\n    '0':  '',\n    '1':  '♯',\n    '2':  '𝄪'\n};\n\nconst global = globalThis || window;\nconst assign = Object.assign;\nconst { floor, round } = Math;\n\nconst keys = {\n    //                                             C      D       E  F      G      A       B\n    '-7': { name: 'C♭', symbol: 'C♭∆', spellings: [0, -1, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1] },  // (Should have Ebb?)\n    '-6': { name: 'G♭', symbol: 'G♭∆', spellings: [0, -1, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1] },  // (Should have Ebb?)\n    '-5': { name: 'D♭', symbol: 'D♭∆', spellings: [0, -1, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1] },\n    '-4': { name: 'A♭', symbol: 'A♭∆', spellings: [0, -1, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1] },\n    '-3': { name: 'E♭', symbol: 'E♭∆', spellings: [0, -1, 0, -1,  0, 0, -1, 0, -1, 0, -1, -1] },\n    '-2': { name: 'B♭', symbol: 'B♭∆', spellings: [0, -1, 0, -1,  0, 0, -1, 0, -1, 0, -1,  0] },\n    '-1': { name: 'F',  symbol: 'F∆',  spellings: [0, -1, 0, -1,  0, 0,  1, 0, -1, 0, -1,  0] },\n    '0':  { name: 'C',  symbol: 'C∆',  spellings: [0,  1, 0, -1,  0, 0,  1, 0, -1, 0, -1,  0] },\n    '1':  { name: 'G',  symbol: 'G∆',  spellings: [0,  1, 0, -1,  0, 0,  1, 0,  1, 0, -1,  0] },\n    '2':  { name: 'D',  symbol: 'D∆',  spellings: [0,  1, 0,  1,  0, 0,  1, 0,  1, 0, -1,  0] },\n    '3':  { name: 'A',  symbol: 'A∆',  spellings: [0,  1, 0,  1,  0, 0,  1, 0,  1, 0,  1,  0] },\n    '4':  { name: 'E',  symbol: 'E∆',  spellings: [0,  1, 0,  1,  0, 1,  1, 0,  1, 0,  1,  0] },\n    '5':  { name: 'B',  symbol: 'B∆',  spellings: [1,  1, 0,  1,  0, 1,  1, 0,  1, 0,  1,  0] },\n    '6':  { name: 'F♯', symbol: 'F♯∆', spellings: [1,  1, 0,  1,  2, 1,  1, 0,  1, 0,  1,  0] }, // (Should have G##?)\n    '7':  { name: 'C♯', symbol: 'C♯∆', spellings: [1,  1, 0,  1,  2, 1,  1, 0,  1, 0,  1,  2] }  // (Should have G##?)\n};\n\n\n/* Stave */\n\nexport default class Stave {\n    constructor() {}\n\n    /**\n    .pitched\n    A boolean indicating whether this stave supports keys and transposition.\n    **/\n    pitched = true;\n\n    /**\n    .rows\n    An array of row names, from bottom to top of stave. Row names must correspond\n    to those defined for a given stave in CSS.\n    **/\n    rows = nothing;\n\n    /**\n    .getNoteHTML(pitch, dynamic, duration)\n    Get the HTML content used for a note of given `pitch`, `dynamic` and\n    `duration`. For normal chromatic staves only `duration` really matters, but\n    percussion staves may replace heads based on pitch and dynamics.\n    **/\n\n    getHeadHTML(pitch, dynamic, duration) {\n        const name =\n            // Semibreve\n            duration >= 4 ? 'head4' :\n            // Triplet semibreve\n            Math.fround(duration) === Math.fround(2.666666667) ? 'head4' :\n            // Minim\n            duration >= 2 ? 'head2' :\n            // Triplet minim\n            Math.fround(duration) === Math.fround(1.333333333) ? 'head2' :\n            // Everything else\n            'head1' ;\n\n        return `<span class=\"head\" data-glyph=\"${ name }\">${ glyphs[name] }</span>`;\n    }\n\n    getNoteHTML(pitch, dynamic, duration) {\n        return dynamic < config.ghostThreshold ? `\n            <span class=\"pre\" data-glyph=\"headBracketLeft\">${ glyphs.headBracketLeft }</span>\n            ${ this.getHeadHTML(pitch, dynamic, duration) }\n            <span class=\"post\" data-glyph=\"headBracketRight\">${ glyphs.headBracketRight }</span>` :\n            this.getHeadHTML(pitch, dynamic, duration) ;\n    }\n\n    /**\n    .minRow, .bottomRow, .centerRow, .topRow, .maxRow\n    Minimum and maximum row numbers supported by the stave. Note that `.minRow`\n    is greater than `.maxRow`. We are counting rows in pitch order.\n    **/\n\n    get maxRow()    { return 0; }\n    get topRow()    { return this.centerRow - 4; }\n    get centerRow() { return floor(0.5 * (this.rows.length - 1)); }\n    get bottomRow() { return this.centerRow + 5; }\n    get minRow()    { return this.rows.length - 1; }\n\n    /**\n    .minPitch, .bottomPitch, .centerPitch, .topPitch, .maxPitch\n    Minimum and maximum pitch names supported by the stave corresponding to the\n    first and last row names in `.rows`, and lower, middle and upper stave pitches\n    corresponding to the lower, middle and upper lines of the stave.\n    **/\n\n    get maxPitch()    { return this.rows[this.maxRow]; }\n    get topPitch()    { return this.rows[this.topRow]; }\n    get centerPitch() { return this.rows[this.centerRow]; }\n    get bottomPitch() { return this.rows[this.bottomRow]; }\n    get minPitch()    { return this.rows[this.minRow]; }\n\n    /**\n    .movePitch(pitch, n)\n    Chromatically transpose `pitch` by `n` semitones within the bounds of\n    `.minPitch` and `.maxPitch`. Should a transposed pitch fall outside this\n    range, returns `undefined`.\n    **/\n    movePitch(pitch, n) {\n        // Chromatic transpose\n        const min    = toNoteNumber(this.minPitch);\n        const max    = toNoteNumber(this.maxPitch);\n        const number = toNoteNumber(pitch) + n;\n        // Don't transpose outside the limits of the stave\n        return number >= min && number <= max ?\n            number :\n            undefined ;\n    }\n\n    /**\n    .getPart(pitch)\n    **/\n\n    parts = [{\n        name: 'main'\n    }];\n\n    getPart(number) {\n        return this.parts[0];\n    }\n\n    /**\n    .getRow(part, pitch)\n    Returns the row index of a given pitch name or number. Multi-staff staves\n    require part to know which staff they are positioned upon.\n    **/\n    getRow(part, pitch) {\n        const name = typeof pitch === 'string' ? pitch : toNoteName(pitch) ;\n        const row  = name.replace(rflatsharp, '');\n        const i    = this.rows.indexOf(row);\n        //if (global.DEBUG && i === -1) throw new Error('Pitch \"' + pitch + '\" is not supported by stave ' + this.constructor.name);\n        if (i === -1) console.warn('Pitch \"' + pitch + '\" is not supported by stave ' + this.constructor.name);\n        return i > -1 ? i : undefined ;\n    }\n\n    /**\n    .getPitch(row)\n    Returns the pitch of a given row number.\n    **/\n    getPitch(row) {\n        const names = this.rows[row];\n        return names ?\n            names.split(/\\s+/)[0] :\n            undefined ;\n    }\n\n    /**\n    .getSpelling(key, pitch, withOctave)\n    Gets spelling of a given pitch. Returns a pitch name string.\n    **/\n    getSpelling(key, pitch, withOctave = false) {\n        const keyData = keys[key];\n\n        if (!withOctave) {\n            const n = toRootNumber(pitch);\n            const a = keyData.spellings[n];\n            return noteNames[mod12(n - a)] + accidentals[a];\n        }\n\n        let n, a, o;\n\n        if (typeof pitch === 'string') {\n            let [notename, letter, accidental, octave] = rpitch.exec(pitch) || [pitch];\n            if (octave) {\n                // pitch is note name like \"C4\", deconstruct it and put it back together\n                n = toNoteNumber(pitch);\n                a = keyData.spellings[mod12(n)];\n                o = toNoteOctave(n - a);\n            }\n        }\n        else {\n            // pitch is a number\n            n = pitch;\n            a = keyData.spellings[mod12(n)];\n            o = toNoteOctave(n - a);\n        }\n\n        // key.spellings makes sure name is a natural note name\n        const name = noteNames[mod12(n - a)];\n        const accidental = accidentals[a];\n\n        if (window.DEBUG && name === undefined) {\n            throw new Error('Incorrect spelling for pitch number ' + n + ': \"' + name + '\"');\n        }\n\n        return name + accidental + o;\n    }\n\n    createKeySymbols(key) {\n        const numbers = keyToNumbers(key);\n        return Array.from(numbers, (n, i) => (n - major[i] && {\n            type:  'acci',\n            pitch: toRootName(major[i]) + accidentalChars[n - major[i]],\n            value: n - major[i],\n            part:  this.parts[0]\n        }))\n        .filter((o) => !!o)\n        .sort(byFatherCharlesPitch);\n    }\n\n    createSignatureSymbols(key) {\n        const symbols   = [{\n            type: 'clef',\n            clef: this.type,\n            part: this.parts[0]\n        }];\n\n        return symbols.concat(this.createKeySymbols(key));\n    }\n\n    /**\n    .yRatioToPitch(y)\n    Used for converting pointer movements to pitch changes.\n    **/\n    yRatioToPitch(y) {\n        const n = floor(y * this.pitches.length);\n        return n < 0 ? this.pitches[0] :\n            n > this.pitches.length - 1 ? this.pitches[this.pitches.length - 1] :\n            this.pitches[n] ;\n    }\n}\n", "/**\nslugify(string)\n\nReplaces any series of non-word characters with a `'-'` and lowercases the rest.\n\n```js\n    slugify('Party on #mydudes!') // 'party-on-mydudes'\n```\n**/\n\nexport default function slugify(string) {\n    // Accept a number or string\n    string = typeof string === 'number' ?\n        string + '' : \n        string.trim() ;\n\n    if (typeof string !== 'string') { return; }\n\n    return string\n    .toLowerCase()\n    .replace(/^[\\W_]+/, '')\n    .replace(/[\\W_]+$/, '')\n    .replace(/[\\W_]+/g, '-');\n}\n", "\nimport slugify     from 'fn/slugify.js';\nimport { toDrumName, toNoteNumber } from 'midi/note.js';\nimport * as glyphs from \"../glyphs.js\";\nimport config      from '../config.js';\nimport Stave       from './stave.js';\n\n\nconst global = globalThis || window;\n\n\nfunction toDrumSlug(number) {\n    return slugify(toDrumName(number));\n}\n\nexport default class DrumStave extends Stave {\n    type = 'drum';\n\n    pitched = false;\n\n    rows = [\n        \"\",\n        \"\",\n        \"\",\n        /* Splash, Chinese */\n        toDrumSlug(55) + ' ' + toDrumSlug(52),\n        /* Crash 2 */\n        toDrumSlug(57),\n        /* Crash 1 */\n        toDrumSlug(49),\n        /* Ride Cymbal, Ride Bell, Ride Cymbal 2 */\n        toDrumSlug(51) + ' ' + toDrumSlug(53) + ' ' + toDrumSlug(59),\n        /* Closed Hi-hat, Open Hi-hat - Top line */\n        toDrumSlug(42) + ' ' + toDrumSlug(46),\n        /* High tom, Cowbell */\n        toDrumSlug(50) + ' ' + toDrumSlug(56),\n        /* Low mid tom, High mid tom */\n        toDrumSlug(48) + ' ' + toDrumSlug(47),\n        /* Snare drum 1, Snare drum 2 */\n        toDrumSlug(38) + ' ' + toDrumSlug(40),\n        /* Low tom, Sticks, Hand clap, Tambourine */\n        toDrumSlug(45) + ' ' + toDrumSlug(31) + ' ' + toDrumSlug(39) + ' ' + toDrumSlug(54),\n        /* High floor tom */\n        toDrumSlug(43),\n        /* Low floor tom */\n        toDrumSlug(41),\n        /* Low bass drum, High bass drum */\n        toDrumSlug(35) + ' ' + toDrumSlug(36),\n        /* Bottom line */\n        \"\",\n        /* Pedal Hi-hat */\n        toDrumSlug(44),\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        \"\"\n    ];\n\n    #headnames = {\n        31: 'headX',          // Sticks\n        37: 'headCircle',     // Side Stick\n        39: 'headX',          // Hand Clap\n        42: 'headX',          // Closed Hi-Hat\n        44: 'headX',          // Pedal Hi-Hat\n        46: 'headCircleX',    // Open Hi-Hat\n        49: 'headCircleX',    // Crash Cymbal 1\n        51: 'headX',          // Ride Cymbal 1\n        52: 'headCircleX',    // Chinese Cymbal\n        53: 'headDiamond',    // Ride Bell\n        54: 'headX',          // Tambourine\n        55: 'headX',          // Splash Cymbal\n        56: 'headTriangleUp', // Cowbell\n        57: 'headCircleX',    // Crash Symbol 2\n        58: 'headTriangleUp', // Vibraslap\n        59: 'headX'           // Ride Cymbal 2\n    };\n\n    #ghostables = {\n        31: true, // Sticks\n        35: true, // Low bass drum\n        36: true, // High bass drum\n        37: true, // Side Stick\n        38: true, // Snare drum 1\n        40: true, // Snare drum 2\n        41: true, // Low floor tom\n        42: true, // Closed Hi-Hat\n        43: true, // High floot tom\n        45: true, // Low tom\n        47: true, // Low mid tim\n        48: true, // High mid tom\n        50: true, // High tom\n        56: true  // Cowbell\n    };\n\n    getNoteHTML(pitch, dynamic, duration) {\n        const number    = toNoteNumber(pitch);\n        const name      = this.#headnames[number];\n        const ghostable = this.#ghostables[number];\n        const html      = name ?\n            `<span class=\"head\" data-glyph=\"${ name }\">${ glyphs[name] }</span>` :\n            this.getHeadHTML(pitch, dynamic, duration) ;\n\n        // Ghost note gets brackets\n        return ghostable && dynamic < config.ghostThreshold ? `\n            <span class=\"pre\" data-glyph=\"headBracketLeft\">${ glyphs.headBracketLeft }</span>\n            ${ html }\n            <span class=\"post\" data-glyph=\"headBracketRight\">${ glyphs.headBracketRight }</span>\n            ` :\n            html ;\n    }\n\n    parts = [{\n        name:   'drums',\n        beam:   'drums-beam',\n        stemup: false\n    }, {\n        name:   'cymbals',\n        beam:   'cymbals-beam',\n        stemup: true\n    }];\n\n    getPart(number) {\n        // Split drums stave into drums and cymbals parts\n        return [35, 36, 37, 38, 40, 41, 43, 44, 45, 47, 48, 50].includes(toNoteNumber(number)) ?\n            this.parts[0] :\n            this.parts[1] ;\n    }\n\n    /**\n    .getRow(pitch)\n    Returns the row index of a given pitch name or number.\n    **/\n    getRow(part, n) {\n        const pitch = typeof n === 'string' ? n : toDrumSlug(n) ;\n        if (!pitch) throw new Error('Number not found for pitch ' + n);\n        const i = this.rows.findIndex((row) => row.includes(pitch));\n        //if (global.DEBUG && i === -1) throw new Error('Pitch \"' + pitch + '\" is not supported by stave ' + this.constructor.name);\n        if (i === -1) console.warn('Pitch \"' + pitch + '\" is not supported by stave ' + this.constructor.name);\n        return i > -1 ? i : undefined ;\n    }\n\n    getSpelling(key, number) {\n        return toDrumSlug(number);\n    }\n\n    createSignatureSymbols(key) {\n        return [{\n            type: 'clef',\n            clef: this.type\n        }];\n    }\n\n    yRatioToPitch(y) {\n        const i = floor(y * this.rows.length);\n        const j = i < 4 ? 4 : i > 17 ? 17 : i ;\n        return this.pitches[j];\n    }\n}\n", "\nimport { toNoteNumber } from 'midi/note.js';\nimport * as glyphs from \"../glyphs.js\";\nimport DrumStave from './drum.js';\n\n\nexport default class PercussionStave extends DrumStave {\n    type = 'percussion';\n    rows = ['','','','','','','','','note','','','','','','','',''];\n\n    get maxPitch() {\n        return this.rows[17];\n    }\n\n    get bottomPitch() {\n        return this.rows[8];\n    }\n\n    get centerPitch() {\n        return this.rows[8];\n    }\n\n    get topPitch() {\n        return this.rows[8];\n    }\n}\n", "\nimport * as glyphs from \"../glyphs.js\";\nimport { toNoteName, toRootNumber, toRootName } from 'midi/note.js';\nimport { keyToNumbers } from '../keys.js';\nimport { rflatsharp, byFatherCharlesPitch, accidentalChars } from '../pitch.js';\nimport { major } from '../scale.js';\nimport Stave       from './stave.js';\n\n\nconst global = globalThis || window;\nconst assign = Object.assign;\n\n\n/**\nA simple piano grand stave which brute splits treble from bass at Bb3.\n**/\n\nexport default class PianoStave extends Stave {\n    type = 'piano';\n    rows = [\n        \"rh-A6 soprano-A6 alto-A6\",\n        \"rh-G6 soprano-G6 alto-G6\",\n        \"rh-F6 soprano-F6 alto-F6\",\n        \"rh-E6 soprano-E6 alto-E6\",\n        \"rh-D6 soprano-D6 alto-D6\",\n        \"rh-C6 soprano-C6 alto-C6\",\n        \"rh-B5 soprano-B5 alto-B5\",\n        \"rh-A5 soprano-A5 alto-A5\",\n        \"rh-G5 soprano-G5 alto-G5\",\n        \"rh-F5 soprano-F5 alto-F5\",\n        \"rh-E5 soprano-E5 alto-E5\",\n        \"rh-D5 soprano-D5 alto-D5\",\n        \"rh-C5 soprano-C5 alto-C5\",\n        \"rh-B4 soprano-B4 alto-B4\",\n        \"rh-A4 soprano-A4 alto-A4\",\n        \"rh-G4 soprano-G4 alto-G4\",\n        \"rh-F4 soprano-F4 alto-F4\",\n        \"rh-E4 soprano-E4 alto-E4\",\n        \"rh-D4 soprano-D4 alto-D4\",\n        \"rh-C4 soprano-C4 alto-C4\",\n        \"rh-B3 soprano-B3 alto-B3\",\n        \"lh-B4 rh-A3 soprano-A3 alto-A3 tenor-B4 bass-B4\",\n        \"lh-A4 rh-G3 soprano-G3 alto-G3 tenor-A4 bass-A4\",\n        \"lh-G4 rh-F3 soprano-F3 alto-F3 tenor-G4 bass-G4\",\n        \"lh-F4 rh-E3 soprano-E3 alto-E3 tenor-F4 bass-F4\",\n        \"lh-E4 rh-D3 soprano-D3 alto-D3 tenor-E4 bass-E4\",\n        \"lh-D4 tenor-D4 bass-D4\",\n        \"lh-C4 tenor-C4 bass-C4\",\n        \"lh-B3 tenor-B3 bass-B3\",\n        \"lh-A3 tenor-A3 bass-A3\",\n        \"lh-G3 tenor-G3 bass-G3\",\n        \"lh-F3 tenor-F3 bass-F3\",\n        \"lh-E3 tenor-E3 bass-E3\",\n        \"lh-D3 tenor-D3 bass-D3\",\n        \"lh-C3 tenor-C3 bass-C3\",\n        \"lh-B2 tenor-B2 bass-B2\",\n        \"lh-A2 tenor-A2 bass-A2\",\n        \"lh-G2 tenor-G2 bass-G2\",\n        \"lh-F2 tenor-F2 bass-F2\",\n        \"lh-E2 tenor-E2 bass-E2\",\n        \"lh-D2 tenor-D2 bass-D2\",\n        \"lh-C2 tenor-C2 bass-C2\",\n        \"lh-B1 tenor-B1 bass-B1\",\n        \"lh-A1 tenor-A1 bass-A1\",\n        \"lh-G1 tenor-G1 bass-G1\",\n        \"lh-F1 tenor-F1 bass-F1\",\n        \"lh-E1 tenor-E1 bass-E1\"\n    ];\n\n    getTimeSigHTML(numerator, denominator, eventId) {\n        return `<span class=\"timesig\" data-event=\"${ eventId }\" data-part=\"rh\">\n            <sup>${ glyphs['timeSig' + numerator] }</sup>\n            <sub>${ glyphs['timeSig' + denominator] }</sub>\n        </span>\n        <span class=\"timesig\" data-event=\"${ eventId }\" data-part=\"lh\">\n            <sup>${ glyphs['timeSig' + numerator] }</sup>\n            <sub>${ glyphs['timeSig' + denominator] }</sub>\n        </span>`;\n    }\n\n    staffs = ['bass', 'treble'];\n\n    parts = [{}, {\n        name:      'lh',\n        staff:     'bass',\n        topRow:    29,\n        centerRow: 33,\n        bottomRow: 38\n    }, {\n        name:      'rh',\n        staff:     'treble',\n        topRow:    9,\n        centerRow: 13,\n        bottomRow: 18\n    }, {\n        // Voice range C4-C6\n        // Soprano sax Ab3-Eb6\n        // Trumpet F#3-C6\n        name:      'soprano',\n        staff:     'treble',\n        topRow:    9,\n        centerRow: 13,\n        bottomRow: 18,\n        stemup:    true\n    }, {\n        // Voice range G3-G5\n        // Flugel horn E3-Bb5\n        // Alto sax rannge Db3-Ab5\n        name:      'alto',\n        staff:     'treble',\n        topRow:    9,\n        centerRow: 13,\n        bottomRow: 18,\n        stemup:    false\n    }, {\n        // Voice range C3-C5\n        // Tenor Sax range Ab2-Eb5\n        name:      'tenor',\n        staff:     'bass',\n        topRow:    29,\n        centerRow: 33,\n        bottomRow: 38,\n        stemup:    true\n    }, {\n        // Voice range E2-C4\n        // Trombone range E2-Bb4\n        // Sousaphone Eb1-Bb4\n        name:      'bass',\n        staff:     'bass',\n        topRow:    29,\n        centerRow: 33,\n        bottomRow: 38,\n        stemup:    false\n    }];\n\n    /**\n    .getRow(part, pitch)\n    Returns the row index of a given pitch name or number.\n    **/\n    getRow(part, pitch) {\n        pitch = typeof pitch === 'string' ? pitch : toNoteName(pitch) ;\n        const name = part.name + '-' + pitch.replace(rflatsharp, '');\n        const i = this.rows.findIndex((row) => row.includes(name));\n        if (global.DEBUG && i === -1) throw new Error('Pitch \"' + name + '\" is not supported by ' + this.constructor.name);\n        if (i === -1) console.warn('Pitch \"' + name + '\" is not supported by ' + this.constructor.name);\n        return i > -1 ? i : undefined ;\n    }\n\n    getPart(number) {\n        return typeof number === 'number' ?\n            number < 60 ?\n                this.parts[1] :\n                this.parts[2] :\n            /[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(number) ?\n                this.parts[1] :\n                this.parts[2] ;\n    }\n\n    createKeySymbols(key) {\n        const keysig  = super.createKeySymbols(key);\n        const symbols = [];\n        // Add key signature to both staffs\n        symbols.push.apply(symbols, keysig.map((symbol) => assign({}, symbol, { part: this.parts[1] })));\n        symbols.push.apply(symbols, keysig.map((symbol) => assign({}, symbol, { part: this.parts[2] })));\n        return symbols;\n    }\n\n    createSignatureSymbols(key) {\n        const symbols = [{\n            type:  'clef',\n            clef:  'treble',\n            part:  this.parts[1],\n            stave: this\n        }, {\n            type:  'clef',\n            clef:  'bass',\n            part:  this.parts[2],\n            stave: this\n        }];\n\n        return symbols.concat(this.createKeySymbols(key));\n    }\n}\n", "\nimport * as glyphs     from \"./glyphs.js\";\nimport Stave           from './stave/stave.js';\nimport DrumStave       from './stave/drum.js';\nimport PercussionStave from './stave/percussion.js';\nimport PianoStave      from './stave/piano.js';\n\n\nconst assign = Object.assign;\n\n\nclass TrebleUpStave extends Stave {\n    type = 'treble-up';\n    clef = glyphs.clefTrebleUp;\n    rows = [\"A7\", \"G7\", \"F7\", \"E7\", \"D7\", \"C7\", \"B6\", \"A6\", \"G6\", \"F6\", \"E6\", \"D6\", \"C6\", \"B5\", \"A5\", \"G5\", \"F5\", \"E5\", \"D5\", \"C5\", \"B4\", \"A4\", \"G4\", \"F4\", \"E4\", \"D4\", \"C4\"];\n}\n\nclass TrebleStave extends Stave {\n    type = 'treble';\n    clef = glyphs.clefTreble;\n    rows = [\"A6\", \"G6\", \"F6\", \"E6\", \"D6\", \"C6\", \"B5\", \"A5\", \"G5\", \"F5\", \"E5\", \"D5\", \"C5\", \"B4\", \"A4\", \"G4\", \"F4\", \"E4\", \"D4\", \"C4\", \"B3\", \"A3\", \"G3\", \"F3\", \"E3\", \"D3\", \"C3\"];\n}\n\nclass TrebleDownStave extends Stave {\n    type = 'treble-down';\n    clef = glyphs.clefTrebleDown;\n    rows = [\"A5\", \"G5\", \"F5\", \"E5\", \"D5\", \"C5\", \"B4\", \"A4\", \"G4\", \"F4\", \"E4\", \"D4\", \"C4\", \"B3\", \"A3\", \"G3\", \"F3\", \"E3\", \"D3\", \"C3\", \"B2\", \"A2\", \"G2\", \"F2\", \"E2\", \"D2\", \"C2\"];\n}\n\nclass AltoStave extends Stave {\n    type = 'alto';\n    clef = glyphs.clefAlto;\n    rows = [\"B5\", \"A5\", \"G5\", \"F5\", \"E5\", \"D5\", \"C5\", \"B4\", \"A4\", \"G4\", \"F4\", \"E4\", \"D4\", \"C4\", \"B3\", \"A3\", \"G3\", \"F3\", \"E3\", \"D3\", \"C3\", \"B2\", \"A2\", \"G2\", \"F2\", \"E2\", \"D2\"];\n}\n\nclass BassStave extends Stave {\n    type = 'bass';\n    clef = glyphs.clefBass;\n    rows = [\"C5\", \"B4\", \"A4\", \"G4\", \"F4\", \"E4\", \"D4\", \"C4\", \"B3\", \"A3\", \"G3\", \"F3\", \"E3\", \"D3\", \"C3\", \"B2\", \"A2\", \"G2\", \"F2\", \"E2\", \"D2\", \"C2\", \"B1\", \"A1\", \"G1\", \"F1\", \"E1\"];\n}\n\n\n// Register staves by type. Types are the same string used by the clef attribute,\n// as in <scribe-music clef=\"treble\">. Create a stave by type with:\n// Stave.create(type);\n\nStave['treble']      = new TrebleStave();\nStave['treble-up']   = new TrebleUpStave();\nStave['treble-down'] = new TrebleDownStave();\nStave['alto']        = new AltoStave();\nStave['bass']        = new BassStave();\nStave['piano']       = new PianoStave();\nStave['drum']        = new DrumStave();\nStave['percussion']  = new PercussionStave();\n\n\n/**\nStave.create(type)\nCreate a stave object by type.\n**/\nStave.create = (type) => {\n    console.warn('Deprecated: Stave.create(type). Use Stave[type].');\n    return Stave[type];\n}\n\nexport default Stave;\n", "\n/**\ntoRad(deg)\n**/\n\nexport default (n) => n * Math.PI / 180;\n", "\nimport id         from './id.js';\nimport parseValue from './parse-value.js';\nimport toRad      from './to-rad.js';\n\n/**\nparseAngle(string)\nParses strings of the form `'45deg'`, `'0rad'` or `'0.5turn'`. Returns a\nnumber in radians. If `string` is a number, it passes through.\n**/\n\nexport default parseValue({\n    deg:  toRad,\n    rad:  id,\n    turn: (n) => n * 2 * Math.PI,\n    catch: function(string) {\n        throw new Error('Cannot parse value \"' + string + '\"');\n    }\n});\n", "/**\nstyle(property, node)\n\nReturns the computed style `property` of `node`.\n    style('transform', node);  // returns transform\n*/\n\nimport parseAngle from 'fn/parse-angle.js';\n\nvar rpx    = /px$/;\nvar rangle = /deg$|turn$|rad$/;\n\nfunction computedStyle(name, node) {\n\treturn window.getComputedStyle ?\n\t\twindow\n\t\t.getComputedStyle(node, null)\n\t\t.getPropertyValue(name) :\n\t\t0 ;\n}\n\nexport default function style(name, node) {\n    var value = computedStyle(name, node);\n\n    // Pixel values are converted to number type\n    return typeof value === 'string' ?\n\t\trpx.test(value) ? parseFloat(value) :\n\t\trangle.test(value) ? parseAngle(value) :\n        value :\n\t\tvalue ;\n}\n", "// Units\n\nimport id         from 'fn/id.js';\nimport overload   from 'fn/overload.js';\nimport toType     from 'fn/to-type.js';\nimport parseValue from 'fn/parse-value.js';\nimport style      from './style.js';\n\n\n/* Track document font size */\n\nlet emSize;\nlet remSize;\n\nfunction getEmSize() {\n    if (!emSize) {\n        if (window.DEBUG) {\n            console.warn('Calculating root em value may cause reflow as user font-size cannot be known without setting <html style=\"font-size: 100%;\">');\n        }\n\n        const styledFontSize = document.documentElement.style.fontSize;\n        document.documentElement.style.fontSize = '100%';\n        emSize = style(\"font-size\", document.documentElement);\n        document.documentElement.style.fontSize = styledFontSize || '';\n    }\n\n    return emSize;\n}\n\nfunction getRemSize() {\n    if (!remSize) {\n        remSize = style(\"font-size\", document.documentElement);\n    }\n\n    return remSize;\n}\n\nwindow.addEventListener('resize', () => {\n    emSize  = undefined;\n    remSize = undefined;\n});\n\n/**\npx(value)\nTakes a number in pixels or a string of the form `'10px'`, `'10em'`, `'10rem'`,\n`'100vw'`, `'100vh'`, `'100vmin'` or `'100vmax'`, and returns a numeric value\nin pixels.\n*/\n\nexport const px = overload(toType, {\n    'number': id,\n\n    'string': parseValue({\n        px:   id,\n        em:   (n) => getEmSize() * n,\n        rem:  (n) => getRemSize() * n,\n        vw:   (n) => window.innerWidth * n / 100,\n        vh:   (n) => window.innerHeight * n / 100,\n\n        vmin: (n) => (\n            window.innerWidth < window.innerHeight ?\n                window.innerWidth * n / 100 :\n                window.innerHeight * n / 100\n        ),\n\n        vmax: (n) => (\n            window.innerWidth < window.innerHeight ?\n                window.innerHeight * n / 100 :\n                window.innerWidth * n / 100\n        )\n    })\n});\n\nexport default px;\n\n/**\nem(value)\nTakes numeric value in px, or CSS length of the form `'10px'`, and returns\na numeric value in `em`, eg. `0.625`. Depends on the user defined browser\n`font-size`.\n*/\n\nexport function em(n) {\n    return px(n) / getEmSize();\n}\n\n/**\nrem(value)\nTakes numeric value in px, or CSS length of the form `'10px'`, and returns\na numeric value in `rem`, eg. `0.625`. Depends on the `font-size` of the\ndocumentElement.\n*/\n\nexport function rem(n) {\n    return px(n) / getRemSize();\n}\n\n/**\nvw(value)\nTakes number in pixels or CSS length of the form `'10em'` and returns a\nnumeric value in `vw`, eg. `120`. Depends on the width of the viewport at\nrender time.\n*/\n\nexport function vw(n) {\n    return 100 * px(n) / window.innerWidth;\n}\n\n/**\nvh(value)\nTakes number in pixels or CSS length of the form `'10em'` and returns a\nnumeric value in `vh`, eg. `120`. Depends on the height of the viewport at\nrender time.\n*/\n\nexport function vh(n) {\n    return 100 * px(n) / window.innerHeight;\n}\n\n/**\nvmin(value)\nTakes number in pixels or CSS length of the form `'10em'` and returns a\nnumeric value in `vmin`, eg. `120`. Depends on the minimum dimension of the\nviewport at render time.\n*/\n\nexport function vmin(n) {\n    return 100 * px(n) / (\n        window.innerWidth < window.innerHeight ?\n            window.innerWidth :\n            window.innerHeight\n    );\n}\n\n/**\nvmax(value)\nTakes number in pixels or CSS length of the form `'10em'` and returns a\nnumeric value in `vmax`, eg. `120`. Depends on the maximum dimension of the\nviewport at render time.\n*/\n\nexport function vmax(n) {\n    return 100 * px(n) / (\n        window.innerWidth < window.innerHeight ?\n            window.innerHeight :\n            window.innerWidth\n    );\n}\n", "\n/**\nby(fn, a, b)\n\nFor sorting arrays. Compares `fn(a)` against `fn(b)` and returns `-1`, `0` or\n`1`. Partially applicable. To sort an array of objects by their ids:\n\n```\narray.sort(by(get('id')))\n```\n**/\n\nimport curry from './curry.js';\n\nexport function by(fn, a, b) {\n    const fna = fn(a);\n    const fnb = fn(b);\n    return fnb === fna ? 0 : fna > fnb ? 1 : -1 ;\n}\n\nexport default curry(by, true);\n", "\nconst { abs, EPSILON } = Math;\n\nexport function round(d, n) {\n    return Math.round(n / d) * d;\n}\n\nexport function eq(b, a, precision = EPSILON) {\n    return a !== undefined && (a === b || abs(b - a) < precision);\n}\n\nexport function lte(b, a, precision) {\n    return eq(b, a, precision) || a < b;\n}\n\nexport function gte(b, a, precision) {\n    return eq(b, a, precision) || a > b;\n}\n\nexport function gt(b, a, precision) {\n    return a !== undefined && b !== undefined && !lte(b, a, precision);\n}\n\nexport function lt(b, a, precision) {\n    return a !== undefined && b !== undefined && !gte(b, a, precision);\n}\n", "\nimport getStopBeat from './event/to-stop-beat.js';\nimport { gt, lte } from './number/float.js';\n\n\nconst assign = Object.assign;\nconst { pow } = Math;\n\n// Rounding precision\nconst p24 = 1/24;\n\n// Tuplet divisors detected by the algorithm.\nconst tupletDivisors = [2, 3, 4, 5, 6, 7, 9];\n\n// Tuplets producing notes shorter than this duration are ignored.\nconst minTupletDuration = 1/12;\n\n// Tolerance is the minimum score a rhythm must make before being counted as a\n// tuplet. Where all events fall exactly on tuplet divisions a rhythm scores 1.\n// Where all events fall exactly between tuplet divisions a rhythm scores -1.\n// Between these two limits is a range. Rhythms below tolerance are rejected.\nconst tolerance = 0.25;\n\n// The importance of stop beats as compared to start beats.\nconst stopInfluence = 0.2;\n\n\nconst data = {};\nlet score = 0;\n\n\nfunction getScore(wavelength, beat) {\n    return Math.cos(2 * Math.PI * beat / wavelength);\n}\n\nfunction scoreTupletAtBeat(duration, divisor, beat, events, n) {\n    const tupletDuration = duration / divisor;\n\n    let score = 0;\n    let count = 0;\n    // Rhythm is a binary representation of the rhythm where 1 means there are\n    // events in the first division, 10 means there events in the second\n    // division, 100 events in the third and 111 events in all three, etc.\n    let rhythm = 0;\n    let s, r;\n\n    // Did previous event cross into - tie into - tuplet? Mark rhythm as\n    // occupying division 0. This check MUST match the stop beat test in part.js\n    // that rejects notes from being rendered on the following render iteration\n    if (events[n - 1] && gt(beat + 0.5 * tupletDuration, getStopBeat(events[n - 1]), p24)) {\n        rhythm = 1;\n    }\n\n    // Events before a quarter tuplet are considered the first of a tuplet group\n    --n;\n    while (events[++n] !== undefined && events[n][0] - beat < tupletDuration / 4) {\n        // There's definitely a note in position 0. We're not going to score it,\n        // as division 0 does not in itself make a tuplet. But we do want to\n        // mark it as a populated division.\n        rhythm = 1;\n    }\n\n    // Scan through events up to duration beat less a quarter tuplet\n    --n;\n    while (events[++n] !== undefined && events[n][0] - beat < duration - tupletDuration / 4) {\n        // Rhythmic division number in binary is 2^division\n        s = Math.round((events[n][0] - beat) / tupletDuration);\n        r = 1 << s;\n        // If we have not already filled this division\n        if (s < divisor && r > rhythm) {\n            // Reject large tuplet groups with holes\n            if (divisor > 4 && r > rhythm << 1) return;\n            // Add division to rhythm\n//console.log(beat, duration, divisor, events[n][0] - beat, 'Add r', s, r);\n            rhythm += r;\n        }\n\n        // Score event start\n        score += getScore(tupletDuration, events[n][0] - beat);\n        count += 1;\n\n        // Ignore event stops beyond duration, events may be longer than tuplet\n        if (events[n][0] + events[n][4] - beat > duration) continue;\n\n        // Score event stop\n        score += stopInfluence * getScore(tupletDuration, events[n][0] + events[n][4] - beat);\n        count += stopInfluence;\n    }\n\n    // Detect holes\n    if (divisor > 4 && s !== divisor - 1) return;\n    if (!count) return;\n//console.log(beat, duration, divisor, score, score / (count + 1));\n    // Favour higher counts by adding 1 to count\n    // TODO: Keep this weird number under review!\n    data.score  = score / (count + 1);\n    data.rhythm = rhythm;\n\n    return data;\n}\n\nfunction detectTupletOverDuration(tuplet, duration, events, n, startbeat, divisors, stopBeat) {\n    // n is the index of the first event we are interested in, but there may be an\n    // event that started before startbeat and is still playing, in which case...\n    const beat = events[n - 1] && getStopBeat(events[n - 1]) > startbeat + 0.125 ?\n        // Analyse from startbeat on\n        startbeat :\n        // Analyse from the floored multiple of duration up to this event's beat\n        duration * Math.floor((events[n][0] - startbeat) / duration) + startbeat ;\n\n    // Find greatest divisor producing tuplets longer than minTupletDuration\n    let d = divisors.length;\n    while (duration / divisors[--d] < minTupletDuration);\n    ++d;\n\n    // Loop through lower divisors, keep that with the highest score\n    let divisor, data;\n    while (divisor = divisors[--d]) {\n        // Score tuplet by duration and divisor\n        data = scoreTupletAtBeat(duration, divisor, beat, events, n);\n\n        if (data && data.score >= score && data.score) {\n            score = data.score;\n            tuplet.beat     = beat;\n            tuplet.duration = duration;\n            tuplet.divisor  = divisor;\n            tuplet.rhythm   = data.rhythm;\n        }\n\n        // If first head occurs at or after half a duration of beat\n        if (events[n][0] >= beat + 0.5 * duration && beat + 1.5 * duration < stopBeat) {\n            // Score tuplet offset by half a duration\n            data = scoreTupletAtBeat(duration, divisor, beat + 0.5 * duration, events, n);\n\n            if (data && data.score >= score) {\n                score = data.score;\n                tuplet.beat     = beat + 0.5 * duration;\n                tuplet.duration = duration;\n                tuplet.divisor  = divisor;\n                tuplet.rhythm   = data.rhythm;\n            }\n        }\n    }\n\n    return tuplet;\n}\n\n\n/**\ndetectTuplet(events, beat, duration)\nDetects tuplet and duplet rhythms. Returns a data object with the properties:\n\n```js\n{\n    beat:     // Start beat of tuplet\n    duration: // Duration of tuplet\n    divisor:  // Number of divisions in tuplet\n    rhythm:   // A binary number describing rhythmic divisions\n}\n```\n**/\n\nexport function detectTuplet(events, beat, duration) {\n    let n = -1;\n\n    // Ignore events up to start `beat`. Beat must be a power of 2 or multiple\n    // of here, so this should not be subject to floating point rounding errors\n    while (events[++n] !== undefined && events[n][0] < beat);\n\n    // If we have found no event, quick out\n    if (!events[n]) return;\n\n    const tuplet = {};\n\n    // Reset score. Use a module-scoped variable, safe only because whole\n    // process is synchronous\n    score = tolerance;\n\n    // Loop upward through power of 2 durations, short to long\n    let d = 1/8;\n    while ((d *= 2) && d <= duration) {\n        detectTupletOverDuration(tuplet, d, events, n, beat, tupletDivisors, beat + duration);\n    }\n\n    return score > tolerance && tuplet;\n}\n\nexport function rhythmHasHoles(divisor, rhythm) {\n    return rhythm < pow(2, divisor) - 1;\n}\n", "\nimport sum from 'fn/sum.js';\n\nexport function ceilPow2(n) {\n    return 2 ** Math.ceil(Math.log2(n));\n}\n\nexport function floorPow2(n) {\n    return 2 ** Math.floor(Math.log2(n));\n}\n\nexport function roundPowerOf2(n) {\n    return 2 ** Math.round(Math.log2(n));\n}\n\nexport function averagePowerOf2(...values) {\n    return 2 ** (values.map(Math.log2).reduce(sum, 0) / values.length);\n}\n\nexport function isPowerOf2(n) {\n    return n > 0 && (n & (n - 1)) === 0;\n}\n", "\nimport mod from 'fn/mod.js';\nimport { eq } from './float.js';\n\n/*\ngrainPower2(n)\ngrainPower2(n, min, max)\nFinds the closest power-of-two number that fits into number `n` with no\nremainder. Where given, `min` and `max` must be power-of-two numbers.\n*/\n\nexport default function grainPower2(min, max, n) {\n    // If n is 0 we can say we are on the maximum grain\n    if (eq(0, n, min / 2)) return max;\n\n    let g = max * 2;\n    while ((g /= 2) > min) {\n        if (eq(0, mod(g, n), min / 2)) return g;\n    }\n    return g;\n}\n", "/* Array-like functions that operate on plain objects */\n\nexport default function push(object, value) {\n    let n = -1, a = 0;;\n    while (object[++n] !== undefined);\n    while (arguments[++a] !== undefined) object[n++] = arguments[a];\n    return object;\n}\n", "export default function lengthOf(object) {\n    let n = -1;\n    while (object[++n] !== undefined);\n    return n;\n}\n", "import lengthOf from './length-of.js';\n\nexport default function join(object) {\n    return object[lengthOf(object) - 1];\n}\n", "\nexport default function map(fn, object) {\n    const array = [];\n    let n = -1;\n    while (object[++n] !== undefined) array.push(fn(object[n], n));\n    return array;\n}\n", "\nimport by          from 'fn/by.js';\nimport get         from 'fn/get.js';\nimport { toNoteName, toNoteNumber, toRootName, toRootNumber } from 'midi/note.js';\nimport { keyToRootNumber } from 'sequence/modules/event/keys.js';\nimport { keyWeightsForEvent, chooseKeyFromWeights } from './keys.js';\nimport { rflat, rsharp, rdoubleflat, rdoublesharp } from './pitch.js';\nimport { getDivision } from './bar.js';\nimport { detectTuplet, rhythmHasHoles } from './tuplet.js';\nimport { round as roundTo, eq, gte, lte, lt, gt } from './number/float.js';\nimport { floorPow2, ceilPow2, isPowerOf2 } from './number/power-of-2.js';\nimport grainPow2   from './number/grain-pow-2.js';\nimport push        from './object/push.js';\nimport last        from './object/last.js';\nimport lengthOf    from './object/length-of.js';\nimport map         from './object/map.js';\nimport getDuration from './event/to-duration.js';\nimport getStopBeat from './event/to-stop-beat.js';\nimport config      from './config.js';\n\n\nconst assign = Object.assign;\nconst { abs, ceil, floor, min, max, pow, sqrt, round } = Math;\n\n/* When dealing with rounding errors we only really need beat grid-level\n   precision, our display grid has 24 slots but we only need to compare the\n   smallest possible note values, 32nd notes, or ±1/16 precision */\nconst p16 = 1/16;\nconst p24 = 1/24;\n\n\n/* Fns */\n\nconst byRow = by(get('row'));\n\nfunction average(a, n, i, array) {\n    return a + n / array.length;\n}\n\n\n/* Notes */\n\nfunction toMaxStopBeat(n, event) {\n    return max(n, getStopBeat(event));\n}\n\nfunction byPitch(a, b) {\n    return toNoteNumber(a[2]) < toNoteNumber(b[2]) ? 1 : -1;\n}\n\nfunction createNoteSymbols(stave, key, part, notes) {\n    if (!notes.length) return [];\n\n    const symbols = [];\n    let n = -1, event;\n    while (event = notes[++n]) {\n        const events     = event.scribeEvents;\n        const index      = event.scribeIndex;\n        const keyWeights = keyWeightsForEvent(events, index, key);\n        const keyNumber  = chooseKeyFromWeights(keyWeights);\n        const pitch      = stave.getSpelling(keyNumber, event[2], true);\n        const row        = stave.getRow(part, pitch);\n\n        // Is note not on the stave?\n        if (!row) continue;\n\n        // Create symbols with pitch, row\n        symbols.push({\n            type: 'note',\n            pitch,\n            dynamic: event[3],\n            part,\n            row,\n            stave,\n            event\n        });\n    }\n\n    if (symbols.length === 0) return symbols;\n\n    // Sort by row order\n    symbols.sort(byRow);\n\n    // Assign top and bottom to highest and lowest note symbols\n    const top    = symbols[0];\n    const bottom = symbols[symbols.length - 1];\n    top.top       = true;\n    bottom.bottom = true;\n\n    // Figure out stemup, note that this may be overidden by beam\n    const minRow = top.row;\n    const maxRow = bottom.row;\n    const stemup = part.stemup === undefined ?\n        stemupFromRows(stave, part, minRow, maxRow) :\n        part.stemup ;\n\n    // Assign stemHeight to top and bottom symbols\n    const stemHeight = 1 + (maxRow - minRow) / 8;\n    top.stemHeight    = stemHeight;\n    bottom.stemHeight = stemHeight;\n\n    // Loop forward through rows\n    let c = 0;\n    n = -1;\n    while (symbols[++n]) {\n        // Assign stemup to all symbols\n        symbols[n].stemup = stemup;\n\n        // Detect cluster in downward order\n        if (n > 0 && symbols[n].row - symbols[n - 1].row === 1) symbols[n].clusterdown = ++c;\n        else c = 0;\n    }\n\n    // Loop backward through rows\n    c = 0;\n    n = symbols.length - 1;\n    while (n--) {\n        // Detect cluster in upward order\n        if (symbols[n + 1].row - symbols[n].row === 1) symbols[n].clusterup = ++c;\n        else c = 0;\n    }\n\n    return symbols;\n}\n\n\n/* Pitches */\n\nfunction getMinPitchRow(stave, part, pitches) {\n    let n = -1, row = 0;\n    let pitch, r;\n    while (pitches[++n]) {\n        r = stave.getRow(part, pitches[n]);\n        // r may be out of range oof this stave\n        if (r === undefined) continue;\n        // The bigger r, the lower the pitch\n        if (r > row) {\n            row   = r;\n            pitch = pitches[n];\n        }\n    }\n    return { row, pitch };\n}\n\nfunction getMaxPitchRow(stave, part, pitches) {\n    let n = -1, row = 128;\n    let pitch, r;\n    while (pitches[++n]) {\n        r = stave.getRow(part, pitches[n]);\n        // r may be out of range oof this stave\n        if (r === undefined) continue;\n        // The smaller r, the higher the pitch\n        if (r < row) {\n            row   = r;\n            pitch = pitches[n];\n        }\n    }\n    return { row, pitch };\n}\n\n\n/* Stems */\n\nfunction stemupFromRows(stave, part, minRow, maxRow) {\n    const centerRow = part.centerRow || stave.centerRow;\n    const minDiff   = minRow - centerRow;\n    const maxDiff   = maxRow - centerRow;\n    return maxDiff + minDiff > 0;\n}\n\nfunction stemupFromPitches(stave, part, pitches) {\n    const { row: minRow } = getMinPitchRow(stave, part, pitches);\n    const { row: maxRow } = getMaxPitchRow(stave, part, pitches);\n    return stemupFromRows(stave, part, minRow, maxRow);\n}\n\nfunction stemupFromSymbols(stave, part, symbols) {\n    const pitches = [];\n    let n = -1, symbol;\n    while (symbol = symbols[++n]) {\n        if (symbol.type === 'note') pitches.push(symbol.pitch);\n    }\n    return stemupFromPitches(stave, part, pitches);\n}\n\n\n/* Beams */\n\nlet beamId = 0;\n\nfunction closeBeam(symbols, stave, part, beam) {\n    // Scan through beam symbols to find note not on beat of beam\n    let n = -1;\n    while (beam[++n] && beam[n].beat === beam.beat);\n    // If there is only notes on start beat of beam, no beam needed\n    if (!beam[n]) return symbols;\n\n    const startBeat = beam[0].beat;\n    const stopBeat  = last(beam).beat;\n    const duration  = stopBeat - startBeat;\n    const stemup = part.stemup === undefined ?\n        // Calculate stem up or down\n        stemupFromPitches(stave, part, map(get('pitch'), beam)) :\n        // Get stem direction from part\n        part.stemup ;\n\n    // If part has beam (drum stave) beams are in a fixed position\n    if (part.beam) {\n        // TEMP: DO it better\n        let note;\n\n        // Apply beamed properties to note symbols\n        n = -1;\n        while (note = beam[++n]) {\n            note.stemup = stemup;\n            note.beam   = beam;\n        }\n\n        //console.log('TODO: Beam has fixed position according to part', part.beam);\n        // Push the beam into symbols\n        symbols.push(assign(beam, {\n            duration,\n            stemup,\n            range: 0,\n            id: ++beamId\n        }));\n\n        return symbols;\n    }\n\n    // Calculate beam positions\n    const rows = [];\n\n    let note;\n    n = -1;\n    while (note = beam[++n]) {\n        let row = stave.getRow(part, note.pitch);\n        // row may be out of range of this stave\n        if (row === undefined) continue;\n\n        let r;\n\n        // Find highest or lowest pitch at beat of note\n        while (beam[++n] && eq(beam[n].beat, note.beat, p24)) {\n            r = stave.getRow(part, beam[n].pitch);\n            // row may be out of range of this stave\n            if (r === undefined) continue;\n            if (stemup) { if (r < row) row = r; }\n            else {\n\n                if (r > row) {\n                    row = r;\n                console.log('YEAH');\n                }\n\n            }\n        }\n        --n;\n\n        // Push it into pitches\n        rows.push(row);\n    }\n\n    const beamLength = rows.length - 1;\n    const beginRow   = rows.slice(0, floor(0.5 * rows.length)).reduce(average, 0);\n    const endRow     = rows.slice(ceil(0.5 * rows.length)).reduce(average, 0);\n    // This (0.2 + 0.1 * beamLength) determines the angle of the beam\n    const positions  = Array.from(rows, (r, i) => (0.2 + 0.1 * beamLength) * i * (endRow - beginRow) / beamLength);\n    const range      = positions[positions.length - 1] - positions[0];\n\n    let diff = stemup ? -50 : 50, d;\n    n = rows.length;\n    while (n--) {\n        d = positions[n] - rows[n];\n        diff = stemup ?\n            d > diff ? d : diff :\n            d < diff ? d : diff ;\n    }\nconsole.log(positions, rows, diff);\n    n = rows.length;\n    while (n--) positions[n] -= diff + rows[0];\n\n    // Apply beamed properties to note symbols and stem heights\n    let r = -1;\n    n = -1;\n    while (note = beam[++n]) {\n        ++r;\n        const beamHeight = (positions[r] - rows[r] + rows[0]) / 8;\n        note.stemup     = stemup;\n        note.beam       = beam;\n        note.stemHeight = stemup ?\n            1 - beamHeight :\n            1 + beamHeight ;\n\n        // Find all other notes at beat\n        while (beam[++n] && eq(beam[n].beat, note.beat, p16)) {\n            beam[n].stemup     = stemup;\n            beam[n].beam       = beam;\n            beam[n].stemHeight = stemup ?\n                1 + (beam[n].row - note.row) / 8 - beamHeight :\n                1 + (beam[n].row - note.row) / 8 + beamHeight ;\n        }\n\n        --n;\n    }\n\n    // Push the beam into symbols\n    symbols.push(assign(beam, {\n        pitch: beam[0].pitch,\n        y:     positions[0],\n        duration,\n        stemup,\n        range,\n        id: ++beamId\n    }));\n\n    return symbols;\n}\n\n\n/* Rests */\n\nfunction fitDottedDuration(min, duration) {\n    let grain = 2 * ceilPow2(duration);\n    while ((grain /= 2) > min / 2) {\n        if (1.75 * grain === duration) return 1.75 * grain;\n        if (1.5  * grain === duration) return 1.5  * grain;\n        if (grain <= duration) return grain;\n    }\n    return min;\n}\n\nfunction fitRoundedUpDuration(min, duration, maxDuration) {\n    maxDuration = maxDuration || Infinity;\n    let grain = 4 * ceilPow2(duration);\n    while ((grain /= 2) > min / 2) {\n        if (grain <= duration * 2 && grain <= maxDuration) return grain;\n    }\n    return min;\n}\n\nfunction fitDuration(durations, bar, startBeat, stopBeat, beat, eventBeat) {\n    // Some analysis of beats...\n    const minGrain = 0.125;\n    const maxGrain = floorPow2(bar.divisor);\n    const div1     = floor(beat / bar.divisor) * bar.divisor;\n    const grain    = grainPow2(minGrain, maxGrain, beat - div1);\n\n    // Duration decision tree\n\n    // If note is truncated by next event render up to next event\n    if (eventBeat < stopBeat) {\n        // Beat to event beat is a valid head duration\n        if (durations.indexOf(eventBeat - beat) !== -1) return eventBeat - beat;\n\n        // Last divisor crossed\n        const div2 = floor(eventBeat / bar.divisor) * bar.divisor;\n\n        // Beat is on a divisor\n        if (beat === div1) {\n            // If beat to last division is a valid duration\n            if (durations.indexOf(div2 - beat) !== -1) return div2 - beat;\n            // Beat to next divisor\n            const division = div1 + bar.divisor < eventBeat && div1 + bar.divisor;\n            if (division) return division - beat;\n            // Get the power of 2 duration before eventBeat\n            return fitDottedDuration(0.125, eventBeat - beat);\n        }\n\n        // Event beat is on a divisor\n        if (eq(eventBeat, div2, p16)) {\n            // Otherwise up to the nearest division\n            const division = div1 + bar.divisor < eventBeat && div1 + bar.divisor;\n            if (division && durations.indexOf(division - beat) !== -1) return division - beat;\n            // Otherwise fill the grain\n            // Is this good ??????\n            return grain;\n        }\n    }\n\n    // If beat to last division is a valid duration\n    const div2 = floor(stopBeat / bar.divisor) * bar.divisor;\n\n    // Beat is on a divisor\n    if (beat === div1) {\n        // Beat to stop beat is a valid head duration\n        if (durations.indexOf(stopBeat - beat) !== -1) return stopBeat - beat;\n        // If beat to last division is a valid duration\n        if (durations.indexOf(div2 - beat) !== -1) return div2 - beat;\n        // Beat to divisor\n        const division = div1 + bar.divisor < stopBeat && div1 + bar.divisor;\n        if (division) return division - beat;\n        // Get the next power of 2 duration after stopBeat but before eventBeat\n        return fitRoundedUpDuration(0.125, stopBeat - beat, eventBeat - beat);\n    }\n    // Stop beat is on a divisor\n    else if (eq(stopBeat, div2, p16)) {\n        // If beat to stop beat is a valid duration use it\n        if (durations.indexOf(stopBeat - beat) !== -1) return stopBeat - beat;\n        // Otherwise up to the nearest division\n        const division = div1 + bar.divisor < stopBeat && div1 + bar.divisor;\n        if (division && durations.indexOf(division - beat) !== -1) return division - beat;\n        // Otherwise fill the grain\n        return grain;\n    }\n    else {\n        const quadDuration = 4 * grain;\n        const quadIndex    = ((beat - div1) % quadDuration) / grain;\n\n        if (quadIndex === 1) {\n            // If this note takes us up to note at 0001 render the duration 0--0\n            if (beat + 2 * grain === eventBeat) return 2 * grain;\n\n            // Is event inside the quadruplet?\n            if (beat + 3 * grain >= eventBeat) {\n                console.log('Next event beat is inside quaduplet');\n            }\n\n            // Grain is less than 1\n            return grain < 1 ?\n                // If stop beat is greater than half of three grains render duration 0---\n                stopBeat >= beat + grain * 3/2 ? 3 * grain :\n                // Otherwise render duration 0-00\n                stopBeat >= beat + grain ? grain :\n                // Stop beat is smaller than grain, fit an appropriate duration\n                fitDottedDuration(0.125, stopBeat - beat) :\n            // Grain is 1 or greater and\n                // stop beat is after 3 grains render 0---\n                stopBeat >=  beat + grain * 3 ? grain * 3 :\n                // Stop beat is after 2 grains render 0--0\n                stopBeat >=  beat + grain * 2 ? grain * 2 :\n                // Stop beat is after 1 grain render  0-00\n                stopBeat > beat + grain ? grain :\n                // Stop beat is shorter than a grain\n                fitDottedDuration(0.125, stopBeat - beat) ;\n        }\n\n            // stop beat is after 4th grain render 000-\n        return stopBeat > beat + grain ? grain :\n            // Stop beat is shorter than grain\n            fitDottedDuration(0.125, stopBeat - beat) ;\n    }\n}\n\nfunction createRest(durations, bar, stave, part, stopBeat, beat) {\n    // Create rest symbol\n    return {\n        type: 'rest',\n        beat,\n        duration: fitDuration(durations, bar, beat, stopBeat, beat, stopBeat),\n        stave,\n        part\n    };\n}\n\nfunction createRests(symbols, durations, bar, stave, part, beat, tobeat) {\n    // Insert rests frombeat - tobeat\n    while (gt(beat, tobeat, p16)) {\n        const rest = createRest(durations, bar, stave, part, tobeat, beat);\n        symbols.push(rest);\n        beat += rest.duration;\n    }\n\n    return tobeat;\n}\n\n\n/* Accidentals */\n\nfunction createAccidental(part, accidentals, beat, note, clump, cluster) {\n    const { pitch, event, row } = note;\n    const acci =\n        rsharp.test(pitch) ? 1 :\n        rflat.test(pitch) ? -1 :\n        undefined ;\n\n    // Line name is note name + octave (no # or b)\n    const line = pitch[0] + pitch.slice(-1);\n\n    // If accidental is already in bar's current accidentals do nothing\n    if (acci === accidentals[line]) return;\n\n    // Alter current state of bar accidentals\n    accidentals[line] = acci;\n\n    // Return accidental symbol\n    return {\n        type: 'acci',\n        beat,\n        pitch,\n        row,\n        // An index of overlapping accidentals\n        clump,\n        // Whether the corresponding note head is on the wrong side of its stem\n        cluster,\n        part,\n        event,\n        value: acci || 0\n    };\n}\n\nfunction getAccidentalAboveRowAtBeat(symbols, beat, maxRow) {\n    let n = -1, symbol, row = 0, o;\n    while (symbol = symbols[++n]) if (\n        symbol.type === 'acci'\n        && symbol.beat === beat\n        && symbol.row < maxRow\n        && symbol.row > row\n    ) {\n        row = symbol.row;\n        o = n;\n    }\n\n    return symbols[o];\n}\n\nfunction createAccidentals(symbols, bar, part, accidentals, beat, notes) {\n    let n = -1, clump = 0, note, accidental, above;\n\n    // This only looks for clusters within the current part – but its a start\n    const cluster = !!notes.find((note) => note.stemup ?\n        // Stem up, bottom not should not be clustered\n        note.clusterup % 2 === 1 :\n        // Stem down, top note cannot be clustered\n        note.clusterdown % 2 === 1\n    );\n\n    while (note = notes[++n]) {\n        // If event started before this bar we don't require an accidental\n        if (lt(bar.beat, note.event[0], p16)) continue;\n\n        // Find existing accidental above this one\n        above = getAccidentalAboveRowAtBeat(symbols, beat, note.row);\n\n        // Is any new accidental part of a clump\n        clump = above && above.row - note.row < 6 ?\n            above.cluster === cluster ?\n                above.clump + 1 :\n                0 :\n            0 ;\n\n        // Create accidental symbol\n        accidental = createAccidental(part, accidentals, beat, note, clump, cluster);\n\n        // Push it into symbols\n        if (accidental) symbols.push(accidental);\n    }\n}\n\n\n/* Accents */\n\nfunction createAccents(symbols, stave, part, beat, notes, settings) {\n    // Find max dynamic among all notes\n    let maxDynamic = -Infinity;\n    let n = -1, note, event;\n    while (note = notes[++n]) if (note.dynamic > maxDynamic) {\n        maxDynamic = note.dynamic;\n        event      = note.event;\n    }\n\n    // If max dynamic exceeds accent threshold, create an accent\n    if (notes.length && maxDynamic >= settings.accentThreshold) {\n        const minMaxNote = notes[0].stemup ? notes[notes.length - 1] : notes[0];\n        symbols.push({\n            type:    'accent',\n            beat,\n            pitch:   minMaxNote.pitch,\n            dynamic: maxDynamic,\n            stemup:  minMaxNote.stemup,\n            stave,\n            part,\n            event\n        });\n    }\n}\n\n\n/* Ledger lines */\n\nfunction createLedges(symbols, stave, part, beat, notes) {\n    // Up ledger lines\n    //const { row: maxRow, pitch: maxPitch } = getMaxPitchRow(stave, part, pitches);\n    const maxRow   = notes[0].row;\n    const maxPitch = notes[0].pitch;\n    // Ledges begin two rows away from topPitch, which is the top line\n    let rows = maxRow - (part.topRow || stave.topRow) + 1;\n    if (rows < 0) symbols.push({\n        type: 'ledge',\n        beat,\n        pitch: maxPitch,\n        part,\n        rows\n    });\n\n    // Down ledger lines\n    //const { row: minRow, pitch: minPitch } = getMinPitchRow(stave, part, pitches);\n    const minRow   = notes[notes.length - 1].row;\n    const minPitch = notes[notes.length - 1].pitch;\n    // Ledges begin two rows away from bottomPitch, which is the bottom line\n    rows = minRow - (part.bottomRow || stave.bottomRow);\n    if (rows > 0)  symbols.push({\n        type: 'ledge',\n        beat,\n        pitch: minPitch,\n        part,\n        rows\n    });\n}\n\n\n/* Symbols */\n\nfunction closeTuplet(stave, part, tuplet) {\n    const { beat, duration, divisor } = tuplet;\n\n    // Stem direction\n    const stemup = part.stemup === undefined ?\n        stemupFromSymbols(stave, part, tuplet) :\n        part.stemup ;\n\n    // Apply stem direction to notes\n    let n = -1, symbol;\n    while (symbol = tuplet[++n]) {\n        if (symbol.type === 'note' && !symbol.beam) symbol.stemup = stemup;\n    }\n\n    // Decide on tuplet pitch, effectively vertical row position\n    const centreBeat = beat + 0.5 * duration;\n\n    // Encourage lowest pitch to be 1 octave below top line, ensuring\n    // triplet (with appropriate styling) always sits above the top line\n    const lowestPitchNumber = toNoteNumber(stave.topPitch) - 12;\n\n    let centreNumber;\n    let h = lengthOf(tuplet);\n    // Scan backwards through tuplet until last symbol before centre beat\n    while ((symbol = tuplet[--h]) && symbol.beat > centreBeat);\n    ++h;\n\n    // Scan backwards through tuplet that cross centre beat, get highest pitch\n    while ((symbol = tuplet[--h]) && symbol.beat + symbol.duration > centreBeat) {\n        const number = toNoteNumber(symbol.pitch);\n        if (!centreNumber || number > centreNumber) centreNumber = number;\n    }\n\n    // Scan forwards from first symbol finding highest pitch beginning head\n    let firstNumber = lowestPitchNumber;\n    h = -1;\n    while ((symbol = tuplet[++h]) && symbol.beat < beat + p16) {\n        const number = toNoteNumber(symbol.pitch);\n        if (!firstNumber || number > firstNumber) firstNumber = number;\n    }\n\n    // Scan backwards from last symbol finding highest pitch ending symbol\n    let lastNumber = lowestPitchNumber;\n    h = lengthOf(tuplet);\n    while ((symbol = tuplet[--h]) && symbol.beat > beat + duration - (duration / divisor) - p16) {\n        const number = toNoteNumber(symbol.pitch);\n        if (!lastNumber || number > lastNumber) lastNumber = number;\n    }\n\n    const avgNumber = Math.ceil((firstNumber + lastNumber) / 2);\n    const avgPitch  = toNoteName(avgNumber);\n    if (avgNumber > centreNumber) centreNumber = avgNumber;\n\n    tuplet.pitch  = toNoteName(centreNumber);\n    tuplet.stemup = stemup;\n\n    const diff = lastNumber - firstNumber;\n    tuplet.angle = diff < 0 ?\n        4 * sqrt(-diff) :\n        -4 * sqrt(diff) ;\n}\n\nfunction createTuplet(symbols, bar, stave, key, accidentals, part, beam, settings, beat, duration, divisor, rhythm, notes, events, n) {\n    // Check if we are to interpret swung 8ths or 16ths as straight 8ths or 16ths.\n    // Rhythm is a binary representation of filled divisions where 1 (1) means\n    // an event in the first division, 10 (2) an event in the second division,\n    // 100 (4) an event in the third, and 101 (5) events in first and third, etc.\n    if ((settings.swingAsStraight8ths && duration === 1 || settings.swingAsStraight16ths && duration === 0.5)\n        && divisor === 3\n        && (rhythm === 4 || rhythm === 5)\n    ) {\n        divisor = 2;\n    }\n\n    const division = duration / divisor;\n    const stopBeat = beat + duration;\n    const tuplet   = {\n        type: 'tuplet',\n        beat,\n        duration,\n        divisor,\n        rhythm,\n        part,\n        stave\n    };\n\n    let event;\n\n    // If divisor is not power of two push tuplet symbol\n    if (!isPowerOf2(divisor)) symbols.push(tuplet);\n\n    // While beat is before end of tuplet\n    while (lt(stopBeat, beat, p24)) {\n        // Fill notes with events playing during beat, and leave event as the\n        // next event after beat\n        while ((event = events[++n]) && lte(beat + 0.5 * division, event[0] - bar.beat, p24)) {\n            notes.push(event);\n        }\n        --n;\n\n        // Insert rest\n        if (!notes.length) {\n            symbols.push({ type: 'rest', beat, duration: division, stave, part });\n            beat += division;\n            continue;\n        }\n\n        // Insert heads\n        const noteSymbols = createNoteSymbols(stave, key, part, notes);\n\n        // Create ledgers and accidentals\n        if (noteSymbols.length) {\n            createLedges(symbols, stave, part, beat, noteSymbols);\n            createAccidentals(symbols, bar, part, accidentals, beat, noteSymbols);\n            createAccents(symbols, stave, part, beat, noteSymbols, settings);\n        }\n\n        const stopBeat = min(\n            // Max stop beat of notes\n            notes.reduce(toMaxStopBeat, 0) - bar.beat,\n            // Start beat of next event, if it exists, or end of bar\n            event ? event[0] - bar.beat : bar.duration,\n            // Beat at end of tuplet\n            tuplet.beat + tuplet.duration\n        );\n\n        const duration = max(\n            // Min duration is 1 tuplet division\n            division,\n            // Distance to stop beat rounded to nearest division\n            roundTo(division, stopBeat - beat)\n        );\n\n        // Assign beat, duration to note symbols and push into symbols\n        let p = -1;\n        while (noteSymbols[++p]) symbols.push(assign(noteSymbols[p], {\n            beat,\n            duration\n        }));\n\n        // Push note symbols on to tuplet\n        push(tuplet, ...noteSymbols);\n\n        // Manage beam\n        if (gt(0.5, duration, p24)) {\n            // If there is a beam, close it\n            if (beam) {\n                closeBeam(symbols, stave, part, beam);\n                beam = undefined;\n            }\n        }\n        else if (!beam) beam = {\n            type: 'beam',\n            beat,\n            part\n        };\n\n        // Push note symbols on to beam\n        if (beam) push(beam, ...noteSymbols);\n\n        // Remove notes or insert ties\n        p = notes.length;\n        while (p--) {\n            let stopBeat = getStopBeat(notes[p]) - bar.beat;\n            // Remove notes that end before or near next division, we're done with them\n            if (lte(beat + duration + 0.5 * division, stopBeat, p24)) notes.splice(p, 1);\n            // Add tie to remaining notes\n            else symbols.push({\n                type:   'tie',\n                beat,\n                pitch: noteSymbols[p].pitch,\n                duration,\n                stemup: noteSymbols[p].stemup,\n                part,\n                event: notes[p]\n            });\n        }\n\n        // Update beat\n        beat += duration;\n    }\n\n    if (beam) closeBeam(symbols, stave, part, beam);\n\n    closeTuplet(stave, part, tuplet);\n\n    return n;\n}\n\nexport function createPart(symbols, bar, stave, key = 0, accidentals = {}, part, events, settings = config) {\n    const notes = [];\n    const { headDurations, restDurations } = settings;\n\n    let beat = 0;\n    let n = -1;\n    let event, duration, beam;\n\n    // Ignore events that stop before beat 0. An extra cautious measure because\n    // events array should already start with events at beat 0\n    while ((event = events[++n]) && lte(beat, event[0] + event[4] - bar.beat, p16));\n    --n;\n\n    while (lt(bar.duration, beat, p16)) {\n        // If there's a beam and beat is on a division close it\n        if (beam && bar.divisions.find((division) => eq(beat, division, p16))\n            // or head started after a new division\n            // || getDivision(bar.divisions, , beat)\n        ) {\n            closeBeam(symbols, stave, part, beam);\n            beam = undefined;\n        }\n\n        // If we are not currently in tuplet mode detect the next tuplet\n        const data = detectTuplet(events, bar.beat + beat, bar.duration - beat);\n\n//if (data) console.log(bar.beat, beat, n, event, 'TUPLETS', data.beat, data.duration, 'divisor', data.divisor, data.rhythm, n, events);\n//else console.log(bar.beat, beat, 'DUPLETS', n, events);\n//if (data) console.log(bar.count, beat, 'Rhythm', data.duration, data.divisor, data.rhythm.toString(2).split('').reverse().join(''));\n\n        if (data && !isPowerOf2(data.divisor)) {\n            // Create rests up to tuplet\n            if (gt(beat, data.beat - bar.beat, p16)) createRests(symbols, settings.restDurations, bar, stave, part, beat, data.beat - bar.beat);\n            // Close beam if there any holes in rhythm\n            if (beam && rhythmHasHoles(data.divisor, data.rhythm)) {\n                closeBeam(symbols, stave, part, beam);\n                beam = undefined;\n            }\n            // Render tuplet\n            n = createTuplet(symbols, bar, stave, key, accidentals, part, beam, settings, data.beat - bar.beat, data.duration, data.divisor, data.rhythm, notes, events, n);\n            // Update beat\n            beat = data.beat - bar.beat + data.duration;\n            //\n            continue;\n        }\n\n        // Fill notes with events playing during beat, and leave event as the\n        // next event after beat\n        while ((event = events[++n]) && lte(beat, event[0] - bar.beat, p16)) {\n            notes.push(event);\n        }\n        --n;\n\n        // Sort notes by pitch order, descending (ascending row order)\n        if (stave.pitched) notes.sort(byPitch);\n\n        // Insert rests\n        if (!notes.length) {\n            if (!event) {\n                // If beam close it\n                if (beam) {\n                    // Close the current beam\n                    closeBeam(symbols, stave, part, beam);\n                    beam = undefined;\n                }\n\n                // Fill rest of bar with rests\n                createRests(symbols, settings.restDurations, bar, stave, part, beat, bar.duration);\n                break;\n            }\n\n            // Create rests up to next event\n            const stopBeat = roundTo(0.125, event[0] - bar.beat);\n\nif (stopBeat <= beat) {\n    console.log(`Problem at bar ${ bar.count }, moving to next bar ${ beat } ${ stopBeat }`);\n    bar.error = 'Stop beat has ended up less than beat';\n    break;\n}\n\n            if (beam && (\n                // If beam would cross a division\n                getDivision(bar.divisions, beat, stopBeat)\n                // If beam would have a rest longer than an eighth note\n                || stopBeat - beat >= 0.5\n            )) {\n                // Close the current beam\n                closeBeam(symbols, stave, part, beam);\n                beam = undefined;\n            }\n\n            createRests(symbols, restDurations, bar, stave, part, beat, stopBeat);\n            beat = stopBeat;\n            continue;\n        }\n\n        const noteSymbols = createNoteSymbols(stave, key, part, notes);\n\n        // Create ledgers and accidentals\n        if (noteSymbols.length) {\n            createLedges(symbols, stave, part, beat, noteSymbols);\n            createAccidentals(symbols, bar, part, accidentals, beat, noteSymbols);\n            createAccents(symbols, stave, part, beat, noteSymbols, settings);\n        }\n\n        // Original start beat of notes, may be well before beat\n        const startBeat = notes[0][0] - bar.beat;\n        // Max stop beat of notes\n        const stopBeat  = min(bar.duration, notes.reduce(toMaxStopBeat, 0) - bar.beat);\n        // Start beat of next event, if it exists\n        const eventBeat = event && roundTo(0.125, event[0]) - bar.beat;\n        // Duration of next head\n        const duration  = fitDuration(headDurations, bar, startBeat, stopBeat, beat, eventBeat);\n\n        // Assign beat, duration to note symbols and push into symbols\n        let p = -1;\n        while (noteSymbols[++p]) symbols.push(assign(noteSymbols[p], {\n            beat,\n            duration\n        }));\n\n        // If duration is a quarter note or longer close beam\n        if (duration >= 1) {\n            if (beam) {\n                closeBeam(symbols, stave, part, beam);\n                beam = undefined;\n            }\n        }\n        // Otherwise if there is no beam open one\n        else if (!beam) beam = {\n            type: 'beam',\n            beat,\n            part\n        };\n\n        // Push note symbols on to beam\n        if (beam) push(beam, ...noteSymbols);\n\n        // Remove notes or insert ties\n        p = notes.length;\n        while (p--) {\n            let stopBeat = getStopBeat(notes[p]) - bar.beat;\n            // Remove notes that end before or near next beat\n            if (// Note stops before next beat\n                lte(beat + duration, stopBeat, p16)\n                // Note stops within 0.125 + 1/16 of its own true duration of next beat\n                || stopBeat - (beat + duration) < 0.125 + (1/16) * (getStopBeat(notes[p]) - notes[p][0])) {\n                notes.splice(p, 1);\n            }\n            // Add tie to remaining notes\n            else symbols.push({\n                type:   'tie',\n                beat,\n                pitch: noteSymbols[p].pitch,\n                duration,\n                stemup: noteSymbols[p].stemup,\n                part,\n                event: notes[p]\n            });\n        }\n\n        // Update beat\n        beat += duration;\n    }\n\n    // If there's still a beam close it\n    if (beam) closeBeam(symbols, stave, part, beam);\n\n    return symbols;\n}\n", "import matches from 'fn/matches.js';\nimport nothing from 'fn/nothing.js';\nimport { toRootName, toRootNumber } from 'midi/note.js';\nimport { toKeyNumber, keyToRootNumber, rootToKeyNumber } from 'sequence/modules/event/keys.js';\nimport { toChordName } from 'sequence/modules/event/chords.js';\nimport mod12       from './number/mod-12.js';\nimport toStopBeat from './event/to-stop-beat.js';\nimport { keyToNumbers, keyWeightsForEvent, chooseKeyFromWeights } from './keys.js';\nimport { byFatherCharlesPitch, accidentalChars } from './pitch.js';\nimport { major } from './scale.js';\nimport { createPart } from './part.js';\nimport getStopBeat from './event/to-stop-beat.js';\nimport config     from './config.js';\n\nconst barDivisions = {\n    // 2/2\n    '2,2': [2],\n    // 3/2\n    '3,2': [2,4],\n    // 2/4\n    '2,1': [1],\n    // 3/4\n    '3,1': [1,2],\n    // 4/4\n    '4,1': [2],\n    // 6/8\n    '3,0.5': [1.5],\n    // 6/8\n    '3,1.5': [1.5],\n    // 12/8\n    '12,0.5': [1.5,3,4.5]\n};\n\nconst rslashbass = /\\/\\{(\\d{1,2})\\}$/;\n\n/**\ngetBarDivisions(meter)\nGets bar divisions from `meter` event.\n**/\n\nexport function getBarDivisions(meter) {\n    return barDivisions[meter[2] + ',' + meter[3]] || nothing;\n}\n\nexport function getDivisions(duration, divisor) {\n    return barDivisions[duration + ',' + divisor] || nothing;\n}\n\n/**\ngetDivision(divisions, b1, b2)\nGets first bar division from `divisions` where `b1` is before and `b2` after or\non it.\n**/\n\nexport function getDivision(divisions, b1, b2) {\n    let n = -1;\n    while (divisions[++n] && divisions[n] <= b1);\n    // If divisions[n] is undefined, comparison evaluates to false, which is\n    // what we want\n    return b2 > divisions[n] ?\n        divisions[n] :\n        undefined ;\n}\n\nexport function getLastDivision(divisions, b1, b2) {\n    let n = divisions.length;\n    while (divisions[--n] && divisions[n] >= b2);\n\n    // If divisions[n] is undefined, comparison evaluates to false, which is\n    // what we want\n    return b1 < divisions[n] ?\n        divisions[n] :\n        undefined ;\n}\n\n\n\nconst ignoreTypes = [];\n\nfunction updateAccidentals(accidentals, key) {\n    const numbers = keyToNumbers(key);\n\n    numbers.reduce((accidentals, n, i) => {\n        const acci = n - major[i];\n        if (acci !== 0) {\n            const name = toRootName(major[i]);\n            let n = 10;\n            while (n--) accidentals[name + n] = acci;\n        }\n        return accidentals;\n    }, accidentals);\n\n    return accidentals;\n}\n\nfunction substituteSpelling(settings, name) {\n    if (name === 'C♭' && settings.spellChordRootCFlatAsB)  return 'B';\n    if (name === 'E♯' && settings.spellChordRootESharpAsF) return 'F';\n    if (name === 'B♯' && settings.spellChordRootBSharpAsC) return 'C';\n    if (name === 'F♭' && settings.spellChordRootFFlatAsE)  return 'E';\n    return name;\n}\n\nfunction createBarSymbols(symbols, bar, stave, key, accidentals, events, settings) {\n    let n = -1;\n    let event;\n\n    while (event = events[++n]) switch (event[1]) {\n        case \"key\": {\n            const key = toKeyNumber(event[2]);\n            updateAccidentals(accidentals, key);\n            // TODO: Key is global and added to the side bar, we need to think about\n            // how to make key signature changes\n            // symbols.push.apply(symbols, stave.createKeySymbols(key));\n            bar.key = key;\n            break;\n        }\n\n        case \"meter\": {\n            symbols.push({\n                type:        'timesig',\n                beat:        0,\n                numerator:   event[3] === 1.5 ? event[2] / 0.5 : event[2] / event[3],\n                denominator: event[3] === 1.5 ? 8 : 4 / event[3],\n                stave,\n                event\n            });\n\n            break;\n        }\n\n        case \"symbol\": {\n            symbols.push({\n                type: 'symbol' + event[2],\n                stave\n            });\n\n            break;\n        }\n\n        case \"chord\": {\n            const beat       = event[0] - bar.beat;\n            const keyWeights = keyWeightsForEvent(events, n, key);\n            const keyNumber  = chooseKeyFromWeights(keyWeights);\n            const extension  = toChordName(event[3]);\n            const slashbass  = rslashbass.exec(extension);\n\n            let root, bass, name;\n\n            if (slashbass) {\n                const n = parseInt(slashbass[1], 10);\n                root = stave.getSpelling(keyNumber, mod12(event[2] - n));\n                bass = stave.getSpelling(keyNumber, event[2]);\n                name = substituteSpelling(settings, root) + extension.replace(rslashbass, '/' + substituteSpelling(settings, bass));\n            }\n            else {\n                root = stave.getSpelling(keyNumber, event[2]);\n                name = substituteSpelling(settings, root) + extension;\n            }\n\n            symbols.push({\n                type: 'chord',\n                beat,\n                name,\n                // Does chord cross into next bar? The symbol should not\n                duration: event[0] + event[4] > bar.beat + bar.duration ?\n                    bar.duration - beat :\n                    event[4],\n                event,\n                stave\n            });\n\n            break;\n        }\n\n        case \"text\": {\n            const beat = event[0] - bar.beat;\n            symbols.push({\n                type: 'text',\n                beat,\n                // Does chord cross into next bar? The symbol should not\n                duration: event[0] + event[3] > bar.beat + bar.duration ?\n                    bar.duration - beat :\n                    event[3],\n                value: event[2],\n                event,\n                stave\n            });\n\n            break;\n        }\n\n        case \"sequence\": {\n            // Put a double bar line at the end of bar\n            // symbols.push({ type: 'doublebarline', stave, event });\n            bar.doubleBarLine = true;\n            break;\n        }\n\n        default: {\n            if (ignoreTypes.includes(event[1])) return;\n            console.log('Scribe: ignoring event type \"' + event[1] + '\"');\n        }\n    };\n\n    return symbols;\n}\n\nexport function createBar(count, beat, duration, divisor, stave, key, events, parts, sequence, settings = config) {\n    const symbols = [];\n\n    // Track end of sequence and shove in a double bar line\n    if (sequence) {\n        const sequenceStop = toStopBeat(sequence);\n        if (sequenceStop > beat && sequenceStop <= beat + duration) {\n            events.push(sequence);\n        }\n    }\n\n    // Populate accidentals with key signature sharps and flats\n    const accidentals = updateAccidentals({}, key);\n\n    const bar = {\n        type: 'bar',\n        beat,\n        duration,\n        key,\n        divisor: divisor || 4,\n        divisions: getDivisions(duration, divisor),\n        stave,\n        count,\n        symbols\n    };\n\n    // Populate symbols with events\n    createBarSymbols(symbols, bar, stave, key, accidentals, events, config);\n\n    // Populate symbols with parts\n    const centers = stave.parts.reduce((centers, part) => part.centerRow ?\n        centers.add(part.centerRow) :\n        centers,\n        new Set()\n    );\n    if (!centers.size) centers.add(stave.centerRow);\n\n    let part;\n    for (part of stave.parts) {\n        const events = parts[part.name];\n        if (!events || !events.length) continue;\n        centers.delete(part.centerRow || stave.centerRow);\n        createPart(symbols, bar, stave, key, accidentals, part, events, settings);\n    }\n\n    let center;\n    for (center of centers) {\n        createPart(symbols, bar, stave, key, accidentals, { centerRow: center }, [], settings);\n    }\n\n    return bar;\n}\n", "\nimport get        from 'fn/get.js';\nimport overload   from 'fn/overload.js';\nimport { toNoteNumber, toRootName, toRootNumber } from 'midi/note.js';\nimport join       from './object/join.js';\nimport toStopBeat from './event/to-stop-beat.js';\nimport { createBar }  from './bar.js';\nimport getStopBeat from './event/to-stop-beat.js';\nimport config     from './config.js';\n\n\n/* Bar repeats */\n\nfunction ignoreKeys(key, value) {\n    if (key === \"stave\" || key === \"event\" || key === \"sequence\" || key === \"beam\") return undefined;\n    return value;\n}\n\nfunction jsonifyBar(bar) {\n    const clone = bar.symbols.filter((symbol) => symbol.type === 'chord' || symbol.type === 'note');\n    return JSON.stringify(clone, ignoreKeys);\n}\n\nfunction replaceWithRepeat(bar, count) {\n    bar.symbols = bar.symbols\n        .filter((symbol) => symbol.type === 'doublebarline' || symbol.type === 'clef')\n        .concat([{\n            type: 'barrepeat',\n            count,\n            duration: bar.duration\n        }]);\n}\n\nfunction detectBarRepeats(bars, jsons, bar) {\n    const json = jsonifyBar(bar);\n\n    switch (jsons.length) {\n        case 1: break;\n        case 2: break;\n        case 3: {\n            // If bars have no events of interest they are just rests, we don't\n            // want to bar repeat rest bars\n            if (json === '[]' && jsons[0] === '[]') {\n                jsons.length = 0;\n            }\n            // When jsons reaches 3 check for 3 bar repeats, or 4 identical bars\n            else if (json === jsons[0] && json === jsons[1] && json === jsons[2] && bar.symbols.filter((symbol) => symbol.type !== 'clef' && symbol.type !== 'timesig').find((symbol) => symbol.type !== 'rest')) {\n                // Replace the last three bars with single bar repeat symbols\n                replaceWithRepeat(bars[bars.length - 2], 1);\n                replaceWithRepeat(bars[bars.length - 1], 1);\n                replaceWithRepeat(bar, 1);\n            }\n            else if (json !== jsons[1] || jsons[0] !== jsons[2]) {\n                // There is no double bar repeat cooking return to testing for\n                // single bar repeats\n                jsons.length = 2;\n            }\n\n            break;\n        }\n\n        case 4: {\n            // If all are equal two single bar repeats were already inserted\n            // in case 3. Lucky us. Add another.\n            if (json === jsons[0] && json === jsons[1] && json === jsons[2] && json === jsons[3]) {\n                // Replace the last bar with a single bar repeat symbol\n                replaceWithRepeat(bar, 1);\n                // Come back to case 4 on the next iteration\n                jsons.length = 3;\n            }\n            else if (json !== jsons[1] || jsons[0] !== jsons[2] || json !== jsons[3]) {\n                // There is no double bar repeat cooking and we got here we know\n                // we've been bar repeat mode (do we?), go back to testing for\n                // single bar repeats\n                jsons.length = 2;\n            }\n\n            break;\n        }\n\n        case 5: {\n            // When jsons reaches 5 check for two double bar repeats, or six\n            // bars of identical materiel\n            if (json === jsons[1] && json === jsons[3] && jsons[0] === jsons[2] && jsons[0] === jsons[4]) {\n                // Lop off the previous 2 bars\n                bars.length -= 2;\n                // Replace the last 2 bars with two bars of double bar repeat\n                // symbol\n                replaceWithRepeat(bars[bars.length - 1], 2);\n                replaceWithRepeat(bar, 2);\n            }\n            else {\n                // Go back to testing case 5 ?? What about single repeats?\n                jsons.length = 4;\n            }\n\n            break;\n        }\n\n        case 6: break;\n        case 7: {\n            // Double bars have already been added, determine whether we add another\n            if (json === jsons[1] && json === jsons[3] && jsons[0] === jsons[2] && jsons[0] === jsons[4]) {\n                // Lop off the previous bar\n                bars.length -= 1;\n                // Replace last bar with a double bar symbol\n                replaceWithRepeat(bar, 2);\n                // Prevent another double from happening on the very next bar,\n                // go back to case 6, thus case 7 in two iterations\n                jsons.length = 5;\n            }\n            else {\n                // Prevent another double from happening on the very next bar\n                jsons.length = 1;\n            }\n\n            break;\n        }\n    }\n\n    jsons.unshift(json);\n    while (jsons.length > 8) jsons.pop();\n}\n\n\n/* Bars */\n\nfunction pushEventToPart(stave, parts, event) {\n    const part = event.target ?\n        // TEMP Experimental parts syphoner - but is this the way to do it?\n        stave.parts[event.target] :\n        // Stave decides on part automatically\n        stave.getPart(event[2]) ;\n\n    const partEvents = parts[part.name] || (parts[part.name] = []);\n    parts[part.name].push(event);\n}\n\nexport default function createBars(sequence, excludes, stave, settings = config) {\n    const scribeEvents = [];\n    const bars  = [];\n    const ties  = [];\n    const jsons = [];\n\n    let beat   = 0;\n    let events = [];\n    let parts  = {};\n    let key    = 0;\n    let stopBeat = 0;\n    let duration, divisor, event, sequenceEvent;\n\n    // Extract events from sequence iterator\n    for (event of sequence) {\n        // Store all events for the key analyser. We know event is an object at\n        // this point, as the iterator emits transformed objects, so use the\n        // event to pass the info down\n        event.scribeIndex  = scribeEvents.length;\n        event.scribeEvents = scribeEvents;\n        scribeEvents.push(event);\n\n        if (excludes.includes(event[1])) continue;\n\n        // If event is beyond current duration create bars\n        while (event[0] >= beat + duration) {\n            // Close current bar, push to bars\n            const bar = createBar(bars.length + 1, beat, duration, divisor, stave, key, events, parts, sequenceEvent, settings);\n            detectBarRepeats(bars, jsons, bar);\n            bars.push(bar);\n            key = bar.key;\n\n            // Update beat, start new accumulators\n            beat = beat + duration;\n            events = [];\n            parts  = {};\n\n            let t = -1;\n            while (ties[++t]) {\n                pushEventToPart(stave, parts, ties[t]);\n                // If event does not extend beyond bar remove it from ties\n                if (toStopBeat(ties[t]) < beat + duration) ties.splice(t--, 1);\n            }\n        }\n\n        switch (event[1]) {\n            case \"note\": {\n                // Note events are pushed to parts\n                pushEventToPart(stave, parts, event);\n                // If event extends beyond bar push it into ties\n                if (toStopBeat(event) > beat + duration) ties.push(event);\n                if (stopBeat < toStopBeat(event)) stopBeat = toStopBeat(event);\n                break;\n            }\n\n            case \"sequence\": {\n                if (event.events === sequence.events) sequenceEvent = event;\n                if (stopBeat < toStopBeat(event)) stopBeat = toStopBeat(event);\n                break;\n            }\n\n            case \"meter\": {\n                duration = event[2];\n                divisor  = event[3];\n\n                // If meter event does not land on current bar beat\n                if (event[0] !== beat) {\n                    // Create bar prematurely and start a new one, or error out?\n                    console.log('TODO');\n                }\n            }\n\n            default: {\n                events.push(event);\n            }\n        }\n    }\n\n    // There are still events with long durations to symbolise into bars\n    while (ties.length) {\n        // Close current bar, push to bars\n        const bar = createBar(bars.length + 1, beat, duration, divisor, stave, key, events, parts, sequenceEvent, settings);\n        detectBarRepeats(bars, jsons, bar);\n        bars.push(bar);\n\n        // Update beat, start new arrays\n        beat = beat + duration;\n        events = [];\n        parts  = {};\n\n        let t = -1;\n        while (event = ties[++t]) {\n            pushEventToPart(stave, parts, event);\n            // If event does not extend beyond bar remove it from ties\n            if (toStopBeat(event) < beat + duration) ties.splice(t--, 1);\n        }\n    }\n\n    // Make sure we render up to full duration of note or sequence events\n    // TODO: Surely we can find a more elegant way of doing this... do we really\n    // still need the ties array? Can we not get rid of the loop above?\n    while (beat < stopBeat - duration) {\n        // Close current bar, push to bars\n        const bar = createBar(bars.length + 1, beat, duration, divisor, stave, key, events, parts, sequenceEvent, settings);\n        detectBarRepeats(bars, jsons, bar);\n        bars.push(bar);\n\n        // Update beat, start new arrays\n        beat = beat + duration;\n        events = [];\n        parts  = {};\n    }\n\n    // If no meter was declared this is a bar with indeterminate duration,\n    // but we do need to know how much duration to render so get it from the\n    // last event: TODO: check all events, the last may not be the longest\n    if (!duration) {\n        duration = scribeEvents.length ?\n            getStopBeat(scribeEvents[scribeEvents.length - 1]) :\n            1 ;\n    }\n\n    // Close final bar, push to bars\n    const bar = createBar(bars.length + 1, beat, duration, divisor, stave, key, events, parts, sequenceEvent, settings);\n    detectBarRepeats(bars, jsons, bar);\n    bars.push(bar);\n\n    // Return bars\n    return bars;\n}\n", "\nimport { toRootNumber, toNoteNumber } from 'midi/note.js';\nimport mod12 from './number/mod-12.js';\n\n/* Event ids */\n\nconst $id = Symbol('scribe-id');\n\nconst map = {};\n\nlet id = 0;\n\nconst weak = new WeakMap();\n\nexport function identify(event) {\n    // Get original event\n    while (event.event) event = event.event;\n\n    if (event[$id]) return event[$id];\n    event[$id] = ++id;\n    map[id] = event;\n    return id;\n}\n\nexport function find(events, id) {\n    return events.find((event) => (event[$id] === id));\n}\n\nexport function retrieve(id) {\n    return map[id];\n}\n\nexport function move(n, event) {\n    event[0] = event[0] + n;\n    return event;\n}\n\nexport function transpose(n, event) {\n    switch (event[1]) {\n        case \"chord\":\n        case \"key\":\n            event[2] = mod12(toRootNumber(event[2]) + n);\n            break;\n        case \"note\":\n        case \"start\":\n        case \"stop\":\n            event[2] = toNoteNumber(event[2]) + n;\n            break;\n        case \"sequence\":\n            console.log('TODO: transpose sequence');\n            break;\n    }\n\n    return event;\n}\n\nexport function durate(n, event) {\n    switch (event[1]) {\n        case \"chord\":\n        case \"note\":\n        case \"sequence\":\n            event[4] = n <= 0 ?\n                event[4] :\n                n ;\n            break;\n    }\n\n    return event;\n}\n", "\nimport create from 'dom/create.js';\nimport rect   from 'dom/rect.js';\n\n/* Beams */\n\nexport const beamThickness = 1.1;\n\nfunction getDataBeat(note) {\n    return parseFloat(note.dataset.beat);\n}\n\nfunction getDataDuration(note) {\n    return parseFloat(note.dataset.duration);\n}\n\nfunction removeBeamPaths(svg) {\n    const childNodes = svg.childNodes;\n    while (childNodes.length > 1) {\n        svg.removeChild(svg.lastChild);\n    }\n}\n\nfunction renderPathData(range, xs, beam, beat, duration) {\n    const i0 = beam[0];\n\n    const x0 = beam.length === 1 ?\n        // If beat is divisible by 2 x duration the sub beam projects forward\n        beat % (duration * 2) === 0 ?\n            // Forward tail beam starts at i0\n            xs[i0] :\n            // Backward tail beam starts before i0\n            xs[i0] - 0.4 * (xs[i0] - xs[i0 - 1]) :\n        // Beam spans whole duration\n        xs[i0] ;\n\n    const x1 = beam.length === 1 ?\n        // If beat is divisible by 2 x duration the sub beam projects forward\n        beat % (duration * 2) === 0 ?\n            // Forward tail beam stops after i0\n            xs[i0] + 0.5 * (xs[i0 + 1] - xs[i0]) :\n            // Backward tail beam stops at i0\n            xs[i0] :\n        // Beam spans whole duration\n        xs[beam[beam.length - 1]] ;\n\n    return `M${ x0 }, ${ -range * x0 - 0.5 * beamThickness }\n        L${ x1 },${ -range * x1 - 0.5 * beamThickness }\n        L${ x1 },${ -range * x1 + 0.5 * beamThickness }\n        L${ x0 }, ${ -range * x0 + 0.5 * beamThickness }\n        Z` ;\n}\n\nfunction createBeamPaths(svg, beats, durations, xs, i, range, duration) {\n    // Don't render anything shorter than triplet 32nd note beams\n    if (duration < 0.0833) return;\n\n    let n = i - 1;\n    let beam;\n\n    while (durations[++n]) {\n        if (durations[n] <= duration) {\n            // Push to existing beam\n            if (beam) { beam.push(n); }\n            // Or start new beam\n            else { beam = [n]; }\n        }\n        // Render beam\n        else if (beam) {\n            svg.appendChild(create('path', {\n                // Remember duration is the duration of the beam above this one\n                class: `beam-path-${ 4 / duration } beam-path`,\n                d: renderPathData(range, xs, beam, beats[n - 1], duration)\n            }));\n\n            createBeamPaths(svg, beats, durations, xs, beam[0], range, duration / 2);\n            beam = undefined;\n        }\n    }\n\n    // Render beam\n    if (beam) {\n        svg.appendChild(create('path', {\n            class: `beam-path-${ 4 / duration } beam-path`,\n            d: renderPathData(range, xs, beam, beats[n - 1], duration)\n        }));\n\n        createBeamPaths(svg, beats, durations, xs, beam[0], range, duration / 2);\n        beam = undefined;\n    }\n}\n\nexport function renderBeam(svg) {\n    const id        = svg.dataset.beam;\n    const parent    = svg.parentElement;\n    /* There is only one .top-note (or .bottom-note) per beam division, select that */\n    const notes     = Array.from(parent.querySelectorAll('.top-note[data-beam=\"' + id + '\"]'));\n    const beats     = notes.map(getDataBeat);\n    const durations = notes.map(getDataDuration);\n    const box       = svg.viewBox.baseVal;\n    const range =\n        box.y < -0.5 ? box.y + 0.5 :\n        box.height - 1;\n\n    const boxes  = notes.map(rect);\n    const firstX = boxes[0].x;\n    const lastX  = boxes[boxes.length - 1].x;\n    const xs     = boxes.map((box) => (box.x - firstX) / (lastX - firstX));\n\n    removeBeamPaths(svg);\n    createBeamPaths(svg, beats, durations, xs, 0, -range, 0.25);\n}\n", "\nimport * as glyphs from \"./glyphs.js\";\n\nconst raccidental = /♮|(bb|𝄫)|(##|𝄪)|(b|♭)|(#|♯)|(∆)|(-)|(ø)|(°)|(\\+)|(\\d+)/g;\nconst htmls = {\n    0: `<span class=\"glyph glyph-natural\">${ glyphs.acciNatural }</span>`,\n    1: `<span class=\"glyph glyph-doubleflat\">${ glyphs.acciDoubleFlat }</span>`,\n    2: `<span class=\"glyph glyph-doublesharp\">${ glyphs.acciDoubleSharp }</span>`,\n    3: `<span class=\"glyph glyph-flat\">${ glyphs.acciFlat }</span>`,\n    4: `<span class=\"glyph glyph-sharp\">${ glyphs.acciSharp }</span>`,\n    5: `<span class=\"glyph glyph-major\">∆</span>`,\n    6: `<span class=\"glyph glyph-minor\">-</span>`,\n    7: `<span class=\"glyph glyph-halfdim\">ø</span>`,\n    8: `<span class=\"glyph glyph-dim\">°</span>`,\n    9: `<span class=\"glyph glyph-aug\">+</span>`\n};\n\nfunction replacer() {\n    let n = arguments.length - 2;\n    // Numbers\n    if (arguments[--n]) return `<span class=\"glyph glyph-number\">${ arguments[n] }</span>`;\n    // Symbols\n    while (n--) if (arguments[n]) return htmls[n];\n    // Unmatched\n    return '';\n}\n\nexport function toHTML(string) {\n    return string.replace(raccidental, replacer);\n}\n", "\n/* Returns number as string truncated to at most n decimal places with\n   no trailing zeros. */\n\nexport default function truncate(n, number) {\n    return number.toFixed(n).replace(/\\.?0+$/, '');\n}\n", "import get               from 'fn/get.js';\nimport overload          from 'fn/overload.js';\nimport create            from 'dom/create.js';\nimport { toNoteNumber }  from 'midi/note.js';\nimport * as glyphs       from \"./glyphs.js\";\nimport { chordGlyphs }   from \"./glyphs.js\";\nimport { rflat, rsharp } from './pitch.js';\nimport { identify }      from './event.js';\nimport { beamThickness } from './beam.js';\nimport { toHTML }        from './html.js';\nimport map               from './object/map.js';\nimport truncate          from './number/truncate.js';\nimport config            from './config.js';\n\n\nconst abs = Math.abs;\n\nconst acciClasses = {\n    '2':  'acci acci-doublesharp',\n    '1':  'acci acci-sharp',\n    '0':  'acci acci-natural',\n    '-1': 'acci acci-flat',\n    '-2': 'acci acci-doubleflat'\n};\n\nconst acciGlyphs = {\n    '2':  glyphs.acciDoubleSharp,\n    '1':  glyphs.acciSharp,\n    '0':  glyphs.acciNatural,\n    '-1': glyphs.acciFlat,\n    '-2': glyphs.acciDoubleFlat\n};\n\nconst clefGlyphs = {\n    'treble':      glyphs.clefTreble,\n    'treble-down': glyphs.clefTrebleDown,\n    'treble-up':   glyphs.clefTrebleUp,\n    'alto':        glyphs.clefAlto,\n    'bass':        glyphs.clefBass,\n    'drum':        glyphs.clefDrum,\n    'percussion':  glyphs.clefDrum\n}\n\nconst restGlyphs = {\n    // Triplet rests\n    '1.33': glyphs.rest2,\n    '0.67': glyphs.rest1,\n    '0.33': glyphs.rest05,\n    '0.17': glyphs.rest025,\n    '0.08': glyphs.rest0125\n};\n\n//                    (C         )(7            )(sus      )(♭9      )(/G              )\nconst rchordparts = /^([A-G][♭♯]?)([∆\\-ø+°♭♯\\d]*)([a-zA-Z]*)([♭♯]?\\d+)?(?:\\/([A-G][♭♯]?))?$/;\n\n\nfunction toEventIds(symbol) {\n    let n = -1, string = '';\n    while (symbol[++n]) string += (string ? ' ' : '') + identify(symbol[n].event);\n    return string;\n}\n\nfunction toChordHTML($0, $root, $ext, $sub, $sup, $bass) {\n    return toHTML($root)\n        + (($ext || $sub || $sup) ? '<span class=\"chord-ext\">'\n            + ($ext ? toHTML($ext) : '')\n            + ($sub ? '<sub>' + $sub + '</sub>' : '')\n            + ($sup ? toHTML($sup) : '')\n        + '</span>' : '')\n        + ($bass ? '<span class=\"glyph glyph-slash\">' + glyphs.chordBassSlash + '</span><span class=\"chord-bass\">' + toHTML($bass) + '</span>' : '');\n}\n\nexport default overload(get('type'), {\n    barrepeat: (symbol) => create('span', {\n        class: 'barrepeat',\n        html: glyphs['barRepeat' + symbol.count],\n        data: {\n            beat: 0,\n            duration: symbol.duration\n        }\n    }),\n\n    clef: (symbol) => create('span', {\n        class: `${ symbol.clef }-clef clef`,\n        html: clefGlyphs[symbol.clef]\n    }),\n\n    chord: (symbol) => {\n        return create('abbr', {\n            class: \"chord chord-abbr\",\n            title: \"\",\n            html: symbol.name.replace(rchordparts, toChordHTML),\n            data: {\n                beat:     truncate(4, symbol.beat),\n                duration: truncate(4, symbol.duration),\n                event:    identify(symbol.event)\n            }\n        });\n    },\n\n    timesig: (symbol) => symbol.stave.getTimeSigHTML ?\n        create('fragment', symbol.stave.getTimeSigHTML(symbol.numerator, symbol.denominator, identify(symbol.event))) :\n        create('span', {\n            class: \"timesig\",\n            html: `<sup>${ glyphs['timeSig' + symbol.numerator] }</sup>\n                <sub>${ glyphs['timeSig' + symbol.denominator] }</sub>`,\n            data: {\n                event: identify(symbol.event)\n            }\n        }),\n\n    symbolcoda: (symbol) => create('p', {\n        html: glyphs.coda,\n        class: \"coda\"\n    }),\n\n    barcount: (symbol) => create('span', {\n        html: symbol.text,\n        class: \"barcount\"\n    }),\n\n    text: (symbol) => create('span', {\n        class: \"lyric\",\n        part:  \"lyric\",\n        html: symbol.value,\n        data: {\n            beat:     truncate(4, symbol.beat),\n            duration: truncate(4, symbol.duration),\n            event:    identify(symbol.event)\n        }\n    }),\n\n    acci: (symbol) => create('span', {\n        class: (acciClasses[symbol.value] || 'acci') + (symbol.clump ? ' acci-' + symbol.clump : '' ) + (symbol.cluster ? ' acci-cluster' : ''),\n        html: acciGlyphs[symbol.value] || glyphs.acciNatural,\n        data: {\n            beat:  symbol.beat && truncate(4, symbol.beat),\n            pitch: symbol.pitch,\n            part:  symbol.part.name,\n            event: symbol.event && identify(symbol.event)\n        }\n    }),\n\n    accent: (symbol) => {\n        const isMarcato   = symbol.dynamic >= config.marcatoThreshold;\n        const isDrumStave = symbol.stave.type === 'drum' || symbol.stave.type === 'percussion';\n\n        return create('span', {\n            class: `${ symbol.stemup ? 'up' : 'down' }-accent accent${ isMarcato ? ' marcato-accent' : '' }`,\n            html: isDrumStave ?\n                    isMarcato ? symbol.stemup ? glyphs.marcatoUp : glyphs.marcatoDown :\n                symbol.stemup ? glyphs.accentUp : glyphs.accentDown :\n                    isMarcato ? symbol.stemup ? glyphs.marcatoDown : glyphs.marcatoUp :\n                symbol.stemup ? glyphs.accentDown : glyphs.accentUp,\n\n            data: {\n                beat:  truncate(4, symbol.beat),\n                pitch: symbol.pitch,\n                part:  symbol.part.name,\n                event: identify(symbol.event)\n            }\n        });\n    },\n\n    ledge: (symbol) => create('svg', {\n        class:   `${ symbol.rows < 0 ? 'up' : 'down' }-ledge ledge`,\n        viewBox: symbol.rows < 0 ?\n            // Up ledge start from 1 row above stave.topRow\n            `0 ${ 9 + symbol.rows - 0.5 } 5 ${ abs(symbol.rows) }` :\n            // Down ledge starts from 1 row below stave.bottomRow\n            `0 -0.5 5 ${ abs(symbol.rows) }` ,\n        preserveAspectRatio: \"xMidYMin\",\n        html: `\n            <line x1=\"0\" x2=\"5\" y1=\"0\" y2=\"0\"></line>\n            <line x1=\"0\" x2=\"5\" y1=\"2\" y2=\"2\"></line>\n            <line x1=\"0\" x2=\"5\" y1=\"4\" y2=\"4\"></line>\n            <line x1=\"0\" x2=\"5\" y1=\"6\" y2=\"6\"></line>\n            <line x1=\"0\" x2=\"5\" y1=\"8\" y2=\"8\"></line>\n        `,\n        data: {\n            beat:  truncate(4, symbol.beat),\n            pitch: symbol.pitch,\n            part:  symbol.part.name\n        }\n    }),\n\n    note: (symbol) => create('data', {\n        class: `${ symbol.stemup ? 'up-note ' : 'down-note ' }${ symbol.top ? 'top-note ' : '' }${ symbol.bottom ? 'bottom-note ' : '' }${\n            // Stem up\n            symbol.stemup ?\n                // Stem up, bottom not should not be clustered\n                symbol.clusterup % 2 === 1 ? 'cluster-note ' : '' :\n                // Stem down, top note cannot be clustered\n                symbol.clusterdown % 2 === 1 ? 'cluster-note ' : ''\n        }${ symbol.beam ? 'beam-note ' : '' }note`,\n        style: symbol.stemHeight ? `--stem-height: ${ symbol.stemHeight };` : undefined,\n        html:  symbol.stave.getNoteHTML(symbol.pitch, symbol.dynamic, symbol.duration),\n        title: `${ symbol.pitch } (${ toNoteNumber(symbol.pitch) })`,\n        data: {\n            beat:     truncate(4, symbol.beat),\n            duration: truncate(4, symbol.duration),\n            pitch:    symbol.pitch,\n            part:     symbol.part.name,\n            beam:     symbol.beam && symbol.beam.id,\n            event:    identify(symbol.event)\n        }\n    }),\n\n    beam: (symbol, settings) => create('svg', {\n        // 8th note beams can be rendered directly into the grid. Beams for\n        // shorter durations are rendered as a post process once this SVG is in\n        // the DOM and stem positions can be measured. See beam.js.\n        class: `${ symbol.stemup ? 'up' : 'down' }-beam beam`,\n        viewBox: `0 ${ (symbol.range < 0 ? symbol.range : 0) - 0.5 } 1 ${ abs(symbol.range) + 1 }`,\n        preserveAspectRatio: \"none\",\n        style: `--duration: ${ truncate(4, symbol.duration) }; ${ symbol.y ? '--translate-y:' + (symbol.y * 0.125) + ';' : '' } height: ${ (abs(symbol.range) + beamThickness) * 0.125 }em; align-self: ${ symbol.range < 0 ? 'end' : 'start' };`,\n        html: `<path class=\"beam-path\" d=\"M0,${ -0.5 * beamThickness } L1,${ symbol.range - 0.5 * beamThickness } L1,${ symbol.range + 0.5 * beamThickness } L0,${ 0.5 * beamThickness } Z\"></path>`,\n        data: {\n            beat:     truncate(4, symbol.beat),\n            pitch:    symbol.pitch,\n            part:     symbol.part.name,\n            beam:     symbol.id,\n            events:   toEventIds(symbol)\n        }\n    }),\n\n    tie: (symbol) => create('svg', {\n        class: `${ symbol.stemup ? 'down' : 'up' }-tie tie`,\n        viewBox: `0 0 1 1`,\n        preserveAspectRatio: \"none\",\n        html: `<path class=\"tie-path\" transform=\"translate(0, 0.14) scale(1 0.6)\" d=\"M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307\"></path>`,\n        data: {\n            beat:     truncate(4, symbol.beat),\n            pitch:    symbol.pitch,\n            duration: truncate(4, symbol.duration),\n            part:     symbol.part.name,\n            event:    identify(symbol.event)\n        }\n    }),\n\n    tuplet: (symbol) => create('span', {\n        class: `${ symbol.stemup ? 'up' : 'down' }-tuplet tuplet`,\n        html: glyphs['tuplet' + symbol.divisor],\n        data: {\n            beat:     truncate(4, symbol.beat),\n            pitch:    symbol.pitch,\n            duration: truncate(4, symbol.duration),\n            divisor:  symbol.divisor,\n            // Rhythm is a binary number\n            rhythm:   symbol.rhythm.toString(2).split('').reverse().join(''),\n            part:     symbol.part.name\n        },\n        style: `--angle: ${ symbol.angle }deg;`\n    }),\n\n    rest: (symbol) => create('span', {\n        class: \"rest\",\n        html: restGlyphs[symbol.duration.toFixed(2)]\n            || glyphs['rest' + (symbol.duration + '').replace('.', '')]\n            || '',\n        data: {\n            beat:     truncate(4, symbol.beat),\n            pitch:    symbol.pitch,\n            duration: truncate(4, symbol.duration),\n            part:     symbol.part.name\n        },\n        'aria-hidden': 'true'\n    }),\n\n    default: (function (types) {\n        return function (symbol) {\n            if (types[symbol.type]) return;\n            types[symbol.type] = true;\n            console.log(symbol);\n            console.error('Scribe: symbol type \"' + symbol.type + '\" not rendered');\n        };\n    })({})\n});\n", "\nimport noop from 'fn/noop.js';\n\nconst global = globalThis || window;\nconst colors = {\n    'pink':   '#FE267E',\n    'grey':   '#81868f'\n};\n\nconst log = (global.DEBUG && global.DEBUG.scribe !== false) ?\n    function log($1, $2, $3 = '', $4 = '') {\n        console.log('%cScribe %c' + $1 + ' %c' + $2 + ' %c' + $3 + ' %c' + $4,\n            'color: ' + (colors.pink) + '; font-weight: 300;',\n            'color: ' + (colors.grey) + '; font-weight: 300;',\n            'color: ' + (colors.pink) + '; font-weight: 300;',\n            'color: ' + (colors.grey) + '; font-weight: 300;',\n            'color: ' + (colors.pink) + '; font-weight: 300;'\n        );\n    } :\n    noop ;\n\nexport default log;\n", "\nimport create           from 'dom/create.js';\nimport px               from 'dom/parse-length.js';\nimport rect             from 'dom/rect.js';\nimport SequenceIterator from 'sequence/modules/sequence-iterator.js';\nimport { rootToKeyNumber, toKeyName, toKeyNumber } from 'sequence/modules/event/keys.js';\nimport Stave            from './stave.js';\nimport createBars       from './create-bars.js';\nimport createElement    from './create-element.js';\nimport { renderBeam }   from './beam.js';\nimport * as glyphs      from './glyphs.js';\nimport truncate         from './number/truncate.js';\nimport config           from './config.js';\nimport log              from './log.js';\n\n\nconst global = globalThis || window;\n\n\nfunction isInitialMeterEvent(event) {\n    return event[0] <= 0 && event[1] === 'meter';\n}\n\nfunction isInitialKeyEvent(event) {\n    return event[0] <= 0 && event[1] === 'key';\n}\n\nfunction toElements(nodes, symbol) {\n    const element = createElement(symbol);\n    if (element) { nodes.push(element); }\n    return nodes;\n}\n\nexport function toBarElements(elements, bar) {\n    elements.push(create('div', {\n        class: `${ bar.stave.type }-stave stave ${ bar.doubleBarLine ? 'end-bar ' : '' }bar${ bar.error ? ' error ': '' }`,\n        data: {\n            beat:     bar.beat,\n            duration: bar.duration,\n            count:    bar.count,\n            key:      toKeyName(bar.key),\n            stave:    bar.stave.type\n        },\n        children: bar.symbols.reduce(toElements, [])\n    }));\n\n    return elements;\n}\n\n/* Glyphs for triplet mark d d = d 3 d, instead of saying Swing 8ths, for example\ntext = glyphs.textNoteShort\n    + glyphs.textBeam8Short\n    + glyphs.textNote8Short\n    + '='\n    + glyphs.textNoteShort\n    + ' '\n    + glyphs.textTuplet3Long\n    + glyphs.note05Up\n*/\n\nexport function renderElements(sequence, excludes, clef, keyname, meter, duration = Infinity, transpose = 0, displace = 0, settings = config) {\n    const events = sequence.events;\n\n    // If events contains no initial meter and meter is set, insert a meter event\n    const meterEvent = events.find(isInitialMeterEvent);\n    if (!meterEvent && meter) events.unshift([0, 'meter', meter[2], meter[3]]);\n\n    // If events contains no initial key and keyname is set, insert a key event\n    const keyEvent = events.find(isInitialKeyEvent);\n    if (!keyEvent && keyname) events.unshift([0, 'key', keyname]);\n\n    // Get the stave controller\n    const stave = Stave[clef || 'treble'];\n\n    // Make transforms list\n    const transforms = [];\n    if (transpose) transforms.push(\"transpose\", transpose);\n    if (displace)  transforms.push(\"displace\", displace);\n\n    // Create sequence object\n    const iterator = new SequenceIterator(events, sequence.sequences, transforms);\n\n    // Create bar elements\n    const bars = createBars(iterator, excludes, stave, settings);\n    const elements = bars.reduce(toBarElements, []);\n\n//const keysig = elements[0].querySelectorAll('.acci:not([data-beat])');\n\n    // Creates stave with clef and key signature\n    const bar0      = bars[0];\n    //const key       = rootToKeyNumber(bar0.key);\n    const key       = toKeyNumber(bar0.key);\n    const signature = stave.createSignatureSymbols(key);\n\n    // Quick and dirty way of rendering clefs into left hand side bar\n    const sidebar = create('div', {\n        class: `${ stave.type }-stave signature-stave stave`,\n        children: signature.map(createElement),\n        data: { key: toKeyName(key) }\n    });\n\n    const column = create('div', {\n        id: 'side',\n        class: 'side',\n        data: { key: toKeyName(key) }\n    });\n\n    let n = 24;\n    while (n--) column.appendChild(sidebar.cloneNode(true));\n\n    // Return array of elements\n    elements.unshift(column);\n    return elements;\n}\n\n\nconst heads = [\n    create('span', { html: glyphs.head1, style: 'width: min-content;' }),\n    create('span', { html: glyphs.head2, style: 'width: min-content;' }),\n    create('span', { html: glyphs.head4, style: 'width: min-content;' })\n];\n\nfunction remove(element) {\n    element.remove();\n}\n\nexport function renderStyle(element, root = element) {\n    // Measure head widths. Be aware that root may be a fragment (a shadow root)\n    // and getComputedStyle() won't work on a fragment\n    root.append.apply(root, heads);\n\n    const head1Width = rect(heads[0]).width;\n    const head2Width = rect(heads[1]).width;\n    const head3Width = rect(heads[2]).width;\n    const computed   = window.getComputedStyle(heads[0]);\n    const fontSize   = px(computed.fontSize);\n\n    if (global.DEBUG) log('post render font-size', fontSize, 'heads', `${ head1Width }, ${ head2Width }, ${ head3Width }`);\n\n    heads.forEach(remove);\n\n    // Calculate clef and key signature width\n\n    // TODO: sort out a better system of getting the key signature metrics in here.\n    // One that isn't going to rely on the font so much? Or maybe include the\n    // metrics in the font stylesheet?\n    const side   = root.querySelector('.side');\n    if (!side) return;\n\n    const key    = side.dataset.key;\n    const counts = {'G♭': 6, 'C♯': 5, 'D♭': 5, 'G♯': 4, 'A♭': 4, 'D♯': 3, 'E♭': 3, 'B♭': 2, 'F':  1, 'C':  0, 'G':  1, 'D':  2, 'A':  3, 'E':  4, 'B':  5, 'F♯': 6};\n    const count  = counts[key];\n\n    return `--head-1-size: ${ truncate(6, head1Width / fontSize) }; `\n        + `--head-2-size: ${ truncate(6, head2Width / fontSize) }; `\n        + `--head-4-size: ${ truncate(6, head3Width / fontSize) }; `\n        + `--signature-width: ${ (2.25 + count * 0.625 + 0.625).toFixed(4) }em;`;\n}\n\nexport function renderDOM(element, root = element) {\n    // Render beams\n    root.querySelectorAll('.beam').forEach(renderBeam);\n}\n", "\nimport Signal                    from 'fn/signal.js';\nimport rect                      from 'dom/rect.js';\nimport create                    from 'dom/create.js';\nimport element, { getInternals } from 'dom/element.js';\nimport events                    from 'dom/events.js';\nimport { toRootName, toRootNumber } from 'midi/note.js';\nimport { Sequence }              from 'sequence/module.js';\n\nimport requestData       from '../modules/request-data.js';\nimport parseSource       from '../modules/parse.js';\nimport { timesigToMeter, meterToTimesig } from '../modules/timesig.js';\nimport Stave             from '../modules/stave.js';\nimport { renderElements, renderStyle, renderDOM } from '../modules/render.js';\nimport config            from '../modules/config.js';\n\nconst assign = Object.assign;\nconst define = Object.defineProperties;\n\n/* ScribeMusic.stylesheet */\nconst shadowCSSUrl = new URL('shadow.css', import.meta.url);\nconst stylesheet = Signal.of();\n\n/* Element resizing */\nconst resizes = new ResizeObserver((entries) => {\n    for (const entry of entries) {\n        renderDOM(getInternals(entry.target).shadowRoot);\n    }\n});\n\n\n/* Register <scribe-music> */\n\nexport default define(element('scribe-music', {\n    shadow: `\n        <link rel=\"stylesheet\" href=\"${ shadowCSSUrl }\" />\n    `,\n\n    construct: function(shadow, internals) {\n        // Listen to updates to ScribeMusic.stylesheet and update the link\n        const link = shadow.querySelector('link');\n        if (stylesheet.value) link.href = stylesheet.value;\n\n        // Set up listeners for attribute/property changes\n        internals.data      = Signal.of();\n        internals.clef      = Signal.of('treble');\n        internals.key       = Signal.of('C');\n        internals.meter     = Signal.of(/*[-4, \"meter\", 4, 1]*/);\n        internals.beat      = Signal.of(0);\n        internals.duration  = Signal.of(Infinity);\n        internals.transpose = Signal.of(0);\n        internals.excludes  = Signal.of([]);\n        internals.swingAsStraight8ths  = Signal.of(false);\n        internals.swingAsStraight16ths = Signal.of(false);\n        internals.debug     = Signal.of(false);\n\n        /* Safari has some rounding errors to overcome... */\n        internals.isSafari = navigator.userAgent.includes('AppleWebKit/')\n            && !navigator.userAgent.includes('Chrome/')\n            && !navigator.userAgent.includes('Edge/')\n            && !navigator.userAgent.includes('Gecko/');\n    },\n\n    connect: function(shadow, internals) {\n        // If Safari\n        if (internals.isSafari) {\n            this.classList.add('safari');\n        }\n\n        // Update beams on load and resize\n        resizes.observe(this, { box: 'content-box' });\n\n        // If there is no src use text content as data\n        if (!this.src) {\n            const source = this.textContent.trim();\n            internals.data.value = parseSource(this.type, source);\n        }\n\n        // Listens to changes\n        return Signal.frame(() => {\n            if (!internals.data.value) return;\n\n            const elements = internals.data.value && renderElements(\n                // Events from data\n                Sequence.from(internals.data.value),\n                // Excludes is an array\n                internals.excludes.value,\n                // Clef is a string\n                internals.clef.value,\n                // Key name\n                internals.key.value,\n                // Create an initial [0, \"meter\", ...] event\n                internals.meter.value,\n                // Duration is a number\n                internals.duration.value,\n                // Transpose is a number\n                internals.transpose.value,\n                // Beat is a number\n                internals.beat.value,\n                // Override settings from attributes\n                assign({}, config, {\n                    swingAsStraight8ths:  internals.swingAsStraight8ths.value,\n                    swingAsStraight16ths: internals.swingAsStraight16ths.value\n                })\n            );\n\n            // Clear the shadow DOM of bars and style and put new elements in it\n            shadow.querySelectorAll('.side, .bar, style').forEach((element) => element.remove());\n            shadow.append.apply(shadow, elements);\n            if (!elements) return;\n\n            const style = internals.style = create('style', `:host { ${ renderStyle(this, shadow) } }`);\n            shadow.appendChild(style);\n\n            // Render beams\n            renderDOM(this, shadow);\n\n            // Annoyingly we must wait for fonts to load – this is a safety\n            // render as we cannot gaurantee fonts have loaded on load()\n            // callback as the font stylesheet must be imported outside the\n            // shadow DOM so we cannot track it\n            setTimeout(() => {\n                style.textContent = `:host { ${ renderStyle(this, shadow) } }`;\n                renderDOM(this, shadow);\n            }, 2000);\n\n            // DEBUG\n/*\n            // Does bar contain symbols that add up to longer than bar?\n            if (internals.debug.value) {\n                shadow.querySelectorAll('.bar').forEach((bar) => {\n                    const duration = parseFloat(bar.dataset.duration);\n                    let total = 0;\n                    let b, d;\n\n                    if (bar.querySelector('.barrepeat')) {\n                        return;\n                    }\n\n                    bar.querySelectorAll('.rest[data-duration], .note[data-duration]').forEach((element) => {\n                        // Ignore notes that are at same beat as previous notes\n                        if (b !== parseFloat(element.dataset.beat)) {\n                            b = parseFloat(element.dataset.beat);\n                            d = parseFloat(element.dataset.duration);\n                            total += d;\n                        }\n                    });\n                    if (Math.round(total / 0.0625) !== Math.round(duration / 0.0625)) {\n                        bar.classList.add('error');\n                    }\n                });\n            }\n*/\n        });\n    },\n\n    load: function(shadow, { style }) {\n        // Recalculate when style loads\n        style.textContent = `:host { ${ renderStyle(this, shadow) } }`;\n        renderDOM(this, shadow);\n    },\n\n    disconnect: function() {\n        resizes.unobserve(this);\n    }\n}, {\n    clef: {\n        /**\n        clef=\"treble\"\n        Choose the default clef to render. Not that if the rendered sequence\n        contains clef events, they override this choice. Possible clefs are\n        `\"treble\"`, `\"bass\"`, `\"piano\"`, `\"drum\"`, `\"percussion\"`, `\"chord\"`.\n        **/\n        attribute: function(value) { this.clef = value; },\n\n        /**\n        .clef = \"treble\"\n        Choose the default clef to render. Not that if the rendered sequence\n        contains clef events, they override this choice. Possible clefs are\n        `\"treble\"`, `\"bass\"`, `\"piano\"`, `\"drum\"`, `\"percussion\"`, `\"chord\"`.\n        **/\n        get: function() {  return getInternals(this).clef.value; },\n        set: function(value) {\n            if (!Stave[value]) {\n                console.warn('<scribe-music> Attempt to set invalid clef=\"' + value + '\" ignored');\n                return;\n            }\n\n            getInternals(this).clef.value = value;\n        }\n    },\n\n    key: {\n        /**\n        key=\"C\"\n        Choose the key signature. Defaults to \"C\".\n        **/\n        attribute: function(value) {\n            this.key = value === '' ? 'C' : value;\n        },\n\n        /**\n        .key=\"C\"\n        Choose the key signature.\n        **/\n        get: function() { return getInternals(this).key.value; },\n        set: function(value) {\n            const internals = getInternals(this);\n\n            // Validate\n            if (typeof value !== 'string' || !/^[A-G][#b♯♭]?$/.test(value)) {\n                console.warn('<scribe-music> Attempt to set invalid key=\"' + value + '\" ignored');\n                return;\n            }\n\n            // Set\n            internals.key.value = value.replace(/[#b]$/, ($0) => $0 === '#' ? '♯' : '♭');\n        }\n    },\n\n    meter: {\n        /**\n        meter=\"4/4\"\n        Sets the meter. Note that this is overridden by any `\"meter\"` event\n        found at beat `0` in the data.\n        **/\n        attribute: function(value) {\n            // Default to 4/4 where meter attribute simply exists\n            this.meter = value === '' ? '4/4' : value;\n        },\n\n        /**\n        .meter = \"4/4\"\n        Sets the meter. Note that this is overridden by any `\"meter\"` event\n        found at beat `0` in the data.\n        **/\n        get: function() { return meterToTimesig(getInternals(this).meter.value); },\n        set: function(value) { getInternals(this).meter.value = assign([0], timesigToMeter(value)); }\n    },\n\n    beat: {\n        /**\n        beat=\"0\"\n        Sets beat that notation is rendered from.\n        **/\n        attribute: function(value) { this.beat = value; },\n\n        /**\n        .beat = 0\n        Sets beat that notation is rendered from.\n        **/\n        get: function() { return getInternals(this).beat.value; },\n        set: function(value) {\n            getInternals(this).beat.value = typeof value === 'number' ?\n                value :\n                parseFloat(value) ;\n        }\n    },\n\n    duration: {\n        /**\n        duration=\"0\"\n        Sets duration of notation, in beats.\n        **/\n        attribute: function(value) { this.duration = value; },\n\n        /**\n        .duration = 0\n        Sets duration of notation, in beats.\n        **/\n        get: function() { return getInternals(this).duration.value; },\n        set: function(value) {\n            getInternals(this).duration.value = typeof value === 'number' ?\n                value :\n                parseFloat(value) ;\n        }\n    },\n\n    transpose: {\n        /**\n        transpose=\"0\"\n        Sets transposition value for display of notation.\n        **/\n        attribute: function(value) { this.transpose = value; },\n\n        /**\n        .transpose = 0\n        Sets transposition value for display of notation.\n        **/\n        get: function() { return getInternals(this).transpose.value; },\n        set: function(value) {\n            // Set integer from value\n            getInternals(this).transpose.value = typeof value === 'number' ?\n                Math.round(value) :\n                parseInt(value, 10) ;\n        }\n    },\n\n    type: {\n        /**\n        type=\"application/json\"\n        Mimetype or type of data to fetch. Possible mimetypes:\n        - `\"text/x-abc\"`\n        - `\"text/plain\"`\n        - `\"application/json\"`\n        **/\n        attribute: function(value) { this.type = value; },\n\n        /**\n        .type = \"application/json\"\n        Mimetype or type of data to fetch. Possible mimetypes:\n        - `\"text/x-abc\"`\n        - `\"text/plain\"`\n        - `\"application/json\"`\n        **/\n        writable: true,\n        value: 'application/json'\n    },\n\n    /**\n    src=\"url\"\n    A path to an ABC, JSON or SEQUENCE file\n    **/\n    src: {\n        attribute: function(src) { this.src = src; },\n        get: function() { return getInternals(this).src; },\n        set: function(src) {\n            const internals = getInternals(this);\n            internals.src = src;\n            const url = new URL(src, window.location);\n\n            // src points to a hash in current document\n            if (window.location.origin === url.origin && window.location.pathname === url.pathname) {\n                const script = this.getRootNode().getElementById(url.hash.slice(1));\n                if (!script) throw new Error('<scribe-music> src script \"' + src + '\" not found in document');\n                this.data = JSON.parse(script.textContent);\n            }\n            else {\n                requestData(this.type, url.href)\n                .then((data) => this.data = data);\n            }\n        },\n        default:   null\n    },\n\n    /**\n    .data\n    **/\n    data: {\n        get: function() { return getInternals(this).data.value; },\n        set: function(data) { getInternals(this).data.value = data; },\n        default: null\n    },\n\n    swing: {\n        attribute: function(value) { getInternals(this).swingAsStraight8ths.value = value !== null; }\n    },\n\n    shuffle: {\n        attribute: function(value) { getInternals(this).swingAsStraight16ths.value = value !== null; }\n    },\n\n    debug: {\n        attribute: function(value) { this.debug = value !== null; },\n        get: function() { return getInternals(this).debug.value; },\n        set: function(value) { getInternals(this).debug.value = !!value; }\n    },\n\n    excludes: {\n        attribute: function(string) { return getInternals(this).excludes.value = string.split(/\\s+/); },\n    }\n}, 'stephband.band/scribe/'), {\n    // Define ScribeMusic.styleheet as the stylesheet signal\n    stylesheet: {\n        set: (url) => stylesheet.value = url,\n        get: ()    => stylesheet.value\n    }\n});\n"],
  "mappings": "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",
  "names": ["evaluatingSignal", "hasInvalidDependency", "removeOutput", "signal", "output", "o", "clearInputs", "n", "setDependency", "dependent", "invalidateDependents", "hasInput", "input", "Signal", "_Signal", "object", "value", "ValueSignal", "fn", "context", "PushSignal", "ComputeSignal", "name", "PropertySignal", "FrameSignal", "TickSignal", "TimedSignal", "previous", "evaluatingSignal", "hasInvalidDependency", "#value", "#valid", "#fn", "#context", "#validTime", "time", "isValid", "Observer", "m", "observers", "i", "rendering", "render", "promise", "tick", "frame", "windowBox", "rect", "node", "id", "value", "overload", "fn", "map", "key", "handler", "global", "warned", "cacheByObject", "fn", "map", "object", "value", "global", "A", "applyFn", "fn", "args", "curry", "muteable", "arity", "memo", "cacheByObject", "object", "partial", "_curry", "isFunctionLengthDefineable", "setFunctionProperties", "text", "parity", "fn1", "fn2", "curry_default", "noop", "assignProperty", "overload", "id", "noop", "name", "node", "object", "content", "setAttribute", "assign", "attributes", "names", "n", "assign_default", "curry_default", "svgNamespace", "template", "typeofContent", "type", "content", "createContextFragment", "context", "html", "range", "createSVG", "overload", "tag", "node", "object", "assign_default", "createHTML", "create", "id", "text", "fragment", "create_default", "exec", "regex", "fn", "string", "data", "tokens", "output", "exec_default", "curry_default", "error", "regex", "reducers", "string", "reduce", "acc", "tokens", "n", "capture", "output", "exec", "capture_default", "curry_default", "$internals", "createInternals", "Element", "element", "shadow", "getInternals", "define", "constructors", "formProperties", "name", "getInternals", "supportsCustomisedBuiltIn", "parseNameTag", "capture_default", "data", "captures", "onceEvent", "toLoadPromise", "element", "resolve", "reject", "stop", "object", "getElementConstructor", "tag", "constructor", "transferProperty", "key", "value", "createShadow", "elem", "options", "shadow", "link", "create_default", "fillShadowFromTemplate", "template", "isNotUpgraded", "upgraded", "findByIs", "root", "createDescriptor", "overload", "descriptor", "fn", "definition", "lifecycle", "properties", "log", "attributes", "descriptors", "propname", "Element", "internals", "createInternals", "define", "disabled", "old", "links", "style", "promise", "div", "noop", "upgrade", "store", "n", "attribute", "polyfillByRoot", "to_type_default", "object", "define", "call", "overload", "to_type_default", "fn", "object", "Stopable", "id", "#stopables", "stopables", "throwTypeError", "source", "push", "stream", "value", "n", "stop", "Stopable", "o", "output", "removeInput", "input", "i", "removeOutput", "unpipe", "Consumer", "Each", "fn", "Reduce", "accumulator", "Stream", "inputloop", "values", "BufferStream", "Filter", "FlatMap", "Map", "initial", "Scan", "m", "Slice", "Split", "setResolve", "res", "rej", "noop", "overload", "to_type_default", "object", "PromiseStream", "Value", "inputs", "Merge", "promise", "result", "chunk", "types", "cacheByObject", "clickTimeStamp", "e", "arg", "n", "id", "value", "noop", "self", "create", "freeze", "nothing_default", "noop", "self", "arg", "id", "mod", "d", "n", "slugify", "string", "mod12", "n", "mod", "rnotename", "rnoteroot", "rnoteoctave", "rhz", "noteNumbers", "drumNames", "n", "slugify", "A4", "frequencyToFloat", "freq", "ref", "number", "toNoteNumber", "name", "rhz", "frequencyToFloat", "r", "rnotename", "noteNumbers", "slugify", "toRootNumber", "mod12", "rnoteroot", "noteNames", "toNoteName", "n", "toRootName", "toNoteOctave", "rnoteoctave", "nothing_default", "toDrumName", "number", "drumNames", "toGain", "n", "runit", "parseValue", "units", "string", "entry", "dynamics", "toGain", "parse_gain_default", "parseValue", "string", "mod", "d", "n", "mod12", "n", "mod", "rflatsharp", "flatsharps", "toUnicode", "char", "toObject", "object", "key", "value", "mirror", "TYPENUMBERS", "TYPENAMES", "mirror", "TYPEBYTES", "toTypeName", "value", "CURVENUMBERS", "CURVENAMES", "mirror", "CURVEBYTES", "toCurveName", "value", "get", "key", "object", "get_default", "curry_default", "DEBUG", "floor", "log", "BASE", "MAX_INTERVAL", "MAX_LENGTH", "hsidFrom", "numbers", "id", "n", "m", "interval", "hsidOf", "hsidToNumbers", "cacheByObject", "hsid", "length", "i", "DEBUG", "CHORDENTRIES", "hsidOf", "CHORDNUMBERS", "CHORDNAMES", "mirror", "rparenthesis", "toHSID", "value", "rflatsharp", "toUnicode", "hsidFrom", "toChordName", "hsid", "CHORDIDS", "get_default", "names", "numbers", "number", "name", "assign", "PARAMNAMES", "names", "PARAMNUMBERS", "object", "key", "value", "toParamName", "KEYNUMBERS", "KEYNAMES", "mirror", "toKeyName", "value", "toKeyNumber", "name", "rflatsharp", "toUnicode", "keyToRootNumber", "n", "mod", "rootToKeyNumber", "toRootName", "TRANSFORMNUMBERS", "TRANSFORMNAMES", "mirror", "TRANSFORMBYTES", "TRANSFORMLENGTHS", "toTransformName", "value", "DEBUG", "define", "writable", "arrayify", "event", "array", "n", "stringify", "number", "getEvent", "Event", "_Event", "beat", "type", "toTypeName", "toRootNumber", "toHSID", "toKeyNumber", "toNoteNumber", "parse_gain_default", "toCurveName", "toParamName", "toTransformName", "TRANSFORMNUMBERS", "m", "TRANSFORMLENGTHS", "mod12", "i", "string", "toRootName", "toChordName", "toKeyName", "toNoteName", "data", "index", "events", "isChordEvent", "isNoteEvent", "isSequenceEvent", "matches", "object", "item", "property", "matches_default", "curry_default", "transpose_default", "overload", "n", "event", "toNoteNumber", "toRootNumber", "rootToKeyNumber", "keyToRootNumber", "id", "types", "transforms", "n", "event", "parse_gain_default", "transpose_default", "transform", "type", "assign", "nothing", "done", "priorities", "temp", "priority", "event", "byPriority", "b", "a", "insert", "array", "object", "n", "slice", "i", "getSequence", "sequences", "id", "sequence", "SequenceIterator", "_SequenceIterator", "events", "transforms", "transform", "value", "Event", "iterator", "j", "x", "isSequenceEvent", "assign", "Sequence", "_Sequence", "events", "sequences", "Event", "event", "insert", "beat", "type", "toNoteNumber", "i", "matches_default", "id", "data", "props", "assign", "SequenceIterator", "ROUTEBITS", "PARAMBITS", "CURVEBITS", "ROUTEMASK", "PARAMMASK", "CURVEMASK", "packAddress", "route", "name", "curve", "toRoute", "address", "toParamNumber", "CURVEBITS", "PARAMMASK", "toCurveNumber", "CURVEMASK", "deserialise", "buffer", "view", "events", "offset", "beat", "address", "route", "toRoute", "param", "toParamNumber", "TYPENUMBERS", "Event", "id", "target", "duration", "bytes", "params", "o", "number", "TRANSFORMNUMBERS", "data", "curveNumber", "toCurveNumber", "CURVENUMBERS", "slice", "values", "MAX_TEXT_BYTES", "truncateUTF8", "bytes", "maxLength", "i", "getEventBytes", "event", "type", "t", "TYPENUMBERS", "TYPEBYTES", "encoded", "truncated", "n", "TRANSFORMNUMBERS", "TRANSFORMBYTES", "TRANSFORMLENGTHS", "number", "CURVENUMBERS", "CURVEBYTES", "getAddressFromEvent", "p", "PARAMNUMBERS", "c", "packAddress", "serialise", "events", "buffer", "view", "offset", "Event", "address", "values", "rootId", "hsId", "CHORDNUMBERS", "bassId", "toKeyNumber", "bytesIndex", "name", "clefId", "io_sound_sequence_default", "io_sound_credit_default", "assign", "sequenceSchema", "io_sound_sequence_default", "creditSchema", "io_sound_credit_default", "rdatetime", "raturi", "rhandle", "rnsid", "disallowedTlds", "graphemeSegmenter", "countGraphemes", "str", "textEncoder", "countBytes", "validateFormat", "overload", "id", "format", "name", "value", "e", "tld", "validateRule", "get_default", "rule", "approxBytes", "item", "index", "validateObject", "validateRequired", "required", "data", "schema", "type", "properties", "VERSION", "validateRecord", "record", "toRecord", "sequence", "events", "sequences", "serialise", "fromRecord", "version", "props", "bytes", "Sequence", "deserialise", "assign", "fromData", "Sequence", "data", "fromRecord", "VERSION", "toRecord", "validateRecord", "cacheByKey", "fn", "map", "input", "choose", "map", "key", "params", "fn", "mimetypes", "parse", "type", "string", "mimetype", "xml", "parseHTML", "parseSVG", "assign", "config", "data", "id", "createHeaders", "choose", "headers", "createBody", "formDataToJSON", "formDataToQuery", "dataToQuery", "dataToFormData", "formData", "output", "entry", "params", "key", "urlFromData", "url", "createOptions", "method", "head", "controller", "contentType", "options", "respondBlob", "response", "respondJSON", "respondForm", "respondText", "respondDOM", "text", "parseHTML", "create_default", "respondSVG", "parseSVG", "responders", "respond", "mimetype", "request", "contenttype", "requestGet", "lengths", "rnote", "rroot", "parseSequenceText", "source", "data", "events", "n", "time", "type", "event", "m", "root", "extension", "duration", "value", "fromGist", "gist", "file", "parseSource", "fromTheSession", "object", "song", "type", "source", "parseSequenceText", "events", "requestData", "cacheByKey", "requestGet", "request_data_default", "overload", "type", "value", "url", "requestData", "source", "parseSource", "error", "name", "internals", "rtimesig", "timesigToMeter", "string", "groups", "num", "div", "meterToTimesig", "meter", "dur", "den", "glyphs_exports", "__export", "accentDown", "accentUp", "acciDoubleFlat", "acciDoubleSharp", "acciFlat", "acciNatural", "acciParensLeft", "acciParensRight", "acciSharp", "augmentationDot", "barLine", "barRepeat1", "barRepeat2", "barRepeat4", "barRepeatBegin", "barRepeatDots", "barRepeatEnd", "barRepeatEndBegin", "barRepeatLowerDot", "barRepeatSlash", "barRepeatUpperDot", "chordAugmented", "chordBassSlash", "chordBracketLeft", "chordBracketRight", "chordDiminished", "chordGlyphs", "chordHalfDiminished", "chordMajorSeventh", "chordMinor", "chordParensLeftTall", "chordParensRightTall", "clefAlto", "clefBass", "clefDrum", "clefTreble", "clefTrebleDown", "clefTrebleUp", "coda", "graceNoteStemDown", "graceNoteStemUp", "head1", "head2", "head4", "headBracketLeft", "headBracketRight", "headCircle", "headCircleX", "headDiamond", "headDiamondWide", "headPlus", "headSlashHorizontalEnds", "headSlashVerticalEnds", "headSlashed2", "headTriangleUp", "headX", "marcatoDown", "marcatoUp", "metDot", "metNote05Down", "metNote05Up", "metNote1Down", "metNote1Up", "metNote2Down", "metNote2Up", "note0125Down", "note0125Up", "note025Down", "note025Up", "note05Down", "note05Up", "note1Down", "note1Up", "note2Down", "note2Up", "rest0125", "rest01875", "rest025", "rest0375", "rest05", "rest075", "rest1", "rest15", "rest2", "rest3", "rest4", "rest6", "staccatoDown", "staccatoUp", "tailDown0125", "tailDown025", "tailDown05", "tailUp0125", "tailUp025", "tailUp05", "tenutoDown", "tenutoUp", "textBeam16Long", "textBeam16Short", "textBeam8Long", "textBeam8Short", "textDot", "textNote16Long", "textNote16Short", "textNote8Long", "textNote8Short", "textNoteLong", "textNoteShort", "textTie", "textTuplet3Long", "textTuplet3Short", "textTupletBeginLong", "textTupletBeginShort", "textTupletEndLong", "textTupletEndShort", "timeSig0", "timeSig1", "timeSig2", "timeSig3", "timeSig4", "timeSig5", "timeSig6", "timeSig7", "timeSig8", "timeSig9", "timeSigCommon", "timeSigCutCommon", "tuplet0", "tuplet1", "tuplet2", "tuplet3", "tuplet4", "tuplet5", "tuplet6", "tuplet7", "tuplet8", "tuplet9", "arg", "n", "self", "create", "freeze", "nothing_default", "noop", "self", "arg", "id", "mod12", "n", "mod", "to_duration_default", "overload", "get_default", "event", "toStopBeat", "event", "to_duration_default", "major", "abs", "degreeWeights", "modulationWeights", "factors", "keyToNumbers", "cacheByObject", "key", "root", "keyToRootNumber", "major", "n", "mod12", "keysContainingNote", "number", "keys", "toRootNumber", "i", "multiplyWeights", "weights1", "weights2", "factor", "types", "weights", "event", "influence", "toNoteNumber", "probs", "r", "numbers", "hsidToNumbers", "keyWeightsForEvent", "events", "KEYROOT", "beat", "isNoteEvent", "isChordEvent", "m", "fn", "stopBeat", "toStopBeat", "order", "chooseKeyFromWeights", "value", "rpitch", "rflat", "rsharp", "rflatsharp", "accidentalChars", "fathercharles", "byFatherCharlesPitch", "a", "b", "ai", "bi", "config_default", "parse_gain_default", "accidentals", "floor", "round", "keys", "Stave", "nothing_default", "pitch", "dynamic", "duration", "name", "glyphs_exports", "config_default", "headBracketLeft", "headBracketRight", "n", "min", "toNoteNumber", "max", "number", "part", "row", "toNoteName", "rflatsharp", "names", "key", "withOctave", "keyData", "toRootNumber", "a", "noteNames", "mod12", "accidentals", "o", "notename", "letter", "accidental", "octave", "rpitch", "toNoteOctave", "numbers", "keyToNumbers", "i", "major", "toRootName", "accidentalChars", "byFatherCharlesPitch", "y", "slugify", "string", "toDrumSlug", "number", "slugify", "toDrumName", "DrumStave", "Stave", "#headnames", "#ghostables", "pitch", "dynamic", "duration", "toNoteNumber", "name", "ghostable", "html", "glyphs_exports", "config_default", "headBracketLeft", "headBracketRight", "part", "n", "i", "row", "key", "y", "j", "PercussionStave", "DrumStave", "global", "assign", "PianoStave", "Stave", "numerator", "denominator", "eventId", "glyphs_exports", "part", "pitch", "toNoteName", "name", "rflatsharp", "i", "row", "number", "key", "keysig", "symbols", "symbol", "TrebleUpStave", "Stave", "clefTrebleUp", "TrebleStave", "clefTreble", "TrebleDownStave", "clefTrebleDown", "AltoStave", "clefAlto", "BassStave", "clefBass", "PianoStave", "DrumStave", "PercussionStave", "type", "stave_default", "to_rad_default", "n", "parse_angle_default", "parseValue", "to_rad_default", "id", "n", "string", "rpx", "rangle", "computedStyle", "name", "node", "style", "value", "parse_angle_default", "emSize", "remSize", "getEmSize", "styledFontSize", "style", "getRemSize", "px", "overload", "to_type_default", "id", "parseValue", "n", "parse_length_default", "by", "fn", "a", "b", "fna", "fnb", "by_default", "curry_default", "abs", "EPSILON", "round", "d", "n", "eq", "b", "a", "precision", "lte", "gte", "gt", "lt", "pow", "p24", "tupletDivisors", "minTupletDuration", "tolerance", "stopInfluence", "data", "score", "getScore", "wavelength", "beat", "scoreTupletAtBeat", "duration", "divisor", "events", "tupletDuration", "count", "rhythm", "s", "r", "gt", "toStopBeat", "detectTupletOverDuration", "tuplet", "n", "startbeat", "divisors", "stopBeat", "d", "detectTuplet", "rhythmHasHoles", "ceilPow2", "n", "floorPow2", "isPowerOf2", "n", "grainPower2", "min", "max", "n", "eq", "g", "mod", "push", "object", "value", "n", "a", "lengthOf", "object", "n", "join", "object", "lengthOf", "map", "fn", "object", "array", "n", "assign", "abs", "ceil", "floor", "min", "max", "pow", "sqrt", "round", "p16", "p24", "byRow", "by_default", "get_default", "average", "a", "n", "i", "array", "toMaxStopBeat", "event", "toStopBeat", "byPitch", "b", "toNoteNumber", "createNoteSymbols", "stave", "key", "part", "notes", "symbols", "events", "index", "keyWeights", "keyWeightsForEvent", "keyNumber", "chooseKeyFromWeights", "pitch", "row", "top", "bottom", "minRow", "maxRow", "stemup", "stemupFromRows", "stemHeight", "c", "getMinPitchRow", "pitches", "r", "getMaxPitchRow", "centerRow", "minDiff", "stemupFromPitches", "stemupFromSymbols", "symbol", "beamId", "closeBeam", "beam", "startBeat", "duration", "join", "map", "note", "rows", "eq", "beamLength", "beginRow", "endRow", "positions", "range", "diff", "d", "beamHeight", "fitDottedDuration", "grain", "ceilPow2", "fitRoundedUpDuration", "maxDuration", "fitDuration", "durations", "bar", "stopBeat", "beat", "eventBeat", "maxGrain", "floorPow2", "div1", "grainPower2", "div2", "division", "quadDuration", "createRest", "createRests", "tobeat", "gt", "rest", "createAccidental", "accidentals", "clump", "cluster", "acci", "rsharp", "rflat", "line", "getAccidentalAboveRowAtBeat", "o", "createAccidentals", "accidental", "above", "lt", "createAccents", "settings", "maxDynamic", "minMaxNote", "createLedges", "maxPitch", "minPitch", "closeTuplet", "tuplet", "divisor", "centreBeat", "lowestPitchNumber", "centreNumber", "h", "lengthOf", "number", "firstNumber", "lastNumber", "avgNumber", "avgPitch", "toNoteName", "createTuplet", "rhythm", "isPowerOf2", "lte", "noteSymbols", "p", "push", "createPart", "config_default", "headDurations", "restDurations", "data", "detectTuplet", "rhythmHasHoles", "getDivision", "barDivisions", "rslashbass", "getDivisions", "duration", "divisor", "barDivisions", "nothing_default", "getDivision", "divisions", "b1", "b2", "n", "ignoreTypes", "updateAccidentals", "accidentals", "key", "keyToNumbers", "acci", "major", "name", "toRootName", "n", "substituteSpelling", "settings", "createBarSymbols", "symbols", "bar", "stave", "events", "event", "toKeyNumber", "beat", "keyWeights", "keyWeightsForEvent", "keyNumber", "chooseKeyFromWeights", "extension", "toChordName", "slashbass", "rslashbass", "root", "bass", "mod12", "createBar", "count", "duration", "divisor", "parts", "sequence", "config_default", "sequenceStop", "toStopBeat", "getDivisions", "centers", "part", "createPart", "center", "ignoreKeys", "key", "value", "jsonifyBar", "bar", "clone", "symbol", "replaceWithRepeat", "count", "detectBarRepeats", "bars", "jsons", "json", "pushEventToPart", "stave", "parts", "event", "part", "partEvents", "createBars", "sequence", "excludes", "settings", "config_default", "scribeEvents", "ties", "beat", "events", "stopBeat", "duration", "divisor", "sequenceEvent", "createBar", "t", "toStopBeat", "$id", "map", "id", "identify", "event", "$id", "id", "map", "beamThickness", "getDataBeat", "note", "getDataDuration", "removeBeamPaths", "svg", "childNodes", "renderPathData", "range", "xs", "beam", "beat", "duration", "i0", "x0", "x1", "createBeamPaths", "beats", "durations", "i", "n", "create_default", "renderBeam", "id", "parent", "notes", "box", "boxes", "rect", "firstX", "lastX", "raccidental", "htmls", "acciNatural", "acciDoubleFlat", "acciDoubleSharp", "acciFlat", "acciSharp", "replacer", "n", "toHTML", "string", "truncate", "n", "number", "abs", "acciClasses", "acciGlyphs", "acciDoubleSharp", "acciSharp", "acciNatural", "acciFlat", "acciDoubleFlat", "clefGlyphs", "clefTreble", "clefTrebleDown", "clefTrebleUp", "clefAlto", "clefBass", "clefDrum", "restGlyphs", "rest2", "rest1", "rest05", "rest025", "rest0125", "rchordparts", "toEventIds", "symbol", "n", "string", "identify", "toChordHTML", "$0", "$root", "$ext", "$sub", "$sup", "$bass", "toHTML", "chordBassSlash", "create_element_default", "overload", "get_default", "create_default", "glyphs_exports", "truncate", "coda", "isMarcato", "config_default", "isDrumStave", "marcatoUp", "marcatoDown", "accentUp", "accentDown", "toNoteNumber", "settings", "beamThickness", "types", "global", "colors", "log", "$1", "$2", "$3", "$4", "noop", "log_default", "global", "isInitialMeterEvent", "event", "isInitialKeyEvent", "toElements", "nodes", "symbol", "element", "create_element_default", "toBarElements", "elements", "bar", "create_default", "toKeyName", "renderElements", "sequence", "excludes", "clef", "keyname", "meter", "duration", "transpose", "displace", "settings", "config_default", "events", "stave", "stave_default", "transforms", "iterator", "SequenceIterator", "bars", "createBars", "bar0", "key", "toKeyNumber", "signature", "sidebar", "column", "n", "heads", "head1", "head2", "head4", "remove", "renderStyle", "root", "head1Width", "rect", "head2Width", "head3Width", "computed", "fontSize", "parse_length_default", "log_default", "side", "count", "truncate", "renderDOM", "renderBeam", "assign", "define", "shadowCSSUrl", "stylesheet", "Signal", "resizes", "entries", "entry", "renderDOM", "getInternals", "element_default", "element", "shadow", "internals", "link", "source", "parseSource", "elements", "renderElements", "Sequence", "config_default", "style", "create_default", "renderStyle", "value", "stave_default", "$0", "meterToTimesig", "timesigToMeter", "src", "url", "script", "request_data_default", "data", "string"]
}
