/* Scribe 
   0.3.1
   By Stephen */

var bn=Object.defineProperty;var Rn=(t,e)=>{for(var n in e)bn(t,n,{get:e[n],enumerable:!0})};function k(t){return t}function N(t,e){return function(){let o=t.apply(this,arguments),r=e[o]||e.default;if(!r)throw new Error('overload() no function defined for key "'+o+'"');return r.apply(this,arguments)}}function Et(t){var e=new Map;return function(o){if(e.has(o))return e.get(o);var r=t(o);return e.set(o,r),r}}var Tn=Array.prototype;function Mn(t,e){return typeof t=="function"?t.apply(null,e):t}function Ie(t,e,n){n=n||t.length;var o=n===1?e?t:Et(t):Et(function(r){return Ie(function(){var i=[r];return i.push.apply(i,arguments),t.apply(null,i)},e,n-1)});return function r(i){return arguments.length===0?r:arguments.length===1?o(i):arguments.length>=n?t.apply(null,arguments):Mn(o(i),Tn.slice.call(arguments,1))}}var wt=Ie;function O(){}var $n=N(k,{is:O,tag:O,data:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},dataset:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},html:function(t,e,n){e.innerHTML=n},text:function(t,e,n){e.textContent=n},style:N((t,e,n)=>typeof n,{string:(t,e,n)=>e.style=n,object:(t,e,n)=>Object.assign(e.style,n)}),children:function(t,e,n){e.innerHTML="",e.append.apply(e,n)},href:function(t,e,n){e instanceof SVGElement?e.setAttribute("href",n):e.href=n},points:$,cx:$,cy:$,r:$,x:$,y:$,dx:$,dy:$,transform:$,preserveAspectRatio:$,viewBox:$,default:function(t,e,n){t in e?e[t]=n:e.setAttribute(t,n)}});function $(t,e,n){e.setAttribute(t,n)}function Gn(t,e){for(var n=Object.keys(e),o=n.length;o--;)e[n[o]]!==void 0&&$n(n[o],t,e[n[o]]);return t}var yt=wt(Gn,!0);var Kt="http://www.w3.org/2000/svg",Xe=document.createElement("template"),Vt=(t,e)=>e&&typeof e;function ze(t,e=""){let n=document.createRange();return n.selectNode(t),n.createContextualFragment(e)}var b=N(Vt,{string:function(t,e){let n=document.createElementNS(Kt,t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElementNS(Kt,t);return typeof e.length=="number"?n.append.apply(n,e):yt(n,e),n},default:t=>document.createElementNS(Kt,t)}),Ln=N(Vt,{string:function(t,e){let n=document.createElement(t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElement(t);return typeof e.length=="number"?n.append.apply(n,e):yt(n,e),n},default:t=>document.createElement(t)}),On=N(k,{comment:function(t,e){return document.createComment(e||"")},fragment:N(Vt,{string:function(t,e,n){return n?ze(n,e):(Xe.innerHTML=e,Xe.content.cloneNode(!0))},object:function(t,e,n){let o=n?ze(n):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):yt(o,e),o},default:()=>document.createDocumentFragment()}),circle:b,ellipse:b,g:b,glyph:b,image:b,line:b,rect:b,use:b,path:b,pattern:b,polygon:b,polyline:b,svg:b,tspan:b,text:b,default:Ln}),v=On;function Jt(t){return function(){return arguments[t]}}function Zt(t){return t}function K(){}function G(){return this}var Ke=Object.create,kn=Object.freeze,Ve=kn(Ke(Ke(Object.prototype,{at:{value:K},shift:{value:K},push:{value:K},forEach:{value:K},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:G},find:{value:K},findIndex:{value:function(){return-1}},flat:{value:G},flatMap:{value:G},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:G},reduce:{value:Jt(1)},sort:{value:G},each:{value:G},pipe:{value:Zt},start:{value:G},stop:{value:G},done:{value:G},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Qt(t,e){return(e%t+t)%t}var Ze=t=>Qt(12,t);var Hn=/^([A-G][♭♯#b]?)(-?\d)$/,qn=/^[A-G][♭♯#b]?/,Un=/-?\d$/,Wn=/[Hh]z$/,ot={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},Je={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Bass Drum 2",36:"Bass Drum 1",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Tom 2",42:"Closed Hi-hat",43:"Low Tom 1",44:"Pedal Hi-hat",45:"Mid Tom 2",46:"Open Hi-hat",47:"Mid Tom 1",48:"High Tom 2",49:"Crash Cymbal 1",50:"High Tom 1",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Qe(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in Je)ot[Qe(Je[t])]=parseInt(t,10);var In=69;function Xn(t,e=440){var n=In+12*Math.log(t/e)/Math.log(2);return Math.fround(n)}function E(t){if(typeof t=="number")return t;if(Wn.test(t))return Xn(parseFloat(t));let e=Hn.exec(t);return e?(parseInt(e[2],10)+1)*12+ot[e[1]]:ot[Qe(t)]}function C(t){return typeof t=="number"?Ze(t):ot[qn.exec(t)[0]]}var Dt=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function rt(t){return _(t)+vt(t)}function _(t){return Dt[Ze(t)]}function vt(t){return typeof t=="number"?Math.floor(t/12)-1:Number(ot[(Un.exec(name)||Ve)[0]])}var P={};Rn(P,{acciDoubleFlat:()=>ne,acciDoubleSharp:()=>oe,acciFlat:()=>Bt,acciNatural:()=>Ct,acciParensLeft:()=>oo,acciParensRight:()=>ro,acciSharp:()=>Pt,augmentationDot:()=>No,barLine:()=>_o,barRepeat1:()=>jo,barRepeat2:()=>tr,barRepeat4:()=>er,barRepeatBegin:()=>ir,barRepeatDots:()=>ar,barRepeatEnd:()=>cr,barRepeatEndBegin:()=>sr,barRepeatLowerDot:()=>rr,barRepeatSlash:()=>nr,barRepeatUpperDot:()=>or,chordAugmented:()=>Dr,chordBassSlash:()=>fe,chordBracketLeft:()=>Sr,chordBracketRight:()=>Ar,chordDiminished:()=>wr,chordGlyphs:()=>Fr,chordHalfDiminished:()=>yr,chordMajorSeventh:()=>vr,chordMinor:()=>Br,chordParensLeftTall:()=>Cr,chordParensRightTall:()=>Pr,clefAlto:()=>jt,clefBass:()=>ct,clefDrum:()=>te,clefPercussion:()=>ee,clefTreble:()=>it,clefTrebleDown:()=>Yt,clefTrebleUp:()=>_t,coda:()=>pe,graceNoteStemDown:()=>ko,graceNoteStemUp:()=>Oo,head1:()=>io,head2:()=>co,head4:()=>so,headBracketLeft:()=>re,headBracketRight:()=>ie,headCircle:()=>ho,headCircleX:()=>mo,headDiamond:()=>uo,headDiamondWide:()=>lo,headPlus:()=>fo,headSlashHorizontalEnds:()=>Eo,headSlashVerticalEnds:()=>go,headSlashed2:()=>ao,headTriangleUp:()=>xo,headX:()=>po,metDot:()=>Lo,metNote05Down:()=>Go,metNote05Up:()=>To,metNote1Down:()=>$o,metNote1Up:()=>Ro,metNote2Down:()=>Mo,metNote2Up:()=>bo,note0125Down:()=>Fo,note0125Up:()=>Bo,note025Down:()=>Ao,note025Up:()=>vo,note05Down:()=>So,note05Up:()=>Do,note1Down:()=>Po,note1Up:()=>yo,note2Down:()=>Co,note2Up:()=>wo,rest0125:()=>ce,rest01875:()=>zo,rest025:()=>se,rest0375:()=>Ko,rest05:()=>ae,rest075:()=>Vo,rest1:()=>ue,rest15:()=>Jo,rest2:()=>le,rest3:()=>Zo,rest4:()=>Qo,rest6:()=>Yo,tailDown0125:()=>Xo,tailDown025:()=>Wo,tailDown05:()=>qo,tailUp0125:()=>Io,tailUp025:()=>Uo,tailUp05:()=>Ho,textBeam16Long:()=>kr,textBeam16Short:()=>Or,textBeam8Long:()=>Lr,textBeam8Short:()=>Gr,textDot:()=>Hr,textNote16Long:()=>$r,textNote16Short:()=>Mr,textNote8Long:()=>Tr,textNote8Short:()=>Rr,textNoteLong:()=>br,textNoteShort:()=>Nr,textTie:()=>qr,textTuplet3Long:()=>zr,textTuplet3Short:()=>Wr,textTupletBeginLong:()=>Xr,textTupletBeginShort:()=>Ur,textTupletEndLong:()=>Kr,textTupletEndShort:()=>Ir,timeSig0:()=>zn,timeSig1:()=>Kn,timeSig2:()=>Vn,timeSig3:()=>Jn,timeSig4:()=>Zn,timeSig5:()=>Qn,timeSig6:()=>Yn,timeSig7:()=>_n,timeSig8:()=>jn,timeSig9:()=>to,timeSigCommon:()=>eo,timeSigCutCommon:()=>no,tuplet0:()=>ur,tuplet1:()=>lr,tuplet2:()=>pr,tuplet3:()=>fr,tuplet4:()=>hr,tuplet5:()=>dr,tuplet6:()=>mr,tuplet7:()=>xr,tuplet8:()=>gr,tuplet9:()=>Er});var it="&#xE050;",Yt="&#xE052;",_t="&#xE053;",jt="&#xE05C;",ct="&#xE062;",te="&#xE069;",ee="&#xE069;",zn="&#xE080;",Kn="&#xE081;",Vn="&#xE082;",Jn="&#xE083;",Zn="&#xE084;",Qn="&#xE085;",Yn="&#xE086;",_n="&#xE087;",jn="&#xE088;",to="&#xE089;",eo="&#xE08A;",no="&#xE08B;",ne="&#xE264;",Bt="&#xE260;",Ct="&#xE261;",Pt="&#xE262;",oe="&#xE263;",oo="&#xE26A;",ro="&#xE26B;",io="&#xE0A4;",co="&#xE0A3;",so="&#xE0A2;",re="&#xE0F5;",ie="&#xE0F6;",ao="&#xE0D0;",uo="&#xE0DB;",lo="&#xE0DC;",po="&#xE0A9;",fo="&#xE0AF;",ho="&#xE0E8;",mo="&#xE0B3;",xo="&#xE0BE;",go="&#xE100;",Eo="&#xE101;",wo="&#xE1D3;",yo="&#xE1D5;",Do="&#xE1D7;",vo="&#xE1D9;",Bo="&#xE1DB;",Co="&#xE1D4;",Po="&#xE1D6;",So="&#xE1D8;",Ao="&#xE1DA;",Fo="&#xE1DC;",No="&#xE1E7;",bo="&#xECA3;",Ro="&#xECA5;",To="&#xECA7;",Mo="&#xECA4;",$o="&#xECA6;",Go="&#xECA8;",Lo="&#xECB7;",Oo="&#xE560;",ko="&#xE561;",Ho="&#xE240;",qo="&#xE241;",Uo="&#xE242;",Wo="&#xE243;",Io="&#xE244;",Xo="&#xE245;",ce="&#xE4E8;",zo="&#xE4E8;&#xE1E7;",se="&#xE4E7;",Ko="&#xE4E7;&#xE1E7;",ae="&#xE4E6;",Vo="&#xE4E6;&#xE1E7;",ue="&#xE4E5;",Jo="&#xE4E5;&#x200A;&#xE1E7;",le="&#xE4E4;",Zo="&#xE4E4;&#x200A;&#xE1E7;",Qo="&#xE4E3;",Yo="&#xE4E3;&#x200A;&#xE1E7;",_o="&#xE030",jo="&#xE500;",tr="&#xE501;",er="&#xE502;",nr="&#xE504;",or="&#xE503;",rr="&#xE505;",ir="&#xE040",cr="&#xE041",sr="&#xE042",ar="&#xE043",pe="&#xE048",ur="&#xE880;",lr="&#xE881;",pr="&#xE882;",fr="&#xE883;",hr="&#xE884;",dr="&#xE885;",mr="&#xE886;",xr="&#xE887;",gr="&#xE888;",Er="&#xE889;",wr="&#xE870;",yr="&#xE871;",Dr="&#xE872;",vr="&#xE873;",Br="&#xE874;",Cr="&#xE875;",Pr="&#xE876;",Sr="(",Ar=")",fe="&#xE87B;",Fr={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},Nr="&#xE1F0;",br="&#xE1F1;",Rr="&#xE1F2;",Tr="&#xE1F3;",Mr="&#xE1F4;",$r="&#xE1F5;",Gr="&#xE1F7;",Lr="&#xE1F8;",Or="&#xE1F9;",kr="&#xE1FA;",Hr="&#xE1FC;",qr="&#xE1FD;",Ur="&#xE1FE",Wr="&#xE1FF",Ir="&#xE200",Xr="&#xE201",zr="&#xE202",Kr="&#xE203";function he(t){return function(){return arguments[t]}}function L(){return this}var Ye=Object.create,Vr=Object.freeze,St=Vr(Ye(Ye(Object.prototype,{at:{value:O},shift:{value:O},push:{value:O},forEach:{value:O},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:L},find:{value:O},findIndex:{value:function(){return-1}},flat:{value:L},flatMap:{value:L},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:L},reduce:{value:he(1)},sort:{value:L},each:{value:L},pipe:{value:k},start:{value:L},stop:{value:L},done:{value:L},valueOf:{value:function(){return null}}}),{length:{value:0}}));function j(t,e){return(e%t+t)%t}function H(t){return j(12,t)}var Jr=Object.assign,At=Object.defineProperty,Ft={writable:!0};function Zr(t){let e=[],n=-1;for(;t[++n]!==void 0;)e.push(t[n]);return e}var tt=class t{constructor(){Jr(this,arguments),At(this,"event",Ft),At(this,"events",Ft),At(this,"index",Ft),At(this,"target",Ft)}toJSON(){return Zr(this)}static of(...e){return new t(...e)}static from(e,n,o){let r=new t(...e);return r.event=e,r.events=n,r.index=o,r}static isChordEvent=de;static isNoteEvent=Nt;static isSequenceEvent=Qr};function de(t){return t[1]==="chord"}function Nt(t){return t[1]==="note"}function Qr(t){return t[1]==="sequence"}function Yr(t,e){return e[t]}var et=wt(Yr,!0);var bt=N(et(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function S(t){return t[0]+bt(t)}function _e(t,e){return t>e?1:t<e?-1:0}var q=[0,2,4,5,7,9,11];function _r(t,e,n){return n.indexOf(t)===e}function je(t,e){return t.map(n=>H(n+e)).filter(_r).sort(_e)}var Ee=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function we(t){return je(q,t)}var{abs:Xc}=Math,jr={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},ti=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),ei=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],zc={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function xe(t){let e=new Float32Array(12),n=C(t+2),o=7;for(;o--;)n=C(n+5),e[n]=1;return e}function ge(t,e,n){let o=t.length;for(;o--;)t[o]*=1-n+n*e[o];return t}var me={note:(t,e,n=1)=>{let o=E(e[2]),r=xe(o);return ge(t,r,n*(1-o/192))},chord:(t,e,n=1)=>{let o=C(e[2]),r=jr[e[3].replace(/\(|\)/g,"")];if(!r)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=r.map(c=>C(o+c)),u=i.length,s;for(;u--;)s=xe(i[u]),ge(t,s,n/i.length*ti[r[u]]);return t}};function Tt(t,e,n){let o=t[e],r=o[0],i=Nt(o)?xe(E(o[2])):de(o)?me.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(n!==void 0){let s=Float32Array.from({length:12},(c,a)=>ei[(a+12-n)%12]);ge(i,s,.3)}let u=e;for(;o=t[--u];){let s=me[o[1]];if(!s)continue;let c=S(o);if(c>r)s(i,o,.5);else if(o[1]==="note"&&r-c<3){if(1-(r-c)/3>1)throw new Error("Influence should never be > 1 "+r+" "+c);s(i,o,.25*(1-(r-o[0])/3))}}for(u=e;(o=t[++u])&&o[0]-r<2;){if(!Nt(o))continue;let s=me[o[1]];if(s){if(1-(o[0]-r)/2>1)throw new Error("Influence should never be > 1 "+r+" "+stopBeat);s(i,o,.3*(1-(o[0]-r)/2))}}return i}var Rt=[0,7,5,2,10,9,3,4,8,11,1,6];function Mt(t){let e=Rt.length,n=0,o;for(;e--;)t[Rt[e]]>n&&(n=t[Rt[e]],o=Rt[e]);return o}var V=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,st=/b|♭/,at=/#|♯/;var ye=/b|♭|#|♯/g;var tn={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function en(t,e){let n=Ee[t],o=C(e),r=n.spellings[H(o)];return Dt[H(o-r)]+tn[r]}function $t(t,e){let n=Ee[t],o,r,i;if(typeof e=="string"){let[c,a,p,l]=V.exec(e)||[e];l&&(o=E(e),r=n.spellings[H(o)],i=vt(o-r))}else o=e,r=n.spellings[H(o)],i=vt(o-r);let u=Dt[H(o-r)],s=tn[r];return u+s+i}var{round:De}=Math,B=class{constructor(){}clef="";pitched=!0;rows=St;getNoteHTML(e,n,o){let r=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${r}">${P[r]}</span>`}get minPitch(){return this.rows[0]}get bottomPitch(){return this.rows[De(.5*this.rows.length)-4]}get centerPitch(){return this.rows[De(.5*this.rows.length)]}get topPitch(){return this.rows[De(.5*this.rows.length)+4]}get maxPitch(){return this.rows[this.rows.length-1]}movePitch(e,n){let o=E(this.minPitch),r=E(this.maxPitch),i=E(e)+n;return i>=o&&i<=r?i:void 0}parts=[{name:"main",top:"stave-top",center:"stave-center",bottom:"stave-bottom",DEFAULT:!0}];getPart(e){return this.parts[0]}getRowDiff(e,n){let o=e.replace(ye,""),r=n.replace(ye,""),i=this.rows.indexOf(o),u=this.rows.indexOf(r);if(i===-1)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);if(u===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return u-i}getSpelling(e,n){return n[1]==="chord"?en(e,n[2]):$t(e,n[2])}yRatioToPitch(e){let n=floor(e*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};var J=class extends B{type="drum";clef=te;pitched=!1;rows=["","","","","","","","pedal-hi-hat","bass-drum-2","bass-drum-1","low-tom-2","low-tom-1","mid-tom-2","snare-drum-1","mid-tom-1","high-tom-1","closed-hi-hat","ride-cymbal-1","crash-cymbal-1","crash-cymbal-2","splash-cymbal","","","",""];#e={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#t={27:0,28:0,29:0,30:0,31:13,32:0,33:0,34:0,35:10,36:9,37:14,38:14,39:13,40:14,41:11,42:17,43:12,44:8,45:13,46:17,47:13,48:15,49:19,50:16,51:18,52:21,53:18,54:13,55:21,56:16,57:20,58:0,59:19,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0};get maxPitch(){return this.rows[25]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[12]}get topPitch(){return this.rows[16]}getNoteHTML(e,n,o){let r=E(e),i=this.#e[r],u=P[i],s=i?`<span class="head" data-glyph="${i}">${u}</span>`:super.getNoteHTML(e,n,o);return n<.02?re+s+ie:s}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(E(e))?this.parts.drums:this.parts.cymbals}getRowDiff(e,n){let o=E(e),r=E(n),i=this.#t[o],u=this.#t[r];if(i===void 0)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);if(u===void 0)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return u-i}getSpelling(e,n){return n[1]==="note"?rt(E(n[2])):$t(e,n[2])}yRatioToPitch(e){let n=floor(e*this.rows.length),o=n<4?4:n>17?17:n;return this.pitches[o]}};var ut=class extends J{type="percussion";clef=ee;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getRowDiff(e,n){return 0}};var lt=class extends B{type="piano";rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"];getClefHTML(){return`<span class="treble-clef clef">${it}</span><span class="bass-clef clef">${ct}</span>`}getTimeSigHTML(e,n,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${P["timeSig"+e]}</sup>
            <sub>${P["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${P["timeSig"+e]}</sup>
            <sub>${P["timeSig"+n]}</sub>
        </span>`}parts=[{name:"lh",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",DEFAULT:!0},{name:"rh",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",DEFAULT:!0},{name:"soprano",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!0},{name:"alto",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!1},{name:"tenor",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!0},{name:"bass",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1}];getPart(e){return/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(e)?this.parts[0]:this.parts[1]}};var ve=class extends B{type="treble-up";clef=_t;rows=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6","B6","C7","D7","E7","F7","G7","A7"]},Be=class extends B{type="treble";clef=it;rows=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"]},Ce=class extends B{type="treble-down";clef=Yt;rows=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5"]},Pe=class extends B{type="alto";clef=jt;rows=["D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"]},Se=class extends B{type="bass";clef=ct;rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5"]};B.treble=Be;B["treble-up"]=ve;B["treble-down"]=Ce;B.alto=Pe;B.bass=Se;B.piano=lt;B.drum=J;B.percussion=ut;B.create=t=>new B[t];var nn=B;var U={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};function ni(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Ae(t){return t===window?ni():t.getClientRects()[0]||t.getBoundingClientRect()}var W=1.1;function oi(t){return parseFloat(t.dataset.duration)}function ri(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function on(t,e,n){return`M${e[n[0]]}, ${-t*e[n[0]]-.5*W}
        L${e[n[n.length-1]]},${-t*e[n[n.length-1]]-.5*W}
        L${e[n[n.length-1]]},${-t*e[n[n.length-1]]+.5*W}
        L${e[n[0]]}, ${-t*e[n[0]]+.5*W}
        Z`}function Fe(t,e,n,o,r,i){if(i<.125)return;let u=o-1,s;for(;e[++u];)e[u]<=i?s?s.push(u):s=[u]:s&&(t.appendChild(v("path",{class:`beam-path-${4/i} beam-path`,d:on(r,n,s)})),Fe(t,e,n,s[0],r,i/2),s=void 0);s&&(t.appendChild(v("path",{class:`beam-path-${4/i} beam-path`,d:on(r,n,s)})),Fe(t,e,n,s[0],r,i/2),s=void 0)}function Fs(t){let e=t.dataset.events.split(/\s+/),n=t.parentElement,o=e.map(l=>n.querySelector('.note[data-event="'+l+'"]')),r=o.map(oi),i=t.viewBox.baseVal,u=i.y<-.5?i.y+.5:i.height-1,s=o.map(Ae),c=s[0].x,a=s[s.length-1].x,p=s.map(l=>(l.x-c)/(a-c));ri(t),Fe(t,r,p,0,-u,.25)}var rn=N((t,e)=>e[1],{note:(t,e)=>(e[2]=E(e[2])+t,e),chord:(t,e)=>(e[2]=C(C(e[2])+t),e[5]!==void 0&&(e[5]=C(C(e[2])+t)),e),key:(t,e)=>(e[2]=C(C(e[2])+t),e),default:k});var ii={displace:(t,e,n)=>(n[0]-=t[++e],e),rate:(t,e,n)=>(n[0]/=t[++e],e),quantize:(t,e,n)=>{},transpose:(t,e,n)=>(rn(t[e+1],n),e+1)};function pt(t,e){let n=-1,o;for(;o=t[++n];)n=ii[o](t,n,e);return e}var cn=Object.assign,sn=[],ci={done:!0,value:void 0},an={key:2,meter:1,default:0},si={};function un(t){return an[t[1]]||an.default}function ai(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:un(e)-un(t)}function ui(t,e){return t.find(n=>n.id===e)}var ft=class t{constructor(e,n=sn,o=sn){e.sort(ai),this.events=e,this.sequences=n,this.transforms=o;let r=-1,i;for(;(i=e[++r])&&pt(o,cn(si,i))[0]<0;);this.n=r-1}next(){let{events:e,sequences:n,transforms:o,n:r}=this,i=e[r+1],u=i&&pt(o,tt.from(i,e,r+1)),s,c=-1,a=0,p=u?u[0]:1/0,l;for(;s=this[++c];)s.value||(s.next().value&&(pt(this.transforms,s.value),s.value[0]+=s.startBeat,s.value.target=s.target),(s.done||s.value[0]>=s.stopBeat)&&++a),s.value&&s.value[0]<s.stopBeat&&s.value[0]<p&&(l=s,p=s.value[0]),a&&(this[c]=this[c+a]);if(l)return this.value=l.value,l.value=void 0,this;if(!u)return cn(this,ci);if(this.n+=1,this.value=u,tt.isSequenceEvent(i)){let h=this.sequences,d=ui(h,i[2]);if(!d)throw new Error('Sequence id "'+i[2]+'" not found');let x=new t(d.events,d.sequences?d.sequences.concat(h):h,i.slice(5));x.startBeat=u[0],x.stopBeat=u[0]+u[4],x.target=u[3];let f=-1;for(;this[++f];);this[f]=x}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};var li=[2,3,4,5,6,7,9],pi=1/12,ln=.25,pn=.2,Ne={},nt=0;function fn(t,e){return Math.cos(2*Math.PI*e/t)}function hn(t,e,n,o,r){let i=t/e,u=0,s=0,c=0,a,p;for(o[r-1]&&S(o[r-1])>n+.125&&(c=1),--r;o[++r]!==void 0&&o[r][0]-n<i/4;)c=1;for(--r;o[++r]!==void 0&&o[r][0]-n<t-i/4;){if(a=Math.round((o[r][0]-n)/i),p=1<<a,a<e&&p>c){if(e>4&&p>c<<1)return;c+=p}u+=fn(i,o[r][0]-n),s+=1,!(o[r][0]+o[r][4]-n>t)&&(u+=pn*fn(i,o[r][0]+o[r][4]-n),s+=pn)}if(!(e>4&&a!==e-1)&&s)return Ne.score=u/(s+1),Ne.rhythm=c,Ne}function fi(t,e,n,o,r,i,u){let s=n[o-1]&&S(n[o-1])>r+.125?r:e*Math.floor((n[o][0]-r)/e)+r,c=i.length;for(;e/i[--c]<pi;);++c;let a,p;for(;a=i[--c];)p=hn(e,a,s,n,o),p&&p.score>=nt&&p.score&&(nt=p.score,t.beat=s,t.duration=e,t.divisor=a,t.rhythm=p.rhythm),n[o][0]>=s+.5*e&&s+1.5*e<u&&(p=hn(e,a,s+.5*e,n,o),p&&p.score>=nt&&(nt=p.score,t.beat=s+.5*e,t.duration=e,t.divisor=a,t.rhythm=p.rhythm));return t}function be(t,e,n){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let r={};nt=ln;let i=1/8;for(;(i*=2)&&i<=n;)fi(r,i,t,o,e,li,e+n);return nt>ln&&r}var{abs:hi,EPSILON:di}=Math;function Gt(t,e){return Math.round(e/t)*t}function I(t,e,n=di){return t!==void 0&&(t===e||hi(t-e)<n)}function Z(t,e,n){return I(t,e,n)||t<e}function Re(t,e,n){return I(t,e,n)||t>e}function Lt(t,e,n){return t!==void 0&&e!==void 0&&!Z(t,e,n)}function Te(t,e,n){return t!==void 0&&e!==void 0&&!Re(t,e,n)}function Me(t){return 2**Math.ceil(Math.log2(t))}function dn(t){return 2**Math.floor(Math.log2(t))}function mn(t){return t>0&&(t&t-1)===0}function $e(t,e,n){if(I(0,n,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(I(0,j(o,n),t/2))return o;return o}function ht(t,e){let n=-1,o=0;for(;t[++n]!==void 0;);for(;arguments[++o]!==void 0;)t[n++]=arguments[o];return t}function Q(t){let e=-1;for(;t[++e]!==void 0;);return e}function Ot(t){return t[Q(t)-1]}function dt(t,e){let n=[],o=-1;for(;e[++o]!==void 0;)n.push(t(e[o],o));return n}var Oe=Object.assign,{abs:xn,ceil:Wa,floor:gn,min:wn,max:yn,sqrt:En,round:Ia}=Math,A=1/16,Xa=1/24;function kt(t){return t[0]+bt(t)}function Dn(t,e){return yn(t,kt(e))}function vn(t,e,n){let o={},r=-1,i;for(;i=n[++r];){let u=i.scribeEvents,s=i.scribeIndex,c=Tt(u,s,e),a=Mt(c);o[r]=t.getSpelling(a,i)}return o}function Ht(t){let[e,n,o,r]=V.exec(t[0]),i=r,u=C(n),s=t[0],c=0;for(;t[++c];){let[a,p,l,h]=V.exec(t[c]);(h<i||h===i&&C(p)<u)&&(i=h,u=C(p),s=t[c])}return s}function qt(t){let[e,n,o,r]=V.exec(t[0]),i=r,u=C(n),s=t[0],c=0;for(;t[++c];){let[a,p,l,h]=V.exec(t[c]);(h>i||h===i&&C(p)>u)&&(i=h,u=C(p),s=t[c])}return s}function ke(t,e,n,o){let r=t.getRowDiff(e.centerPitch||t.centerPitch,n);return t.getRowDiff(e.centerPitch||t.centerPitch,o)+r<-1}function Bn(t,e,n){let o=Ht(n),r=qt(n);return ke(t,e,o,r)}function mi(t,e,n){let o=[],r=-1,i;for(;i=n[++r];)i.type==="note"&&o.push(i.pitch);return Bn(t,e,o)}function z(t,e,n,o){let r=-1;for(;o[++r]&&o[r].beat===o.beat;);if(!o[r])return t;let i=o[0].beat,s=Ot(o).beat-i,c=n.stemup===void 0?Bn(e,n,dt(et("pitch"),o)):n.stemup;if(n.beam){let a;for(r=-1;a=o[++r];)a.stemup=c,a.beam=o;t.push(Oe(o,{duration:s,stemup:c,range:0}))}else{let a=[],p;for(r=-1;p=o[++r];){let R=p.pitch;for(;o[++r]&&I(o[r].beat,p.beat,A);)c?E(o[r].pitch)>E(R)&&(R=o[r].pitch):E(o[r].pitch)<E(R)&&(R=o[r].pitch);--r,a.push(R)}let l=Q(o),h=0,d=0,x;for(r=-1;a[++r];)x=e.getRowDiff(e.centerPitch,a[r]),r<(a.length-1)/2?h+=x/Math.floor(a.length/2):r>(a.length-1)/2&&(d+=x/Math.floor(a.length/2));let f=o[0],g=Ot(o),w=e.getRowDiff(f.pitch,g.pitch),m=d-h,y=xn(m)>xn(.75*w)?.5*w:.5*m;for(r=-1;p=o[++r];)p.stemup=c,p.beam=o,p.stemHeight=c?1+.125*(y*r/(a.length-1)-e.getRowDiff(f.pitch,p.pitch)):1+.125*(-y*r/(a.length-1)+e.getRowDiff(f.pitch,p.pitch));t.push(Oe(o,{pitch:f.pitch,duration:s,stemup:c,range:y}))}return t}function xi(t,e,n,o,r,i){return{type:"rest",beat:i,duration:Sn(t,e,i,r,i,r),stave:n,part:o}}function Ge(t,e,n,o,r,i,u){for(;Lt(u,i,A);){let s=xi(e,n,o,r,u,i);t.push(s),i+=s.duration}return u}function gi(t,e,n,o,r,i,u,s){let c=at.test(s)?1:st.test(s)?-1:void 0,a=s[0]+s.slice(-1);Re(u[0],e.beat,A)&&c!==r[a]&&(r[a]=c,t.push(Oe({},{type:"acci",beat:i,pitch:s,part:o,stave:n,event:u,value:c||0})))}function Cn(t,e,n,o,r,i,u,s){let c=-1;for(;s[++c];)gi(t,e,n,o,r,i,u[c],s[c]);return i}function Pn(t,e,n,o,r){let i=qt(r),u=e.getRowDiff(i,n.topPitch||e.topPitch);u<0&&t.push({type:"ledge",beat:o,pitch:i,rows:u}),i=Ht(r),u=e.getRowDiff(i,n.bottomPitch||e.bottomPitch)-2,u>0&&t.push({type:"ledge",beat:o,pitch:i,rows:u})}function Ei(t,e,n){let{beat:o,duration:r,divisor:i}=n,u=e.stemup===void 0?mi(t,e,n):e.stemup,s=-1,c;for(;c=n[++s];)c.type==="note"&&!c.beam&&(c.stemup=u);let a=o+.5*r,p=E(t.topPitch)-12,l,h=Q(n);for(;(c=n[--h])&&c.beat>a;);for(++h;(c=n[--h])&&c.beat+c.duration>a;){let m=E(c.pitch);(!l||m>l)&&(l=m)}let d=p;for(h=-1;(c=n[++h])&&c.beat<o+A;){let m=E(c.pitch);(!d||m>d)&&(d=m)}let x=p;for(h=Q(n);(c=n[--h])&&c.beat>o+r-r/i-A;){let m=E(c.pitch);(!x||m>x)&&(x=m)}let f=Math.ceil((d+x)/2),g=rt(f);f>l&&(l=f),n.pitch=rt(l),n.stemup=u;let w=x-d;n.angle=w<0?4*En(-w):-4*En(w)}function wi(t,e,n,o,r,i,u,s,c,a,p,l,h,d){(u.swingAsStraight8ths&&c===1||u.swingAsStraight16ths&&c===.5)&&a===3&&(p===4||p===5)&&(a=2);let x=c/a,f=s+c,g={type:"tuplet",beat:s,duration:c,divisor:a,rhythm:p,part:i,stave:n},w,m;for(mn(a)||t.push(g);Te(s,f,A);){for(;(w=h[++d])&&Z(w[0]-e.beat,s+.5*x,A);)l.push(w);if(--d,!l.length){t.push({type:"rest",beat:s,duration:x,stave:n,part:i}),s+=x;continue}let y=vn(n,o,l),R=Ht(y),xt=qt(y),gt=i.stemup===void 0?ke(n,i,R,xt):i.stemup,zt=wn(l.reduce(Dn,0)-e.beat,w?w[0]-e.beat:e.duration,g.beat+g.duration),M=yn(x,Gt(x,zt-s));Lt(M,.5,A)?m&&(z(t,n,i,m),m=void 0):m||(m={type:"beam",beat:s,part:i}),Pn(t,n,i,s,y),Cn(t,e,n,i,r,s,l,y);let D=-1;for(;l[++D];)t.push({type:"note",beat:s,pitch:y[D],duration:M,part:i,stemup:gt,top:y[D]===xt,bottom:y[D]===R,stave:n,event:l[D]});for(ht(g,...t.slice(-1*l.length)),m&&ht(m,...t.slice(-1*l.length)),D=l.length;D--;){let T=kt(l[D])-e.beat;Z(T,s+M+.5*x,A)?l.splice(D,1):t.push({type:"tie",beat:s,pitch:y[D],duration:M,stemup:gt,part:i,event:l[D]})}s+=M}return m&&z(t,n,i,m),Ei(n,i,g),d}function Le(t,e){let n=2*Me(e);for(;(n/=2)>t/2;){if(1.75*n===e)return 1.75*n;if(1.5*n===e)return 1.5*n;if(n<=e)return n}return t}function yi(t,e,n){n=n||1/0;let o=4*Me(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=n)return o;return t}function Sn(t,e,n,o,r,i){let s=dn(e.divisor),c=gn(r/e.divisor)*e.divisor,a=$e(.125,s,r-c),p=gn(o/e.divisor)*e.divisor,l=c+e.divisor<o&&c+e.divisor;if(r===c)return t.indexOf(o-r)!==-1?o-r:t.indexOf(p-r)!==-1?p-r:l?l-r:yi(.125,o-r,i-r);if(I(o,p,A))return t.indexOf(o-r)!==-1?o-r:l&&t.indexOf(l-r)!==-1?l-r:a;{let h=4*a;return(r-c)%h/a===1?r+2*a===i?2*a:(r+3*a>=i&&console.log("Next event beat is inside quaduplet"),a<1?o>=r+a*3/2?3*a:o>=r+a?a:Le(.125,o-r):o>=r+a*3?a*3:o>=r+a*2?a*2:o>r+a?a:Le(.125,o-r)):o>r+a?a:Le(.125,o-r)}}function He(t,e,n,o=0,r={},i,u,s=U){let c=[],{headDurations:a,restDurations:p}=s,l=0,h=-1,d,x,f;for(;(d=u[++h])&&Z(d[0]+d[4]-e.beat,l,A););for(--h;Te(l,e.duration,A);){f&&e.divisions.find(T=>I(l,T,A))&&(z(t,n,i,f),f=void 0);let g=be(u,e.beat+l,e.duration-l);if(g&&g.divisor!==2&&g.divisor!==4){Lt(g.beat-e.beat,l,A)&&Ge(t,s.restDurations,e,n,i,l,g.beat-e.beat),f&&(z(t,n,i,f),f=void 0),h=wi(t,e,n,o,r,i,s,g.beat-e.beat,g.duration,g.divisor,g.rhythm,c,u,h),l=g.beat-e.beat+g.duration;continue}for(;(d=u[++h])&&Z(d[0]-e.beat,l,A);)c.push(d);if(--h,!c.length){if(!d){f&&(z(t,n,i,f),f=void 0),Ge(t,s.restDurations,e,n,i,l,e.duration);break}let T=Gt(.125,d[0]-e.beat);if(T<=l){console.log(`Problem at bar ${e.count}, moving to next bar ${l} ${T}`),e.error="Stop beat has ended up less than beat";break}f&&(An(e.divisions,l,T)||T-l>=.5)&&(z(t,n,i,f),f=void 0),Ge(t,p,e,n,i,l,T),l=T;continue}let w=vn(n,o,c),m=Ht(w),y=qt(w),R=i.stemup===void 0?ke(n,i,m,y):i.stemup;Pn(t,n,i,l,w),Cn(t,e,n,i,r,l,c,w);let xt=c[0][0]-e.beat,gt=wn(e.duration,c.reduce(Dn,0)-e.beat),zt=d&&Gt(.125,d[0])-e.beat,M=Sn(a,e,xt,gt,l,zt);M>=1?f&&(z(t,n,i,f),f=void 0):f||(f={type:"beam",beat:l,part:i});let D=-1;for(;c[++D];)t.push({type:"note",beat:l,pitch:w[D],duration:M,part:i,stemup:R,top:w[D]===y,bottom:w[D]===m,stave:n,event:c[D]});for(f&&ht(f,...t.slice(-1*c.length)),D=c.length;D--;){let T=kt(c[D])-e.beat;Z(T,l+M,A)||T-(l+M)<.125+1/16*(kt(c[D])-c[D][0])?c.splice(D,1):t.push({type:"tie",beat:l,pitch:w[D],duration:M,stemup:R,part:i,event:c[D]})}l+=M}return f&&(z(t,n,i,f),f=void 0),t}var Di={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function vi(t,e){return Di[t+","+e]||St}function An(t,e,n){let o=-1;for(;t[++o]&&t[o]<=e;);return n>t[o]?t[o]:void 0}var Bi=[],Ci={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},Fn=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function Pi(t,e){let n=Fn.indexOf(t.pitch),o=Fn.indexOf(e.pitch);return n>o?1:n<o?-1:0}function Nn(t,e){return we(e).reduce((o,r,i)=>{let u=r-q[i];if(u!==0){let s=_(q[i]),c=10;for(;c--;)o[s+c]=u}return o},t),t}function Si(t,e,n,o,r,i,u){let s=-1,c;for(;c=i[++s];)switch(c[1]){case"key":{let a=C(c[2]),p=we(a);Nn(r,a),t.push.apply(t,p.map((l,h)=>l-q[h]&&{type:"acci",pitch:_(q[h])+Ci[l-q[h]],value:l-q[h],stave:n}).filter(l=>!!l).sort(Pi)),e.key=a;break}case"meter":{t.push({type:"timesig",beat:0,numerator:c[3]===1.5?c[2]/.5:c[2]/c[3],denominator:c[3]===1.5?8:4/c[3],stave:n,event:c});break}case"symbol":{t.push({type:"symbol"+c[2],stave:n});break}case"chord":{let a=c[0]-e.beat,p=Tt(i,s,o),l=Mt(p),h=n.getSpelling(l,c);h==="C♭"&&u.spellChordRootCFlatAsB&&(h="B"),h==="E♯"&&u.spellChordRootESharpAsF&&(h="F"),h==="B♯"&&u.spellChordRootBSharpAsC&&(h="C"),h==="F♭"&&u.spellChordRootFFlatAsE&&(h="E"),t.push({type:"chord",beat:a,duration:c[0]+c[4]>e.beat+e.duration?e.duration-a:c[4],root:h,extension:c[3],event:c,stave:n});break}case"lyric":{let a=c[0]-e.beat;t.push({type:"lyric",beat:a,duration:c[0]+c[3]>e.beat+e.duration?e.duration-a:c[3],value:c[2],event:c,stave:n});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(Bi.includes(c[1]))return;console.log('Scribe: ignoring event type "'+c[1]+'"')}}return t}function mt(t,e,n,o,r,i,u,s,c,a=U){let p=[];if(c){let f=S(c);f>e&&f<=e+n&&u.push(c)}let l=Nn({},i),h={type:"bar",beat:e,duration:n,key:i,divisor:o,divisions:vi(n,o),stave:r,count:t,symbols:p};Si(p,h,r,i,l,u,U);let d,x=0;for(d in r.parts){let f=r.parts[d],g=s[f.name]||[];!f.DEFAULT&&!g.length||(He(p,h,r,i,l,f,g,a),++x)}return x||(console.log("Stave has no parts defined SHOULD NOT BE"),He(p,h,r,i,l,r.parts[0],[],a)),h}function Ai(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function Fi(t){let e=t.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(e,Ai)}function Y(t,e){t.symbols=t.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"BARREPEAT",count:e,duration:t.duration}])}function Ut(t,e,n){let o=Fi(n);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&n.symbols.filter(r=>r.type!=="clef"&&r.type!=="timesig").find(r=>r.type!=="rest")?(Y(t[t.length-2],1),Y(t[t.length-1],1),Y(n,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(Y(n,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,Y(t[t.length-1],2),Y(n,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,Y(n,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function qe(t,e,n){let o=n.target?t.parts[n.target]:t.getPart(n[2]),r=e[o.name]||(e[o.name]=[]);e[o.name].push(n)}function Ue(t,e,n,o=U){let r=[],i=[],u=[],s=[],c=0,a=[],p={},l=0,h=0,d,x,f,g;for(f of t)if(f.scribeIndex=r.length,f.scribeEvents=r,r.push(f),!e.includes(f[1])){for(;f[0]>=c+d;){let m=mt(i.length+1,c,d,x,n,l,a,p,g,o);Ut(i,s,m),i.push(m),l=m.key,c=c+d,a=[],p={};let y=-1;for(;u[++y];)qe(n,p,u[y]),S(u[y])<c+d&&u.splice(y--,1)}switch(f[1]){case"note":{qe(n,p,f),S(f)>c+d&&u.push(f),h<S(f)&&(h=S(f));break}case"sequence":{f.events===t.events&&(g=f),h<S(f)&&(h=S(f));break}case"meter":d=f[2],x=f[3],f[0]!==c&&console.log("TODO");default:a.push(f)}}for(;u.length;){let m=mt(i.length+1,c,d,x,n,l,a,p,g,o);Ut(i,s,m),i.push(m),c=c+d,a=[],p={};let y=-1;for(;f=u[++y];)qe(n,p,f),S(f)<c+d&&u.splice(y--,1)}for(;c<h-d;){let m=mt(i.length+1,c,d,x,n,l,a,p,g,o);Ut(i,s,m),i.push(m),c=c+d,a=[],p={}}let w=mt(i.length+1,c,d,x,n,l,a,p,g,o);return Ut(i,s,w),i.push(w),i}var Wt=Symbol("scribe-id"),Ni=0;function X(t){return t[Wt]||(t[Wt]=++Ni+""),t[Wt]}var It=Math.abs,Xt={flat:`<span class="chord-flat">${Bt}</span>`,sharp:`<span class="chord-sharp">${Pt}</span>`},bi={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Ri={2:oe,1:Pt,0:Ct,"-1":Bt,"-2":ne},Ti={"1.33":le,"0.67":ue,"0.33":ae,"0.17":se,"0.08":ce},Mi=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function F(t){return t.toFixed(4).replace(/\.?0+$/,"")}var We=N(et("type"),{BARREPEAT:t=>v("span",{class:"BARREPEAT",html:P["barRepeat"+t.count],data:{duration:t.duration}}),clef:t=>t.stave.getClefHTML?v("fragment",t.stave.getClefHTML()):v("span",{class:`${t.stave.type}-clef clef`,html:t.stave.clef}),chord:t=>{let e=Mi.exec(t.extension);return v("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(at,Xt.sharp).replace(st,Xt.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(at,Xt.sharp).replace(st,Xt.flat)+"</sup>":"")+"</span>"+(t.bass?fe+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:F(t.beat),duration:F(t.duration),event:X(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?v("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,X(t.event))):v("span",{class:"timesig",html:`<sup>${P["timeSig"+t.numerator]}</sup>
                <sub>${P["timeSig"+t.denominator]}</sub>`,data:{event:X(t.event)}}),symbolcoda:t=>v("p",{html:pe,class:"coda"}),barcount:t=>v("span",{html:t.text,class:"barcount"}),lyric:t=>v("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:F(t.beat),duration:F(t.duration),event:X(t.event)}}),acci:t=>v("span",{class:bi[t.value]||"acci",html:Ri[t.value]||Ct,data:t.beat===void 0?{pitch:t.pitch}:{beat:F(t.beat),pitch:t.pitch,part:t.part.name,event:X(t.event)}}),ledge:t=>v("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 4.8 ${It(t.rows)}`:`0 -0.5 4.8 ${It(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="4.8" y1="0" y2="0"></line>
            <line x1="0" x2="4.8" y1="2" y2="2"></line>
            <line x1="0" x2="4.8" y1="4" y2="4"></line>
            <line x1="0" x2="4.8" y1="6" y2="6"></line>
            <line x1="0" x2="4.8" y1="8" y2="8"></line>
        `,data:{beat:F(t.beat),pitch:t.pitch}}),note:t=>v("data",{class:`${t.stemup?"up-note":"down-note"} ${t.top?"top-note":""} ${t.bottom?"bottom-note":""} ${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${E(t.pitch)})`,data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name,beam:t.beam&&X(t.beam),event:X(t.event)}}),beam:t=>v("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range>0?-t.range:0)-.5} 1 ${It(t.range)+1}`,preserveAspectRatio:"none",style:`height: ${(It(t.range)+.5)*.125}em; align-self: ${t.range>0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*W} L1,${-t.range-.5*W} L1,${-t.range+.5*W} L0,${.5*W} Z"></path>`,data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name,events:dt(e=>X(e.event),t).join(" ")}}),tie:t=>v("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name}}),tuplet:t=>v("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:P["tuplet"+t.divisor],data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>v("span",{class:"rest",html:Ti[t.duration.toFixed(2)]||P["rest"+(t.duration+"").replace(".","")]||"",data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function $i(t){return t[0]<=0&&t[1]==="meter"}function Gi(t){return t[0]<=0&&t[1]==="key"}function Li(t,e){let n=We(e);return n&&t.push(n),t}function Oi(t,e){return t.push(v("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:_(e.key)},children:e.symbols.reduce(Li,[])})),t}function ki(t,e,n,o,r,i=1/0,u=0,s=0,c=U){let a=t.events;!a.find($i)&&r&&a.unshift([0,"meter",r[2],r[3]]),!a.find(Gi)&&o&&a.unshift([0,"key",o]);let h=nn.create(n||"treble"),d=[];u&&d.push("transpose",u),s&&d.push("displace",s);let x=new ft(a,t.sequences,d),f=Ue(x,e,h,c).reduce(Oi,[]),g=f[0],w=g.querySelectorAll(".acci:not([data-beat])"),m=v("div",{class:`${h.type}-stave signature-stave stave`,children:[We({type:"clef",stave:h}),...w],data:{key:g.dataset.key}}),y=v("div",{id:"side",class:"side",data:{key:g.dataset.key}}),R=24;for(;R--;)y.appendChild(m.cloneNode(!0));return f.unshift(y),f}export{k as a,N as b,Et as c,wt as d,O as e,v as f,nn as g,U as h,Fs as i,ki as j};
//# sourceMappingURL=chunk-QFZ5U7AM.js.map
