/* Scribe 
   0.3.1
   By Stephen */

var Rn=Object.defineProperty;var Mn=(t,e)=>{for(var n in e)Rn(t,n,{get:e[n],enumerable:!0})};function J(t){return t}function b(t,e){return function(){let o=t.apply(this,arguments),r=e[o]||e.default;if(!r)throw new Error('overload() no function defined for key "'+o+'"');return r.apply(this,arguments)}}function wt(t){var e=new Map;return function(o){if(e.has(o))return e.get(o);var r=t(o);return e.set(o,r),r}}var $n=Array.prototype;function Ln(t,e){return typeof t=="function"?t.apply(null,e):t}function Ve(t,e,n){n=n||t.length;var o=n===1?e?t:wt(t):wt(function(r){return Ve(function(){var i=[r];return i.push.apply(i,arguments),t.apply(null,i)},e,n-1)});return function r(i){return arguments.length===0?r:arguments.length===1?o(i):arguments.length>=n?t.apply(null,arguments):Ln(o(i),$n.slice.call(arguments,1))}}var yt=Ve;function k(){}var Gn=b(J,{is:k,tag:k,data:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},dataset:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},html:function(t,e,n){e.innerHTML=n},text:function(t,e,n){e.textContent=n},style:b((t,e,n)=>typeof n,{string:(t,e,n)=>e.style=n,object:(t,e,n)=>Object.assign(e.style,n)}),children:function(t,e,n){e.innerHTML="",e.append.apply(e,n)},href:function(t,e,n){e instanceof SVGElement?e.setAttribute("href",n):e.href=n},points:$,cx:$,cy:$,r:$,x:$,y:$,dx:$,dy:$,transform:$,preserveAspectRatio:$,viewBox:$,default:function(t,e,n){t in e?e[t]=n:e.setAttribute(t,n)}});function $(t,e,n){e.setAttribute(t,n)}function On(t,e){for(var n=Object.keys(e),o=n.length;o--;)e[n[o]]!==void 0&&Gn(n[o],t,e[n[o]]);return t}var Dt=yt(On,!0);var Zt="http://www.w3.org/2000/svg",Ze=document.createElement("template"),Jt=(t,e)=>e&&typeof e;function Je(t,e=""){let n=document.createRange();return n.selectNode(t),n.createContextualFragment(e)}var F=b(Jt,{string:function(t,e){let n=document.createElementNS(Zt,t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElementNS(Zt,t);return typeof e.length=="number"?n.append.apply(n,e):Dt(n,e),n},default:t=>document.createElementNS(Zt,t)}),kn=b(Jt,{string:function(t,e){let n=document.createElement(t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElement(t);return typeof e.length=="number"?n.append.apply(n,e):Dt(n,e),n},default:t=>document.createElement(t)}),Hn=b(J,{comment:function(t,e){return document.createComment(e||"")},fragment:b(Jt,{string:function(t,e,n){return n?Je(n,e):(Ze.innerHTML=e,Ze.content.cloneNode(!0))},object:function(t,e,n){let o=n?Je(n):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):Dt(o,e),o},default:()=>document.createDocumentFragment()}),circle:F,ellipse:F,g:F,glyph:F,image:F,line:F,rect:F,use:F,path:F,pattern:F,polygon:F,polyline:F,svg:F,tspan:F,text:F,default:kn}),y=Hn;function Qt(t){return function(){return arguments[t]}}function Yt(t){return t}function Q(){}function L(){return this}var Qe=Object.create,qn=Object.freeze,Ye=qn(Qe(Qe(Object.prototype,{at:{value:Q},shift:{value:Q},push:{value:Q},forEach:{value:Q},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:L},find:{value:Q},findIndex:{value:function(){return-1}},flat:{value:L},flatMap:{value:L},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:L},reduce:{value:Qt(1)},sort:{value:L},each:{value:L},pipe:{value:Yt},start:{value:L},stop:{value:L},done:{value:L},valueOf:{value:function(){return null}}}),{length:{value:0}}));function _t(t,e){return(e%t+t)%t}var je=t=>_t(12,t);var Un=/^([A-G][â™­â™¯#b]?)(-?\d)$/,Wn=/^[A-G][â™­â™¯#b]?/,Xn=/-?\d$/,In=/[Hh]z$/,ct={C:0,"Câ™¯":1,"C#":1,"Dâ™­":1,Db:1,D:2,"Dâ™¯":3,"D#":3,"Eâ™­":3,Eb:3,E:4,F:5,"Fâ™¯":6,"F#":6,"Gâ™­":6,Gb:6,G:7,"Gâ™¯":8,"G#":8,"Aâ™­":8,Ab:8,A:9,"Aâ™¯":10,"A#":10,"Bâ™­":10,Bb:10,B:11},_e={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Bass Drum 2",36:"Bass Drum 1",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Tom 2",42:"Closed Hi-hat",43:"Low Tom 1",44:"Pedal Hi-hat",45:"Mid Tom 2",46:"Open Hi-hat",47:"Mid Tom 1",48:"High Tom 2",49:"Crash Cymbal 1",50:"High Tom 1",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function tn(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in _e)ct[tn(_e[t])]=parseInt(t,10);var zn=69;function Kn(t,e=440){var n=zn+12*Math.log(t/e)/Math.log(2);return Math.fround(n)}function E(t){if(typeof t=="number")return t;if(In.test(t))return Kn(parseFloat(t));let e=Un.exec(t);return e?(parseInt(e[2],10)+1)*12+ct[e[1]]:ct[tn(t)]}function C(t){return typeof t=="number"?je(t):ct[Wn.exec(t)[0]]}var Bt=["C","Câ™¯","D","Eâ™­","E","F","Fâ™¯","G","Gâ™¯","A","Bâ™­","B"];function st(t){return vt(t)+Ct(t)}function vt(t){return Bt[je(t)]}function Ct(t){return typeof t=="number"?Math.floor(t/12)-1:Number(ct[(Xn.exec(name)||Ye)[0]])}var P={};Mn(P,{acciDoubleFlat:()=>re,acciDoubleSharp:()=>ie,acciFlat:()=>Pt,acciNatural:()=>St,acciParensLeft:()=>io,acciParensRight:()=>co,acciSharp:()=>At,augmentationDot:()=>To,barLine:()=>tr,barRepeat1:()=>er,barRepeat2:()=>nr,barRepeat4:()=>or,barRepeatBegin:()=>sr,barRepeatDots:()=>lr,barRepeatEnd:()=>ar,barRepeatEndBegin:()=>ur,barRepeatLowerDot:()=>cr,barRepeatSlash:()=>rr,barRepeatUpperDot:()=>ir,chordAugmented:()=>vr,chordBassSlash:()=>de,chordBracketLeft:()=>Fr,chordBracketRight:()=>Nr,chordDiminished:()=>Dr,chordGlyphs:()=>br,chordHalfDiminished:()=>Br,chordMajorSeventh:()=>Cr,chordMinor:()=>Pr,chordParensLeftTall:()=>Sr,chordParensRightTall:()=>Ar,clefAlto:()=>ee,clefBass:()=>ut,clefDrum:()=>ne,clefPercussion:()=>oe,clefTreble:()=>at,clefTrebleDown:()=>jt,clefTrebleUp:()=>te,coda:()=>he,graceNoteStemDown:()=>qo,graceNoteStemUp:()=>Ho,head1:()=>so,head2:()=>ao,head4:()=>uo,headBracketLeft:()=>ce,headBracketRight:()=>se,headCircle:()=>xo,headCircleX:()=>go,headDiamond:()=>po,headDiamondWide:()=>fo,headPlus:()=>mo,headSlashHorizontalEnds:()=>yo,headSlashVerticalEnds:()=>wo,headSlashed2:()=>lo,headTriangleUp:()=>Eo,headX:()=>ho,metDot:()=>ko,metNote05Down:()=>Oo,metNote05Up:()=>$o,metNote1Down:()=>Go,metNote1Up:()=>Mo,metNote2Down:()=>Lo,metNote2Up:()=>Ro,note0125Down:()=>bo,note0125Up:()=>Po,note025Down:()=>No,note025Up:()=>Co,note05Down:()=>Fo,note05Up:()=>vo,note1Down:()=>Ao,note1Up:()=>Bo,note2Down:()=>So,note2Up:()=>Do,rest0125:()=>ae,rest01875:()=>Vo,rest025:()=>ue,rest0375:()=>Zo,rest05:()=>le,rest075:()=>Jo,rest1:()=>pe,rest15:()=>Qo,rest2:()=>fe,rest3:()=>Yo,rest4:()=>_o,rest6:()=>jo,tailDown0125:()=>Ko,tailDown025:()=>Io,tailDown05:()=>Wo,tailUp0125:()=>zo,tailUp025:()=>Xo,tailUp05:()=>Uo,textBeam16Long:()=>qr,textBeam16Short:()=>Hr,textBeam8Long:()=>kr,textBeam8Short:()=>Or,textDot:()=>Ur,textNote16Long:()=>Gr,textNote16Short:()=>Lr,textNote8Long:()=>$r,textNote8Short:()=>Mr,textNoteLong:()=>Rr,textNoteShort:()=>Tr,textTie:()=>Wr,textTuplet3Long:()=>Vr,textTuplet3Short:()=>Ir,textTupletBeginLong:()=>Kr,textTupletBeginShort:()=>Xr,textTupletEndLong:()=>Zr,textTupletEndShort:()=>zr,timeSig0:()=>Vn,timeSig1:()=>Zn,timeSig2:()=>Jn,timeSig3:()=>Qn,timeSig4:()=>Yn,timeSig5:()=>_n,timeSig6:()=>jn,timeSig7:()=>to,timeSig8:()=>eo,timeSig9:()=>no,timeSigCommon:()=>oo,timeSigCutCommon:()=>ro,tuplet0:()=>pr,tuplet1:()=>fr,tuplet2:()=>hr,tuplet3:()=>dr,tuplet4:()=>mr,tuplet5:()=>xr,tuplet6:()=>gr,tuplet7:()=>Er,tuplet8:()=>wr,tuplet9:()=>yr});var at="&#xE050;",jt="&#xE052;",te="&#xE053;",ee="&#xE05C;",ut="&#xE062;",ne="&#xE069;",oe="&#xE069;",Vn="&#xE080;",Zn="&#xE081;",Jn="&#xE082;",Qn="&#xE083;",Yn="&#xE084;",_n="&#xE085;",jn="&#xE086;",to="&#xE087;",eo="&#xE088;",no="&#xE089;",oo="&#xE08A;",ro="&#xE08B;",re="&#xE264;",Pt="&#xE260;",St="&#xE261;",At="&#xE262;",ie="&#xE263;",io="&#xE26A;",co="&#xE26B;",so="&#xE0A4;",ao="&#xE0A3;",uo="&#xE0A2;",ce="&#xE0F5;",se="&#xE0F6;",lo="&#xE0D0;",po="&#xE0DB;",fo="&#xE0DC;",ho="&#xE0A9;",mo="&#xE0AF;",xo="&#xE0E8;",go="&#xE0B3;",Eo="&#xE0BE;",wo="&#xE100;",yo="&#xE101;",Do="&#xE1D3;",Bo="&#xE1D5;",vo="&#xE1D7;",Co="&#xE1D9;",Po="&#xE1DB;",So="&#xE1D4;",Ao="&#xE1D6;",Fo="&#xE1D8;",No="&#xE1DA;",bo="&#xE1DC;",To="&#xE1E7;",Ro="&#xECA3;",Mo="&#xECA5;",$o="&#xECA7;",Lo="&#xECA4;",Go="&#xECA6;",Oo="&#xECA8;",ko="&#xECB7;",Ho="&#xE560;",qo="&#xE561;",Uo="&#xE240;",Wo="&#xE241;",Xo="&#xE242;",Io="&#xE243;",zo="&#xE244;",Ko="&#xE245;",ae="&#xE4E8;",Vo="&#xE4E8;&#xE1E7;",ue="&#xE4E7;",Zo="&#xE4E7;&#xE1E7;",le="&#xE4E6;",Jo="&#xE4E6;&#xE1E7;",pe="&#xE4E5;",Qo="&#xE4E5;&#x200A;&#xE1E7;",fe="&#xE4E4;",Yo="&#xE4E4;&#x200A;&#xE1E7;",_o="&#xE4E3;",jo="&#xE4E3;&#x200A;&#xE1E7;",tr="&#xE030",er="&#xE500;",nr="&#xE501;",or="&#xE502;",rr="&#xE504;",ir="&#xE503;",cr="&#xE505;",sr="&#xE040",ar="&#xE041",ur="&#xE042",lr="&#xE043",he="&#xE048",pr="&#xE880;",fr="&#xE881;",hr="&#xE882;",dr="&#xE883;",mr="&#xE884;",xr="&#xE885;",gr="&#xE886;",Er="&#xE887;",wr="&#xE888;",yr="&#xE889;",Dr="&#xE870;",Br="&#xE871;",vr="&#xE872;",Cr="&#xE873;",Pr="&#xE874;",Sr="&#xE875;",Ar="&#xE876;",Fr="(",Nr=")",de="&#xE87B;",br={"âˆ†â™¯11":"î¡³îµ¢11","âˆ†":"î¡³",7:"7","-7":"î¡´7","-â™­6":"î¡´îµ 6","7susâ™­9":"7susîµ¢",Ã¸:"î¡±","7â™¯11":"7îµ¢11","-âˆ†":"î¡´î¡³","âˆ†â™­6":"î¡³îµ 6","-â™­9":"î¡´îµ 9",Ã¸7:"î¡±7","âˆ†â™¯5":"î¡³îµ¢5","7alt":"7alt","Â°":"î¡°",dim:"î¡°","7â™­9":"7îµ ","+7":"î¡²7"},Tr="&#xE1F0;",Rr="&#xE1F1;",Mr="&#xE1F2;",$r="&#xE1F3;",Lr="&#xE1F4;",Gr="&#xE1F5;",Or="&#xE1F7;",kr="&#xE1F8;",Hr="&#xE1F9;",qr="&#xE1FA;",Ur="&#xE1FC;",Wr="&#xE1FD;",Xr="&#xE1FE",Ir="&#xE1FF",zr="&#xE200",Kr="&#xE201",Vr="&#xE202",Zr="&#xE203";function me(t){return function(){return arguments[t]}}function G(){return this}var en=Object.create,Jr=Object.freeze,Ft=Jr(en(en(Object.prototype,{at:{value:k},shift:{value:k},push:{value:k},forEach:{value:k},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:G},find:{value:k},findIndex:{value:function(){return-1}},flat:{value:G},flatMap:{value:G},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:G},reduce:{value:me(1)},sort:{value:G},each:{value:G},pipe:{value:J},start:{value:G},stop:{value:G},done:{value:G},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Y(t,e){return(e%t+t)%t}function q(t){return Y(12,t)}function nn(t){return t[1]==="chord"}function xe(t){return t[1]==="note"}function on(t){return t[1]==="sequence"}function Qr(t,e){return e[t]}var K=yt(Qr,!0);var Nt=b(K(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function S(t){return t[0]+Nt(t)}function rn(t,e){return t>e?1:t<e?-1:0}var U=[0,2,4,5,7,9,11];function Yr(t,e,n){return n.indexOf(t)===e}function cn(t,e){return t.map(n=>q(n+e)).filter(Yr).sort(rn)}var ye=[{name:"C",symbol:"Câˆ†",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Dâ™­",symbol:"Dâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"Dâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"Eâ™­",symbol:"Eâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"Eâˆ†",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"Fâˆ†",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"Fâ™¯",symbol:"Fâ™¯âˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"Gâˆ†",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"Aâ™­",symbol:"Aâ™­âˆ†",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"Aâˆ†",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"Bâ™­",symbol:"Bâ™­âˆ†",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"Bâˆ†",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function De(t){return cn(U,t)}var{abs:Xc}=Math,_r={"":[0,4,7],"âˆ†":[0,4,7,11],"âˆ†7":[0,4,7,11],"âˆ†â™¯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-â™­6":[0,3,7,8],"7susâ™­9":[0,1,5,7,10],Ã¸:[0,3,6,10],"-âˆ†":[0,3,7,11],"7â™¯11":[0,4,6,7,10],"âˆ†â™­6":[0,4,7,8],"-â™­9":[0,1,3,7],Ã¸7:[0,2,3,6,10],"âˆ†â™¯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"Â°":[0,3,6,9],"7â™­9":[0,1,4,7,10],"7â™¯9":[0,3,4,7,10],"7â™­13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},jr=Float32Array.of(.9,.9,.8,1,1,.8,.8,.8,.9,1,1,1),ti=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/9+0,4/6+0+0,1/6+0+0],Ic={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function Ee(t){let e=new Float32Array(12),n=C(t+2),o=7;for(;o--;)e[n=C(n+5)]=1;return e}function we(t,e,n){let o=t.length;for(;o--;)t[o]*=1-n+n*e[o];return t}var ge={note:(t,e,n=1)=>{let o=E(e[2]),r=Ee(o);return we(t,r,n*(1-o/192))},chord:(t,e,n=1)=>{let o=C(e[2]),r=_r[e[3].replace(/\(|\)/g,"")];if(!r)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=r.map(c=>C(o+c)),a=i.length,s;for(;a--;)s=Ee(i[a]),we(t,s,n*jr[r[a]]);return t}};function Tt(t,e,n){let o=t[e],r=o[0],i=xe(o)?Ee(E(o[2])):nn(o)?ge.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(n!==void 0){let s=Float32Array.from({length:12},(c,u)=>ti[(u+12-n)%12]);we(i,s,.3)}let a=e;for(;o=t[--a];){let s=ge[o[1]];if(!s)continue;let c=S(o);if(c>r)s(i,o,.5);else if(o[1]==="note"&&r-c<3){if(1-(r-c)/3>1)throw new Error("Influence should never be > 1 "+r+" "+c);s(i,o,.25*(1-(r-c)/3))}}for(a=e;(o=t[++a])&&o[0]-r<2;){if(!xe(o))continue;let s=ge[o[1]];if(s){if(1-(o[0]-r)/2>1)throw new Error("Influence should never be > 1 "+r+" "+stopBeat);s(i,o,.3*(1-(o[0]-r)/2))}}return i}var bt=[0,7,5,2,10,9,3,4,8,11,1,6];function Rt(t){let e=bt.length,n=0,o;for(;e--;)t[bt[e]]>n&&(n=t[bt[e]],o=bt[e]);return o}var _=/^([A-G])([b#â™­â™¯ð„«ð„ª])?(-?\d)?$/,lt=/b|â™­/,pt=/#|â™¯/;var Be=/b|â™­|#|â™¯/g;var sn={"-2":"ð„«","-1":"â™­",0:"",1:"â™¯",2:"ð„ª"};function an(t,e){let n=ye[t],o=C(e),r=n.spellings[q(o)];return Bt[q(o-r)]+sn[r]}function Mt(t,e){let n=ye[t],o,r,i;if(typeof e=="string"){let[c,u,p,l]=_.exec(e)||[e];l&&(o=E(e),r=n.spellings[q(o)],i=Ct(o-r))}else o=e,r=n.spellings[q(o)],i=Ct(o-r);let a=Bt[q(o-r)],s=sn[r];return a+s+i}var{round:ve}=Math,D=class{constructor(){}clef="";pitched=!0;rows=Ft;getNoteHTML(e,n,o){let r=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${r}">${P[r]}</span>`}get minPitch(){return this.rows[0]}get bottomPitch(){return this.rows[ve(.5*this.rows.length)-4]}get centerPitch(){return this.rows[ve(.5*this.rows.length)]}get topPitch(){return this.rows[ve(.5*this.rows.length)+4]}get maxPitch(){return this.rows[this.rows.length-1]}movePitch(e,n){let o=E(this.minPitch),r=E(this.maxPitch),i=E(e)+n;return i>=o&&i<=r?i:void 0}parts=[{name:"main",top:"stave-top",center:"stave-center",bottom:"stave-bottom",DEFAULT:!0}];getPart(e){return this.parts[0]}getRowDiff(e,n){let o=e.replace(Be,""),r=n.replace(Be,""),i=this.rows.indexOf(o),a=this.rows.indexOf(r);if(i===-1)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);if(a===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return a-i}getSpelling(e,n){return n[1]==="chord"?an(e,n[2]):Mt(e,n[2])}yRatioToPitch(e){let n=floor(e*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};var j=class extends D{type="drum";clef=ne;pitched=!1;rows=["","","","","","","","pedal-hi-hat","bass-drum-2","bass-drum-1","low-tom-2","low-tom-1","mid-tom-2","snare-drum-1","mid-tom-1","high-tom-1","closed-hi-hat","ride-cymbal-1","crash-cymbal-1","crash-cymbal-2","splash-cymbal","","","",""];#e={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#t={27:0,28:0,29:0,30:0,31:13,32:0,33:0,34:0,35:10,36:9,37:14,38:14,39:13,40:14,41:11,42:17,43:12,44:8,45:13,46:17,47:13,48:15,49:19,50:16,51:18,52:21,53:18,54:13,55:21,56:16,57:20,58:0,59:19,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0};get maxPitch(){return this.rows[25]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[12]}get topPitch(){return this.rows[16]}getNoteHTML(e,n,o){let r=E(e),i=this.#e[r],a=P[i],s=i?`<span class="head" data-glyph="${i}">${a}</span>`:super.getNoteHTML(e,n,o);return n<.02?ce+s+se:s}parts={drums:{name:"drums",stemup:!1},cymbals:{name:"cymbals",stemup:!0}};getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(E(e))?this.parts.drums:this.parts.cymbals}getRowDiff(e,n){let o=E(e),r=E(n),i=this.#t[o],a=this.#t[r];if(i===void 0)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);if(a===void 0)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return a-i}getSpelling(e,n){return n[1]==="note"?st(E(n[2])):Mt(e,n[2])}yRatioToPitch(e){let n=floor(e*this.rows.length),o=n<4?4:n>17?17:n;return this.pitches[o]}};var ft=class extends j{type="percussion";clef=oe;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}parts={drums:{name:"drums",stemup:!1},cymbals:{name:"cymbals",stemup:!0}};getRowDiff(e,n){return 0}};var ht=class extends D{type="piano";rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"];getClefHTML(){return`<span class="treble-clef clef">${at}</span><span class="bass-clef clef">${ut}</span>`}getTimeSigHTML(e,n,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${P["timeSig"+e]}</sup>
            <sub>${P["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${P["timeSig"+e]}</sup>
            <sub>${P["timeSig"+n]}</sub>
        </span>`}parts=[{name:"lh",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",DEFAULT:!0},{name:"rh",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",DEFAULT:!0},{name:"soprano",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!0},{name:"alto",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!1},{name:"tenor",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!0},{name:"bass",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1}];getPart(e){return/[012]$|[AC-G][b#â™­â™¯ð„«ð„ª]*3$/.test(e)?this.parts[0]:this.parts[1]}};var Ce=class extends D{type="treble-up";clef=te;rows=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6","B6","C7","D7","E7","F7","G7","A7"]},Pe=class extends D{type="treble";clef=at;rows=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"]},Se=class extends D{type="treble-down";clef=jt;rows=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5"]},Ae=class extends D{type="alto";clef=ee;rows=["D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"]},Fe=class extends D{type="bass";clef=ut;rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5"]};D.treble=Pe;D["treble-up"]=Ce;D["treble-down"]=Se;D.alto=Ae;D.bass=Fe;D.piano=ht;D.drum=j;D.percussion=ft;D.create=t=>new D[t];var un=D;var W={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0};function ei(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Ne(t){return t===window?ei():t.getClientRects()[0]||t.getBoundingClientRect()}var X=1.1;function ni(t){return parseFloat(t.dataset.duration)}function oi(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function ln(t,e,n){return`M${e[n[0]]}, ${-t*e[n[0]]-.5*X}
        L${e[n[n.length-1]]},${-t*e[n[n.length-1]]-.5*X}
        L${e[n[n.length-1]]},${-t*e[n[n.length-1]]+.5*X}
        L${e[n[0]]}, ${-t*e[n[0]]+.5*X}
        Z`}function be(t,e,n,o,r,i){if(i<.125)return;let a=o-1,s;for(;e[++a];)e[a]<=i?s?s.push(a):s=[a]:s&&(t.appendChild(y("path",{class:`beam-path-${4/i} beam-path`,d:ln(r,n,s)})),be(t,e,n,s[0],r,i/2),s=void 0);s&&(t.appendChild(y("path",{class:`beam-path-${4/i} beam-path`,d:ln(r,n,s)})),be(t,e,n,s[0],r,i/2),s=void 0)}function As(t){let e=t.dataset.events.split(/\s+/),n=t.parentElement,o=e.map(l=>n.querySelector('.note[data-event="'+l+'"]')),r=o.map(ni),i=t.viewBox.baseVal,a=i.y<-.5?i.y+.5:i.height-1,s=o.map(Ne),c=s[0].x,u=s[s.length-1].x,p=s.map(l=>(l.x-c)/(u-c));oi(t),be(t,r,p,0,-a,.25)}function Te(t){return Y(12,t)}var Re=Object.assign,pn=[],ri={done:!0,value:void 0};var fn={key:2,meter:1,default:0},ii={},Ls=K(0);function hn(t){return fn[t[1]]||fn.default}function ci(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:hn(e)-hn(t)}function si(t,e){return t.find(n=>n.id===e)}var ai={displace:(t,e,n)=>(n[0]-=t[++e],e),rate:(t,e,n)=>(n[0]/=t[++e],e),quantize:(t,e,n)=>{},transpose:(t,e,n)=>{switch(n[1]){case"note":{let o=typeof n[2]=="string"?E(n[2]):n[2];n[2]=o+t[e+1];break}case"chord":case"key":{let o=typeof n[2]=="string"?C(n[2]):n[2];n[2]=Te(o+t[e+1]);break}}return e+1}};function Me(t,e){let n=-1,o;for(;o=t[++n];)n=ai[o](t,n,e);return e}var $t=class t{constructor(e,n=pn,o=0,r=1/0,i=pn){e.sort(ci),this.events=e,this.sequences=n,this.beat=o,this.duration=r,this.transforms=i;let a=-1,s;for(;(s=e[++a])&&Me(this.transforms,Re(ii,s))[0]<0;);this.n=a-1}next(){let{buffer:e,events:n,sequences:o,n:r}=this,i=n[r+1],a=i&&Me(this.transforms,Re({event:i,events:n},i)),s,c=0,u=0,p=i?a[0]:this.duration,l;for(;s=this[--c];)s.value||(s.next().value&&Me(this.transforms,s.value),s.done&&++u),s.value&&s.value[0]<p&&(l=s,p=s.value[0]),u&&(this[c]=this[c-u]);if(l)return this.value=l.value,this.value[0]+=this.beat,l.value=void 0,this;if(!a||this.duration<=a[0])return Re(this,ri);if(on(i)){let h=this.sequences,f=si(h,i[2]);if(!f)throw new Error('Sequence "'+i[2]+'" not found');let d=i.slice(5),x=new t(f.events,f.sequences?f.sequences.concat(h):h,a[0],a[4],d),g=0;for(;this[--g];);this[g]=x}return this.n+=1,this.value=a,this.value[0]+=this.beat,this}[Symbol.iterator](){return this}};var ui=[2,3,4,5,6,7,9],li=1/12,dn=.25,mn=.2,$e={},ot=0;function xn(t,e){return Math.cos(2*Math.PI*e/t)}function gn(t,e,n,o,r){let i=t/e,a=0,s=0,c=0,u,p;for(o[r-1]&&S(o[r-1])>n+.125&&(c=1),--r;o[++r]!==void 0&&o[r][0]-n<i/4;)c=1;for(--r;o[++r]!==void 0&&o[r][0]-n<t-i/4;){if(u=Math.round((o[r][0]-n)/i),p=1<<u,u<e&&p>c){if(e>4&&p>c<<1)return;c+=p}a+=xn(i,o[r][0]-n),s+=1,!(o[r][0]+o[r][4]-n>t)&&(a+=mn*xn(i,o[r][0]+o[r][4]-n),s+=mn)}if(!(e>4&&u!==e-1)&&s)return $e.score=a/(s+1),$e.rhythm=c,$e}function pi(t,e,n,o,r,i,a){let s=n[o-1]&&S(n[o-1])>r+.125?r:e*Math.floor((n[o][0]-r)/e)+r,c=i.length;for(;e/i[--c]<li;);++c;let u,p;for(;u=i[--c];)p=gn(e,u,s,n,o),p&&p.score>=ot&&p.score&&(ot=p.score,t.beat=s,t.duration=e,t.divisor=u,t.rhythm=p.rhythm),n[o][0]>=s+.5*e&&s+1.5*e<a&&(p=gn(e,u,s+.5*e,n,o),p&&p.score>=ot&&(ot=p.score,t.beat=s+.5*e,t.duration=e,t.divisor=u,t.rhythm=p.rhythm));return t}function Le(t,e,n){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let r={};ot=dn;let i=1/8;for(;(i*=2)&&i<=n;)pi(r,i,t,o,e,ui,e+n);return ot>dn&&r}var{abs:fi,EPSILON:hi}=Math;function dt(t,e){return Math.round(e/t)*t}function T(t,e,n=hi){return t!==void 0&&(t===e||fi(t-e)<n)}function V(t,e,n){return T(t,e,n)||t<e}function Ge(t,e,n){return T(t,e,n)||t>e}function Lt(t,e,n){return t!==void 0&&e!==void 0&&!V(t,e,n)}function Oe(t,e,n){return t!==void 0&&e!==void 0&&!Ge(t,e,n)}function ke(t){return 2**Math.ceil(Math.log2(t))}function En(t){return 2**Math.floor(Math.log2(t))}function wn(t){return t>0&&(t&t-1)===0}function Gt(t,e){let n=t.length;for(;t[--n]&&t[n]>e;);return t[n]}function Ot(t,e,n){if(T(0,n,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(T(0,Y(o,n),t/2))return o;return o}function mt(t,e){let n=-1,o=0;for(;t[++n]!==void 0;);for(;arguments[++o]!==void 0;)t[n++]=arguments[o];return t}function tt(t){let e=-1;for(;t[++e]!==void 0;);return e}function kt(t){return t[tt(t)-1]}function xt(t,e){let n=[],o=-1;for(;e[++o]!==void 0;)n.push(t(e[o],o));return n}var vn=Object.assign,{abs:yn,ceil:Ra,floor:Dn,min:di,max:Cn,sqrt:Bn}=Math,v=1/24,Ma=[0,2/24,3/24,4/24,6/24,8/24,9/24,10/24,12/24,14/24,15/24,16/24,18/24,20/24,21/24,22/24,1],gt=[1/8,6/32,7/32,1/4,6/16,7/16,1/2,6/8,7/8,1,6/4,7/4,2,6/2,7/2,4,6,7,8],$a=gt[0],He=[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8];function Ue(t){return t[0]+Nt(t)}function Pn(t,e){return Cn(t,Ue(e))}function Sn(t,e,n,o,r){if(n[0]!==o[r+1])throw console.log(r,n,o),new Error("HELP "+r);let i={},a=-1,s;for(;s=n[++a];){let c=Tt(o,++r,e),u=Rt(c);i[a]=t.getSpelling(u,s)}return i}function qt(t){let[e,n,o,r]=_.exec(t[0]),i=r,a=C(n),s=t[0],c=0;for(;t[++c];){let[u,p,l,h]=_.exec(t[c]);(h<i||h===i&&C(p)<a)&&(i=h,a=C(p),s=t[c])}return s}function Ut(t){let[e,n,o,r]=_.exec(t[0]),i=r,a=C(n),s=t[0],c=0;for(;t[++c];){let[u,p,l,h]=_.exec(t[c]);(h>i||h===i&&C(p)>a)&&(i=h,a=C(p),s=t[c])}return s}function We(t,e,n,o){let r=t.getRowDiff(e.centerPitch||t.centerPitch,n);return t.getRowDiff(e.centerPitch||t.centerPitch,o)+r<-1}function An(t,e,n){let o=qt(n),r=Ut(n);return We(t,e,o,r)}function mi(t,e,n){let o=[],r=-1,i;for(;i=n[++r];)i.type==="note"&&o.push(i.pitch);return An(t,e,o)}function Z(t,e,n,o){let r=-1;for(;o[++r]&&o[r].beat===o.beat;);if(!o[r])return t;let i=o[0].beat,s=kt(o).beat-i,c=n.stemup===void 0?An(e,n,xt(K("pitch"),o)):n.stemup,u=[],p;for(r=-1;p=o[++r];){let R=p.pitch;for(;o[++r]&&T(o[r].beat,p.beat,v);)c?E(o[r].pitch)>E(R)&&(R=o[r].pitch):E(o[r].pitch)<E(R)&&(R=o[r].pitch);--r,u.push(R)}let l=tt(o),h=0,f=0,d;for(r=-1;u[++r];)d=e.getRowDiff(e.centerPitch,u[r]),r<(u.length-1)/2?h+=d/Math.floor(u.length/2):r>(u.length-1)/2&&(f+=d/Math.floor(u.length/2));let x=o[0],g=kt(o),B=e.getRowDiff(x.pitch,g.pitch),w=f-h,m=yn(w)>yn(.75*B)?.5*B:.5*w;for(r=-1;p=o[++r];)p.stemup=c,p.beam=o,p.stemHeight=c?1+.125*(m*r/(u.length-1)-e.getRowDiff(x.pitch,p.pitch)):1+.125*(-m*r/(u.length-1)+e.getRowDiff(x.pitch,p.pitch));return t.push(vn(o,{pitch:x.pitch,duration:s,stemup:c,range:m})),t}function xi(t,e,n,o,r,i,a){let s=i-a;if(!(a===0||e.includes(a))||!(i===n||e.includes(i))){let p=Ht(e,a,a+s);p&&(s=p-a)}let c=t.length;for(;t[--c]+v>s;);s=t[c+1]||t[t.length-1];let u=8;for(;(u*=.5)&&a%u;);return u<s&&(s=u),{type:"rest",beat:a,duration:s,stave:o,part:r}}function qe(t,e,n,o,r,i,a){for(;Lt(a,i,v);){let s=xi(e,n.divisions,n.duration||100,o,r,a,i);t.push(s),i+=s.duration}return a}function gi(t,e,n,o,r,i,a,s){let c=pt.test(s)?1:lt.test(s)?-1:void 0,u=s[0]+s.slice(-1);Ge(a[0],e.beat,v)&&c!==r[u]&&(r[u]=c,t.push(vn({},{type:"acci",beat:i,pitch:s,part:o,stave:n,event:a,value:c||0})))}function Fn(t,e,n,o,r,i,a,s){let c=-1;for(;s[++c];)gi(t,e,n,o,r,i,a[c],s[c]);return i}function Nn(t,e,n,o,r){let i=Ut(r),a=e.getRowDiff(i,n.topPitch||e.topPitch);a<0&&t.push({type:"ledge",beat:o,pitch:i,rows:a}),i=qt(r),a=e.getRowDiff(i,n.bottomPitch||e.bottomPitch)-2,a>0&&t.push({type:"ledge",beat:o,pitch:i,rows:a})}function Ei(t,e,n){let{beat:o,duration:r,divisor:i}=n,a=e.stemup===void 0?mi(t,e,n):e.stemup,s=-1,c;for(;c=n[++s];)c.type==="note"&&!c.beam&&(c.stemup=a);let u=o+.5*r,p=E(t.topPitch)-12,l,h=tt(n);for(;(c=n[--h])&&c.beat>u;);for(++h;(c=n[--h])&&c.beat+c.duration>u;){let w=E(c.pitch);(!l||w>l)&&(l=w)}let f=p;for(h=-1;(c=n[++h])&&c.beat<o+v;){let w=E(c.pitch);(!f||w>f)&&(f=w)}let d=p;for(h=tt(n);(c=n[--h])&&c.beat>o+r-r/i-v;){let w=E(c.pitch);(!d||w>d)&&(d=w)}let x=Math.ceil((f+d)/2),g=st(x);x>l&&(l=x),n.pitch=st(l),n.stemup=a;let B=d-f;n.angle=B<0?4*Bn(-B):-4*Bn(B)}function wi(t,e,n,o,r,i,a,s,c,u,p,l,h,f){(a.swingAsStraight8ths&&c===1||a.swingAsStraight16ths&&c===.5)&&u===3&&(p===4||p===5)&&(u=2);let d=c/u,x=s+c,g={type:"tuplet",beat:s,duration:c,divisor:u,rhythm:p,part:i,stave:n},B,w;for(wn(u)||t.push(g);Oe(s,x,v);){for(;(B=h[++f])&&V(B[0]-e.beat,s+.5*d,v);)l.push(B);if(--f,!l.length){t.push({type:"rest",beat:s,duration:d,stave:n,part:i}),s+=d;continue}let m=Sn(n,o,l,h,f-l.length),R=qt(m),rt=Ut(m),it=i.stemup===void 0?We(n,i,R,rt):i.stemup,Kt=di(l.reduce(Pn,0)-e.beat,B?B[0]-e.beat:e.duration,g.beat+g.duration),z=Cn(d,dt(d,Kt-s));Lt(z,.5,v)?w&&(Z(t,n,i,w),w=void 0):w||(w={type:"beam",beat:s,part:i}),Nn(t,n,i,s,m),Fn(t,e,n,i,r,s,l,m);let N=-1;for(;l[++N];)t.push({type:"note",beat:s,pitch:m[N],duration:z,part:i,stemup:it,top:m[N]===rt,bottom:m[N]===R,stave:n,event:l[N]});for(mt(g,...t.slice(-1*l.length)),w&&mt(w,...t.slice(-1*l.length)),N=l.length;N--;){let nt=Ue(l[N])-e.beat;V(nt,s+z+.5*d,v)?l.splice(N,1):t.push({type:"tie",beat:s,pitch:m[N],duration:z,stemup:it,part:i,event:l[N]})}s+=z}return w&&Z(t,n,i,w),Ei(n,i,g),f}function yi(t,e,n,o){let r=t.length,i;for(;(i=t[--r])&&i>o;);for(++r;i=t[--r];)if(T(n+i,e.duration,v)||T(0,(n+i)%e.divisor,v))return i}function Xe(t,e,n,o=0,r={},i,a,s=W){let c=[],u=0,p=-1,l,h,f;for(;(l=a[++p])&&V(l[0]+l[4]-e.beat,u,v););for(--p;Oe(u,e.duration,v);){f&&e.divisions.find(O=>T(u,O,v))&&(Z(t,n,i,f),f=void 0);let d=Le(a,e.beat+u,e.duration-u);if(d&&d.divisor!==2&&d.divisor!==4){Lt(d.beat-e.beat,u,v)&&qe(t,He,e,n,i,u,d.beat-e.beat),f&&(Z(t,n,i,f),f=void 0),p=wi(t,e,n,o,r,i,s,d.beat-e.beat,d.duration,d.divisor,d.rhythm,c,a,p),u=d.beat-e.beat+d.duration;continue}for(;(l=a[++p])&&V(l[0]-e.beat,u,v);)c.push(l);if(--p,!c.length){if(!l){f&&(Z(t,n,i,f),f=void 0),qe(t,He,e,n,i,u,e.duration);break}let O=dt(.125,l[0]-e.beat);if(O<=u){console.log(`Problem at bar ${e.count}, moving to next bar ${u} ${O}`),e.error="Stop beat has ended up less than beat";break}f&&(Ht(e.divisions,u,O)||O-u>=.5)&&(Z(t,n,i,f),f=void 0),qe(t,He,e,n,i,u,O),u=O;continue}let x=Sn(n,o,c,a,p-c.length),g=qt(x),B=Ut(x),w=i.stemup===void 0?We(n,i,g,B):i.stemup;Nn(t,n,i,u,x),Fn(t,e,n,i,r,u,c,x);let m=c.reduce(Pn,0)-e.beat,R=.125,rt=En(e.divisor),it=Dn(u/e.divisor)*e.divisor,Kt=Ot(R,rt,u-it),z=Dn(m/e.divisor)*e.divisor,N=Ot(R,rt,m-z);console.log("Grain beat",it,u,Kt,"stop beat",z,m,N,"bar.divisor",e.divisor);let nt=l&&dt(.125,l[0])-e.beat;V(nt,m,v)||nt-u<1.5*(m-u)?m=nt:m%e.divisor>.6?m=Math.ceil(m/e.divisor)*e.divisor:m-u<1&&m-u>.5*ke(m-u)?m=ke(m-u)+u:m=dt(.125,m),m>e.duration&&(m=e.duration);let Vt=Ht(e.divisions,u,m),H=Vt?yi(gt,e,u,m-u):Gt(gt,m-u)||gt[0];if(m=u+H,!H||!m){console.log("We have a problem. Stopping bar render."),console.log("DURATION ",H,m),e.error="Bad duration";break}Vt&&(!(u===0||T(0,u%e.divisor,v))||!(m===e.duration||T(0,m%e.divisor,v)))&&(H=Gt(gt,Vt-u)),H>=1?f&&(Z(t,n,i,f),f=void 0):f||(f={type:"beam",beat:u,part:i});let M=-1;for(;c[++M];)t.push({type:"note",beat:u,pitch:x[M],duration:H,part:i,stemup:w,top:x[M]===B,bottom:x[M]===g,stave:n,event:c[M]});for(f&&mt(f,...t.slice(-1*c.length)),M=c.length;M--;){let O=Ue(c[M])-e.beat;V(O,u+H,v)?c.splice(M,1):t.push({type:"tie",beat:u,pitch:x[M],duration:H,stemup:w,part:i,event:c[M]})}u+=H}return f&&(Z(t,n,i,f),f=void 0),t}var Di={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function Bi(t,e){return Di[t+","+e]||Ft}function Ht(t,e,n){let o=-1;for(;t[++o]&&t[o]<=e;);return n>t[o]?t[o]:void 0}var vi=[],Ci={"-2":"ð„«","-1":"â™­",0:"",1:"â™¯",2:"ð„ª"},bn=["Fâ™¯","Câ™¯","Gâ™¯","Dâ™¯","Aâ™¯","Eâ™¯","Bâ™¯","Bâ™­","Eâ™­","Aâ™­","Dâ™­","Gâ™­","Câ™­","Fâ™­"];function Pi(t,e){let n=bn.indexOf(t.pitch),o=bn.indexOf(e.pitch);return n>o?1:n<o?-1:0}function Tn(t,e){return De(e).reduce((o,r,i)=>{let a=r-U[i];if(a!==0){let s=vt(U[i]),c=10;for(;c--;)o[s+c]=a}return o},t),t}function Si(t,e,n,o,r,i,a){let s=-1,c;for(;c=i[++s];)switch(c[1]){case"key":{let u=C(c[2]),p=De(u);Tn(r,u),t.push.apply(t,p.map((l,h)=>l-U[h]&&{type:"acci",pitch:vt(U[h])+Ci[l-U[h]],value:l-U[h],stave:n}).filter(l=>!!l).sort(Pi)),e.key=u;break}case"meter":{t.push({type:"timesig",beat:0,numerator:c[3]===1.5?c[2]/.5:c[2]/c[3],denominator:c[3]===1.5?8:4/c[3],stave:n,event:c});break}case"symbol":{t.push({type:"symbol"+c[2],stave:n});break}case"chord":{let u=c[0]-e.beat,p=Tt(i,s,o),l=Rt(p),h=n.getSpelling(l,c);h==="Câ™­"&&a.spellChordRootCFlatAsB&&(h="B"),h==="Eâ™¯"&&a.spellChordRootESharpAsF&&(h="F"),h==="Bâ™¯"&&a.spellChordRootBSharpAsC&&(h="C"),h==="Fâ™­"&&a.spellChordRootFFlatAsE&&(h="E"),t.push({type:"chord",beat:u,duration:c[0]+c[4]>e.beat+e.duration?e.duration-u:c[4],root:h,extension:c[3],event:c,stave:n});break}case"lyric":{let u=c[0]-e.beat;t.push({type:"lyric",beat:u,duration:c[0]+c[3]>e.beat+e.duration?e.duration-u:c[3],value:c[2],event:c,stave:n});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(vi.includes(c[1]))return;console.log('Scribe: ignoring event type "'+c[1]+'"')}}return t}function Et(t,e,n,o,r,i,a,s,c,u=W){let p=[];if(c){let x=S(c);x>e&&x<=e+n&&a.push(c)}let l=Tn({},i),h={type:"bar",beat:e,duration:n,key:i,divisor:o,divisions:Bi(n,o),stave:r,count:t,symbols:p};Si(p,h,r,i,l,a,W);let f,d=0;for(f in r.parts){let x=r.parts[f],g=s[x.name]||[];!x.DEFAULT&&!g.length||(Xe(p,h,r,i,l,x,g,u),++d)}return d||(console.log("Stave has no parts defined SHOULD NOT BE"),Xe(p,h,r,i,l,r.parts[0],[],u)),h}function Ai(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function Fi(t){let e=t.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(e,Ai)}function et(t,e){t.symbols=t.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"BARREPEAT",count:e,duration:t.duration}])}function Wt(t,e,n){let o=Fi(n);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&n.symbols.filter(r=>r.type!=="clef"&&r.type!=="timesig").find(r=>r.type!=="rest")?(et(t[t.length-2],1),et(t[t.length-1],1),et(n,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(et(n,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,et(t[t.length-1],2),et(n,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,et(n,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function Ie(t,e,n){let o=n.target?t.parts[n.target]:t.getPart(n[2]),r=e[o.name]||(e[o.name]=[]);e[o.name].push(n)}function ze(t,e,n=W){let o=[],r=[],i=[],a=0,s=[],c={},u=0,p=0,l,h,f,d;for(f of t){for(;f[0]>=a+l;){let g=Et(o.length+1,a,l,h,e,u,s,c,d,n);Wt(o,i,g),o.push(g),u=g.key,a=a+l,s=[],c={};let B=-1;for(;r[++B];)Ie(e,c,r[B]),S(r[B])<a+l&&r.splice(B--,1)}switch(f[1]){case"note":{Ie(e,c,f),S(f)>a+l&&r.push(f),p<S(f)&&(p=S(f));break}case"sequence":{f.events===t.events&&(d=f),p<S(f)&&(p=S(f));break}case"meter":l=f[2],h=f[3],f[0]!==a&&console.log("TODO");default:s.push(f)}}for(;r.length;){let g=Et(o.length+1,a,l,h,e,u,s,c,d,n);Wt(o,i,g),o.push(g),a=a+l,s=[],c={};let B=-1;for(;f=r[++B];)Ie(e,c,f),S(f)<a+l&&r.splice(B--,1)}for(;a<p-l;){let g=Et(o.length+1,a,l,h,e,u,s,c,d,n);Wt(o,i,g),o.push(g),a=a+l,s=[],c={}}let x=Et(o.length+1,a,l,h,e,u,s,c,d,n);return Wt(o,i,x),o.push(x),o}var Xt=Symbol("scribe-id"),Ni=0;function I(t){return t[Xt]||(t[Xt]=++Ni+""),t[Xt]}var It=Math.abs,zt={flat:`<span class="chord-flat">${Pt}</span>`,sharp:`<span class="chord-sharp">${At}</span>`},bi={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Ti={2:ie,1:At,0:St,"-1":Pt,"-2":re},Ri={"1.33":fe,"0.67":pe,"0.33":le,"0.17":ue,"0.08":ae},Mi=/^(âˆ†|-|Ã¸|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function A(t){return t.toFixed(4).replace(/\.?0+$/,"")}var Ke=b(K("type"),{BARREPEAT:t=>y("span",{class:"BARREPEAT",html:P["barRepeat"+t.count],data:{duration:t.duration}}),clef:t=>t.stave.getClefHTML?y("fragment",t.stave.getClefHTML()):y("span",{class:`${t.stave.type}-clef clef`,html:t.stave.clef}),chord:t=>{let e=Mi.exec(t.extension);return y("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(pt,zt.sharp).replace(lt,zt.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(pt,zt.sharp).replace(lt,zt.flat)+"</sup>":"")+"</span>"+(t.bass?de+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:A(t.beat),duration:A(t.duration),event:I(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?y("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,I(t.event))):y("span",{class:"timesig",html:`<sup>${P["timeSig"+t.numerator]}</sup>
                <sub>${P["timeSig"+t.denominator]}</sub>`,data:{event:I(t.event)}}),symbolcoda:t=>y("p",{html:he,class:"coda"}),barcount:t=>y("span",{html:t.text,class:"barcount"}),lyric:t=>y("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:A(t.beat),duration:A(t.duration),event:I(t.event)}}),acci:t=>y("span",{class:bi[t.value]||"acci",html:Ti[t.value]||St,data:t.beat===void 0?{pitch:t.pitch}:{beat:A(t.beat),pitch:t.pitch,part:t.part.name,event:I(t.event)}}),ledge:t=>y("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 4.8 ${It(t.rows)}`:`0 -0.5 4.8 ${It(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="4.8" y1="0" y2="0"></line>
            <line x1="0" x2="4.8" y1="2" y2="2"></line>
            <line x1="0" x2="4.8" y1="4" y2="4"></line>
            <line x1="0" x2="4.8" y1="6" y2="6"></line>
            <line x1="0" x2="4.8" y1="8" y2="8"></line>
        `,data:{beat:A(t.beat),pitch:t.pitch}}),note:t=>y("data",{class:`${t.stemup?"up-note":"down-note"} ${t.top?"top-note":""} ${t.bottom?"bottom-note":""} note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${E(t.pitch)}) ${t.part.name}`,data:{beat:A(t.beat),pitch:t.pitch,duration:A(t.duration),part:t.part.name,beam:t.beam&&I(t.beam),event:I(t.event)}}),beam:t=>y("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range>0?-t.range:0)-.5} 1 ${It(t.range)+1}`,preserveAspectRatio:"none",style:`height: ${(It(t.range)+.5)*.125}em; align-self: ${t.range>0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*X} L1,${-t.range-.5*X} L1,${-t.range+.5*X} L0,${.5*X} Z"></path>`,data:{beat:A(t.beat),pitch:t.pitch,duration:A(t.duration),part:t.part.name,events:xt(e=>I(e.event),t).join(" ")}}),tie:t=>y("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:A(t.beat),pitch:t.pitch,duration:A(t.duration),part:t.part.name}}),tuplet:t=>y("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:P["tuplet"+t.divisor],data:{beat:A(t.beat),pitch:t.pitch,duration:A(t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>y("span",{class:"rest",html:Ri[t.duration.toFixed(2)]||P["rest"+(t.duration+"").replace(".","")]||"",data:{beat:A(t.beat),pitch:t.pitch,duration:A(t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function $i(t){return t[0]<=0&&t[1]==="meter"}function Li(t){return t[0]<=0&&t[1]==="key"}function Gi(t,e){let n=Ke(e);return n&&t.push(n),t}function Oi(t,e){return t.push(y("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count},children:e.symbols.reduce(Gi,[])})),t}function ki(t,e,n,o,r=1/0,i=0,a=0,s=W){let c=t.events;!c.find($i)&&o&&c.unshift([0,"meter",o[2],o[3]]),!c.find(Li)&&n&&c.unshift([0,"key",n]);let l=un.create(e||"treble"),h=[];i&&h.push("transpose",i),a&&h.push("displace",a);let f=new $t(c,t.sequences,0,r,h),d=y("div",{class:`${l.type}-stave stave bar`,children:[Ke({type:"clef",stave:l})]}),x=y("div",{id:"side",class:"side"}),g=12;for(;g--;)x.appendChild(d.cloneNode(!0));return ze(f,l,s).reduce(Oi,[x])}export{J as a,b,wt as c,yt as d,k as e,y as f,un as g,W as h,As as i,ki as j};
//# sourceMappingURL=chunk-76IE3PXW.js.map
