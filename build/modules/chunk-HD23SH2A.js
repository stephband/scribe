/* Scribe 
   0.3.1
   By Stephen */

var Fn=Object.defineProperty;var Nn=(t,e)=>{for(var n in e)Fn(t,n,{get:e[n],enumerable:!0})};function K(t){return t}function R(t,e){return function(){let o=t.apply(this,arguments),r=e[o]||e.default;if(!r)throw new Error('overload() no function defined for key "'+o+'"');return r.apply(this,arguments)}}function mt(t){var e=new Map;return function(o){if(e.has(o))return e.get(o);var r=t(o);return e.set(o,r),r}}var bn=Array.prototype;function Rn(t,e){return typeof t=="function"?t.apply(null,e):t}function qe(t,e,n){n=n||t.length;var o=n===1?e?t:mt(t):mt(function(r){return qe(function(){var i=[r];return i.push.apply(i,arguments),t.apply(null,i)},e,n-1)});return function r(i){return arguments.length===0?r:arguments.length===1?o(i):arguments.length>=n?t.apply(null,arguments):Rn(o(i),bn.slice.call(arguments,1))}}var xt=qe;function k(){}var Tn=R(K,{is:k,tag:k,data:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},dataset:function(t,e,n){for(t in n)n[t]===void 0&&delete n[t];Object.assign(e.dataset,n)},html:function(t,e,n){e.innerHTML=n},text:function(t,e,n){e.textContent=n},style:R((t,e,n)=>typeof n,{string:(t,e,n)=>e.style=n,object:(t,e,n)=>Object.assign(e.style,n)}),children:function(t,e,n){e.innerHTML="",e.append.apply(e,n)},href:function(t,e,n){e instanceof SVGElement?e.setAttribute("href",n):e.href=n},points:$,cx:$,cy:$,r:$,x:$,y:$,dx:$,dy:$,transform:$,preserveAspectRatio:$,viewBox:$,default:function(t,e,n){t in e?e[t]=n:e.setAttribute(t,n)}});function $(t,e,n){e.setAttribute(t,n)}function Mn(t,e){for(var n=Object.keys(e),o=n.length;o--;)e[n[o]]!==void 0&&Tn(n[o],t,e[n[o]]);return t}var gt=xt(Mn,!0);var Ut="http://www.w3.org/2000/svg",Ue=document.createElement("template"),Wt=(t,e)=>e&&typeof e;function We(t,e=""){let n=document.createRange();return n.selectNode(t),n.createContextualFragment(e)}var N=R(Wt,{string:function(t,e){let n=document.createElementNS(Ut,t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElementNS(Ut,t);return typeof e.length=="number"?n.append.apply(n,e):gt(n,e),n},default:t=>document.createElementNS(Ut,t)}),$n=R(Wt,{string:function(t,e){let n=document.createElement(t);return n.innerHTML=e,n},object:function(t,e){let n=document.createElement(t);return typeof e.length=="number"?n.append.apply(n,e):gt(n,e),n},default:t=>document.createElement(t)}),Gn=R(K,{comment:function(t,e){return document.createComment(e||"")},fragment:R(Wt,{string:function(t,e,n){return n?We(n,e):(Ue.innerHTML=e,Ue.content.cloneNode(!0))},object:function(t,e,n){let o=n?We(n):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):gt(o,e),o},default:()=>document.createDocumentFragment()}),circle:N,ellipse:N,g:N,glyph:N,image:N,line:N,rect:N,use:N,path:N,pattern:N,polygon:N,polyline:N,svg:N,tspan:N,text:N,default:$n}),D=Gn;function It(t){return function(){return arguments[t]}}function Xt(t){return t}function V(){}function G(){return this}var Ie=Object.create,Ln=Object.freeze,Xe=Ln(Ie(Ie(Object.prototype,{at:{value:V},shift:{value:V},push:{value:V},forEach:{value:V},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:G},find:{value:V},findIndex:{value:function(){return-1}},flat:{value:G},flatMap:{value:G},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:G},reduce:{value:It(1)},sort:{value:G},each:{value:G},pipe:{value:Xt},start:{value:G},stop:{value:G},done:{value:G},valueOf:{value:function(){return null}}}),{length:{value:0}}));function zt(t,e){return(e%t+t)%t}var Ke=t=>zt(12,t);var kn=/^([A-G][♭♯#b]?)(-?\d)$/,On=/^[A-G][♭♯#b]?/,Hn=/-?\d$/,qn=/[Hh]z$/,nt={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},ze={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Bass Drum 2",36:"Bass Drum 1",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Tom 2",42:"Closed Hi-hat",43:"Low Tom 1",44:"Pedal Hi-hat",45:"Mid Tom 2",46:"Open Hi-hat",47:"Mid Tom 1",48:"High Tom 2",49:"Crash Cymbal 1",50:"High Tom 1",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Ve(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in ze)nt[Ve(ze[t])]=parseInt(t,10);var Un=69;function Wn(t,e=440){var n=Un+12*Math.log(t/e)/Math.log(2);return Math.fround(n)}function w(t){if(typeof t=="number")return t;if(qn.test(t))return Wn(parseFloat(t));let e=kn.exec(t);return e?(parseInt(e[2],10)+1)*12+nt[e[1]]:nt[Ve(t)]}function v(t){return typeof t=="number"?Ke(t):nt[On.exec(t)[0]]}var Et=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function ot(t){return tt(t)+wt(t)}function tt(t){return Et[Ke(t)]}function wt(t){return typeof t=="number"?Math.floor(t/12)-1:Number(nt[(Hn.exec(name)||Xe)[0]])}var B={};Nn(B,{acciDoubleFlat:()=>Yt,acciDoubleSharp:()=>_t,acciFlat:()=>yt,acciNatural:()=>Dt,acciParensLeft:()=>eo,acciParensRight:()=>no,acciSharp:()=>Ct,augmentationDot:()=>Ao,barLine:()=>Qo,barRepeat1:()=>Yo,barRepeat2:()=>_o,barRepeat4:()=>jo,barRepeatBegin:()=>or,barRepeatDots:()=>cr,barRepeatEnd:()=>rr,barRepeatEndBegin:()=>ir,barRepeatLowerDot:()=>nr,barRepeatSlash:()=>tr,barRepeatUpperDot:()=>er,chordAugmented:()=>wr,chordBassSlash:()=>se,chordBracketLeft:()=>Br,chordBracketRight:()=>Pr,chordDiminished:()=>gr,chordGlyphs:()=>Sr,chordHalfDiminished:()=>Er,chordMajorSeventh:()=>yr,chordMinor:()=>Dr,chordParensLeftTall:()=>Cr,chordParensRightTall:()=>vr,clefAlto:()=>Zt,clefBass:()=>it,clefDrum:()=>Jt,clefPercussion:()=>Qt,clefTreble:()=>rt,clefTrebleDown:()=>Kt,clefTrebleUp:()=>Vt,coda:()=>ce,graceNoteStemDown:()=>Lo,graceNoteStemUp:()=>Go,head1:()=>oo,head2:()=>ro,head4:()=>io,headBracketLeft:()=>jt,headBracketRight:()=>te,headCircle:()=>po,headCircleX:()=>fo,headDiamond:()=>so,headDiamondWide:()=>ao,headPlus:()=>lo,headSlashHorizontalEnds:()=>xo,headSlashVerticalEnds:()=>mo,headSlashed2:()=>co,headTriangleUp:()=>ho,headX:()=>uo,metDot:()=>$o,metNote05Down:()=>Mo,metNote05Up:()=>bo,metNote1Down:()=>To,metNote1Up:()=>No,metNote2Down:()=>Ro,metNote2Up:()=>Fo,note0125Down:()=>So,note0125Up:()=>Do,note025Down:()=>Po,note025Up:()=>yo,note05Down:()=>Bo,note05Up:()=>wo,note1Down:()=>vo,note1Up:()=>Eo,note2Down:()=>Co,note2Up:()=>go,rest0125:()=>ee,rest01875:()=>Io,rest025:()=>ne,rest0375:()=>Xo,rest05:()=>oe,rest075:()=>zo,rest1:()=>re,rest15:()=>Ko,rest2:()=>ie,rest3:()=>Vo,rest4:()=>Zo,rest6:()=>Jo,tailDown0125:()=>Wo,tailDown025:()=>qo,tailDown05:()=>Oo,tailUp0125:()=>Uo,tailUp025:()=>Ho,tailUp05:()=>ko,textBeam16Long:()=>Lr,textBeam16Short:()=>Gr,textBeam8Long:()=>$r,textBeam8Short:()=>Mr,textDot:()=>kr,textNote16Long:()=>Tr,textNote16Short:()=>Rr,textNote8Long:()=>br,textNote8Short:()=>Nr,textNoteLong:()=>Fr,textNoteShort:()=>Ar,textTie:()=>Or,textTuplet3Long:()=>Ir,textTuplet3Short:()=>qr,textTupletBeginLong:()=>Wr,textTupletBeginShort:()=>Hr,textTupletEndLong:()=>Xr,textTupletEndShort:()=>Ur,timeSig0:()=>In,timeSig1:()=>Xn,timeSig2:()=>zn,timeSig3:()=>Kn,timeSig4:()=>Vn,timeSig5:()=>Zn,timeSig6:()=>Jn,timeSig7:()=>Qn,timeSig8:()=>Yn,timeSig9:()=>_n,timeSigCommon:()=>jn,timeSigCutCommon:()=>to,tuplet0:()=>sr,tuplet1:()=>ar,tuplet2:()=>ur,tuplet3:()=>lr,tuplet4:()=>pr,tuplet5:()=>fr,tuplet6:()=>hr,tuplet7:()=>dr,tuplet8:()=>mr,tuplet9:()=>xr});var rt="&#xE050;",Kt="&#xE052;",Vt="&#xE053;",Zt="&#xE05C;",it="&#xE062;",Jt="&#xE069;",Qt="&#xE069;",In="&#xE080;",Xn="&#xE081;",zn="&#xE082;",Kn="&#xE083;",Vn="&#xE084;",Zn="&#xE085;",Jn="&#xE086;",Qn="&#xE087;",Yn="&#xE088;",_n="&#xE089;",jn="&#xE08A;",to="&#xE08B;",Yt="&#xE264;",yt="&#xE260;",Dt="&#xE261;",Ct="&#xE262;",_t="&#xE263;",eo="&#xE26A;",no="&#xE26B;",oo="&#xE0A4;",ro="&#xE0A3;",io="&#xE0A2;",jt="&#xE0F5;",te="&#xE0F6;",co="&#xE0D0;",so="&#xE0DB;",ao="&#xE0DC;",uo="&#xE0A9;",lo="&#xE0AF;",po="&#xE0E8;",fo="&#xE0B3;",ho="&#xE0BE;",mo="&#xE100;",xo="&#xE101;",go="&#xE1D3;",Eo="&#xE1D5;",wo="&#xE1D7;",yo="&#xE1D9;",Do="&#xE1DB;",Co="&#xE1D4;",vo="&#xE1D6;",Bo="&#xE1D8;",Po="&#xE1DA;",So="&#xE1DC;",Ao="&#xE1E7;",Fo="&#xECA3;",No="&#xECA5;",bo="&#xECA7;",Ro="&#xECA4;",To="&#xECA6;",Mo="&#xECA8;",$o="&#xECB7;",Go="&#xE560;",Lo="&#xE561;",ko="&#xE240;",Oo="&#xE241;",Ho="&#xE242;",qo="&#xE243;",Uo="&#xE244;",Wo="&#xE245;",ee="&#xE4E8;",Io="&#xE4E8;&#xE1E7;",ne="&#xE4E7;",Xo="&#xE4E7;&#xE1E7;",oe="&#xE4E6;",zo="&#xE4E6;&#xE1E7;",re="&#xE4E5;",Ko="&#xE4E5;&#x200A;&#xE1E7;",ie="&#xE4E4;",Vo="&#xE4E4;&#x200A;&#xE1E7;",Zo="&#xE4E3;",Jo="&#xE4E3;&#x200A;&#xE1E7;",Qo="&#xE030",Yo="&#xE500;",_o="&#xE501;",jo="&#xE502;",tr="&#xE504;",er="&#xE503;",nr="&#xE505;",or="&#xE040",rr="&#xE041",ir="&#xE042",cr="&#xE043",ce="&#xE048",sr="&#xE880;",ar="&#xE881;",ur="&#xE882;",lr="&#xE883;",pr="&#xE884;",fr="&#xE885;",hr="&#xE886;",dr="&#xE887;",mr="&#xE888;",xr="&#xE889;",gr="&#xE870;",Er="&#xE871;",wr="&#xE872;",yr="&#xE873;",Dr="&#xE874;",Cr="&#xE875;",vr="&#xE876;",Br="(",Pr=")",se="&#xE87B;",Sr={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},Ar="&#xE1F0;",Fr="&#xE1F1;",Nr="&#xE1F2;",br="&#xE1F3;",Rr="&#xE1F4;",Tr="&#xE1F5;",Mr="&#xE1F7;",$r="&#xE1F8;",Gr="&#xE1F9;",Lr="&#xE1FA;",kr="&#xE1FC;",Or="&#xE1FD;",Hr="&#xE1FE",qr="&#xE1FF",Ur="&#xE200",Wr="&#xE201",Ir="&#xE202",Xr="&#xE203";function ae(t){return function(){return arguments[t]}}function L(){return this}var Ze=Object.create,zr=Object.freeze,vt=zr(Ze(Ze(Object.prototype,{at:{value:k},shift:{value:k},push:{value:k},forEach:{value:k},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:L},find:{value:k},findIndex:{value:function(){return-1}},flat:{value:L},flatMap:{value:L},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:L},reduce:{value:ae(1)},sort:{value:L},each:{value:L},pipe:{value:K},start:{value:L},stop:{value:L},done:{value:L},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Z(t,e){return(e%t+t)%t}function O(t){return Z(12,t)}function Je(t){return t[1]==="chord"}function ue(t){return t[1]==="note"}function Qe(t){return t[1]==="sequence"}function Kr(t,e){return e[t]}var X=xt(Kr,!0);var Bt=R(X(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function S(t){return t[0]+Bt(t)}function Ye(t,e){return t>e?1:t<e?-1:0}var H=[0,2,4,5,7,9,11];function Vr(t,e,n){return n.indexOf(t)===e}function _e(t,e){return t.map(n=>O(n+e)).filter(Vr).sort(Ye)}var he=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function de(t){return _e(H,t)}var{abs:Hc}=Math,Zr={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},Jr=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),Qr=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],qc={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function pe(t){let e=new Float32Array(12),n=v(t+2),o=7;for(;o--;)n=v(n+5),e[n]=1;return e}function fe(t,e,n){let o=t.length;for(;o--;)t[o]*=1-n+n*e[o];return t}var le={note:(t,e,n=1)=>{let o=w(e[2]),r=pe(o);return fe(t,r,n*(1-o/192))},chord:(t,e,n=1)=>{let o=v(e[2]),r=Zr[e[3].replace(/\(|\)/g,"")];if(!r)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=r.map(c=>v(o+c)),a=i.length,s;for(;a--;)s=pe(i[a]),fe(t,s,n/i.length*Jr[r[a]]);return t}};function St(t,e,n){let o=t[e],r=o[0],i=ue(o)?pe(w(o[2])):Je(o)?le.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),o):0;if(n!==void 0){let s=Float32Array.from({length:12},(c,u)=>Qr[(u+12-n)%12]);fe(i,s,.3)}let a=e;for(;o=t[--a];){let s=le[o[1]];if(!s)continue;let c=S(o);if(c>r)s(i,o,.5);else if(o[1]==="note"&&r-c<3){if(1-(r-c)/3>1)throw new Error("Influence should never be > 1 "+r+" "+c);s(i,o,.25*(1-(r-o[0])/3))}}for(a=e;(o=t[++a])&&o[0]-r<2;){if(!ue(o))continue;let s=le[o[1]];if(s){if(1-(o[0]-r)/2>1)throw new Error("Influence should never be > 1 "+r+" "+stopBeat);s(i,o,.3*(1-(o[0]-r)/2))}}return i}var Pt=[0,7,5,2,10,9,3,4,8,11,1,6];function At(t){let e=Pt.length,n=0,o;for(;e--;)t[Pt[e]]>n&&(n=t[Pt[e]],o=Pt[e]);return o}var J=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,ct=/b|♭/,st=/#|♯/;var me=/b|♭|#|♯/g;var je={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function tn(t,e){let n=he[t],o=v(e),r=n.spellings[O(o)];return Et[O(o-r)]+je[r]}function Ft(t,e){let n=he[t],o,r,i;if(typeof e=="string"){let[c,u,f,l]=J.exec(e)||[e];l&&(o=w(e),r=n.spellings[O(o)],i=wt(o-r))}else o=e,r=n.spellings[O(o)],i=wt(o-r);let a=Et[O(o-r)],s=je[r];return a+s+i}var{round:xe}=Math,C=class{constructor(){}clef="";pitched=!0;rows=vt;getNoteHTML(e,n,o){let r=o>=4||Math.fround(o)===Math.fround(2.666666667)?"head4":o>=2||Math.fround(o)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${r}">${B[r]}</span>`}get minPitch(){return this.rows[0]}get bottomPitch(){return this.rows[xe(.5*this.rows.length)-4]}get centerPitch(){return this.rows[xe(.5*this.rows.length)]}get topPitch(){return this.rows[xe(.5*this.rows.length)+4]}get maxPitch(){return this.rows[this.rows.length-1]}movePitch(e,n){let o=w(this.minPitch),r=w(this.maxPitch),i=w(e)+n;return i>=o&&i<=r?i:void 0}parts=[{name:"main",top:"stave-top",center:"stave-center",bottom:"stave-bottom",DEFAULT:!0}];getPart(e){return this.parts[0]}getRowDiff(e,n){let o=e.replace(me,""),r=n.replace(me,""),i=this.rows.indexOf(o),a=this.rows.indexOf(r);if(i===-1)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);if(a===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return a-i}getSpelling(e,n){return n[1]==="chord"?tn(e,n[2]):Ft(e,n[2])}yRatioToPitch(e){let n=floor(e*this.pitches.length);return n<0?this.pitches[0]:n>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[n]}};var Q=class extends C{type="drum";clef=Jt;pitched=!1;rows=["","","","","","","","pedal-hi-hat","bass-drum-2","bass-drum-1","low-tom-2","low-tom-1","mid-tom-2","snare-drum-1","mid-tom-1","high-tom-1","closed-hi-hat","ride-cymbal-1","crash-cymbal-1","crash-cymbal-2","splash-cymbal","","","",""];#e={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};#t={27:0,28:0,29:0,30:0,31:13,32:0,33:0,34:0,35:10,36:9,37:14,38:14,39:13,40:14,41:11,42:17,43:12,44:8,45:13,46:17,47:13,48:15,49:19,50:16,51:18,52:21,53:18,54:13,55:21,56:16,57:20,58:0,59:19,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0};get maxPitch(){return this.rows[25]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[12]}get topPitch(){return this.rows[16]}getNoteHTML(e,n,o){let r=w(e),i=this.#e[r],a=B[i],s=i?`<span class="head" data-glyph="${i}">${a}</span>`:super.getNoteHTML(e,n,o);return n<.02?jt+s+te:s}parts={drums:{name:"drums",stemup:!1},cymbals:{name:"cymbals",stemup:!0}};getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(w(e))?this.parts.drums:this.parts.cymbals}getRowDiff(e,n){let o=w(e),r=w(n),i=this.#t[o],a=this.#t[r];if(i===void 0)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);if(a===void 0)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return a-i}getSpelling(e,n){return n[1]==="note"?ot(w(n[2])):Ft(e,n[2])}yRatioToPitch(e){let n=floor(e*this.rows.length),o=n<4?4:n>17?17:n;return this.pitches[o]}};var at=class extends Q{type="percussion";clef=Qt;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}parts={drums:{name:"drums",stemup:!1},cymbals:{name:"cymbals",stemup:!0}};getRowDiff(e,n){return 0}};var ut=class extends C{type="piano";rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"];getClefHTML(){return`<span class="treble-clef clef">${rt}</span><span class="bass-clef clef">${it}</span>`}getTimeSigHTML(e,n,o){return`<span class="timesig" data-event="${o}" data-part="rh">
            <sup>${B["timeSig"+e]}</sup>
            <sub>${B["timeSig"+n]}</sub>
        </span>
        <span class="timesig" data-event="${o}" data-part="lh">
            <sup>${B["timeSig"+e]}</sup>
            <sub>${B["timeSig"+n]}</sub>
        </span>`}parts=[{name:"lh",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",DEFAULT:!0},{name:"rh",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",DEFAULT:!0},{name:"soprano",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!0},{name:"alto",topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!1},{name:"tenor",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!0},{name:"bass",topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1}];getPart(e){return/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(e)?this.parts[0]:this.parts[1]}};var ge=class extends C{type="treble-up";clef=Vt;rows=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6","B6","C7","D7","E7","F7","G7","A7"]},Ee=class extends C{type="treble";clef=rt;rows=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6"]},we=class extends C{type="treble-down";clef=Kt;rows=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5"]},ye=class extends C{type="alto";clef=Zt;rows=["D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"]},De=class extends C{type="bass";clef=it;rows=["E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5"]};C.treble=Ee;C["treble-up"]=ge;C["treble-down"]=we;C.alto=ye;C.bass=De;C.piano=ut;C.drum=Q;C.percussion=at;C.create=t=>new C[t];var en=C;var q={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};function Yr(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Ce(t){return t===window?Yr():t.getClientRects()[0]||t.getBoundingClientRect()}var U=1.1;function _r(t){return parseFloat(t.dataset.duration)}function jr(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function nn(t,e,n){return`M${e[n[0]]}, ${-t*e[n[0]]-.5*U}
        L${e[n[n.length-1]]},${-t*e[n[n.length-1]]-.5*U}
        L${e[n[n.length-1]]},${-t*e[n[n.length-1]]+.5*U}
        L${e[n[0]]}, ${-t*e[n[0]]+.5*U}
        Z`}function ve(t,e,n,o,r,i){if(i<.125)return;let a=o-1,s;for(;e[++a];)e[a]<=i?s?s.push(a):s=[a]:s&&(t.appendChild(D("path",{class:`beam-path-${4/i} beam-path`,d:nn(r,n,s)})),ve(t,e,n,s[0],r,i/2),s=void 0);s&&(t.appendChild(D("path",{class:`beam-path-${4/i} beam-path`,d:nn(r,n,s)})),ve(t,e,n,s[0],r,i/2),s=void 0)}function vs(t){let e=t.dataset.events.split(/\s+/),n=t.parentElement,o=e.map(l=>n.querySelector('.note[data-event="'+l+'"]')),r=o.map(_r),i=t.viewBox.baseVal,a=i.y<-.5?i.y+.5:i.height-1,s=o.map(Ce),c=s[0].x,u=s[s.length-1].x,f=s.map(l=>(l.x-c)/(u-c));jr(t),ve(t,r,f,0,-a,.25)}function Be(t){return Z(12,t)}var Pe=Object.assign,on=[],ti={done:!0,value:void 0};var rn={key:2,meter:1,default:0},ei={},Rs=X(0);function cn(t){return rn[t[1]]||rn.default}function ni(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:cn(e)-cn(t)}function oi(t,e){return t.find(n=>n.id===e)}var ri={displace:(t,e,n)=>(n[0]-=t[++e],e),rate:(t,e,n)=>(n[0]/=t[++e],e),quantize:(t,e,n)=>{},transpose:(t,e,n)=>{switch(n[1]){case"note":{let o=typeof n[2]=="string"?w(n[2]):n[2];n[2]=o+t[e+1];break}case"chord":case"key":{let o=typeof n[2]=="string"?v(n[2]):n[2];n[2]=Be(o+t[e+1]);break}}return e+1}};function Se(t,e){let n=-1,o;for(;o=t[++n];)n=ri[o](t,n,e);return e}var Nt=class t{constructor(e,n=on,o=0,r=1/0,i=on){e.sort(ni),this.events=e,this.sequences=n,this.beat=o,this.duration=r,this.transforms=i;let a=-1,s;for(;(s=e[++a])&&Se(this.transforms,Pe(ei,s))[0]<0;);this.n=a-1}next(){let{buffer:e,events:n,sequences:o,n:r}=this,i=n[r+1],a=i&&Se(this.transforms,Pe({event:i,events:n},i)),s,c=0,u=0,f=i?a[0]:this.duration,l;for(;s=this[--c];)s.value||(s.next().value&&Se(this.transforms,s.value),s.done&&++u),s.value&&s.value[0]<f&&(l=s,f=s.value[0]),u&&(this[c]=this[c-u]);if(l)return this.value=l.value,this.value[0]+=this.beat,l.value=void 0,this;if(!a||this.duration<=a[0])return Pe(this,ti);if(Qe(i)){let p=this.sequences,m=oi(p,i[2]);if(!m)throw new Error('Sequence "'+i[2]+'" not found');let d=i.slice(5),h=new t(m.events,m.sequences?m.sequences.concat(p):p,a[0],a[4],d),E=0;for(;this[--E];);this[E]=h}return this.n+=1,this.value=a,this.value[0]+=this.beat,this}[Symbol.iterator](){return this}};var ii=[2,3,4,5,6,7,9],ci=1/12,sn=.25,an=.2,Ae={},et=0;function un(t,e){return Math.cos(2*Math.PI*e/t)}function ln(t,e,n,o,r){let i=t/e,a=0,s=0,c=0,u,f;for(o[r-1]&&S(o[r-1])>n+.125&&(c=1),--r;o[++r]!==void 0&&o[r][0]-n<i/4;)c=1;for(--r;o[++r]!==void 0&&o[r][0]-n<t-i/4;){if(u=Math.round((o[r][0]-n)/i),f=1<<u,u<e&&f>c){if(e>4&&f>c<<1)return;c+=f}a+=un(i,o[r][0]-n),s+=1,!(o[r][0]+o[r][4]-n>t)&&(a+=an*un(i,o[r][0]+o[r][4]-n),s+=an)}if(!(e>4&&u!==e-1)&&s)return Ae.score=a/(s+1),Ae.rhythm=c,Ae}function si(t,e,n,o,r,i,a){let s=n[o-1]&&S(n[o-1])>r+.125?r:e*Math.floor((n[o][0]-r)/e)+r,c=i.length;for(;e/i[--c]<ci;);++c;let u,f;for(;u=i[--c];)f=ln(e,u,s,n,o),f&&f.score>=et&&f.score&&(et=f.score,t.beat=s,t.duration=e,t.divisor=u,t.rhythm=f.rhythm),n[o][0]>=s+.5*e&&s+1.5*e<a&&(f=ln(e,u,s+.5*e,n,o),f&&f.score>=et&&(et=f.score,t.beat=s+.5*e,t.duration=e,t.divisor=u,t.rhythm=f.rhythm));return t}function Fe(t,e,n){let o=-1;for(;t[++o]!==void 0&&t[o][0]<e;);if(!t[o])return;let r={};et=sn;let i=1/8;for(;(i*=2)&&i<=n;)si(r,i,t,o,e,ii,e+n);return et>sn&&r}var{abs:ai,EPSILON:ui}=Math;function bt(t,e){return Math.round(e/t)*t}function W(t,e,n=ui){return t!==void 0&&(t===e||ai(t-e)<n)}function Y(t,e,n){return W(t,e,n)||t<e}function Ne(t,e,n){return W(t,e,n)||t>e}function Rt(t,e,n){return t!==void 0&&e!==void 0&&!Y(t,e,n)}function be(t,e,n){return t!==void 0&&e!==void 0&&!Ne(t,e,n)}function Re(t){return 2**Math.ceil(Math.log2(t))}function pn(t){return 2**Math.floor(Math.log2(t))}function fn(t){return t>0&&(t&t-1)===0}function Te(t,e,n){if(W(0,n,t/2))return e;let o=e*2;for(;(o/=2)>t;)if(W(0,Z(o,n),t/2))return o;return o}function lt(t,e){let n=-1,o=0;for(;t[++n]!==void 0;);for(;arguments[++o]!==void 0;)t[n++]=arguments[o];return t}function _(t){let e=-1;for(;t[++e]!==void 0;);return e}function Tt(t){return t[_(t)-1]}function pt(t,e){let n=[],o=-1;for(;e[++o]!==void 0;)n.push(t(e[o],o));return n}var xn=Object.assign,{abs:hn,ceil:Na,floor:dn,min:gn,max:En,sqrt:mn,round:ba}=Math,A=1/16,Ra=1/24;function Mt(t){return t[0]+Bt(t)}function wn(t,e){return En(t,Mt(e))}function yn(t,e,n){let o={},r=-1,i;for(;i=n[++r];){let a=i.scribeEvents,s=i.scribeIndex,c=St(a,s,e),u=At(c);o[r]=t.getSpelling(u,i)}return o}function $t(t){let[e,n,o,r]=J.exec(t[0]),i=r,a=v(n),s=t[0],c=0;for(;t[++c];){let[u,f,l,p]=J.exec(t[c]);(p<i||p===i&&v(f)<a)&&(i=p,a=v(f),s=t[c])}return s}function Gt(t){let[e,n,o,r]=J.exec(t[0]),i=r,a=v(n),s=t[0],c=0;for(;t[++c];){let[u,f,l,p]=J.exec(t[c]);(p>i||p===i&&v(f)>a)&&(i=p,a=v(f),s=t[c])}return s}function Ge(t,e,n,o){let r=t.getRowDiff(e.centerPitch||t.centerPitch,n);return t.getRowDiff(e.centerPitch||t.centerPitch,o)+r<-1}function Dn(t,e,n){let o=$t(n),r=Gt(n);return Ge(t,e,o,r)}function li(t,e,n){let o=[],r=-1,i;for(;i=n[++r];)i.type==="note"&&o.push(i.pitch);return Dn(t,e,o)}function z(t,e,n,o){let r=-1;for(;o[++r]&&o[r].beat===o.beat;);if(!o[r])return t;let i=o[0].beat,s=Tt(o).beat-i,c=n.stemup===void 0?Dn(e,n,pt(X("pitch"),o)):n.stemup,u=[],f;for(r=-1;f=o[++r];){let M=f.pitch;for(;o[++r]&&W(o[r].beat,f.beat,A);)c?w(o[r].pitch)>w(M)&&(M=o[r].pitch):w(o[r].pitch)<w(M)&&(M=o[r].pitch);--r,u.push(M)}let l=_(o),p=0,m=0,d;for(r=-1;u[++r];)d=e.getRowDiff(e.centerPitch,u[r]),r<(u.length-1)/2?p+=d/Math.floor(u.length/2):r>(u.length-1)/2&&(m+=d/Math.floor(u.length/2));let h=o[0],E=Tt(o),g=e.getRowDiff(h.pitch,E.pitch),x=m-p,P=hn(x)>hn(.75*g)?.5*g:.5*x;for(r=-1;f=o[++r];)f.stemup=c,f.beam=o,f.stemHeight=c?1+.125*(P*r/(u.length-1)-e.getRowDiff(h.pitch,f.pitch)):1+.125*(-P*r/(u.length-1)+e.getRowDiff(h.pitch,f.pitch));return t.push(xn(o,{pitch:h.pitch,duration:s,stemup:c,range:P})),t}function pi(t,e,n,o,r,i){return{type:"rest",beat:i,duration:Bn(t,e,i,r,i,r),stave:n,part:o}}function Me(t,e,n,o,r,i,a){for(;Rt(a,i,A);){let s=pi(e,n,o,r,a,i);t.push(s),i+=s.duration}return a}function fi(t,e,n,o,r,i,a,s){let c=st.test(s)?1:ct.test(s)?-1:void 0,u=s[0]+s.slice(-1);Ne(a[0],e.beat,A)&&c!==r[u]&&(r[u]=c,t.push(xn({},{type:"acci",beat:i,pitch:s,part:o,stave:n,event:a,value:c||0})))}function Cn(t,e,n,o,r,i,a,s){let c=-1;for(;s[++c];)fi(t,e,n,o,r,i,a[c],s[c]);return i}function vn(t,e,n,o,r){let i=Gt(r),a=e.getRowDiff(i,n.topPitch||e.topPitch);a<0&&t.push({type:"ledge",beat:o,pitch:i,rows:a}),i=$t(r),a=e.getRowDiff(i,n.bottomPitch||e.bottomPitch)-2,a>0&&t.push({type:"ledge",beat:o,pitch:i,rows:a})}function hi(t,e,n){let{beat:o,duration:r,divisor:i}=n,a=e.stemup===void 0?li(t,e,n):e.stemup,s=-1,c;for(;c=n[++s];)c.type==="note"&&!c.beam&&(c.stemup=a);let u=o+.5*r,f=w(t.topPitch)-12,l,p=_(n);for(;(c=n[--p])&&c.beat>u;);for(++p;(c=n[--p])&&c.beat+c.duration>u;){let x=w(c.pitch);(!l||x>l)&&(l=x)}let m=f;for(p=-1;(c=n[++p])&&c.beat<o+A;){let x=w(c.pitch);(!m||x>m)&&(m=x)}let d=f;for(p=_(n);(c=n[--p])&&c.beat>o+r-r/i-A;){let x=w(c.pitch);(!d||x>d)&&(d=x)}let h=Math.ceil((m+d)/2),E=ot(h);h>l&&(l=h),n.pitch=ot(l),n.stemup=a;let g=d-m;n.angle=g<0?4*mn(-g):-4*mn(g)}function di(t,e,n,o,r,i,a,s,c,u,f,l,p,m){(a.swingAsStraight8ths&&c===1||a.swingAsStraight16ths&&c===.5)&&u===3&&(f===4||f===5)&&(u=2);let d=c/u,h=s+c,E={type:"tuplet",beat:s,duration:c,divisor:u,rhythm:f,part:i,stave:n},g,x;for(fn(u)||t.push(E);be(s,h,A);){for(;(g=p[++m])&&Y(g[0]-e.beat,s+.5*d,A);)l.push(g);if(--m,!l.length){t.push({type:"rest",beat:s,duration:d,stave:n,part:i}),s+=d;continue}let P=yn(n,o,l),M=$t(P),ht=Gt(P),dt=i.stemup===void 0?Ge(n,i,M,ht):i.stemup,qt=gn(l.reduce(wn,0)-e.beat,g?g[0]-e.beat:e.duration,E.beat+E.duration),T=En(d,bt(d,qt-s));Rt(T,.5,A)?x&&(z(t,n,i,x),x=void 0):x||(x={type:"beam",beat:s,part:i}),vn(t,n,i,s,P),Cn(t,e,n,i,r,s,l,P);let y=-1;for(;l[++y];)t.push({type:"note",beat:s,pitch:P[y],duration:T,part:i,stemup:dt,top:P[y]===ht,bottom:P[y]===M,stave:n,event:l[y]});for(lt(E,...t.slice(-1*l.length)),x&&lt(x,...t.slice(-1*l.length)),y=l.length;y--;){let b=Mt(l[y])-e.beat;Y(b,s+T+.5*d,A)?l.splice(y,1):t.push({type:"tie",beat:s,pitch:P[y],duration:T,stemup:dt,part:i,event:l[y]})}s+=T}return x&&z(t,n,i,x),hi(n,i,E),m}function $e(t,e){let n=2*Re(e);for(;(n/=2)>t/2;){if(1.75*n===e)return 1.75*n;if(1.5*n===e)return 1.5*n;if(n<=e)return n}return t}function mi(t,e,n){n=n||1/0;let o=4*Re(e);for(;(o/=2)>t/2;)if(o<=e*2&&o<=n)return o;return t}function Bn(t,e,n,o,r,i){let s=pn(e.divisor),c=dn(r/e.divisor)*e.divisor,u=Te(.125,s,r-c),f=dn(o/e.divisor)*e.divisor,l=c+e.divisor<o&&c+e.divisor;if(r===c)return t.indexOf(o-r)!==-1?o-r:t.indexOf(f-r)!==-1?f-r:l?l-r:(console.log(r,"huh",o-r,i-r),mi(.125,o-r,i-r));if(W(o,f,A))return t.indexOf(o-r)!==-1?o-r:l&&t.indexOf(l-r)!==-1?l-r:u;{let p=4*u;return(r-c)%p/u===1?r+2*u===i?2*u:(r+3*u>=i&&console.log("Next event beat is inside quaduplet"),u<1?o>=r+u*3/2?3*u:o>=r+u?u:$e(.125,o-r):o>=r+u*3?u*3:o>=r+u*2?u*2:o>r+u?u:$e(.125,o-r)):o>r+u?u:$e(.125,o-r)}}function Le(t,e,n,o=0,r={},i,a,s=q){let c=[],{headDurations:u,restDurations:f}=s,l=0,p=-1,m,d,h;for(;(m=a[++p])&&Y(m[0]+m[4]-e.beat,l,A););for(--p;be(l,e.duration,A);){h&&e.divisions.find(b=>W(l,b,A))&&(z(t,n,i,h),h=void 0);let E=Fe(a,e.beat+l,e.duration-l);if(E&&E.divisor!==2&&E.divisor!==4){Rt(E.beat-e.beat,l,A)&&Me(t,s.restDurations,e,n,i,l,E.beat-e.beat),h&&(z(t,n,i,h),h=void 0),p=di(t,e,n,o,r,i,s,E.beat-e.beat,E.duration,E.divisor,E.rhythm,c,a,p),l=E.beat-e.beat+E.duration;continue}for(;(m=a[++p])&&Y(m[0]-e.beat,l,A);)c.push(m);if(--p,!c.length){if(!m){h&&(z(t,n,i,h),h=void 0),Me(t,s.restDurations,e,n,i,l,e.duration);break}let b=bt(.125,m[0]-e.beat);if(b<=l){console.log(`Problem at bar ${e.count}, moving to next bar ${l} ${b}`),e.error="Stop beat has ended up less than beat";break}h&&(Pn(e.divisions,l,b)||b-l>=.5)&&(z(t,n,i,h),h=void 0),Me(t,f,e,n,i,l,b),l=b;continue}let g=yn(n,o,c),x=$t(g),P=Gt(g),M=i.stemup===void 0?Ge(n,i,x,P):i.stemup;vn(t,n,i,l,g),Cn(t,e,n,i,r,l,c,g);let ht=c[0][0]-e.beat,dt=gn(e.duration,c.reduce(wn,0)-e.beat),qt=m&&bt(.125,m[0])-e.beat,T=Bn(u,e,ht,dt,l,qt);T>=1?h&&(z(t,n,i,h),h=void 0):h||(h={type:"beam",beat:l,part:i});let y=-1;for(;c[++y];)t.push({type:"note",beat:l,pitch:g[y],duration:T,part:i,stemup:M,top:g[y]===P,bottom:g[y]===x,stave:n,event:c[y]});for(h&&lt(h,...t.slice(-1*c.length)),y=c.length;y--;){let b=Mt(c[y])-e.beat;Y(b,l+T,A)||b-(l+T)<.125+1/16*(Mt(c[y])-c[y][0])?c.splice(y,1):t.push({type:"tie",beat:l,pitch:g[y],duration:T,stemup:M,part:i,event:c[y]})}l+=T}return h&&(z(t,n,i,h),h=void 0),t}var xi={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function gi(t,e){return xi[t+","+e]||vt}function Pn(t,e,n){let o=-1;for(;t[++o]&&t[o]<=e;);return n>t[o]?t[o]:void 0}var Ei=[],wi={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},Sn=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function yi(t,e){let n=Sn.indexOf(t.pitch),o=Sn.indexOf(e.pitch);return n>o?1:n<o?-1:0}function An(t,e){return de(e).reduce((o,r,i)=>{let a=r-H[i];if(a!==0){let s=tt(H[i]),c=10;for(;c--;)o[s+c]=a}return o},t),t}function Di(t,e,n,o,r,i,a){let s=-1,c;for(;c=i[++s];)switch(c[1]){case"key":{let u=v(c[2]),f=de(u);An(r,u),t.push.apply(t,f.map((l,p)=>l-H[p]&&{type:"acci",pitch:tt(H[p])+wi[l-H[p]],value:l-H[p],stave:n}).filter(l=>!!l).sort(yi)),e.key=u;break}case"meter":{t.push({type:"timesig",beat:0,numerator:c[3]===1.5?c[2]/.5:c[2]/c[3],denominator:c[3]===1.5?8:4/c[3],stave:n,event:c});break}case"symbol":{t.push({type:"symbol"+c[2],stave:n});break}case"chord":{let u=c[0]-e.beat,f=St(i,s,o),l=At(f),p=n.getSpelling(l,c);p==="C♭"&&a.spellChordRootCFlatAsB&&(p="B"),p==="E♯"&&a.spellChordRootESharpAsF&&(p="F"),p==="B♯"&&a.spellChordRootBSharpAsC&&(p="C"),p==="F♭"&&a.spellChordRootFFlatAsE&&(p="E"),t.push({type:"chord",beat:u,duration:c[0]+c[4]>e.beat+e.duration?e.duration-u:c[4],root:p,extension:c[3],event:c,stave:n});break}case"lyric":{let u=c[0]-e.beat;t.push({type:"lyric",beat:u,duration:c[0]+c[3]>e.beat+e.duration?e.duration-u:c[3],value:c[2],event:c,stave:n});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(Ei.includes(c[1]))return;console.log('Scribe: ignoring event type "'+c[1]+'"')}}return t}function ft(t,e,n,o,r,i,a,s,c,u=q){let f=[];if(c){let h=S(c);h>e&&h<=e+n&&a.push(c)}let l=An({},i),p={type:"bar",beat:e,duration:n,key:i,divisor:o,divisions:gi(n,o),stave:r,count:t,symbols:f};Di(f,p,r,i,l,a,q);let m,d=0;for(m in r.parts){let h=r.parts[m],E=s[h.name]||[];!h.DEFAULT&&!E.length||(Le(f,p,r,i,l,h,E,u),++d)}return d||(console.log("Stave has no parts defined SHOULD NOT BE"),Le(f,p,r,i,l,r.parts[0],[],u)),p}function Ci(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function vi(t){let e=t.symbols.filter(n=>n.type==="chord"||n.type==="note");return JSON.stringify(e,Ci)}function j(t,e){t.symbols=t.symbols.filter(n=>n.type==="doublebarline"||n.type==="clef").concat([{type:"BARREPEAT",count:e,duration:t.duration}])}function Lt(t,e,n){let o=vi(n);switch(e.length){case 1:break;case 2:break;case 3:{o==="[]"&&e[0]==="[]"?e.length=0:o===e[0]&&o===e[1]&&o===e[2]&&n.symbols.filter(r=>r.type!=="clef"&&r.type!=="timesig").find(r=>r.type!=="rest")?(j(t[t.length-2],1),j(t[t.length-1],1),j(n,1)):(o!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{o===e[0]&&o===e[1]&&o===e[2]&&o===e[3]?(j(n,1),e.length=3):(o!==e[1]||e[0]!==e[2]||o!==e[3])&&(e.length=2);break}case 5:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,j(t[t.length-1],2),j(n,2)):e.length=4;break}case 6:break;case 7:{o===e[1]&&o===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,j(n,2),e.length=5):e.length=1;break}}for(e.unshift(o);e.length>8;)e.pop()}function ke(t,e,n){let o=n.target?t.parts[n.target]:t.getPart(n[2]),r=e[o.name]||(e[o.name]=[]);e[o.name].push(n)}function Oe(t,e,n=q){let o=[],r=[],i=[],a=[],s=0,c=[],u={},f=0,l=0,p,m,d,h;for(d of t){for(d.scribeIndex=o.length,d.scribeEvents=o,o.push(d);d[0]>=s+p;){let g=ft(r.length+1,s,p,m,e,f,c,u,h,n);Lt(r,a,g),r.push(g),f=g.key,s=s+p,c=[],u={};let x=-1;for(;i[++x];)ke(e,u,i[x]),S(i[x])<s+p&&i.splice(x--,1)}switch(d[1]){case"note":{ke(e,u,d),S(d)>s+p&&i.push(d),l<S(d)&&(l=S(d));break}case"sequence":{d.events===t.events&&(h=d),l<S(d)&&(l=S(d));break}case"meter":p=d[2],m=d[3],d[0]!==s&&console.log("TODO");default:c.push(d)}}for(;i.length;){let g=ft(r.length+1,s,p,m,e,f,c,u,h,n);Lt(r,a,g),r.push(g),s=s+p,c=[],u={};let x=-1;for(;d=i[++x];)ke(e,u,d),S(d)<s+p&&i.splice(x--,1)}for(;s<l-p;){let g=ft(r.length+1,s,p,m,e,f,c,u,h,n);Lt(r,a,g),r.push(g),s=s+p,c=[],u={}}let E=ft(r.length+1,s,p,m,e,f,c,u,h,n);return Lt(r,a,E),r.push(E),r}var kt=Symbol("scribe-id"),Bi=0;function I(t){return t[kt]||(t[kt]=++Bi+""),t[kt]}var Ot=Math.abs,Ht={flat:`<span class="chord-flat">${yt}</span>`,sharp:`<span class="chord-sharp">${Ct}</span>`},Pi={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Si={2:_t,1:Ct,0:Dt,"-1":yt,"-2":Yt},Ai={"1.33":ie,"0.67":re,"0.33":oe,"0.17":ne,"0.08":ee},Fi=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function F(t){return t.toFixed(4).replace(/\.?0+$/,"")}var He=R(X("type"),{BARREPEAT:t=>D("span",{class:"BARREPEAT",html:B["barRepeat"+t.count],data:{duration:t.duration}}),clef:t=>t.stave.getClefHTML?D("fragment",t.stave.getClefHTML()):D("span",{class:`${t.stave.type}-clef clef`,html:t.stave.clef}),chord:t=>{let e=Fi.exec(t.extension);return D("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(st,Ht.sharp).replace(ct,Ht.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(st,Ht.sharp).replace(ct,Ht.flat)+"</sup>":"")+"</span>"+(t.bass?se+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:F(t.beat),duration:F(t.duration),event:I(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?D("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,I(t.event))):D("span",{class:"timesig",html:`<sup>${B["timeSig"+t.numerator]}</sup>
                <sub>${B["timeSig"+t.denominator]}</sub>`,data:{event:I(t.event)}}),symbolcoda:t=>D("p",{html:ce,class:"coda"}),barcount:t=>D("span",{html:t.text,class:"barcount"}),lyric:t=>D("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:F(t.beat),duration:F(t.duration),event:I(t.event)}}),acci:t=>D("span",{class:Pi[t.value]||"acci",html:Si[t.value]||Dt,data:t.beat===void 0?{pitch:t.pitch}:{beat:F(t.beat),pitch:t.pitch,part:t.part.name,event:I(t.event)}}),ledge:t=>D("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 4.8 ${Ot(t.rows)}`:`0 -0.5 4.8 ${Ot(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="4.8" y1="0" y2="0"></line>
            <line x1="0" x2="4.8" y1="2" y2="2"></line>
            <line x1="0" x2="4.8" y1="4" y2="4"></line>
            <line x1="0" x2="4.8" y1="6" y2="6"></line>
            <line x1="0" x2="4.8" y1="8" y2="8"></line>
        `,data:{beat:F(t.beat),pitch:t.pitch}}),note:t=>D("data",{class:`${t.stemup?"up-note":"down-note"} ${t.top?"top-note":""} ${t.bottom?"bottom-note":""} note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${w(t.pitch)}) ${t.part.name}`,data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name,beam:t.beam&&I(t.beam),event:I(t.event)}}),beam:t=>D("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range>0?-t.range:0)-.5} 1 ${Ot(t.range)+1}`,preserveAspectRatio:"none",style:`height: ${(Ot(t.range)+.5)*.125}em; align-self: ${t.range>0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*U} L1,${-t.range-.5*U} L1,${-t.range+.5*U} L0,${.5*U} Z"></path>`,data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name,events:pt(e=>I(e.event),t).join(" ")}}),tie:t=>D("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name}}),tuplet:t=>D("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:B["tuplet"+t.divisor],data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>D("span",{class:"rest",html:Ai[t.duration.toFixed(2)]||B["rest"+(t.duration+"").replace(".","")]||"",data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function Ni(t){return t[0]<=0&&t[1]==="meter"}function bi(t){return t[0]<=0&&t[1]==="key"}function Ri(t,e){let n=He(e);return n&&t.push(n),t}function Ti(t,e){return t.push(D("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:tt(e.key)},children:e.symbols.reduce(Ri,[])})),t}function Mi(t,e,n,o,r=1/0,i=0,a=0,s=q){let c=t.events;!c.find(Ni)&&o&&c.unshift([0,"meter",o[2],o[3]]),!c.find(bi)&&n&&c.unshift([0,"key",n]);let l=en.create(e||"treble"),p=[];i&&p.push("transpose",i),a&&p.push("displace",a);let m=new Nt(c,t.sequences,0,r,p),d=Oe(m,l,s).reduce(Ti,[]),h=d[0],E=h.querySelectorAll(".acci:not([data-beat])"),g=D("div",{class:`${l.type}-stave signature-stave stave`,children:[He({type:"clef",stave:l}),...E],data:{key:h.dataset.key}}),x=D("div",{id:"side",class:"side",data:{key:h.dataset.key}}),P=24;for(;P--;)x.appendChild(g.cloneNode(!0));return console.log("BBBB",d),d.unshift(x),d}export{K as a,R as b,mt as c,xt as d,k as e,D as f,en as g,q as h,vs as i,Mi as j};
//# sourceMappingURL=chunk-HD23SH2A.js.map
