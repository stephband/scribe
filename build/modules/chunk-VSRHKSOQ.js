/* Scribe 
   0.4.5
   By Stephen */

var To=Object.defineProperty;var Go=(t,e)=>{for(var o in e)To(t,o,{get:e[o],enumerable:!0})};function I(t){return t}function v(t,e){return function(){let r=t.apply(this,arguments),n=e[r]||e.default;if(!n)throw new Error('overload() no function defined for key "'+r+'"');return n.apply(this,arguments)}}function bt(t){var e=new Map;return function(r){if(e.has(r))return e.get(r);var n=t(r);return e.set(r,n),n}}var $o=Array.prototype;function Mo(t,e){return typeof t=="function"?t.apply(null,e):t}function Le(t,e,o){o=o||t.length;var r=o===1?e?t:bt(t):bt(function(n){return Le(function(){var i=[n];return i.push.apply(i,arguments),t.apply(null,i)},e,o-1)});return function n(i){return arguments.length===0?n:arguments.length===1?r(i):arguments.length>=o?t.apply(null,arguments):Mo(r(i),$o.slice.call(arguments,1))}}var j=Le;function q(){}var Lo=v(I,{is:q,tag:q,data:function(t,e,o){for(t in o)o[t]===void 0&&delete o[t];Object.assign(e.dataset,o)},dataset:function(t,e,o){for(t in o)o[t]===void 0&&delete o[t];Object.assign(e.dataset,o)},html:function(t,e,o){e.innerHTML=o},text:function(t,e,o){e.textContent=o},style:v((t,e,o)=>typeof o,{string:(t,e,o)=>e.style=o,object:(t,e,o)=>Object.assign(e.style,o)}),children:function(t,e,o){e.innerHTML="",e.append.apply(e,o)},href:function(t,e,o){e instanceof SVGElement?e.setAttribute("href",o):e.href=o},points:M,cx:M,cy:M,r:M,x:M,y:M,dx:M,dy:M,transform:M,preserveAspectRatio:M,viewBox:M,default:function(t,e,o){t in e?e[t]=o:e.setAttribute(t,o)}});function M(t,e,o){e.setAttribute(t,o)}function Oo(t,e){for(var o=Object.keys(e),r=o.length;r--;)e[o[r]]!==void 0&&Lo(o[r],t,e[o[r]]);return t}var St=j(Oo,!0);var Zt="http://www.w3.org/2000/svg",Oe=document.createElement("template"),Qt=(t,e)=>e&&typeof e;function He(t,e=""){let o=document.createRange();return o.selectNode(t),o.createContextualFragment(e)}var A=v(Qt,{string:function(t,e){let o=document.createElementNS(Zt,t);return o.innerHTML=e,o},object:function(t,e){let o=document.createElementNS(Zt,t);return typeof e.length=="number"?o.append.apply(o,e):St(o,e),o},default:t=>document.createElementNS(Zt,t)}),Ho=v(Qt,{string:function(t,e){let o=document.createElement(t);return o.innerHTML=e,o},object:function(t,e){let o=document.createElement(t);return typeof e.length=="number"?o.append.apply(o,e):St(o,e),o},default:t=>document.createElement(t)}),qo=v(I,{comment:function(t,e){return document.createComment(e||"")},fragment:v(Qt,{string:function(t,e,o){return o?He(o,e):(Oe.innerHTML=e,Oe.content.cloneNode(!0))},object:function(t,e,o){let r=o?He(o):document.createDocumentFragment();return typeof e.length=="number"?r.append.apply(r,e):St(r,e),r},default:()=>document.createDocumentFragment()}),circle:A,ellipse:A,g:A,glyph:A,image:A,line:A,rect:A,use:A,path:A,pattern:A,polygon:A,polyline:A,svg:A,tspan:A,text:A,default:Ho}),S=qo;function Yt(t){return function(){return arguments[t]}}function _t(t){return t}function V(){}function L(){return this}var qe=Object.create,Uo=Object.freeze,Ue=Uo(qe(qe(Object.prototype,{at:{value:V},shift:{value:V},push:{value:V},forEach:{value:V},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:L},find:{value:V},findIndex:{value:function(){return-1}},flat:{value:L},flatMap:{value:L},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:L},reduce:{value:Yt(1)},sort:{value:L},each:{value:L},pipe:{value:_t},start:{value:L},stop:{value:L},done:{value:L},valueOf:{value:function(){return null}}}),{length:{value:0}}));function jt(t,e){return(e%t+t)%t}var We=t=>jt(12,t);var Wo=/^([A-G][♭♯#b]?)(-?\d)$/,Io=/^[A-G][♭♯#b]?/,Xo=/-?\d$/,Ko=/[Hh]z$/,st={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},te={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Low Bass Drum",36:"High Bass Drum",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Floor Tom",42:"Closed Hi-hat",43:"High Floor Tom",44:"Pedal Hi-hat",45:"Low Tom",46:"Open Hi-hat",47:"Low Mid Tom",48:"High Mid Tom",49:"Crash Cymbal 1",50:"High Tom",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Ie(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in te)st[Ie(te[t])]=parseInt(t,10);var zo=69;function Vo(t,e=440){var o=zo+12*Math.log(t/e)/Math.log(2);return Math.fround(o)}function y(t){if(typeof t=="number")return t;if(Ko.test(t))return Vo(parseFloat(t));let e=Wo.exec(t);return e?(parseInt(e[2],10)+1)*12+st[e[1]]:st[Ie(t)]}function C(t){return typeof t=="number"?We(t):st[Io.exec(t)[0]]}var Ct=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function U(t){return T(t)+Rt(t)}function T(t){return Ct[We(t)]}function Rt(t){return typeof t=="number"?Math.floor(t/12)-1:Number(st[(Xo.exec(name)||Ue)[0]])}function Xe(t){let e=y(t);return te[e]||""}var N={};Go(N,{acciDoubleFlat:()=>ee,acciDoubleSharp:()=>oe,acciFlat:()=>Bt,acciNatural:()=>Ft,acciParensLeft:()=>cr,acciParensRight:()=>sr,acciSharp:()=>vt,augmentationDot:()=>Pr,barLine:()=>tn,barRepeat1:()=>en,barRepeat2:()=>on,barRepeat4:()=>rn,barRepeatBegin:()=>an,barRepeatDots:()=>pn,barRepeatEnd:()=>un,barRepeatEndBegin:()=>ln,barRepeatLowerDot:()=>sn,barRepeatSlash:()=>nn,barRepeatUpperDot:()=>cn,chordAugmented:()=>Cn,chordBassSlash:()=>pe,chordBracketLeft:()=>vn,chordBracketRight:()=>An,chordDiminished:()=>bn,chordGlyphs:()=>Pn,chordHalfDiminished:()=>Sn,chordMajorSeventh:()=>Rn,chordMinor:()=>Nn,chordParensLeftTall:()=>Bn,chordParensRightTall:()=>Fn,clefAlto:()=>pt,clefBass:()=>ht,clefDrum:()=>Nt,clefTreble:()=>at,clefTrebleDown:()=>ut,clefTrebleUp:()=>lt,coda:()=>le,graceNoteStemDown:()=>qr,graceNoteStemUp:()=>Hr,head1:()=>ar,head2:()=>ur,head4:()=>lr,headBracketLeft:()=>re,headBracketRight:()=>ne,headCircle:()=>xr,headCircleX:()=>gr,headDiamond:()=>hr,headDiamondWide:()=>fr,headPlus:()=>dr,headSlashHorizontalEnds:()=>yr,headSlashVerticalEnds:()=>Er,headSlashed2:()=>pr,headTriangleUp:()=>wr,headX:()=>mr,metDot:()=>Or,metNote05Down:()=>Lr,metNote05Up:()=>Gr,metNote1Down:()=>Mr,metNote1Up:()=>Tr,metNote2Down:()=>$r,metNote2Up:()=>kr,note0125Down:()=>Ar,note0125Up:()=>Rr,note025Down:()=>vr,note025Up:()=>Cr,note05Down:()=>Fr,note05Up:()=>Sr,note1Down:()=>Br,note1Up:()=>br,note2Down:()=>Nr,note2Up:()=>Dr,rest0125:()=>ie,rest01875:()=>Vr,rest025:()=>ce,rest0375:()=>Jr,rest05:()=>se,rest075:()=>Zr,rest1:()=>ae,rest15:()=>Qr,rest2:()=>ue,rest3:()=>Yr,rest4:()=>_r,rest6:()=>jr,tailDown0125:()=>zr,tailDown025:()=>Xr,tailDown05:()=>Wr,tailUp0125:()=>Kr,tailUp025:()=>Ir,tailUp05:()=>Ur,textBeam16Long:()=>Un,textBeam16Short:()=>qn,textBeam8Long:()=>Hn,textBeam8Short:()=>On,textDot:()=>Wn,textNote16Long:()=>Ln,textNote16Short:()=>Mn,textNote8Long:()=>$n,textNote8Short:()=>Gn,textNoteLong:()=>Tn,textNoteShort:()=>kn,textTie:()=>In,textTuplet3Long:()=>Jn,textTuplet3Short:()=>Kn,textTupletBeginLong:()=>Vn,textTupletBeginShort:()=>Xn,textTupletEndLong:()=>Zn,textTupletEndShort:()=>zn,timeSig0:()=>Jo,timeSig1:()=>Zo,timeSig2:()=>Qo,timeSig3:()=>Yo,timeSig4:()=>_o,timeSig5:()=>jo,timeSig6:()=>tr,timeSig7:()=>er,timeSig8:()=>or,timeSig9:()=>rr,timeSigCommon:()=>nr,timeSigCutCommon:()=>ir,tuplet0:()=>hn,tuplet1:()=>fn,tuplet2:()=>mn,tuplet3:()=>dn,tuplet4:()=>xn,tuplet5:()=>gn,tuplet6:()=>wn,tuplet7:()=>En,tuplet8:()=>yn,tuplet9:()=>Dn});var at="&#xE050;",ut="&#xE052;",lt="&#xE053;",pt="&#xE05C;",ht="&#xE062;",Nt="&#xE069;",Jo="&#xE080;",Zo="&#xE081;",Qo="&#xE082;",Yo="&#xE083;",_o="&#xE084;",jo="&#xE085;",tr="&#xE086;",er="&#xE087;",or="&#xE088;",rr="&#xE089;",nr="&#xE08A;",ir="&#xE08B;",ee="&#xE264;",Bt="&#xE260;",Ft="&#xE261;",vt="&#xE262;",oe="&#xE263;",cr="&#xE26A;",sr="&#xE26B;",ar="&#xE0A4;",ur="&#xE0A3;",lr="&#xE0A2;",re="&#xE0F5;",ne="&#xE0F6;",pr="&#xE0D0;",hr="&#xE0DB;",fr="&#xE0DC;",mr="&#xE0A9;",dr="&#xE0AF;",xr="&#xE0E8;",gr="&#xE0B3;",wr="&#xE0BE;",Er="&#xE100;",yr="&#xE101;",Dr="&#xE1D3;",br="&#xE1D5;",Sr="&#xE1D7;",Cr="&#xE1D9;",Rr="&#xE1DB;",Nr="&#xE1D4;",Br="&#xE1D6;",Fr="&#xE1D8;",vr="&#xE1DA;",Ar="&#xE1DC;",Pr="&#xE1E7;",kr="&#xECA3;",Tr="&#xECA5;",Gr="&#xECA7;",$r="&#xECA4;",Mr="&#xECA6;",Lr="&#xECA8;",Or="&#xECB7;",Hr="&#xE560;",qr="&#xE561;",Ur="&#xE240;",Wr="&#xE241;",Ir="&#xE242;",Xr="&#xE243;",Kr="&#xE244;",zr="&#xE245;",ie="&#xE4E8;",Vr="&#xE4E8;&#xE1E7;",ce="&#xE4E7;",Jr="&#xE4E7;&#xE1E7;",se="&#xE4E6;",Zr="&#xE4E6;&#xE1E7;",ae="&#xE4E5;",Qr="&#xE4E5;&#x200A;&#xE1E7;",ue="&#xE4E4;",Yr="&#xE4E4;&#x200A;&#xE1E7;",_r="&#xE4E3;",jr="&#xE4E3;&#x200A;&#xE1E7;",tn="&#xE030",en="&#xE500;",on="&#xE501;",rn="&#xE502;",nn="&#xE504;",cn="&#xE503;",sn="&#xE505;",an="&#xE040",un="&#xE041",ln="&#xE042",pn="&#xE043",le="&#xE048",hn="&#xE880;",fn="&#xE881;",mn="&#xE882;",dn="&#xE883;",xn="&#xE884;",gn="&#xE885;",wn="&#xE886;",En="&#xE887;",yn="&#xE888;",Dn="&#xE889;",bn="&#xE870;",Sn="&#xE871;",Cn="&#xE872;",Rn="&#xE873;",Nn="&#xE874;",Bn="&#xE875;",Fn="&#xE876;",vn="(",An=")",pe="&#xE87B;",Pn={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},kn="&#xE1F0;",Tn="&#xE1F1;",Gn="&#xE1F2;",$n="&#xE1F3;",Mn="&#xE1F4;",Ln="&#xE1F5;",On="&#xE1F7;",Hn="&#xE1F8;",qn="&#xE1F9;",Un="&#xE1FA;",Wn="&#xE1FC;",In="&#xE1FD;",Xn="&#xE1FE",Kn="&#xE1FF",zn="&#xE200",Vn="&#xE201",Jn="&#xE202",Zn="&#xE203";function he(t){return function(){return arguments[t]}}function O(){return this}var Ke=Object.create,Qn=Object.freeze,At=Qn(Ke(Ke(Object.prototype,{at:{value:q},shift:{value:q},push:{value:q},forEach:{value:q},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:O},find:{value:q},findIndex:{value:function(){return-1}},flat:{value:O},flatMap:{value:O},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:O},reduce:{value:he(1)},sort:{value:O},each:{value:O},pipe:{value:I},start:{value:O},stop:{value:O},done:{value:O},valueOf:{value:function(){return null}}}),{length:{value:0}}));var Yn=/b|#/g,_n={b:"♭","#":"♯"};function jn(t){return _n[t]}function fe(t){switch(t[1]){case"chord":t[2]=C(t[2]),t[3]=t[3].replaceAll(Yn,jn);break;case"lyric":console.warn('Old data contains "lyric" event, should be "text"'),t[1]="text";break;case"key":t[2]=C(t[2]);break;case"note":t[2]=y(t[2]);break}return t}var ti=Object.assign,Pt=Object.defineProperty,kt={writable:!0};function ei(t){let e=[],o=-1;for(;t[++o]!==void 0;)e.push(t[o]);return e}function tt(t){return t.toFixed(4).replace(/\.?0+$/,"")}var et=class t{constructor(){ti(this,fe(arguments)),Pt(this,"event",kt),Pt(this,"events",kt),Pt(this,"index",kt),Pt(this,"target",kt)}toJSON(){return ei(this)}toString(){let e=tt(this[0])+" "+this[1];switch(this[1]){case"chord":e+=" "+T(this[2])+" "+this[3]+" "+tt(this[4]);break;case"key":e+=" "+T(this[2]);break;case"note":e+=" "+U(this[2])+" "+this[3]+" "+tt(this[4]);break;case"param":e+=" "+this[2]+" "+this[3]+" "+tt(this[4])+" "+this[5];break;case"rate":e+=" "+tt(this[2]);break;case"sequence":e+=" "+this[2]+" "+this[3]+" "+tt(this[4]);break;case"start":case"stop":e+=" "+U(this[2])+" "+this[3];break;default:let o=1;for(;this[++o]!==void 0;)e+=this[o]}return e}static of(...e){return new t(...e)}static from(e,o,r){let n=new t(...e);return n.event=e,n.events=o,n.index=r,n}static isChordEvent=me;static isNoteEvent=Tt;static isSequenceEvent=oi};function me(t){return t[1]==="chord"}function Tt(t){return t[1]==="note"}function oi(t){return t[1]==="sequence"}function ri(t,e){return e[t]}var J=j(ri,!0);var ze=v(J(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function R(t){return t[0]+ze(t)}function ot(t,e){return(e%t+t)%t}function X(t){return ot(12,t)}function Ve(t,e){return t>e?1:t<e?-1:0}var P=[0,2,4,5,7,9,11];function ni(t,e,o){return o.indexOf(t)===e}function Je(t,e){return t.map(o=>X(o+e)).filter(ni).sort(Ve)}var we=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function rt(t){return Je(P,t)}var{abs:hs}=Math,ii={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},ci=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),si=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],fs={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function xe(t){let e=new Float32Array(12),o=C(t+2),r=7;for(;r--;)o=C(o+5),e[o]=1;return e}function ge(t,e,o){let r=t.length;for(;r--;)t[r]*=1-o+o*e[r];return t}var de={note:(t,e,o=1)=>{let r=y(e[2]),n=xe(r);return ge(t,n,o*(1-r/192))},chord:(t,e,o=1)=>{let r=C(e[2]),n=ii[e[3].replace(/\(|\)/g,"")];if(!n)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=n.map(c=>C(r+c)),s=i.length,a;for(;s--;)a=xe(i[s]),ge(t,a,o/i.length*ci[n[s]]);return t}};function $t(t,e,o){let r=t[e],n=r[0],i=Tt(r)?xe(y(r[2])):me(r)?de.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),r):0;if(o!==void 0){let a=Float32Array.from({length:12},(c,u)=>si[(u+12-o)%12]);ge(i,a,.3)}let s=e;for(;r=t[--s];){let a=de[r[1]];if(!a)continue;let c=R(r);if(c>n)a(i,r,.5);else if(r[1]==="note"&&n-c<3){if(1-(n-c)/3>1)throw new Error("Influence should never be > 1 "+n+" "+c);a(i,r,.25*(1-(n-r[0])/3))}}for(s=e;(r=t[++s])&&r[0]-n<2;){if(!Tt(r))continue;let a=de[r[1]];if(a){if(1-(r[0]-n)/2>1)throw new Error("Influence should never be > 1 "+n+" "+stopBeat);a(i,r,.3*(1-(r[0]-n)/2))}}return i}var Gt=[0,7,5,2,10,9,3,4,8,11,1,6];function Mt(t){let e=Gt.length,o=0,r;for(;e--;)t[Gt[e]]>o&&(o=t[Gt[e]],r=Gt[e]);return r}var Qe=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,ft=/b|♭/,mt=/#|♯/;var Lt=/b|♭|#|♯/g,Ot={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},Ze=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function Ht(t,e){let o=Ze.indexOf(t.pitch),r=Ze.indexOf(e.pitch);return o>r?1:o<r?-1:0}var Ye={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function _e(t,e){let o=we[t],r=C(e),n=o.spellings[X(r)];return Ct[X(r-n)]+Ye[n]}function je(t,e){let o=we[t],r,n,i;if(typeof e=="string"){let[c,u,f,p]=Qe.exec(e)||[e];p&&(r=y(e),n=o.spellings[X(r)],i=Rt(r-n))}else r=e,n=o.spellings[X(r)],i=Rt(r-n);let s=Ct[X(r-n)],a=Ye[n];return s+a+i}var ai=globalThis||window;var{floor:to,round:vs}=Math,D=class{constructor(){}clef="";pitched=!0;rows=At;getNoteHTML(e,o,r){let n=r>=4||Math.fround(r)===Math.fround(2.666666667)?"head4":r>=2||Math.fround(r)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${n}">${N[n]}</span>`}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return to(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,o){let r=y(this.minPitch),n=y(this.maxPitch),i=y(e)+o;return i>=r&&i<=n?i:void 0}parts=[{name:"main",top:"stave-top",center:"stave-center",bottom:"stave-bottom",DEFAULT:!0}];getPart(e){return this.parts[0]}getRow(e,o){let n=(typeof o=="string"?o:U(o)).replace(Lt,""),i=this.rows.indexOf(n);if(ai.DEBUG&&i===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getSpelling(e,o){return o[1]==="chord"?_e(e,o[2]):je(e,o[2])}createKeySymbols(e){let o=[],r=C(e),n=rt(r);return o.push.apply(o,n.map((i,s)=>i-P[s]&&{type:"acci",pitch:T(P[s])+Ot[i-P[s]],value:i-P[s],part:this.parts[0]}).filter(i=>!!i).sort(Ht)),o}createSignatureSymbols(e){return[{type:"clef",clef:this.type,part:this.parts[0]}].concat(this.createKeySymbols(e))}yRatioToPitch(e){let o=to(e*this.pitches.length);return o<0?this.pitches[0]:o>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[o]}};var ui=globalThis||window;function eo(t){return Xe(t).toLowerCase().replace(/\s+/g,"-").replace(/-drum|-cymbal/,"")}var Z=class extends D{type="drum";pitched=!1;rows=["","","","","splash chinese","crash-2","crash-1","ride-1 ride-2 ride-bell","closed-hi-hat open-hi-hat","high-tom cowbell","low-mid-tom high-mid-tom","snare-1 snare2 side-stick","low-tom sticks hand-clap tambourine","high-floor-tom","low-floor-tom","low-bass high-bass","","pedal-hi-hat","","","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};getNoteHTML(e,o,r){let n=y(e),i=this.#t[n],s=N[i],a=i?`<span class="head" data-glyph="${i}">${s}</span>`:super.getNoteHTML(e,o,r);return o<.02?re+a+ne:a}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(y(e))?this.parts.drums:this.parts.cymbals}getRow(e,o){let r=typeof o=="string"?o:eo(o);if(!r)throw new Error("Drum name not found for pitch "+o);let n=this.rows.findIndex(i=>i.includes(r));if(ui.DEBUG&&n===-1)throw new Error('Pitch "'+r+'" is not supported by stave '+this.constructor.name);return n===-1&&console.warn('Pitch "'+r+'" is not supported by stave '+this.constructor.name),n>-1?n:void 0}getSpelling(e,o){return o[1]==="note"?eo(y(o[2])):super.getSpelliing(e,o[2])}createSignatureSymbols(e){return[{type:"clef",clef:this.type}]}yRatioToPitch(e){let o=floor(e*this.rows.length),r=o<4?4:o>17?17:o;return this.pitches[r]}};var dt=class extends Z{type="percussion";clef=void 0;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}}};var li=globalThis||window,oo=Object.assign,xt=class extends D{type="piano";rows=["rh-A6","rh-G6","rh-F6","rh-E6","rh-D6","rh-C6","rh-B5","rh-A5","rh-G5","rh-F5","rh-E5","rh-D5","rh-C5","rh-B4","rh-A4","rh-G4","rh-F4","rh-E4","rh-D4","rh-C4","rh-B3","lh-B4 rh-A3","lh-A4 rh-G3","lh-G4 rh-F3","lh-F4 rh-E3","lh-E4 rh-D3","lh-D4","lh-C4","lh-B3","lh-A3","lh-G3","lh-F3","lh-E3","lh-D3","lh-C3","lh-B2","lh-A2","lh-G2","lh-F2","lh-E2","lh-D2","lh-C2","lh-B1","lh-A1","lh-G1","lh-F1","lh-E1"];getTimeSigHTML(e,o,r){return`<span class="timesig" data-event="${r}" data-part="rh">
            <sup>${N["timeSig"+e]}</sup>
            <sub>${N["timeSig"+o]}</sub>
        </span>
        <span class="timesig" data-event="${r}" data-part="lh">
            <sup>${N["timeSig"+e]}</sup>
            <sub>${N["timeSig"+o]}</sub>
        </span>`}parts=[{},{name:"lh",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1,DEFAULT:!0},{name:"rh",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",DEFAULT:!0},{name:"soprano",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!0},{name:"alto",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!1},{name:"tenor",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!0},{name:"bass",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1}];getRow(e,o){o=typeof o=="string"?o:U(o);let r=e.name+"-"+o.replace(Lt,""),n=this.rows.findIndex(i=>i.includes(r));if(li.DEBUG&&n===-1)throw new Error('Pitch "'+r+'" is not supported by '+this.constructor.name);return n===-1&&console.warn('Pitch "'+r+'" is not supported by '+this.constructor.name),n>-1?n:void 0}getPart(e){return typeof e=="number"?e<60?this.parts[1]:this.parts[2]:/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(e)?this.parts[1]:this.parts[2]}createKeySymbols(e){let o=[],r=C(e),i=rt(r).map((s,a)=>s-P[a]&&{type:"acci",pitch:T(P[a])+Ot[s-P[a]],value:s-P[a]}).filter(s=>!!s).sort(Ht);return o.push.apply(o,i.map(s=>oo({part:this.parts[1]},s))),o.push.apply(o,i.map(s=>oo({part:this.parts[2]},s))),o}createSignatureSymbols(e){return[{type:"clef",clef:"treble",part:this.parts[1],stave:this},{type:"clef",clef:"bass",part:this.parts[2],stave:this}].concat(this.createKeySymbols(e))}};var Ee=class extends D{type="treble-up";clef=lt;rows=["A7","G7","F7","E7","D7","C7","B6","A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4"]},ye=class extends D{type="treble";clef=at;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},De=class extends D{type="treble-down";clef=ut;rows=["A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2"]},be=class extends D{type="alto";clef=pt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Se=class extends D{type="bass";clef=ht;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};D.treble=ye;D["treble-up"]=Ee;D["treble-down"]=De;D.alto=be;D.bass=Se;D.piano=xt;D.drum=Z;D.percussion=dt;D.create=t=>new D[t];var ro=D;var K={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};function pi(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Ce(t){return t===window?pi():t.getClientRects()[0]||t.getBoundingClientRect()}var W=1.1;function hi(t){return parseFloat(t.dataset.beat)}function fi(t){return parseFloat(t.dataset.duration)}function mi(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function no(t,e,o,r,n){let i=o[0],s=o.length===1?r%(n*2)===0?e[i]:e[i]-.4*(e[i]-e[i-1]):e[i],a=o.length===1?r%(n*2)===0?e[i]+.5*(e[i+1]-e[i]):e[i]:e[o[o.length-1]];return`M${s}, ${-t*s-.5*W}
        L${a},${-t*a-.5*W}
        L${a},${-t*a+.5*W}
        L${s}, ${-t*s+.5*W}
        Z`}function Re(t,e,o,r,n,i,s){if(s<.0833)return;let a=n-1,c;for(;o[++a];)o[a]<=s?c?c.push(a):c=[a]:c&&(t.appendChild(S("path",{class:`beam-path-${4/s} beam-path`,d:no(i,r,c,e[a-1],s)})),Re(t,e,o,r,c[0],i,s/2),c=void 0);c&&(t.appendChild(S("path",{class:`beam-path-${4/s} beam-path`,d:no(i,r,c,e[a-1],s)})),Re(t,e,o,r,c[0],i,s/2),c=void 0)}function ca(t){let e=t.dataset.beam,o=t.parentElement,r=Array.from(o.querySelectorAll('.top-note[data-beam="'+e+'"]')),n=r.map(hi),i=r.map(fi),s=t.viewBox.baseVal,a=s.y<-.5?s.y+.5:s.height-1,c=r.map(Ce),u=c[0].x,f=c[c.length-1].x,p=c.map(l=>(l.x-u)/(f-u));mi(t),Re(t,n,i,p,0,-a,.25)}var io=v((t,e)=>e[1],{note:(t,e)=>(e[2]=y(e[2])+t,e),chord:(t,e)=>(e[2]=C(C(e[2])+t),e[5]!==void 0&&(e[5]=C(C(e[2])+t)),e),key:(t,e)=>(e[2]=C(C(e[2])+t),e),default:I});var di={displace:(t,e,o)=>(o[0]-=t[++e],e),rate:(t,e,o)=>{switch(o[0]/=t[++e],o[1]){case"chord":case"note":case"sequence":o[4]/=t[e];break;case"text":o[3]/=t[e];break}return e},quantize:(t,e,o)=>{},transpose:(t,e,o)=>(io(t[e+1],o),e+1)};function gt(t,e){let o=-1,r;for(;r=t[++o];)o=di[r](t,o,e);return e}var co=Object.assign,so=[],xi={done:!0,value:void 0},ao={key:2,meter:1,default:0},gi={};function uo(t){return ao[t[1]]||ao.default}function wi(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:uo(e)-uo(t)}function Ei(t,e){return t.find(o=>o.id===e)}var wt=class t{constructor(e,o=so,r=so){e.sort(wi),this.events=e,this.sequences=o,this.transforms=r;let n=-1,i;for(;(i=e[++n])&&gt(r,co(gi,i))[0]<0;);this.n=n-1}next(){let{events:e,sequences:o,transforms:r,n}=this,i=e[n+1],s=i&&gt(r,et.from(i,e,n+1)),a,c=-1,u=0,f=s?s[0]:1/0,p;for(;a=this[++c];){let l=a.value;l||((l=a.next().value)&&(gt(this.transforms,l),l[0]+=a.startBeat,l.target=(l.target||0)+a.target),(a.done||l[0]>=a.stopBeat)&&++u),l&&l[0]<a.stopBeat&&l[0]<f&&(p=a,f=l[0]),u&&(this[c]=this[c+u])}if(p)return this.value=p.value,p.value=void 0,this;if(!s)return co(this,xi);if(this.n+=1,this.value=s,et.isSequenceEvent(i)){let l=this.sequences,m=Ei(l,i[2]);if(!m)throw new Error('Sequence id "'+i[2]+'" not found');let d=new t(m.events,m.sequences?m.sequences.concat(l):l,i.slice(5));d.startBeat=s[0],d.stopBeat=s[0]+s[4],d.target=s[3];let h=-1;for(;this[++h];);this[h]=d}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};function yi(t,e,o){let r=t(e),n=t(o);return n===r?0:r>n?1:-1}var lo=j(yi,!0);var{abs:Di,EPSILON:bi}=Math;function qt(t,e){return Math.round(e/t)*t}function H(t,e,o=bi){return t!==void 0&&(t===e||Di(t-e)<o)}function Q(t,e,o){return H(t,e,o)||t<e}function Si(t,e,o){return H(t,e,o)||t>e}function nt(t,e,o){return t!==void 0&&e!==void 0&&!Q(t,e,o)}function Ut(t,e,o){return t!==void 0&&e!==void 0&&!Si(t,e,o)}var{pow:Ci}=Math,Ri=1/24,Ni=[2,3,4,5,6,7,9],Bi=1/12,po=.25,ho=.2,Ne={},it=0;function fo(t,e){return Math.cos(2*Math.PI*e/t)}function mo(t,e,o,r,n){let i=t/e,s=0,a=0,c=0,u,f;for(r[n-1]&&nt(R(r[n-1]),o+.5*i,Ri)&&(c=1),--n;r[++n]!==void 0&&r[n][0]-o<i/4;)c=1;for(--n;r[++n]!==void 0&&r[n][0]-o<t-i/4;){if(u=Math.round((r[n][0]-o)/i),f=1<<u,u<e&&f>c){if(e>4&&f>c<<1)return;c+=f}s+=fo(i,r[n][0]-o),a+=1,!(r[n][0]+r[n][4]-o>t)&&(s+=ho*fo(i,r[n][0]+r[n][4]-o),a+=ho)}if(!(e>4&&u!==e-1)&&a)return Ne.score=s/(a+1),Ne.rhythm=c,Ne}function Fi(t,e,o,r,n,i,s){let a=o[r-1]&&R(o[r-1])>n+.125?n:e*Math.floor((o[r][0]-n)/e)+n,c=i.length;for(;e/i[--c]<Bi;);++c;let u,f;for(;u=i[--c];)f=mo(e,u,a,o,r),f&&f.score>=it&&f.score&&(it=f.score,t.beat=a,t.duration=e,t.divisor=u,t.rhythm=f.rhythm),o[r][0]>=a+.5*e&&a+1.5*e<s&&(f=mo(e,u,a+.5*e,o,r),f&&f.score>=it&&(it=f.score,t.beat=a+.5*e,t.duration=e,t.divisor=u,t.rhythm=f.rhythm));return t}function xo(t,e,o){let r=-1;for(;t[++r]!==void 0&&t[r][0]<e;);if(!t[r])return;let n={};it=po;let i=1/8;for(;(i*=2)&&i<=o;)Fi(n,i,t,r,e,Ni,e+o);return it>po&&n}function go(t,e){return e<Ci(2,t)-1}function Be(t){return 2**Math.ceil(Math.log2(t))}function wo(t){return 2**Math.floor(Math.log2(t))}function Fe(t){return t>0&&(t&t-1)===0}function ve(t,e,o){if(H(0,o,t/2))return e;let r=e*2;for(;(r/=2)>t;)if(H(0,ot(r,o),t/2))return r;return r}function Et(t,e){let o=-1,r=0;for(;t[++o]!==void 0;);for(;arguments[++r]!==void 0;)t[o++]=arguments[r];return t}function ct(t){let e=-1;for(;t[++e]!==void 0;);return e}function Ae(t){return t[ct(t)-1]}function Pe(t,e){let o=[],r=-1;for(;e[++r]!==void 0;)o.push(t(e[r],r));return o}var Xt=Object.assign,{abs:fu,ceil:vi,floor:It,min:bo,max:So,pow:mu,sqrt:Eo,round:du}=Math,$=1/16,yt=1/24,Ai=lo(J("row"));function yo(t,e,o,r){return t+e/r.length}function Co(t,e){return So(t,R(e))}function Pi(t,e){return y(t[2])<y(e[2])?1:-1}function Ro(t,e,o,r){if(!r.length)return[];let n=[],i=-1,s;for(;s=r[++i];){let p=s.scribeEvents,l=s.scribeIndex,m=$t(p,l,e),d=Mt(m),h=t.getSpelling(d,s),x=t.getRow(o,h);n.push({type:"note",pitch:h,part:o,row:x,stave:t,event:s})}n.sort(Ai),n[0].top=!0,n[n.length-1].bottom=!0;let a=n[0].row,c=n[n.length-1].row,u=o.stemup===void 0?No(t,o,a,c):o.stemup,f=0;for(i=-1;n[++i];)n[i].stemup=u,i>0&&n[i].row-n[i-1].row===1?n[i].clusterdown=++f:f=0;for(f=0,i=n.length-1;i--;)n[i+1].row-n[i].row===1?n[i].clusterup=++f:f=0;return n}function ki(t,e,o){let r=-1,n=0,i,s;for(;o[++r];)s=t.getRow(e,o[r]),s!==void 0&&s>n&&(n=s,i=o[r]);return{row:n,pitch:i}}function Ti(t,e,o){let r=-1,n=128,i,s;for(;o[++r];)s=t.getRow(e,o[r]),s!==void 0&&s<n&&(n=s,i=o[r]);return{row:n,pitch:i}}function No(t,e,o,r){let n=e.centerRow||t.centerRow,i=o-n;return r-n+i>0}function Bo(t,e,o){let{row:r}=ki(t,e,o),{row:n}=Ti(t,e,o);return No(t,e,r,n)}function Gi(t,e,o){let r=[],n=-1,i;for(;i=o[++n];)i.type==="note"&&r.push(i.pitch);return Bo(t,e,r)}var Do=0;function z(t,e,o,r){console.log("BEAM",r);let n=-1;for(;r[++n]&&r[n].beat===r.beat;);if(!r[n])return t;let i=r[0].beat,a=Ae(r).beat-i,c=o.stemup===void 0?Bo(e,o,Pe(J("pitch"),r)):o.stemup;if(o.beam){let w;for(n=-1;w=r[++n];)w.stemup=c,w.beam=r;return t.push(Xt(r,{duration:a,stemup:c,range:0,id:++Do})),t}let u=[],f;for(n=-1;f=r[++n];){let w=e.getRow(o,f.pitch);if(w===void 0)continue;let k;for(;r[++n]&&H(r[n].beat,f.beat,yt);)k=e.getRow(o,r[n].pitch),k!==void 0&&(c?k<w&&(w=k):k>w&&(w=k));--n,u.push(w)}let p=u.length-1,l=u.slice(0,It(.5*u.length)).reduce(yo,0),m=u.slice(vi(.5*u.length)).reduce(yo,0),d=Array.from(u,(w,k)=>(.2+.1*p)*k*(m-l)/p),h=d[d.length-1]-d[0],x=c?-50:50,E;for(n=u.length;n--;)E=d[n]-u[n],x=c?E>x?E:x:E<x?E:x;for(n=u.length;n--;)d[n]-=x+u[0];let g=-1;for(n=-1;f=r[++n];){for(++g,f.stemup=c,f.beam=r,f.stemHeight=c?1-.125*(d[n]-u[n]+u[0]):1+.125*(d[n]-u[n]+u[0]);r[++n]&&H(r[n].beat,f.beat,$);)r[n].stemup=c,r[n].beam=r,r[n].stemHeight=f.stemHeight;--n}return t.push(Xt(r,{pitch:r[0].pitch,y:d[0],duration:a,stemup:c,range:h,id:++Do})),t}function Wt(t,e){let o=2*Be(e);for(;(o/=2)>t/2;){if(1.75*o===e)return 1.75*o;if(1.5*o===e)return 1.5*o;if(o<=e)return o}return t}function $i(t,e,o){o=o||1/0;let r=4*Be(e);for(;(r/=2)>t/2;)if(r<=e*2&&r<=o)return r;return t}function Fo(t,e,o,r,n,i){let a=wo(e.divisor),c=It(n/e.divisor)*e.divisor,u=ve(.125,a,n-c);if(i<r){if(t.indexOf(i-n)!==-1)return i-n;let p=It(i/e.divisor)*e.divisor;if(n===c){if(t.indexOf(p-n)!==-1)return p-n;let l=c+e.divisor<i&&c+e.divisor;return l?l-n:Wt(.125,i-n)}if(H(i,p,$)){let l=c+e.divisor<i&&c+e.divisor;return l&&t.indexOf(l-n)!==-1?l-n:u}}let f=It(r/e.divisor)*e.divisor;if(n===c){if(t.indexOf(r-n)!==-1)return r-n;if(t.indexOf(f-n)!==-1)return f-n;let p=c+e.divisor<r&&c+e.divisor;return p?p-n:$i(.125,r-n,i-n)}else if(H(r,f,$)){if(t.indexOf(r-n)!==-1)return r-n;let p=c+e.divisor<r&&c+e.divisor;return p&&t.indexOf(p-n)!==-1?p-n:u}else{let p=4*u;return(n-c)%p/u===1?n+2*u===i?2*u:(n+3*u>=i&&console.log("Next event beat is inside quaduplet"),u<1?r>=n+u*3/2?3*u:r>=n+u?u:Wt(.125,r-n):r>=n+u*3?u*3:r>=n+u*2?u*2:r>n+u?u:Wt(.125,r-n)):r>n+u?u:Wt(.125,r-n)}}function Mi(t,e,o,r,n,i){return{type:"rest",beat:i,duration:Fo(t,e,i,n,i,n),stave:o,part:r}}function ke(t,e,o,r,n,i,s){for(;nt(s,i,$);){let a=Mi(e,o,r,n,s,i);t.push(a),i+=a.duration}return s}function Li(t,e,o,r,n){let{pitch:i,event:s}=r,a=mt.test(i)?1:ft.test(i)?-1:void 0,c=i[0]+i.slice(-1);if(a!==e[c])return e[c]=a,{type:"acci",beat:o,pitch:i,part:t,distance:n,value:a||0}}function vo(t,e,o,r,n,i){let s=-1,a,c,u;for(;a=i[++s];)Ut(a.event[0],e.beat,$)||(c=Li(o,r,n,a,u!==void 0?a.row-u:void 0),c&&(u=a.row,t.push(c)))}function Ao(t,e,o,r,n){let i=n[0].row,s=n[0].pitch,a=i-(o.topRow||e.topRow)+1;a<0&&t.push({type:"ledge",beat:r,pitch:s,part:o,rows:a});let c=n[n.length-1].row,u=n[n.length-1].pitch;a=c-(o.bottomRow||e.bottomRow),a>0&&t.push({type:"ledge",beat:r,pitch:u,part:o,rows:a})}function Oi(t,e,o){let{beat:r,duration:n,divisor:i}=o,s=e.stemup===void 0?Gi(t,e,o):e.stemup,a=-1,c;for(;c=o[++a];)c.type==="note"&&!c.beam&&(c.stemup=s);let u=r+.5*n,f=y(t.topPitch)-12,p,l=ct(o);for(;(c=o[--l])&&c.beat>u;);for(++l;(c=o[--l])&&c.beat+c.duration>u;){let g=y(c.pitch);(!p||g>p)&&(p=g)}let m=f;for(l=-1;(c=o[++l])&&c.beat<r+$;){let g=y(c.pitch);(!m||g>m)&&(m=g)}let d=f;for(l=ct(o);(c=o[--l])&&c.beat>r+n-n/i-$;){let g=y(c.pitch);(!d||g>d)&&(d=g)}let h=Math.ceil((m+d)/2),x=U(h);h>p&&(p=h),o.pitch=U(p),o.stemup=s;let E=d-m;o.angle=E<0?4*Eo(-E):-4*Eo(E)}function Hi(t,e,o,r,n,i,s,a,c,u,f,p,l,m,d){(a.swingAsStraight8ths&&u===1||a.swingAsStraight16ths&&u===.5)&&f===3&&(p===4||p===5)&&(f=2);let h=u/f,x=c+u,E={type:"tuplet",beat:c,duration:u,divisor:f,rhythm:p,part:i,stave:o},g;for(Fe(f)||t.push(E);Ut(c,x,yt);){for(;(g=m[++d])&&Q(g[0]-e.beat,c+.5*h,yt);)l.push(g);if(--d,!l.length){t.push({type:"rest",beat:c,duration:h,stave:o,part:i}),c+=h;continue}let w=Ro(o,r,i,l);Ao(t,o,i,c,w),vo(t,e,i,n,c,w);let k=bo(l.reduce(Co,0)-e.beat,g?g[0]-e.beat:e.duration,E.beat+E.duration),F=So(h,qt(h,k-c)),b=-1;for(;w[++b];)t.push(Xt(w[b],{beat:c,duration:F}));for(Et(E,...w),nt(F,.5,yt)?s&&(z(t,o,i,s),s=void 0):s||(s={type:"beam",beat:c,part:i}),s&&Et(s,...w),b=l.length;b--;){let G=R(l[b])-e.beat;Q(G,c+F+.5*h,yt)?l.splice(b,1):t.push({type:"tie",beat:c,pitch:w[b].pitch,duration:F,stemup:w[b].stemup,part:i,event:l[b]})}c+=F}return s&&z(t,o,i,s),Oi(o,i,E),d}function Te(t,e,o,r=0,n={},i,s,a=K){let c=[],{headDurations:u,restDurations:f}=a,p=0,l=-1,m,d,h;for(;(m=s[++l])&&Q(m[0]+m[4]-e.beat,p,$););for(--l;Ut(p,e.duration,$);){h&&e.divisions.find(G=>H(p,G,$))&&(z(t,o,i,h),h=void 0);let x=xo(s,e.beat+p,e.duration-p);if(x&&!Fe(x.divisor)){nt(x.beat-e.beat,p,$)&&ke(t,a.restDurations,e,o,i,p,x.beat-e.beat),h&&go(x.divisor,x.rhythm)&&(z(t,o,i,h),h=void 0),l=Hi(t,e,o,r,n,i,h,a,x.beat-e.beat,x.duration,x.divisor,x.rhythm,c,s,l),p=x.beat-e.beat+x.duration;continue}for(;(m=s[++l])&&Q(m[0]-e.beat,p,$);)c.push(m);if(--l,o.pitched&&c.sort(Pi),!c.length){if(!m){h&&(z(t,o,i,h),h=void 0),ke(t,a.restDurations,e,o,i,p,e.duration);break}let G=qt(.125,m[0]-e.beat);if(G<=p){console.log(`Problem at bar ${e.count}, moving to next bar ${p} ${G}`),e.error="Stop beat has ended up less than beat";break}h&&(Po(e.divisions,p,G)||G-p>=.5)&&(z(t,o,i,h),h=void 0),ke(t,f,e,o,i,p,G),p=G;continue}let E=Ro(o,r,i,c);Ao(t,o,i,p,E),vo(t,e,i,n,p,E);let g=c[0][0]-e.beat,w=bo(e.duration,c.reduce(Co,0)-e.beat),k=m&&qt(.125,m[0])-e.beat,F=Fo(u,e,g,w,p,k),b=-1;for(;E[++b];)t.push(Xt(E[b],{beat:p,duration:F}));for(F>=1?h&&(z(t,o,i,h),h=void 0):h||(h={type:"beam",beat:p,part:i}),h&&Et(h,...E),b=c.length;b--;){let G=R(c[b])-e.beat;Q(G,p+F,$)||G-(p+F)<.125+1/16*(R(c[b])-c[b][0])?c.splice(b,1):t.push({type:"tie",beat:p,pitch:E[b].pitch,duration:F,stemup:E[b].stemup,part:i,event:c[b]})}p+=F}return h&&z(t,o,i,h),t}var qi={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function Ui(t,e){return qi[t+","+e]||At}function Po(t,e,o){let r=-1;for(;t[++r]&&t[r]<=e;);return o>t[r]?t[r]:void 0}var Wi=[];function ko(t,e){return rt(e).reduce((r,n,i)=>{let s=n-P[i];if(s!==0){let a=T(P[i]),c=10;for(;c--;)r[a+c]=s}return r},t),t}function Ii(t,e,o,r,n,i,s){let a=-1,c;for(;c=i[++a];)switch(c[1]){case"key":{let u=C(c[2]);ko(n,u),e.key=u;break}case"meter":{t.push({type:"timesig",beat:0,numerator:c[3]===1.5?c[2]/.5:c[2]/c[3],denominator:c[3]===1.5?8:4/c[3],stave:o,event:c});break}case"symbol":{t.push({type:"symbol"+c[2],stave:o});break}case"chord":{let u=c[0]-e.beat,f=$t(i,a,r),p=Mt(f),l=o.getSpelling(p,c);l==="C♭"&&s.spellChordRootCFlatAsB&&(l="B"),l==="E♯"&&s.spellChordRootESharpAsF&&(l="F"),l==="B♯"&&s.spellChordRootBSharpAsC&&(l="C"),l==="F♭"&&s.spellChordRootFFlatAsE&&(l="E"),t.push({type:"chord",beat:u,duration:c[0]+c[4]>e.beat+e.duration?e.duration-u:c[4],root:l,extension:c[3],event:c,stave:o});break}case"text":{let u=c[0]-e.beat;t.push({type:"text",beat:u,duration:c[0]+c[3]>e.beat+e.duration?e.duration-u:c[3],value:c[2],event:c,stave:o});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(Wi.includes(c[1]))return;console.log('Scribe: ignoring event type "'+c[1]+'"')}}return t}function Dt(t,e,o,r,n,i,s,a,c,u=K){let f=[];if(c){let h=R(c);h>e&&h<=e+o&&s.push(c)}let p=ko({},i),l={type:"bar",beat:e,duration:o,key:i,divisor:r||4,divisions:Ui(o,r),stave:n,count:t,symbols:f};Ii(f,l,n,i,p,s,K);let m,d=0;for(m in n.parts){let h=n.parts[m],x=a[h.name]||[];!h.DEFAULT&&!x.length||(Te(f,l,n,i,p,h,x,u),++d)}return d||(console.log("Stave has no parts defined SHOULD NOT BE"),Te(f,l,n,i,p,n.parts[0],[],u)),l}function Xi(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function Ki(t){let e=t.symbols.filter(o=>o.type==="chord"||o.type==="note");return JSON.stringify(e,Xi)}function Y(t,e){t.symbols=t.symbols.filter(o=>o.type==="doublebarline"||o.type==="clef").concat([{type:"barrepeat",count:e,duration:t.duration}])}function Kt(t,e,o){let r=Ki(o);switch(e.length){case 1:break;case 2:break;case 3:{r==="[]"&&e[0]==="[]"?e.length=0:r===e[0]&&r===e[1]&&r===e[2]&&o.symbols.filter(n=>n.type!=="clef"&&n.type!=="timesig").find(n=>n.type!=="rest")?(Y(t[t.length-2],1),Y(t[t.length-1],1),Y(o,1)):(r!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{r===e[0]&&r===e[1]&&r===e[2]&&r===e[3]?(Y(o,1),e.length=3):(r!==e[1]||e[0]!==e[2]||r!==e[3])&&(e.length=2);break}case 5:{r===e[1]&&r===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,Y(t[t.length-1],2),Y(o,2)):e.length=4;break}case 6:break;case 7:{r===e[1]&&r===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,Y(o,2),e.length=5):e.length=1;break}}for(e.unshift(r);e.length>8;)e.pop()}function Ge(t,e,o){let r=o.target?t.parts[o.target]:t.getPart(o[2]),n=e[r.name]||(e[r.name]=[]);e[r.name].push(o)}function $e(t,e,o,r=K){let n=[],i=[],s=[],a=[],c=0,u=[],f={},p=0,l=0,m,d,h,x;for(h of t)if(h.scribeIndex=n.length,h.scribeEvents=n,n.push(h),!e.includes(h[1])){for(;h[0]>=c+m;){let g=Dt(i.length+1,c,m,d,o,p,u,f,x,r);Kt(i,a,g),i.push(g),p=g.key,c=c+m,u=[],f={};let w=-1;for(;s[++w];)Ge(o,f,s[w]),R(s[w])<c+m&&s.splice(w--,1)}switch(h[1]){case"note":{Ge(o,f,h),R(h)>c+m&&s.push(h),l<R(h)&&(l=R(h));break}case"sequence":{h.events===t.events&&(x=h),l<R(h)&&(l=R(h));break}case"meter":m=h[2],d=h[3],h[0]!==c&&console.log("TODO");default:u.push(h)}}for(;s.length;){let g=Dt(i.length+1,c,m,d,o,p,u,f,x,r);Kt(i,a,g),i.push(g),c=c+m,u=[],f={};let w=-1;for(;h=s[++w];)Ge(o,f,h),R(h)<c+m&&s.splice(w--,1)}for(;c<l-m;){let g=Dt(i.length+1,c,m,d,o,p,u,f,x,r);Kt(i,a,g),i.push(g),c=c+m,u=[],f={}}m||(m=R(n[n.length-1]));let E=Dt(i.length+1,c,m,d,o,p,u,f,x,r);return Kt(i,a,E),i.push(E),i}var zt=Symbol("scribe-id"),zi=0;function _(t){return t[zt]||(t[zt]=++zi+""),t[zt]}var Vt=Math.abs,Jt={flat:`<span class="chord-flat">${Bt}</span>`,sharp:`<span class="chord-sharp">${vt}</span>`},Vi={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Ji={2:oe,1:vt,0:Ft,"-1":Bt,"-2":ee},Zi={treble:at,"treble-down":ut,"treble-up":lt,alto:pt,bass:ht,drum:Nt,percussion:Nt},Qi={"1.33":ue,"0.67":ae,"0.33":se,"0.17":ce,"0.08":ie},Yi=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function B(t){return t.toFixed(4).replace(/\.?0+$/,"")}var Me=v(J("type"),{barrepeat:t=>S("span",{class:"barrepeat",html:N["barRepeat"+t.count],data:{duration:t.duration}}),clef:t=>S("span",{class:`${t.clef}-clef clef`,html:Zi[t.clef]}),chord:t=>{let e=Yi.exec(t.extension);return S("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(mt,Jt.sharp).replace(ft,Jt.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(mt,Jt.sharp).replace(ft,Jt.flat)+"</sup>":"")+"</span>"+(t.bass?pe+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:B(t.beat),duration:B(t.duration),event:_(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?S("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,_(t.event))):S("span",{class:"timesig",html:`<sup>${N["timeSig"+t.numerator]}</sup>
                <sub>${N["timeSig"+t.denominator]}</sub>`,data:{event:_(t.event)}}),symbolcoda:t=>S("p",{html:le,class:"coda"}),barcount:t=>S("span",{html:t.text,class:"barcount"}),text:t=>S("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:B(t.beat),duration:B(t.duration),event:_(t.event)}}),acci:t=>S("span",{class:(Vi[t.value]||"acci")+(t.distance<6?" cluster-acci":""),html:Ji[t.value]||Ft,data:{beat:t.beat&&B(t.beat),pitch:t.pitch,part:t.part.name,event:t.event&&_(t.event)}}),ledge:t=>S("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${Vt(t.rows)}`:`0 -0.5 5 ${Vt(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:B(t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>S("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${y(t.pitch)})`,data:{beat:B(t.beat),pitch:t.pitch,duration:B(t.duration),part:t.part.name,beam:t.beam&&t.beam.id,event:_(t.event)}}),beam:(t,e)=>S("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${Vt(t.range)+1}`,preserveAspectRatio:"none",style:`--duration: ${B(t.duration)}; ${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(Vt(t.range)+W)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*W} L1,${t.range-.5*W} L1,${t.range+.5*W} L0,${.5*W} Z"></path>`,data:{beat:B(t.beat),pitch:t.pitch,part:t.part.name,beam:t.id}}),tie:t=>S("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:B(t.beat),pitch:t.pitch,duration:B(t.duration),part:t.part.name}}),tuplet:t=>S("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:N["tuplet"+t.divisor],data:{beat:B(t.beat),pitch:t.pitch,duration:B(t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>S("span",{class:"rest",html:Qi[t.duration.toFixed(2)]||N["rest"+(t.duration+"").replace(".","")]||"",data:{beat:B(t.beat),pitch:t.pitch,duration:B(t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function _i(t){return t[0]<=0&&t[1]==="meter"}function ji(t){return t[0]<=0&&t[1]==="key"}function tc(t,e){let o=Me(e);return o&&t.push(o),t}function ec(t,e){return t.push(S("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:T(e.key)},children:e.symbols.reduce(tc,[])})),t}function oc(t,e,o,r,n,i=1/0,s=0,a=0,c=K){let u=t.events;!u.find(_i)&&n&&u.unshift([0,"meter",n[2],n[3]]),!u.find(ji)&&r&&u.unshift([0,"key",r]);let l=ro.create(o||"treble"),m=[];s&&m.push("transpose",s),a&&m.push("displace",a);let d=new wt(u,t.sequences,m),h=$e(d,e,l,c),x=h.reduce(ec,[]),g=h[0].key,w=l.createSignatureSymbols(g),k=S("div",{class:`${l.type}-stave signature-stave stave`,children:w.map(Me),data:{key:T(g)}}),F=S("div",{id:"side",class:"side",data:{key:T(g)}}),b=24;for(;b--;)F.appendChild(k.cloneNode(!0));return x.unshift(F),x}export{I as a,v as b,bt as c,j as d,q as e,S as f,ro as g,K as h,ca as i,oc as j};
//# sourceMappingURL=chunk-VSRHKSOQ.js.map
