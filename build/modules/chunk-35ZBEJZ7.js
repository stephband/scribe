/* Scribe 
   0.3.1
   By Stephen */

var $o=Object.defineProperty;var Lo=(t,e)=>{for(var o in e)$o(t,o,{get:e[o],enumerable:!0})};function k(t){return t}function N(t,e){return function(){let n=t.apply(this,arguments),r=e[n]||e.default;if(!r)throw new Error('overload() no function defined for key "'+n+'"');return r.apply(this,arguments)}}function gt(t){var e=new Map;return function(n){if(e.has(n))return e.get(n);var r=t(n);return e.set(n,r),r}}var Go=Array.prototype;function ko(t,e){return typeof t=="function"?t.apply(null,e):t}function We(t,e,o){o=o||t.length;var n=o===1?e?t:gt(t):gt(function(r){return We(function(){var i=[r];return i.push.apply(i,arguments),t.apply(null,i)},e,o-1)});return function r(i){return arguments.length===0?r:arguments.length===1?n(i):arguments.length>=o?t.apply(null,arguments):ko(n(i),Go.slice.call(arguments,1))}}var Et=We;function G(){}var Oo=N(k,{is:G,tag:G,data:function(t,e,o){for(t in o)o[t]===void 0&&delete o[t];Object.assign(e.dataset,o)},dataset:function(t,e,o){for(t in o)o[t]===void 0&&delete o[t];Object.assign(e.dataset,o)},html:function(t,e,o){e.innerHTML=o},text:function(t,e,o){e.textContent=o},style:N((t,e,o)=>typeof o,{string:(t,e,o)=>e.style=o,object:(t,e,o)=>Object.assign(e.style,o)}),children:function(t,e,o){e.innerHTML="",e.append.apply(e,o)},href:function(t,e,o){e instanceof SVGElement?e.setAttribute("href",o):e.href=o},points:M,cx:M,cy:M,r:M,x:M,y:M,dx:M,dy:M,transform:M,preserveAspectRatio:M,viewBox:M,default:function(t,e,o){t in e?e[t]=o:e.setAttribute(t,o)}});function M(t,e,o){e.setAttribute(t,o)}function Ho(t,e){for(var o=Object.keys(e),n=o.length;n--;)e[o[n]]!==void 0&&Oo(o[n],t,e[o[n]]);return t}var wt=Et(Ho,!0);var Kt="http://www.w3.org/2000/svg",Ie=document.createElement("template"),Vt=(t,e)=>e&&typeof e;function Xe(t,e=""){let o=document.createRange();return o.selectNode(t),o.createContextualFragment(e)}var P=N(Vt,{string:function(t,e){let o=document.createElementNS(Kt,t);return o.innerHTML=e,o},object:function(t,e){let o=document.createElementNS(Kt,t);return typeof e.length=="number"?o.append.apply(o,e):wt(o,e),o},default:t=>document.createElementNS(Kt,t)}),qo=N(Vt,{string:function(t,e){let o=document.createElement(t);return o.innerHTML=e,o},object:function(t,e){let o=document.createElement(t);return typeof e.length=="number"?o.append.apply(o,e):wt(o,e),o},default:t=>document.createElement(t)}),Uo=N(k,{comment:function(t,e){return document.createComment(e||"")},fragment:N(Vt,{string:function(t,e,o){return o?Xe(o,e):(Ie.innerHTML=e,Ie.content.cloneNode(!0))},object:function(t,e,o){let n=o?Xe(o):document.createDocumentFragment();return typeof e.length=="number"?n.append.apply(n,e):wt(n,e),n},default:()=>document.createDocumentFragment()}),circle:P,ellipse:P,g:P,glyph:P,image:P,line:P,rect:P,use:P,path:P,pattern:P,polygon:P,polyline:P,svg:P,tspan:P,text:P,default:qo}),R=Uo;function Jt(t){return function(){return arguments[t]}}function Zt(t){return t}function z(){}function $(){return this}var ze=Object.create,Wo=Object.freeze,Ke=Wo(ze(ze(Object.prototype,{at:{value:z},shift:{value:z},push:{value:z},forEach:{value:z},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:$},find:{value:z},findIndex:{value:function(){return-1}},flat:{value:$},flatMap:{value:$},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:$},reduce:{value:Jt(1)},sort:{value:$},each:{value:$},pipe:{value:Zt},start:{value:$},stop:{value:$},done:{value:$},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Qt(t,e){return(e%t+t)%t}var Ve=t=>Qt(12,t);var Io=/^([A-G][♭♯#b]?)(-?\d)$/,Xo=/^[A-G][♭♯#b]?/,zo=/-?\d$/,Ko=/[Hh]z$/,ot={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},Yt={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Bass Drum 2",36:"Bass Drum 1",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Tom 2",42:"Closed Hi-hat",43:"Low Tom 1",44:"Pedal Hi-hat",45:"Mid Tom 2",46:"Open Hi-hat",47:"Mid Tom 1",48:"High Tom 2",49:"Crash Cymbal 1",50:"High Tom 1",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Je(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in Yt)ot[Je(Yt[t])]=parseInt(t,10);var Vo=69;function Jo(t,e=440){var o=Vo+12*Math.log(t/e)/Math.log(2);return Math.fround(o)}function w(t){if(typeof t=="number")return t;if(Ko.test(t))return Jo(parseFloat(t));let e=Io.exec(t);return e?(parseInt(e[2],10)+1)*12+ot[e[1]]:ot[Je(t)]}function S(t){return typeof t=="number"?Ve(t):ot[Xo.exec(t)[0]]}var yt=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function nt(t){return Z(t)+Dt(t)}function Z(t){return yt[Ve(t)]}function Dt(t){return typeof t=="number"?Math.floor(t/12)-1:Number(ot[(zo.exec(name)||Ke)[0]])}function Ze(t){let e=w(t);return Yt[e]||""}var B={};Lo(B,{acciDoubleFlat:()=>ne,acciDoubleSharp:()=>re,acciFlat:()=>Rt,acciNatural:()=>Ct,acciParensLeft:()=>an,acciParensRight:()=>un,acciSharp:()=>Bt,augmentationDot:()=>Mn,barLine:()=>or,barRepeat1:()=>nr,barRepeat2:()=>rr,barRepeat4:()=>ir,barRepeatBegin:()=>ur,barRepeatDots:()=>fr,barRepeatEnd:()=>pr,barRepeatEndBegin:()=>lr,barRepeatLowerDot:()=>ar,barRepeatSlash:()=>cr,barRepeatUpperDot:()=>sr,chordAugmented:()=>Sr,chordBassSlash:()=>he,chordBracketLeft:()=>Pr,chordBracketRight:()=>br,chordDiminished:()=>Cr,chordGlyphs:()=>Tr,chordHalfDiminished:()=>Br,chordMajorSeventh:()=>vr,chordMinor:()=>Ar,chordParensLeftTall:()=>Fr,chordParensRightTall:()=>Nr,clefAlto:()=>te,clefBass:()=>it,clefDrum:()=>ee,clefPercussion:()=>oe,clefTreble:()=>rt,clefTrebleDown:()=>_t,clefTrebleUp:()=>jt,coda:()=>fe,graceNoteStemDown:()=>Wn,graceNoteStemUp:()=>Un,head1:()=>pn,head2:()=>ln,head4:()=>fn,headBracketLeft:()=>ie,headBracketRight:()=>ce,headCircle:()=>En,headCircleX:()=>wn,headDiamond:()=>mn,headDiamondWide:()=>dn,headPlus:()=>gn,headSlashHorizontalEnds:()=>Rn,headSlashVerticalEnds:()=>Dn,headSlashed2:()=>hn,headTriangleUp:()=>yn,headX:()=>xn,metDot:()=>qn,metNote05Down:()=>Hn,metNote05Up:()=>Gn,metNote1Down:()=>On,metNote1Up:()=>Ln,metNote2Down:()=>kn,metNote2Up:()=>$n,note0125Down:()=>Tn,note0125Up:()=>An,note025Down:()=>bn,note025Up:()=>vn,note05Down:()=>Pn,note05Up:()=>Sn,note1Down:()=>Nn,note1Up:()=>Bn,note2Down:()=>Fn,note2Up:()=>Cn,rest0125:()=>se,rest01875:()=>Zn,rest025:()=>ae,rest0375:()=>Qn,rest05:()=>ue,rest075:()=>Yn,rest1:()=>pe,rest15:()=>_n,rest2:()=>le,rest3:()=>jn,rest4:()=>tr,rest6:()=>er,tailDown0125:()=>Jn,tailDown025:()=>Kn,tailDown05:()=>Xn,tailUp0125:()=>Vn,tailUp025:()=>zn,tailUp05:()=>In,textBeam16Long:()=>Wr,textBeam16Short:()=>Ur,textBeam8Long:()=>qr,textBeam8Short:()=>Hr,textDot:()=>Ir,textNote16Long:()=>Or,textNote16Short:()=>kr,textNote8Long:()=>Gr,textNote8Short:()=>Lr,textNoteLong:()=>$r,textNoteShort:()=>Mr,textTie:()=>Xr,textTuplet3Long:()=>Zr,textTuplet3Short:()=>Kr,textTupletBeginLong:()=>Jr,textTupletBeginShort:()=>zr,textTupletEndLong:()=>Qr,textTupletEndShort:()=>Vr,timeSig0:()=>Zo,timeSig1:()=>Qo,timeSig2:()=>Yo,timeSig3:()=>_o,timeSig4:()=>jo,timeSig5:()=>tn,timeSig6:()=>en,timeSig7:()=>on,timeSig8:()=>nn,timeSig9:()=>rn,timeSigCommon:()=>cn,timeSigCutCommon:()=>sn,tuplet0:()=>hr,tuplet1:()=>mr,tuplet2:()=>dr,tuplet3:()=>xr,tuplet4:()=>gr,tuplet5:()=>Er,tuplet6:()=>wr,tuplet7:()=>yr,tuplet8:()=>Dr,tuplet9:()=>Rr});var rt="&#xE050;",_t="&#xE052;",jt="&#xE053;",te="&#xE05C;",it="&#xE062;",ee="&#xE069;",oe="&#xE069;",Zo="&#xE080;",Qo="&#xE081;",Yo="&#xE082;",_o="&#xE083;",jo="&#xE084;",tn="&#xE085;",en="&#xE086;",on="&#xE087;",nn="&#xE088;",rn="&#xE089;",cn="&#xE08A;",sn="&#xE08B;",ne="&#xE264;",Rt="&#xE260;",Ct="&#xE261;",Bt="&#xE262;",re="&#xE263;",an="&#xE26A;",un="&#xE26B;",pn="&#xE0A4;",ln="&#xE0A3;",fn="&#xE0A2;",ie="&#xE0F5;",ce="&#xE0F6;",hn="&#xE0D0;",mn="&#xE0DB;",dn="&#xE0DC;",xn="&#xE0A9;",gn="&#xE0AF;",En="&#xE0E8;",wn="&#xE0B3;",yn="&#xE0BE;",Dn="&#xE100;",Rn="&#xE101;",Cn="&#xE1D3;",Bn="&#xE1D5;",Sn="&#xE1D7;",vn="&#xE1D9;",An="&#xE1DB;",Fn="&#xE1D4;",Nn="&#xE1D6;",Pn="&#xE1D8;",bn="&#xE1DA;",Tn="&#xE1DC;",Mn="&#xE1E7;",$n="&#xECA3;",Ln="&#xECA5;",Gn="&#xECA7;",kn="&#xECA4;",On="&#xECA6;",Hn="&#xECA8;",qn="&#xECB7;",Un="&#xE560;",Wn="&#xE561;",In="&#xE240;",Xn="&#xE241;",zn="&#xE242;",Kn="&#xE243;",Vn="&#xE244;",Jn="&#xE245;",se="&#xE4E8;",Zn="&#xE4E8;&#xE1E7;",ae="&#xE4E7;",Qn="&#xE4E7;&#xE1E7;",ue="&#xE4E6;",Yn="&#xE4E6;&#xE1E7;",pe="&#xE4E5;",_n="&#xE4E5;&#x200A;&#xE1E7;",le="&#xE4E4;",jn="&#xE4E4;&#x200A;&#xE1E7;",tr="&#xE4E3;",er="&#xE4E3;&#x200A;&#xE1E7;",or="&#xE030",nr="&#xE500;",rr="&#xE501;",ir="&#xE502;",cr="&#xE504;",sr="&#xE503;",ar="&#xE505;",ur="&#xE040",pr="&#xE041",lr="&#xE042",fr="&#xE043",fe="&#xE048",hr="&#xE880;",mr="&#xE881;",dr="&#xE882;",xr="&#xE883;",gr="&#xE884;",Er="&#xE885;",wr="&#xE886;",yr="&#xE887;",Dr="&#xE888;",Rr="&#xE889;",Cr="&#xE870;",Br="&#xE871;",Sr="&#xE872;",vr="&#xE873;",Ar="&#xE874;",Fr="&#xE875;",Nr="&#xE876;",Pr="(",br=")",he="&#xE87B;",Tr={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},Mr="&#xE1F0;",$r="&#xE1F1;",Lr="&#xE1F2;",Gr="&#xE1F3;",kr="&#xE1F4;",Or="&#xE1F5;",Hr="&#xE1F7;",qr="&#xE1F8;",Ur="&#xE1F9;",Wr="&#xE1FA;",Ir="&#xE1FC;",Xr="&#xE1FD;",zr="&#xE1FE",Kr="&#xE1FF",Vr="&#xE200",Jr="&#xE201",Zr="&#xE202",Qr="&#xE203";function me(t){return function(){return arguments[t]}}function L(){return this}var Qe=Object.create,Yr=Object.freeze,St=Yr(Qe(Qe(Object.prototype,{at:{value:G},shift:{value:G},push:{value:G},forEach:{value:G},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:L},find:{value:G},findIndex:{value:function(){return-1}},flat:{value:L},flatMap:{value:L},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:L},reduce:{value:me(1)},sort:{value:L},each:{value:L},pipe:{value:k},start:{value:L},stop:{value:L},done:{value:L},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Q(t,e){return(e%t+t)%t}function O(t){return Q(12,t)}var _r=Object.assign,vt=Object.defineProperty,At={writable:!0};function jr(t){let e=[],o=-1;for(;t[++o]!==void 0;)e.push(t[o]);return e}var Y=class t{constructor(){_r(this,arguments),vt(this,"event",At),vt(this,"events",At),vt(this,"index",At),vt(this,"target",At)}toJSON(){return jr(this)}static of(...e){return new t(...e)}static from(e,o,n){let r=new t(...e);return r.event=e,r.events=o,r.index=n,r}static isChordEvent=de;static isNoteEvent=Ft;static isSequenceEvent=ti};function de(t){return t[1]==="chord"}function Ft(t){return t[1]==="note"}function ti(t){return t[1]==="sequence"}function ei(t,e){return e[t]}var _=Et(ei,!0);var Nt=N(_(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function v(t){return t[0]+Nt(t)}function Ye(t,e){return t>e?1:t<e?-1:0}var H=[0,2,4,5,7,9,11];function oi(t,e,o){return o.indexOf(t)===e}function _e(t,e){return t.map(o=>O(o+e)).filter(oi).sort(Ye)}var we=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function ye(t){return _e(H,t)}var{abs:Jc}=Math,ni={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},ri=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),ii=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],Zc={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function ge(t){let e=new Float32Array(12),o=S(t+2),n=7;for(;n--;)o=S(o+5),e[o]=1;return e}function Ee(t,e,o){let n=t.length;for(;n--;)t[n]*=1-o+o*e[n];return t}var xe={note:(t,e,o=1)=>{let n=w(e[2]),r=ge(n);return Ee(t,r,o*(1-n/192))},chord:(t,e,o=1)=>{let n=S(e[2]),r=ni[e[3].replace(/\(|\)/g,"")];if(!r)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=r.map(c=>S(n+c)),p=i.length,s;for(;p--;)s=ge(i[p]),Ee(t,s,o/i.length*ri[r[p]]);return t}};function bt(t,e,o){let n=t[e],r=n[0],i=Ft(n)?ge(w(n[2])):de(n)?xe.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),n):0;if(o!==void 0){let s=Float32Array.from({length:12},(c,a)=>ii[(a+12-o)%12]);Ee(i,s,.3)}let p=e;for(;n=t[--p];){let s=xe[n[1]];if(!s)continue;let c=v(n);if(c>r)s(i,n,.5);else if(n[1]==="note"&&r-c<3){if(1-(r-c)/3>1)throw new Error("Influence should never be > 1 "+r+" "+c);s(i,n,.25*(1-(r-n[0])/3))}}for(p=e;(n=t[++p])&&n[0]-r<2;){if(!Ft(n))continue;let s=xe[n[1]];if(s){if(1-(n[0]-r)/2>1)throw new Error("Influence should never be > 1 "+r+" "+stopBeat);s(i,n,.3*(1-(n[0]-r)/2))}}return i}var Pt=[0,7,5,2,10,9,3,4,8,11,1,6];function Tt(t){let e=Pt.length,o=0,n;for(;e--;)t[Pt[e]]>o&&(o=t[Pt[e]],n=Pt[e]);return n}var je=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,ct=/b|♭/,st=/#|♯/;var to=/b|♭|#|♯/g;var eo={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function oo(t,e){let o=we[t],n=S(e),r=o.spellings[O(n)];return yt[O(n-r)]+eo[r]}function no(t,e){let o=we[t],n,r,i;if(typeof e=="string"){let[c,a,f,u]=je.exec(e)||[e];u&&(n=w(e),r=o.spellings[O(n)],i=Dt(n-r))}else n=e,r=o.spellings[O(n)],i=Dt(n-r);let p=yt[O(n-r)],s=eo[r];return p+s+i}var{floor:ro,round:ps}=Math,C=class{constructor(){}clef="";pitched=!0;rows=St;getNoteHTML(e,o,n){let r=n>=4||Math.fround(n)===Math.fround(2.666666667)?"head4":n>=2||Math.fround(n)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${r}">${B[r]}</span>`}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return ro(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,o){let n=w(this.minPitch),r=w(this.maxPitch),i=w(e)+o;return i>=n&&i<=r?i:void 0}parts=[{name:"main",top:"stave-top",center:"stave-center",bottom:"stave-bottom",DEFAULT:!0}];getPart(e){return this.parts[0]}getRow(e){let n=(typeof e=="string"?e:nt(e)).replace(to,""),r=this.rows.indexOf(n);if(r===-1)throw new Error('Pitch "'+e+'" is not supported by stave '+this.constructor.name);return r}getRowDiff(e,o){let n=this.getRow(e);return this.getRow(o)-n}getSpelling(e,o){return o[1]==="chord"?oo(e,o[2]):no(e,o[2])}yRatioToPitch(e){let o=ro(e*this.pitches.length);return o<0?this.pitches[0]:o>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[o]}};function io(t){return Ze(t).toLowerCase().replace(/\s+/g,"-").replace(/-drum|-cymbal/,"")}var K=class extends C{type="drum";clef=ee;pitched=!1;rows=["","","","","splash chinese","crash-2","crash-1","ride-1 ride-2 ride-bell","closed-hi-hat open-hi-hat","high-tom cowbell","low-mid-tom high-mid-tom","snare-1 snare2 side-stick","low-tom sticks hand-clap tambourine","high-floor-tom","low-floor-tom","low-bass high-bass","","pedal-hi-hat","","","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};getNoteHTML(e,o,n){let r=w(e),i=this.#t[r],p=B[i],s=i?`<span class="head" data-glyph="${i}">${p}</span>`:super.getNoteHTML(e,o,n);return o<.02?ie+s+ce:s}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(w(e))?this.parts.drums:this.parts.cymbals}getRow(e){let o=typeof e=="string"?e:io(e);if(!o)throw new Error("Drum name not found for pitch "+e);let n=this.rows.findIndex(r=>r.includes(o));if(n===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return n}getSpelling(e,o){return o[1]==="note"?io(w(o[2])):super.getSpelliing(e,o[2])}yRatioToPitch(e){let o=floor(e*this.rows.length),n=o<4?4:o>17?17:o;return this.pitches[n]}};var at=class extends K{type="percussion";clef=oe;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getRowDiff(e,o){return 0}};var ut=class extends C{type="piano";rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","","","","","","","","","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"];getClefHTML(){return`<span class="treble-clef clef">${rt}</span><span class="bass-clef clef">${it}</span>`}getTimeSigHTML(e,o,n){return`<span class="timesig" data-event="${n}" data-part="rh">
            <sup>${B["timeSig"+e]}</sup>
            <sub>${B["timeSig"+o]}</sub>
        </span>
        <span class="timesig" data-event="${n}" data-part="lh">
            <sup>${B["timeSig"+e]}</sup>
            <sub>${B["timeSig"+o]}</sub>
        </span>`}parts=[{name:"lh",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",DEFAULT:!0},{name:"rh",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",DEFAULT:!0},{name:"soprano",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!0},{name:"alto",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!1},{name:"tenor",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!0},{name:"bass",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1}];getPart(e){return/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(e)?this.parts[0]:this.parts[1]}};var De=class extends C{type="treble-up";clef=jt;rows=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6","B6","C7","D7","E7","F7","G7","A7"]},Re=class extends C{type="treble";clef=rt;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},Ce=class extends C{type="treble-down";clef=_t;rows=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5"]},Be=class extends C{type="alto";clef=te;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Se=class extends C{type="bass";clef=it;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};C.treble=Re;C["treble-up"]=De;C["treble-down"]=Ce;C.alto=Be;C.bass=Se;C.piano=ut;C.drum=K;C.percussion=at;C.create=t=>new C[t];var co=C;var q={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};function ci(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function ve(t){return t===window?ci():t.getClientRects()[0]||t.getBoundingClientRect()}var U=1.1;function si(t){return parseFloat(t.dataset.duration)}function ai(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function so(t,e,o){return`M${e[o[0]]}, ${-t*e[o[0]]-.5*U}
        L${e[o[o.length-1]]},${-t*e[o[o.length-1]]-.5*U}
        L${e[o[o.length-1]]},${-t*e[o[o.length-1]]+.5*U}
        L${e[o[0]]}, ${-t*e[o[0]]+.5*U}
        Z`}function Ae(t,e,o,n,r,i){if(i<.125)return;let p=n-1,s;for(;e[++p];)e[p]<=i?s?s.push(p):s=[p]:s&&(t.appendChild(R("path",{class:`beam-path-${4/i} beam-path`,d:so(r,o,s)})),Ae(t,e,o,s[0],r,i/2),s=void 0);s&&(t.appendChild(R("path",{class:`beam-path-${4/i} beam-path`,d:so(r,o,s)})),Ae(t,e,o,s[0],r,i/2),s=void 0)}function ks(t){let e=t.dataset.events.split(/\s+/),o=t.parentElement,n=e.map(u=>o.querySelector('.note[data-event="'+u+'"]')),r=n.map(si),i=t.viewBox.baseVal,p=i.y<-.5?i.y+.5:i.height-1,s=n.map(ve),c=s[0].x,a=s[s.length-1].x,f=s.map(u=>(u.x-c)/(a-c));ai(t),Ae(t,r,f,0,-p,.25)}var ao=N((t,e)=>e[1],{note:(t,e)=>(e[2]=w(e[2])+t,e),chord:(t,e)=>(e[2]=S(S(e[2])+t),e[5]!==void 0&&(e[5]=S(S(e[2])+t)),e),key:(t,e)=>(e[2]=S(S(e[2])+t),e),default:k});var ui={displace:(t,e,o)=>(o[0]-=t[++e],e),rate:(t,e,o)=>(o[0]/=t[++e],e),quantize:(t,e,o)=>{},transpose:(t,e,o)=>(ao(t[e+1],o),e+1)};function pt(t,e){let o=-1,n;for(;n=t[++o];)o=ui[n](t,o,e);return e}var uo=Object.assign,po=[],pi={done:!0,value:void 0},lo={key:2,meter:1,default:0},li={};function fo(t){return lo[t[1]]||lo.default}function fi(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:fo(e)-fo(t)}function hi(t,e){return t.find(o=>o.id===e)}var lt=class t{constructor(e,o=po,n=po){e.sort(fi),this.events=e,this.sequences=o,this.transforms=n;let r=-1,i;for(;(i=e[++r])&&pt(n,uo(li,i))[0]<0;);this.n=r-1}next(){let{events:e,sequences:o,transforms:n,n:r}=this,i=e[r+1],p=i&&pt(n,Y.from(i,e,r+1)),s,c=-1,a=0,f=p?p[0]:1/0,u;for(;s=this[++c];)s.value||(s.next().value&&(pt(this.transforms,s.value),s.value[0]+=s.startBeat,s.value.target=s.target),(s.done||s.value[0]>=s.stopBeat)&&++a),s.value&&s.value[0]<s.stopBeat&&s.value[0]<f&&(u=s,f=s.value[0]),a&&(this[c]=this[c+a]);if(u)return this.value=u.value,u.value=void 0,this;if(!p)return uo(this,pi);if(this.n+=1,this.value=p,Y.isSequenceEvent(i)){let h=this.sequences,m=hi(h,i[2]);if(!m)throw new Error('Sequence id "'+i[2]+'" not found');let x=new t(m.events,m.sequences?m.sequences.concat(h):h,i.slice(5));x.startBeat=p[0],x.stopBeat=p[0]+p[4],x.target=p[3];let l=-1;for(;this[++l];);this[l]=x}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};var mi=[2,3,4,5,6,7,9],di=1/12,ho=.25,mo=.2,Fe={},j=0;function xo(t,e){return Math.cos(2*Math.PI*e/t)}function go(t,e,o,n,r){let i=t/e,p=0,s=0,c=0,a,f;for(n[r-1]&&v(n[r-1])>o+.125&&(c=1),--r;n[++r]!==void 0&&n[r][0]-o<i/4;)c=1;for(--r;n[++r]!==void 0&&n[r][0]-o<t-i/4;){if(a=Math.round((n[r][0]-o)/i),f=1<<a,a<e&&f>c){if(e>4&&f>c<<1)return;c+=f}p+=xo(i,n[r][0]-o),s+=1,!(n[r][0]+n[r][4]-o>t)&&(p+=mo*xo(i,n[r][0]+n[r][4]-o),s+=mo)}if(!(e>4&&a!==e-1)&&s)return Fe.score=p/(s+1),Fe.rhythm=c,Fe}function xi(t,e,o,n,r,i,p){let s=o[n-1]&&v(o[n-1])>r+.125?r:e*Math.floor((o[n][0]-r)/e)+r,c=i.length;for(;e/i[--c]<di;);++c;let a,f;for(;a=i[--c];)f=go(e,a,s,o,n),f&&f.score>=j&&f.score&&(j=f.score,t.beat=s,t.duration=e,t.divisor=a,t.rhythm=f.rhythm),o[n][0]>=s+.5*e&&s+1.5*e<p&&(f=go(e,a,s+.5*e,o,n),f&&f.score>=j&&(j=f.score,t.beat=s+.5*e,t.duration=e,t.divisor=a,t.rhythm=f.rhythm));return t}function Ne(t,e,o){let n=-1;for(;t[++n]!==void 0&&t[n][0]<e;);if(!t[n])return;let r={};j=ho;let i=1/8;for(;(i*=2)&&i<=o;)xi(r,i,t,n,e,mi,e+o);return j>ho&&r}var{abs:gi,EPSILON:Ei}=Math;function Mt(t,e){return Math.round(e/t)*t}function W(t,e,o=Ei){return t!==void 0&&(t===e||gi(t-e)<o)}function V(t,e,o){return W(t,e,o)||t<e}function Pe(t,e,o){return W(t,e,o)||t>e}function $t(t,e,o){return t!==void 0&&e!==void 0&&!V(t,e,o)}function be(t,e,o){return t!==void 0&&e!==void 0&&!Pe(t,e,o)}function Te(t){return 2**Math.ceil(Math.log2(t))}function Eo(t){return 2**Math.floor(Math.log2(t))}function wo(t){return t>0&&(t&t-1)===0}function Me(t,e,o){if(W(0,o,t/2))return e;let n=e*2;for(;(n/=2)>t;)if(W(0,Q(n,o),t/2))return n;return n}function ft(t,e){let o=-1,n=0;for(;t[++o]!==void 0;);for(;arguments[++n]!==void 0;)t[o++]=arguments[n];return t}function tt(t){let e=-1;for(;t[++e]!==void 0;);return e}function Lt(t){return t[tt(t)-1]}function ht(t,e){let o=[],n=-1;for(;e[++n]!==void 0;)o.push(t(e[n],n));return o}var Ge=Object.assign,{abs:yo,ceil:ja,floor:Do,min:Co,max:Bo,sqrt:Ro,round:tu}=Math,A=1/16,eu=1/24;function Gt(t){return t[0]+Nt(t)}function So(t,e){return Bo(t,Gt(e))}function vo(t,e,o){let n={},r=-1,i;for(;i=o[++r];){let p=i.scribeEvents,s=i.scribeIndex,c=bt(p,s,e),a=Tt(c);n[r]=t.getSpelling(a,i)}return n}function kt(t,e){let o=-1,n=0,r,i;for(;e[++o];)i=t.getRow(e[o]),i>n&&(n=i,r=e[o]);return{row:n,pitch:r}}function Ot(t,e){let o=-1,n=128,r,i;for(;e[++o];)i=t.getRow(e[o]),i<n&&(n=i,r=e[o]);return{row:n,pitch:r}}function ke(t,e,o,n){let r=e.centerRow||t.centerRow,i=o-r;return n-r+i>0}function Ao(t,e,o){let{row:n}=kt(t,o),{row:r}=Ot(t,o);return ke(t,e,n,r)}function wi(t,e,o){let n=[],r=-1,i;for(;i=o[++r];)i.type==="note"&&n.push(i.pitch);return Ao(t,e,n)}function X(t,e,o,n){let r=-1;for(;n[++r]&&n[r].beat===n.beat;);if(!n[r])return t;let i=n[0].beat,s=Lt(n).beat-i,c=o.stemup===void 0?Ao(e,o,ht(_("pitch"),n)):o.stemup;if(o.beam){let a;for(r=-1;a=n[++r];)a.stemup=c,a.beam=n;t.push(Ge(n,{duration:s,stemup:c,range:0}))}else{let a=[],f;for(r=-1;f=n[++r];){let E=f.pitch;for(;n[++r]&&W(n[r].beat,f.beat,A);)c?w(n[r].pitch)>w(E)&&(E=n[r].pitch):w(n[r].pitch)<w(E)&&(E=n[r].pitch);--r,a.push(E)}let u=0,h=0,m;for(r=-1;a[++r];)m=e.getRowDiff(e.centerPitch,a[r]),r<(a.length-1)/2?u+=m/Math.floor(a.length/2):r>(a.length-1)/2&&(h+=m/Math.floor(a.length/2));let x=n[0],l=Lt(n),g=e.getRowDiff(x.pitch,l.pitch),y=h-u,d=yo(y)>yo(.75*g)?-.5*g:-.5*y;for(r=-1;f=n[++r];)f.stemup=c,f.beam=n,f.stemHeight=c?1+.125*(d*r/(a.length-1)-e.getRowDiff(f.pitch,x.pitch)):1+.125*(-d*r/(a.length-1)+e.getRowDiff(f.pitch,x.pitch));t.push(Ge(n,{pitch:x.pitch,duration:s,stemup:c,range:d}))}return t}function yi(t,e,o,n,r,i){return{type:"rest",beat:i,duration:Po(t,e,i,r,i,r),stave:o,part:n}}function $e(t,e,o,n,r,i,p){for(;$t(p,i,A);){let s=yi(e,o,n,r,p,i);t.push(s),i+=s.duration}return p}function Di(t,e,o,n,r,i,p,s){let c=st.test(s)?1:ct.test(s)?-1:void 0,a=s[0]+s.slice(-1);Pe(p[0],e.beat,A)&&c!==r[a]&&(r[a]=c,t.push(Ge({},{type:"acci",beat:i,pitch:s,part:n,stave:o,event:p,value:c||0})))}function Fo(t,e,o,n,r,i,p,s){let c=-1;for(;s[++c];)Di(t,e,o,n,r,i,p[c],s[c]);return i}function No(t,e,o,n,r){let{row:i,pitch:p}=Ot(e,r),s=i-(o.topRow||e.topRow)+1;s<0&&t.push({type:"ledge",beat:n,pitch:p,part:o,rows:s});let{row:c,pitch:a}=kt(e,r);s=c-(o.bottomRow||e.bottomRow),s>0&&t.push({type:"ledge",beat:n,pitch:a,part:o,rows:s})}function Ri(t,e,o){let{beat:n,duration:r,divisor:i}=o,p=e.stemup===void 0?wi(t,e,o):e.stemup,s=-1,c;for(;c=o[++s];)c.type==="note"&&!c.beam&&(c.stemup=p);let a=n+.5*r,f=w(t.topPitch)-12,u,h=tt(o);for(;(c=o[--h])&&c.beat>a;);for(++h;(c=o[--h])&&c.beat+c.duration>a;){let d=w(c.pitch);(!u||d>u)&&(u=d)}let m=f;for(h=-1;(c=o[++h])&&c.beat<n+A;){let d=w(c.pitch);(!m||d>m)&&(m=d)}let x=f;for(h=tt(o);(c=o[--h])&&c.beat>n+r-r/i-A;){let d=w(c.pitch);(!x||d>x)&&(x=d)}let l=Math.ceil((m+x)/2),g=nt(l);l>u&&(u=l),o.pitch=nt(u),o.stemup=p;let y=x-m;o.angle=y<0?4*Ro(-y):-4*Ro(y)}function Ci(t,e,o,n,r,i,p,s,c,a,f,u,h,m){(p.swingAsStraight8ths&&c===1||p.swingAsStraight16ths&&c===.5)&&a===3&&(f===4||f===5)&&(a=2);let x=c/a,l=s+c,g={type:"tuplet",beat:s,duration:c,divisor:a,rhythm:f,part:i,stave:o},y,d;for(wo(a)||t.push(g);be(s,l,A);){for(;(y=h[++m])&&V(y[0]-e.beat,s+.5*x,A);)u.push(y);if(--m,!u.length){t.push({type:"rest",beat:s,duration:x,stave:o,part:i}),s+=x;continue}let E=vo(o,n,u),{row:et,pitch:It}=kt(o,E),{row:dt,pitch:Xt}=Ot(o,E),xt=i.stemup===void 0?ke(o,i,et,dt):i.stemup,zt=Co(u.reduce(So,0)-e.beat,y?y[0]-e.beat:e.duration,g.beat+g.duration),T=Bo(x,Mt(x,zt-s));$t(T,.5,A)?d&&(X(t,o,i,d),d=void 0):d||(d={type:"beam",beat:s,part:i}),No(t,o,i,s,E),Fo(t,e,o,i,r,s,u,E);let D=-1;for(;u[++D];)t.push({type:"note",beat:s,pitch:E[D],duration:T,part:i,stemup:xt,top:E[D]===Xt,bottom:E[D]===It,stave:o,event:u[D]});for(ft(g,...t.slice(-1*u.length)),d&&ft(d,...t.slice(-1*u.length)),D=u.length;D--;){let b=Gt(u[D])-e.beat;V(b,s+T+.5*x,A)?u.splice(D,1):t.push({type:"tie",beat:s,pitch:E[D],duration:T,stemup:xt,part:i,event:u[D]})}s+=T}return d&&X(t,o,i,d),Ri(o,i,g),m}function Le(t,e){let o=2*Te(e);for(;(o/=2)>t/2;){if(1.75*o===e)return 1.75*o;if(1.5*o===e)return 1.5*o;if(o<=e)return o}return t}function Bi(t,e,o){o=o||1/0;let n=4*Te(e);for(;(n/=2)>t/2;)if(n<=e*2&&n<=o)return n;return t}function Po(t,e,o,n,r,i){let s=Eo(e.divisor),c=Do(r/e.divisor)*e.divisor,a=Me(.125,s,r-c),f=Do(n/e.divisor)*e.divisor,u=c+e.divisor<n&&c+e.divisor;if(r===c)return t.indexOf(n-r)!==-1?n-r:t.indexOf(f-r)!==-1?f-r:u?u-r:Bi(.125,n-r,i-r);if(W(n,f,A))return t.indexOf(n-r)!==-1?n-r:u&&t.indexOf(u-r)!==-1?u-r:a;{let h=4*a;return(r-c)%h/a===1?r+2*a===i?2*a:(r+3*a>=i&&console.log("Next event beat is inside quaduplet"),a<1?n>=r+a*3/2?3*a:n>=r+a?a:Le(.125,n-r):n>=r+a*3?a*3:n>=r+a*2?a*2:n>r+a?a:Le(.125,n-r)):n>r+a?a:Le(.125,n-r)}}function Oe(t,e,o,n=0,r={},i,p,s=q){let c=[],{headDurations:a,restDurations:f}=s,u=0,h=-1,m,x,l;for(;(m=p[++h])&&V(m[0]+m[4]-e.beat,u,A););for(--h;be(u,e.duration,A);){l&&e.divisions.find(b=>W(u,b,A))&&(X(t,o,i,l),l=void 0);let g=Ne(p,e.beat+u,e.duration-u);if(g&&g.divisor!==2&&g.divisor!==4){$t(g.beat-e.beat,u,A)&&$e(t,s.restDurations,e,o,i,u,g.beat-e.beat),l&&(X(t,o,i,l),l=void 0),h=Ci(t,e,o,n,r,i,s,g.beat-e.beat,g.duration,g.divisor,g.rhythm,c,p,h),u=g.beat-e.beat+g.duration;continue}for(;(m=p[++h])&&V(m[0]-e.beat,u,A);)c.push(m);if(--h,!c.length){if(!m){l&&(X(t,o,i,l),l=void 0),$e(t,s.restDurations,e,o,i,u,e.duration);break}let b=Mt(.125,m[0]-e.beat);if(b<=u){console.log(`Problem at bar ${e.count}, moving to next bar ${u} ${b}`),e.error="Stop beat has ended up less than beat";break}l&&(bo(e.divisions,u,b)||b-u>=.5)&&(X(t,o,i,l),l=void 0),$e(t,f,e,o,i,u,b),u=b;continue}let y=vo(o,n,c),{row:d,pitch:E}=kt(o,y),{row:et,pitch:It}=Ot(o,y),dt=i.stemup===void 0?ke(o,i,d,et):i.stemup;No(t,o,i,u,y),Fo(t,e,o,i,r,u,c,y);let Xt=c[0][0]-e.beat,xt=Co(e.duration,c.reduce(So,0)-e.beat),zt=m&&Mt(.125,m[0])-e.beat,T=Po(a,e,Xt,xt,u,zt);T>=1?l&&(X(t,o,i,l),l=void 0):l||(l={type:"beam",beat:u,part:i});let D=-1;for(;c[++D];)t.push({type:"note",beat:u,pitch:y[D],duration:T,part:i,stemup:dt,top:y[D]===It,bottom:y[D]===E,stave:o,event:c[D]});for(l&&ft(l,...t.slice(-1*c.length)),D=c.length;D--;){let b=Gt(c[D])-e.beat;V(b,u+T,A)||b-(u+T)<.125+1/16*(Gt(c[D])-c[D][0])?c.splice(D,1):t.push({type:"tie",beat:u,pitch:y[D],duration:T,stemup:dt,part:i,event:c[D]})}u+=T}return l&&(X(t,o,i,l),l=void 0),t}var Si={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function vi(t,e){return Si[t+","+e]||St}function bo(t,e,o){let n=-1;for(;t[++n]&&t[n]<=e;);return o>t[n]?t[n]:void 0}var Ai=[],Fi={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},To=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function Ni(t,e){let o=To.indexOf(t.pitch),n=To.indexOf(e.pitch);return o>n?1:o<n?-1:0}function Mo(t,e){return ye(e).reduce((n,r,i)=>{let p=r-H[i];if(p!==0){let s=Z(H[i]),c=10;for(;c--;)n[s+c]=p}return n},t),t}function Pi(t,e,o,n,r,i,p){let s=-1,c;for(;c=i[++s];)switch(c[1]){case"key":{let a=S(c[2]),f=ye(a);Mo(r,a),t.push.apply(t,f.map((u,h)=>u-H[h]&&{type:"acci",pitch:Z(H[h])+Fi[u-H[h]],value:u-H[h],stave:o}).filter(u=>!!u).sort(Ni)),e.key=a;break}case"meter":{t.push({type:"timesig",beat:0,numerator:c[3]===1.5?c[2]/.5:c[2]/c[3],denominator:c[3]===1.5?8:4/c[3],stave:o,event:c});break}case"symbol":{t.push({type:"symbol"+c[2],stave:o});break}case"chord":{let a=c[0]-e.beat,f=bt(i,s,n),u=Tt(f),h=o.getSpelling(u,c);h==="C♭"&&p.spellChordRootCFlatAsB&&(h="B"),h==="E♯"&&p.spellChordRootESharpAsF&&(h="F"),h==="B♯"&&p.spellChordRootBSharpAsC&&(h="C"),h==="F♭"&&p.spellChordRootFFlatAsE&&(h="E"),t.push({type:"chord",beat:a,duration:c[0]+c[4]>e.beat+e.duration?e.duration-a:c[4],root:h,extension:c[3],event:c,stave:o});break}case"lyric":{let a=c[0]-e.beat;t.push({type:"lyric",beat:a,duration:c[0]+c[3]>e.beat+e.duration?e.duration-a:c[3],value:c[2],event:c,stave:o});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(Ai.includes(c[1]))return;console.log('Scribe: ignoring event type "'+c[1]+'"')}}return t}function mt(t,e,o,n,r,i,p,s,c,a=q){let f=[];if(c){let l=v(c);l>e&&l<=e+o&&p.push(c)}let u=Mo({},i),h={type:"bar",beat:e,duration:o,key:i,divisor:n,divisions:vi(o,n),stave:r,count:t,symbols:f};Pi(f,h,r,i,u,p,q);let m,x=0;for(m in r.parts){let l=r.parts[m],g=s[l.name]||[];!l.DEFAULT&&!g.length||(Oe(f,h,r,i,u,l,g,a),++x)}return x||(console.log("Stave has no parts defined SHOULD NOT BE"),Oe(f,h,r,i,u,r.parts[0],[],a)),h}function bi(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function Ti(t){let e=t.symbols.filter(o=>o.type==="chord"||o.type==="note");return JSON.stringify(e,bi)}function J(t,e){t.symbols=t.symbols.filter(o=>o.type==="doublebarline"||o.type==="clef").concat([{type:"BARREPEAT",count:e,duration:t.duration}])}function Ht(t,e,o){let n=Ti(o);switch(e.length){case 1:break;case 2:break;case 3:{n==="[]"&&e[0]==="[]"?e.length=0:n===e[0]&&n===e[1]&&n===e[2]&&o.symbols.filter(r=>r.type!=="clef"&&r.type!=="timesig").find(r=>r.type!=="rest")?(J(t[t.length-2],1),J(t[t.length-1],1),J(o,1)):(n!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{n===e[0]&&n===e[1]&&n===e[2]&&n===e[3]?(J(o,1),e.length=3):(n!==e[1]||e[0]!==e[2]||n!==e[3])&&(e.length=2);break}case 5:{n===e[1]&&n===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,J(t[t.length-1],2),J(o,2)):e.length=4;break}case 6:break;case 7:{n===e[1]&&n===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,J(o,2),e.length=5):e.length=1;break}}for(e.unshift(n);e.length>8;)e.pop()}function He(t,e,o){let n=o.target?t.parts[o.target]:t.getPart(o[2]),r=e[n.name]||(e[n.name]=[]);e[n.name].push(o)}function qe(t,e,o,n=q){let r=[],i=[],p=[],s=[],c=0,a=[],f={},u=0,h=0,m,x,l,g;for(l of t)if(l.scribeIndex=r.length,l.scribeEvents=r,r.push(l),!e.includes(l[1])){for(;l[0]>=c+m;){let d=mt(i.length+1,c,m,x,o,u,a,f,g,n);Ht(i,s,d),i.push(d),u=d.key,c=c+m,a=[],f={};let E=-1;for(;p[++E];)He(o,f,p[E]),v(p[E])<c+m&&p.splice(E--,1)}switch(l[1]){case"note":{He(o,f,l),v(l)>c+m&&p.push(l),h<v(l)&&(h=v(l));break}case"sequence":{l.events===t.events&&(g=l),h<v(l)&&(h=v(l));break}case"meter":m=l[2],x=l[3],l[0]!==c&&console.log("TODO");default:a.push(l)}}for(;p.length;){let d=mt(i.length+1,c,m,x,o,u,a,f,g,n);Ht(i,s,d),i.push(d),c=c+m,a=[],f={};let E=-1;for(;l=p[++E];)He(o,f,l),v(l)<c+m&&p.splice(E--,1)}for(;c<h-m;){let d=mt(i.length+1,c,m,x,o,u,a,f,g,n);Ht(i,s,d),i.push(d),c=c+m,a=[],f={}}let y=mt(i.length+1,c,m,x,o,u,a,f,g,n);return Ht(i,s,y),i.push(y),i}var qt=Symbol("scribe-id"),Mi=0;function I(t){return t[qt]||(t[qt]=++Mi+""),t[qt]}var Ut=Math.abs,Wt={flat:`<span class="chord-flat">${Rt}</span>`,sharp:`<span class="chord-sharp">${Bt}</span>`},$i={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Li={2:re,1:Bt,0:Ct,"-1":Rt,"-2":ne},Gi={"1.33":le,"0.67":pe,"0.33":ue,"0.17":ae,"0.08":se},ki=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function F(t){return t.toFixed(4).replace(/\.?0+$/,"")}var Ue=N(_("type"),{BARREPEAT:t=>R("span",{class:"BARREPEAT",html:B["barRepeat"+t.count],data:{duration:t.duration}}),clef:t=>t.stave.getClefHTML?R("fragment",t.stave.getClefHTML()):R("span",{class:`${t.stave.type}-clef clef`,html:t.stave.clef}),chord:t=>{let e=ki.exec(t.extension);return R("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(st,Wt.sharp).replace(ct,Wt.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(st,Wt.sharp).replace(ct,Wt.flat)+"</sup>":"")+"</span>"+(t.bass?he+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:F(t.beat),duration:F(t.duration),event:I(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?R("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,I(t.event))):R("span",{class:"timesig",html:`<sup>${B["timeSig"+t.numerator]}</sup>
                <sub>${B["timeSig"+t.denominator]}</sub>`,data:{event:I(t.event)}}),symbolcoda:t=>R("p",{html:fe,class:"coda"}),barcount:t=>R("span",{html:t.text,class:"barcount"}),lyric:t=>R("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:F(t.beat),duration:F(t.duration),event:I(t.event)}}),acci:t=>R("span",{class:$i[t.value]||"acci",html:Li[t.value]||Ct,data:t.beat===void 0?{pitch:t.pitch}:{beat:F(t.beat),pitch:t.pitch,part:t.part.name,event:I(t.event)}}),ledge:t=>R("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 4.8 ${Ut(t.rows)}`:`0 -0.5 4.8 ${Ut(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="4.8" y1="0" y2="0"></line>
            <line x1="0" x2="4.8" y1="2" y2="2"></line>
            <line x1="0" x2="4.8" y1="4" y2="4"></line>
            <line x1="0" x2="4.8" y1="6" y2="6"></line>
            <line x1="0" x2="4.8" y1="8" y2="8"></line>
        `,data:{beat:F(t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>R("data",{class:`${t.stemup?"up-note":"down-note"} ${t.top?"top-note":""} ${t.bottom?"bottom-note":""} ${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${w(t.pitch)})`,data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name,beam:t.beam&&I(t.beam),event:I(t.event)}}),beam:t=>R("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range>0?-t.range:0)-.5} 1 ${Ut(t.range)+1}`,preserveAspectRatio:"none",style:`height: ${(Ut(t.range)+.5)*.125}em; align-self: ${t.range>0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*U} L1,${-t.range-.5*U} L1,${-t.range+.5*U} L0,${.5*U} Z"></path>`,data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name,events:ht(e=>I(e.event),t).join(" ")}}),tie:t=>R("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name}}),tuplet:t=>R("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:B["tuplet"+t.divisor],data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>R("span",{class:"rest",html:Gi[t.duration.toFixed(2)]||B["rest"+(t.duration+"").replace(".","")]||"",data:{beat:F(t.beat),pitch:t.pitch,duration:F(t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function Oi(t){return t[0]<=0&&t[1]==="meter"}function Hi(t){return t[0]<=0&&t[1]==="key"}function qi(t,e){let o=Ue(e);return o&&t.push(o),t}function Ui(t,e){return t.push(R("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:Z(e.key)},children:e.symbols.reduce(qi,[])})),t}function Wi(t,e,o,n,r,i=1/0,p=0,s=0,c=q){let a=t.events;!a.find(Oi)&&r&&a.unshift([0,"meter",r[2],r[3]]),!a.find(Hi)&&n&&a.unshift([0,"key",n]);let h=co.create(o||"treble"),m=[];p&&m.push("transpose",p),s&&m.push("displace",s);let x=new lt(a,t.sequences,m),l=qe(x,e,h,c).reduce(Ui,[]),g=l[0],y=g.querySelectorAll(".acci:not([data-beat])"),d=R("div",{class:`${h.type}-stave signature-stave stave`,children:[Ue({type:"clef",stave:h}),...y],data:{key:g.dataset.key}}),E=R("div",{id:"side",class:"side",data:{key:g.dataset.key}}),et=24;for(;et--;)E.appendChild(d.cloneNode(!0));return l.unshift(E),l}export{k as a,N as b,gt as c,Et as d,G as e,R as f,co as g,q as h,ks as i,Wi as j};
//# sourceMappingURL=chunk-35ZBEJZ7.js.map
