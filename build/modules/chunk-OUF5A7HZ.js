/* Scribe 
   0.4.5
   By Stephen */

var Mo=Object.defineProperty;var Lo=(t,e)=>{for(var o in e)Mo(t,o,{get:e[o],enumerable:!0})};function q(t){return t}function F(t,e){return function(){let n=t.apply(this,arguments),r=e[n]||e.default;if(!r)throw new Error('overload() no function defined for key "'+n+'"');return r.apply(this,arguments)}}function Et(t){var e=new Map;return function(n){if(e.has(n))return e.get(n);var r=t(n);return e.set(n,r),r}}var ko=Array.prototype;function Oo(t,e){return typeof t=="function"?t.apply(null,e):t}function Ie(t,e,o){o=o||t.length;var n=o===1?e?t:Et(t):Et(function(r){return Ie(function(){var i=[r];return i.push.apply(i,arguments),t.apply(null,i)},e,o-1)});return function r(i){return arguments.length===0?r:arguments.length===1?n(i):arguments.length>=o?t.apply(null,arguments):Oo(n(i),ko.slice.call(arguments,1))}}var Y=Ie;function k(){}var Ho=F(q,{is:k,tag:k,data:function(t,e,o){for(t in o)o[t]===void 0&&delete o[t];Object.assign(e.dataset,o)},dataset:function(t,e,o){for(t in o)o[t]===void 0&&delete o[t];Object.assign(e.dataset,o)},html:function(t,e,o){e.innerHTML=o},text:function(t,e,o){e.textContent=o},style:F((t,e,o)=>typeof o,{string:(t,e,o)=>e.style=o,object:(t,e,o)=>Object.assign(e.style,o)}),children:function(t,e,o){e.innerHTML="",e.append.apply(e,o)},href:function(t,e,o){e instanceof SVGElement?e.setAttribute("href",o):e.href=o},points:G,cx:G,cy:G,r:G,x:G,y:G,dx:G,dy:G,transform:G,preserveAspectRatio:G,viewBox:G,default:function(t,e,o){t in e?e[t]=o:e.setAttribute(t,o)}});function G(t,e,o){e.setAttribute(t,o)}function qo(t,e){for(var o=Object.keys(e),n=o.length;n--;)e[o[n]]!==void 0&&Ho(o[n],t,e[o[n]]);return t}var yt=Y(qo,!0);var zt="http://www.w3.org/2000/svg",Xe=document.createElement("template"),Kt=(t,e)=>e&&typeof e;function ze(t,e=""){let o=document.createRange();return o.selectNode(t),o.createContextualFragment(e)}var N=F(Kt,{string:function(t,e){let o=document.createElementNS(zt,t);return o.innerHTML=e,o},object:function(t,e){let o=document.createElementNS(zt,t);return typeof e.length=="number"?o.append.apply(o,e):yt(o,e),o},default:t=>document.createElementNS(zt,t)}),Uo=F(Kt,{string:function(t,e){let o=document.createElement(t);return o.innerHTML=e,o},object:function(t,e){let o=document.createElement(t);return typeof e.length=="number"?o.append.apply(o,e):yt(o,e),o},default:t=>document.createElement(t)}),Wo=F(q,{comment:function(t,e){return document.createComment(e||"")},fragment:F(Kt,{string:function(t,e,o){return o?ze(o,e):(Xe.innerHTML=e,Xe.content.cloneNode(!0))},object:function(t,e,o){let n=o?ze(o):document.createDocumentFragment();return typeof e.length=="number"?n.append.apply(n,e):yt(n,e),n},default:()=>document.createDocumentFragment()}),circle:N,ellipse:N,g:N,glyph:N,image:N,line:N,rect:N,use:N,path:N,pattern:N,polygon:N,polyline:N,svg:N,tspan:N,text:N,default:Uo}),R=Wo;function Vt(t){return function(){return arguments[t]}}function Jt(t){return t}function K(){}function M(){return this}var Ke=Object.create,Io=Object.freeze,Ve=Io(Ke(Ke(Object.prototype,{at:{value:K},shift:{value:K},push:{value:K},forEach:{value:K},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:M},find:{value:K},findIndex:{value:function(){return-1}},flat:{value:M},flatMap:{value:M},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:M},reduce:{value:Vt(1)},sort:{value:M},each:{value:M},pipe:{value:Jt},start:{value:M},stop:{value:M},done:{value:M},valueOf:{value:function(){return null}}}),{length:{value:0}}));function Zt(t,e){return(e%t+t)%t}var Je=t=>Zt(12,t);var Xo=/^([A-G][♭♯#b]?)(-?\d)$/,zo=/^[A-G][♭♯#b]?/,Ko=/-?\d$/,Vo=/[Hh]z$/,nt={C:0,"C♯":1,"C#":1,"D♭":1,Db:1,D:2,"D♯":3,"D#":3,"E♭":3,Eb:3,E:4,F:5,"F♯":6,"F#":6,"G♭":6,Gb:6,G:7,"G♯":8,"G#":8,"A♭":8,Ab:8,A:9,"A♯":10,"A#":10,"B♭":10,Bb:10,B:11},Qt={27:"High Q",28:"Slap",29:"Scratch Push",30:"Scratch Pull",31:"Sticks",32:"Square Click",33:"Metronome Click",34:"Metronome Bell",35:"Low Bass Drum",36:"High Bass Drum",37:"Side Stick",38:"Snare Drum 1",39:"Hand Clap",40:"Snare Drum 2",41:"Low Floor Tom",42:"Closed Hi-hat",43:"High Floor Tom",44:"Pedal Hi-hat",45:"Low Tom",46:"Open Hi-hat",47:"Low Mid Tom",48:"High Mid Tom",49:"Crash Cymbal 1",50:"High Tom",51:"Ride Cymbal 1",52:"Chinese Cymbal",53:"Ride Bell",54:"Tambourine",55:"Splash Cymbal",56:"Cowbell",57:"Crash Cymbal 2",58:"Vibra Slap",59:"Ride Cymbal 2",60:"High Bongo",61:"Low Bongo",62:"Mute High Conga",63:"Open High Conga",64:"Low Conga",65:"High Timbale",66:"Low Timbale",67:"High Agogo",68:"Low Agogo",69:"Cabasa",70:"Maracas",71:"Short Whistle",72:"Long Whistle",73:"Short Guiro",74:"Long Guiro",75:"Claves",76:"High Wood Block",77:"Low Wood Block",78:"Mute Cuica",79:"Open Cuica",80:"Mute Triangle",81:"Open Triangle",82:"Shaker",83:"Jingle Bell",84:"Belltree",85:"Castanets",86:"Mute Surdo",87:"Open Surdo"};function Ze(t){return t.toLowerCase().replace(/\s+/g,"-")}for(let t in Qt)nt[Ze(Qt[t])]=parseInt(t,10);var Jo=69;function Zo(t,e=440){var o=Jo+12*Math.log(t/e)/Math.log(2);return Math.fround(o)}function D(t){if(typeof t=="number")return t;if(Vo.test(t))return Zo(parseFloat(t));let e=Xo.exec(t);return e?(parseInt(e[2],10)+1)*12+nt[e[1]]:nt[Ze(t)]}function A(t){return typeof t=="number"?Je(t):nt[zo.exec(t)[0]]}var Dt=["C","C♯","D","E♭","E","F","F♯","G","G♯","A","B♭","B"];function rt(t){return _(t)+Rt(t)}function _(t){return Dt[Je(t)]}function Rt(t){return typeof t=="number"?Math.floor(t/12)-1:Number(nt[(Ko.exec(name)||Ve)[0]])}function Qe(t){let e=D(t);return Qt[e]||""}var S={};Lo(S,{acciDoubleFlat:()=>oe,acciDoubleSharp:()=>ne,acciFlat:()=>Bt,acciNatural:()=>Ct,acciParensLeft:()=>un,acciParensRight:()=>ln,acciSharp:()=>St,augmentationDot:()=>Gn,barLine:()=>nr,barRepeat1:()=>rr,barRepeat2:()=>ir,barRepeat4:()=>cr,barRepeatBegin:()=>lr,barRepeatDots:()=>hr,barRepeatEnd:()=>pr,barRepeatEndBegin:()=>fr,barRepeatLowerDot:()=>ur,barRepeatSlash:()=>sr,barRepeatUpperDot:()=>ar,chordAugmented:()=>Ar,chordBassSlash:()=>fe,chordBracketLeft:()=>Pr,chordBracketRight:()=>Tr,chordDiminished:()=>Cr,chordGlyphs:()=>$r,chordHalfDiminished:()=>Sr,chordMajorSeventh:()=>vr,chordMinor:()=>Fr,chordParensLeftTall:()=>Nr,chordParensRightTall:()=>br,clefAlto:()=>jt,clefBass:()=>ct,clefDrum:()=>te,clefPercussion:()=>ee,clefTreble:()=>it,clefTrebleDown:()=>Yt,clefTrebleUp:()=>_t,coda:()=>pe,graceNoteStemDown:()=>In,graceNoteStemUp:()=>Wn,head1:()=>pn,head2:()=>fn,head4:()=>hn,headBracketLeft:()=>re,headBracketRight:()=>ie,headCircle:()=>En,headCircleX:()=>yn,headDiamond:()=>mn,headDiamondWide:()=>xn,headPlus:()=>wn,headSlashHorizontalEnds:()=>Bn,headSlashVerticalEnds:()=>Rn,headSlashed2:()=>dn,headTriangleUp:()=>Dn,headX:()=>gn,metDot:()=>Un,metNote05Down:()=>qn,metNote05Up:()=>kn,metNote1Down:()=>Hn,metNote1Up:()=>Ln,metNote2Down:()=>On,metNote2Up:()=>Mn,note0125Down:()=>$n,note0125Up:()=>Fn,note025Down:()=>Tn,note025Up:()=>vn,note05Down:()=>Pn,note05Up:()=>An,note1Down:()=>bn,note1Up:()=>Sn,note2Down:()=>Nn,note2Up:()=>Cn,rest0125:()=>ce,rest01875:()=>Qn,rest025:()=>se,rest0375:()=>Yn,rest05:()=>ae,rest075:()=>_n,rest1:()=>ue,rest15:()=>jn,rest2:()=>le,rest3:()=>tr,rest4:()=>er,rest6:()=>or,tailDown0125:()=>Zn,tailDown025:()=>Vn,tailDown05:()=>zn,tailUp0125:()=>Jn,tailUp025:()=>Kn,tailUp05:()=>Xn,textBeam16Long:()=>Ir,textBeam16Short:()=>Wr,textBeam8Long:()=>Ur,textBeam8Short:()=>qr,textDot:()=>Xr,textNote16Long:()=>Hr,textNote16Short:()=>Or,textNote8Long:()=>kr,textNote8Short:()=>Lr,textNoteLong:()=>Mr,textNoteShort:()=>Gr,textTie:()=>zr,textTuplet3Long:()=>Qr,textTuplet3Short:()=>Vr,textTupletBeginLong:()=>Zr,textTupletBeginShort:()=>Kr,textTupletEndLong:()=>Yr,textTupletEndShort:()=>Jr,timeSig0:()=>Qo,timeSig1:()=>Yo,timeSig2:()=>_o,timeSig3:()=>jo,timeSig4:()=>tn,timeSig5:()=>en,timeSig6:()=>on,timeSig7:()=>nn,timeSig8:()=>rn,timeSig9:()=>cn,timeSigCommon:()=>sn,timeSigCutCommon:()=>an,tuplet0:()=>dr,tuplet1:()=>mr,tuplet2:()=>xr,tuplet3:()=>gr,tuplet4:()=>wr,tuplet5:()=>Er,tuplet6:()=>yr,tuplet7:()=>Dr,tuplet8:()=>Rr,tuplet9:()=>Br});var it="&#xE050;",Yt="&#xE052;",_t="&#xE053;",jt="&#xE05C;",ct="&#xE062;",te="&#xE069;",ee="&#xE069;",Qo="&#xE080;",Yo="&#xE081;",_o="&#xE082;",jo="&#xE083;",tn="&#xE084;",en="&#xE085;",on="&#xE086;",nn="&#xE087;",rn="&#xE088;",cn="&#xE089;",sn="&#xE08A;",an="&#xE08B;",oe="&#xE264;",Bt="&#xE260;",Ct="&#xE261;",St="&#xE262;",ne="&#xE263;",un="&#xE26A;",ln="&#xE26B;",pn="&#xE0A4;",fn="&#xE0A3;",hn="&#xE0A2;",re="&#xE0F5;",ie="&#xE0F6;",dn="&#xE0D0;",mn="&#xE0DB;",xn="&#xE0DC;",gn="&#xE0A9;",wn="&#xE0AF;",En="&#xE0E8;",yn="&#xE0B3;",Dn="&#xE0BE;",Rn="&#xE100;",Bn="&#xE101;",Cn="&#xE1D3;",Sn="&#xE1D5;",An="&#xE1D7;",vn="&#xE1D9;",Fn="&#xE1DB;",Nn="&#xE1D4;",bn="&#xE1D6;",Pn="&#xE1D8;",Tn="&#xE1DA;",$n="&#xE1DC;",Gn="&#xE1E7;",Mn="&#xECA3;",Ln="&#xECA5;",kn="&#xECA7;",On="&#xECA4;",Hn="&#xECA6;",qn="&#xECA8;",Un="&#xECB7;",Wn="&#xE560;",In="&#xE561;",Xn="&#xE240;",zn="&#xE241;",Kn="&#xE242;",Vn="&#xE243;",Jn="&#xE244;",Zn="&#xE245;",ce="&#xE4E8;",Qn="&#xE4E8;&#xE1E7;",se="&#xE4E7;",Yn="&#xE4E7;&#xE1E7;",ae="&#xE4E6;",_n="&#xE4E6;&#xE1E7;",ue="&#xE4E5;",jn="&#xE4E5;&#x200A;&#xE1E7;",le="&#xE4E4;",tr="&#xE4E4;&#x200A;&#xE1E7;",er="&#xE4E3;",or="&#xE4E3;&#x200A;&#xE1E7;",nr="&#xE030",rr="&#xE500;",ir="&#xE501;",cr="&#xE502;",sr="&#xE504;",ar="&#xE503;",ur="&#xE505;",lr="&#xE040",pr="&#xE041",fr="&#xE042",hr="&#xE043",pe="&#xE048",dr="&#xE880;",mr="&#xE881;",xr="&#xE882;",gr="&#xE883;",wr="&#xE884;",Er="&#xE885;",yr="&#xE886;",Dr="&#xE887;",Rr="&#xE888;",Br="&#xE889;",Cr="&#xE870;",Sr="&#xE871;",Ar="&#xE872;",vr="&#xE873;",Fr="&#xE874;",Nr="&#xE875;",br="&#xE876;",Pr="(",Tr=")",fe="&#xE87B;",$r={"∆♯11":"11","∆":"",7:"7","-7":"7","-♭6":"6","7sus♭9":"7sus",ø:"","7♯11":"711","-∆":"","∆♭6":"6","-♭9":"9",ø7:"7","∆♯5":"5","7alt":"7alt","°":"",dim:"","7♭9":"7","+7":"7"},Gr="&#xE1F0;",Mr="&#xE1F1;",Lr="&#xE1F2;",kr="&#xE1F3;",Or="&#xE1F4;",Hr="&#xE1F5;",qr="&#xE1F7;",Ur="&#xE1F8;",Wr="&#xE1F9;",Ir="&#xE1FA;",Xr="&#xE1FC;",zr="&#xE1FD;",Kr="&#xE1FE",Vr="&#xE1FF",Jr="&#xE200",Zr="&#xE201",Qr="&#xE202",Yr="&#xE203";function he(t){return function(){return arguments[t]}}function L(){return this}var Ye=Object.create,_r=Object.freeze,At=_r(Ye(Ye(Object.prototype,{at:{value:k},shift:{value:k},push:{value:k},forEach:{value:k},join:{value:function(){return""}},every:{value:function(){return!0}},filter:{value:L},find:{value:k},findIndex:{value:function(){return-1}},flat:{value:L},flatMap:{value:L},includes:{value:function(){return!1}},indexOf:{value:function(){return-1}},map:{value:L},reduce:{value:he(1)},sort:{value:L},each:{value:L},pipe:{value:q},start:{value:L},stop:{value:L},done:{value:L},valueOf:{value:function(){return null}}}),{length:{value:0}}));function j(t,e){return(e%t+t)%t}function U(t){return j(12,t)}var jr=Object.assign,vt=Object.defineProperty,Ft={writable:!0};function ti(t){let e=[],o=-1;for(;t[++o]!==void 0;)e.push(t[o]);return e}var tt=class t{constructor(){jr(this,arguments),vt(this,"event",Ft),vt(this,"events",Ft),vt(this,"index",Ft),vt(this,"target",Ft)}toJSON(){return ti(this)}static of(...e){return new t(...e)}static from(e,o,n){let r=new t(...e);return r.event=e,r.events=o,r.index=n,r}static isChordEvent=de;static isNoteEvent=Nt;static isSequenceEvent=ei};function de(t){return t[1]==="chord"}function Nt(t){return t[1]==="note"}function ei(t){return t[1]==="sequence"}function oi(t,e){return e[t]}var V=Y(oi,!0);var _e=F(V(1),{chord:t=>t[4],lyric:t=>t[3],note:t=>t[4],sequence:t=>t[4],default:t=>0});function C(t){return t[0]+_e(t)}function je(t,e){return t>e?1:t<e?-1:0}var W=[0,2,4,5,7,9,11];function ni(t,e,o){return o.indexOf(t)===e}function to(t,e){return t.map(o=>U(o+e)).filter(ni).sort(je)}var we=[{name:"C",symbol:"C∆",spellings:[0,1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"D♭",symbol:"D♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"D",symbol:"D∆",spellings:[0,1,0,1,0,0,1,0,1,0,-1,0]},{name:"E♭",symbol:"E♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,-1]},{name:"E",symbol:"E∆",spellings:[0,1,0,1,0,1,1,0,1,0,1,0]},{name:"F",symbol:"F∆",spellings:[0,-1,0,-1,0,0,1,0,-1,0,-1,0]},{name:"F♯",symbol:"F♯∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]},{name:"G",symbol:"G∆",spellings:[0,1,0,-1,0,0,1,0,1,0,-1,0]},{name:"A♭",symbol:"A♭∆",spellings:[0,-1,0,-1,-1,0,-1,0,-1,0,-1,-1]},{name:"A",symbol:"A∆",spellings:[0,1,0,1,0,0,1,0,1,0,1,0]},{name:"B♭",symbol:"B♭∆",spellings:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0]},{name:"B",symbol:"B∆",spellings:[1,1,0,1,0,1,1,0,1,0,1,0]}];function Ee(t){return to(W,t)}var{abs:ns}=Math,ri={"":[0,4,7],"∆":[0,4,7,11],"∆7":[0,4,7,11],"∆♯11":[0,4,6,7,11],7:[0,4,7,10],13:[0,4,7,9,10],"7sus":[0,5,7,10],"-":[0,3,7],"-7":[0,3,7,10],"-11":[0,3,5,7],"-13":[0,3,7,9],"-♭6":[0,3,7,8],"7sus♭9":[0,1,5,7,10],ø:[0,3,6,10],"-∆":[0,3,7,11],"7♯11":[0,4,6,7,10],"∆♭6":[0,4,7,8],"-♭9":[0,1,3,7],ø7:[0,2,3,6,10],"∆♯5":[0,2,4,6,8,9,11],"7alt":[0,1,3,4,6,8,10],"°":[0,3,6,9],"7♭9":[0,1,4,7,10],"7♯9":[0,3,4,7,10],"7♭13":[0,4,7,8,10],"+":[0,2,4,6,8,10],"+7":[0,2,4,6,8,10],dim:[0,3,6,9]},ii=Float32Array.of(1,.9,.8,1,1,.8,.8,1,.9,1,1,1),ci=[1,1/6+0+0,4/6+0+0,3/6+1/9+0,2/6+0+1/5,5/6+0+0,0+1/11+0,5/6+0+0,2/6+0+1/5,3/6+1/8+0,4/6+0+0,1/6+0+0],rs={3:[10/16,13/16,10/16],4:[10/16,13/16,10/16,12/16]};function xe(t){let e=new Float32Array(12),o=A(t+2),n=7;for(;n--;)o=A(o+5),e[o]=1;return e}function ge(t,e,o){let n=t.length;for(;n--;)t[n]*=1-o+o*e[n];return t}var me={note:(t,e,o=1)=>{let n=D(e[2]),r=xe(n);return ge(t,r,o*(1-n/192))},chord:(t,e,o=1)=>{let n=A(e[2]),r=ri[e[3].replace(/\(|\)/g,"")];if(!r)return console.warn('No scale for chord extension "'+e[3]+'"'),t;let i=r.map(c=>A(n+c)),u=i.length,s;for(;u--;)s=xe(i[u]),ge(t,s,o/i.length*ii[r[u]]);return t}};function Pt(t,e,o){let n=t[e],r=n[0],i=Nt(n)?xe(D(n[2])):de(n)?me.chord(Float32Array.of(1,1,1,1,1,1,1,1,1,1,1,1),n):0;if(o!==void 0){let s=Float32Array.from({length:12},(c,a)=>ci[(a+12-o)%12]);ge(i,s,.3)}let u=e;for(;n=t[--u];){let s=me[n[1]];if(!s)continue;let c=C(n);if(c>r)s(i,n,.5);else if(n[1]==="note"&&r-c<3){if(1-(r-c)/3>1)throw new Error("Influence should never be > 1 "+r+" "+c);s(i,n,.25*(1-(r-n[0])/3))}}for(u=e;(n=t[++u])&&n[0]-r<2;){if(!Nt(n))continue;let s=me[n[1]];if(s){if(1-(n[0]-r)/2>1)throw new Error("Influence should never be > 1 "+r+" "+stopBeat);s(i,n,.3*(1-(n[0]-r)/2))}}return i}var bt=[0,7,5,2,10,9,3,4,8,11,1,6];function Tt(t){let e=bt.length,o=0,n;for(;e--;)t[bt[e]]>o&&(o=t[bt[e]],n=bt[e]);return n}var eo=/^([A-G])([b#♭♯𝄫𝄪])?(-?\d)?$/,st=/b|♭/,at=/#|♯/;var $t=/b|♭|#|♯/g;var oo={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"};function no(t,e){let o=we[t],n=A(e),r=o.spellings[U(n)];return Dt[U(n-r)]+oo[r]}function ro(t,e){let o=we[t],n,r,i;if(typeof e=="string"){let[c,a,p,l]=eo.exec(e)||[e];l&&(n=D(e),r=o.spellings[U(n)],i=Rt(n-r))}else n=e,r=o.spellings[U(n)],i=Rt(n-r);let u=Dt[U(n-r)],s=oo[r];return u+s+i}var si=globalThis||window;var{floor:io,round:Es}=Math,B=class{constructor(){}clef="";pitched=!0;rows=At;getNoteHTML(e,o,n){let r=n>=4||Math.fround(n)===Math.fround(2.666666667)?"head4":n>=2||Math.fround(n)===Math.fround(1.333333333)?"head2":"head1";return`<span class="head" data-glyph="${r}">${S[r]}</span>`}get maxRow(){return 0}get topRow(){return this.centerRow-4}get centerRow(){return io(.5*(this.rows.length-1))}get bottomRow(){return this.centerRow+5}get minRow(){return this.rows.length-1}get maxPitch(){return this.rows[this.maxRow]}get topPitch(){return this.rows[this.topRow]}get centerPitch(){return this.rows[this.centerRow]}get bottomPitch(){return this.rows[this.bottomRow]}get minPitch(){return this.rows[this.minRow]}movePitch(e,o){let n=D(this.minPitch),r=D(this.maxPitch),i=D(e)+o;return i>=n&&i<=r?i:void 0}parts=[{name:"main",top:"stave-top",center:"stave-center",bottom:"stave-bottom",DEFAULT:!0}];getPart(e){return this.parts[0]}getRow(e,o){let r=(typeof o=="string"?o:rt(o)).replace($t,""),i=this.rows.indexOf(r);if(si.DEBUG&&i===-1)throw new Error('Pitch "'+o+'" is not supported by stave '+this.constructor.name);return i===-1&&console.warn('Pitch "'+o+'" is not supported by stave '+this.constructor.name),i>-1?i:void 0}getRowDiff(e,o){let n=this.getRow(e);return this.getRow(o)-n}getSpelling(e,o){return o[1]==="chord"?no(e,o[2]):ro(e,o[2])}yRatioToPitch(e){let o=io(e*this.pitches.length);return o<0?this.pitches[0]:o>this.pitches.length-1?this.pitches[this.pitches.length-1]:this.pitches[o]}};var ai=globalThis||window;function co(t){return Qe(t).toLowerCase().replace(/\s+/g,"-").replace(/-drum|-cymbal/,"")}var J=class extends B{type="drum";clef=te;pitched=!1;rows=["","","","","splash chinese","crash-2","crash-1","ride-1 ride-2 ride-bell","closed-hi-hat open-hi-hat","high-tom cowbell","low-mid-tom high-mid-tom","snare-1 snare2 side-stick","low-tom sticks hand-clap tambourine","high-floor-tom","low-floor-tom","low-bass high-bass","","pedal-hi-hat","","","","","","",""];#t={31:"headX",37:"headCircle",39:"headX",42:"headX",44:"headX",46:"headCircleX",49:"headCircleX",51:"headX",52:"headCircleX",53:"headDiamond",54:"headX",55:"headX",56:"headTriangleUp",57:"headCircleX",58:"headTriangleUp",59:"headX"};getNoteHTML(e,o,n){let r=D(e),i=this.#t[r],u=S[i],s=i?`<span class="head" data-glyph="${i}">${u}</span>`:super.getNoteHTML(e,o,n);return o<.02?re+s+ie:s}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getPart(e){return[35,36,37,38,40,41,43,44,45,47,50].includes(D(e))?this.parts.drums:this.parts.cymbals}getRow(e,o){let n=typeof o=="string"?o:co(o);if(!n)throw new Error("Drum name not found for pitch "+o);let r=this.rows.findIndex(i=>i.includes(n));if(ai.DEBUG&&r===-1)throw new Error('Pitch "'+n+'" is not supported by stave '+this.constructor.name);return r===-1&&console.warn('Pitch "'+n+'" is not supported by stave '+this.constructor.name),r>-1?r:void 0}getSpelling(e,o){return o[1]==="note"?co(D(o[2])):super.getSpelliing(e,o[2])}yRatioToPitch(e){let o=floor(e*this.rows.length),n=o<4?4:o>17?17:o;return this.pitches[n]}};var ut=class extends J{type="percussion";clef=ee;rows=["","","","","","","","","note","","","","","","","",""];get maxPitch(){return this.rows[17]}get bottomPitch(){return this.rows[8]}get centerPitch(){return this.rows[8]}get topPitch(){return this.rows[8]}parts={drums:{name:"drums",beam:"drums-beam",stemup:!1},cymbals:{name:"cymbals",beam:"cymbals-beam",stemup:!0}};getRowDiff(e,o){return 0}};var ui=globalThis||window,lt=class extends B{type="piano";rows=["rh-A6","rh-G6","rh-F6","rh-E6","rh-D6","rh-C6","rh-B5","rh-A5","rh-G5","rh-F5","rh-E5","rh-D5","rh-C5","rh-B4","rh-A4","rh-G4","rh-F4","rh-E4","rh-D4","rh-C4","rh-B3","lh-B4 rh-A3","lh-A4 rh-G3","lh-G4 rh-F3","lh-F4 rh-E3","lh-E4 rh-D3","lh-D4","lh-C4","lh-B3","lh-A3","lh-G3","lh-F3","lh-E3","lh-D3","lh-C3","lh-B2","lh-A2","lh-G2","lh-F2","lh-E2","lh-D2","lh-C2","lh-B1","lh-A1","lh-G1","lh-F1","lh-E1"];getClefHTML(){return`<span class="treble-clef clef">${it}</span><span class="bass-clef clef">${ct}</span>`}getTimeSigHTML(e,o,n){return`<span class="timesig" data-event="${n}" data-part="rh">
            <sup>${S["timeSig"+e]}</sup>
            <sub>${S["timeSig"+o]}</sub>
        </span>
        <span class="timesig" data-event="${n}" data-part="lh">
            <sup>${S["timeSig"+e]}</sup>
            <sub>${S["timeSig"+o]}</sub>
        </span>`}parts=[{},{name:"lh",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1,DEFAULT:!0},{name:"rh",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",DEFAULT:!0},{name:"soprano",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!0},{name:"alto",topRow:9,centerRow:13,bottomRow:18,topPitch:"F5",centerPitch:"B4",bottomPitch:"E4",stemup:!1},{name:"tenor",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!0},{name:"bass",topRow:29,centerRow:33,bottomRow:38,topPitch:"A3",centerPitch:"D3",bottomPitch:"G2",stemup:!1}];getRow(e,o){o=typeof o=="string"?o:toNoteName(o);let n=e.name+"-"+o.replace($t,""),r=this.rows.findIndex(i=>i.includes(n));if(ui.DEBUG&&r===-1)throw new Error('Pitch "'+n+'" is not supported by '+this.constructor.name);return r===-1&&console.warn('Pitch "'+n+'" is not supported by '+this.constructor.name),r>-1?r:void 0}getPart(e){return/[012]$|[AC-G][b#♭♯𝄫𝄪]*3$/.test(e)?this.parts[1]:this.parts[2]}};var ye=class extends B{type="treble-up";clef=_t;rows=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6","D6","E6","F6","G6","A6","B6","C7","D7","E7","F7","G7","A7"]},De=class extends B{type="treble";clef=it;rows=["A6","G6","F6","E6","D6","C6","B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"]},Re=class extends B{type="treble-down";clef=Yt;rows=["C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5"]},Be=class extends B{type="alto";clef=jt;rows=["B5","A5","G5","F5","E5","D5","C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2"]},Ce=class extends B{type="bass";clef=ct;rows=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3","B2","A2","G2","F2","E2","D2","C2","B1","A1","G1","F1","E1"]};B.treble=De;B["treble-up"]=ye;B["treble-down"]=Re;B.alto=Be;B.bass=Ce;B.piano=lt;B.drum=J;B.percussion=ut;B.create=t=>new B[t];var so=B;var I={spellChordRootCFlatAsB:!0,spellChordRootBSharpAsC:!0,spellChordRootESharpAsF:!0,spellChordRootFFlatAsE:!0,swingAsStraight8ths:!0,swingAsStraight16ths:!0,headDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,6/2,4,6,8],restDurations:[1/8,6/32,1/4,6/16,1/2,6/8,1,6/4,2,3,4,6,8]};function li(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Se(t){return t===window?li():t.getClientRects()[0]||t.getBoundingClientRect()}var O=1.1;function pi(t){return parseFloat(t.dataset.duration)}function fi(t){let e=t.childNodes;for(;e.length>1;)t.removeChild(t.lastChild)}function ao(t,e,o){return`M${e[o[0]]}, ${-t*e[o[0]]-.5*O}
        L${e[o[o.length-1]]},${-t*e[o[o.length-1]]-.5*O}
        L${e[o[o.length-1]]},${-t*e[o[o.length-1]]+.5*O}
        L${e[o[0]]}, ${-t*e[o[0]]+.5*O}
        Z`}function Ae(t,e,o,n,r,i){if(i<.125)return;let u=n-1,s;for(;e[++u];)e[u]<=i?s?s.push(u):s=[u]:s&&(t.appendChild(R("path",{class:`beam-path-${4/i} beam-path`,d:ao(r,o,s)})),Ae(t,e,o,s[0],r,i/2),s=void 0);s&&(t.appendChild(R("path",{class:`beam-path-${4/i} beam-path`,d:ao(r,o,s)})),Ae(t,e,o,s[0],r,i/2),s=void 0)}function Vs(t){let e=t.dataset.events.split(/\s+/),o=t.parentElement,n=e.map(l=>o.querySelector('.note[data-event="'+l+'"]')),r=n.map(pi),i=t.viewBox.baseVal,u=i.y<-.5?i.y+.5:i.height-1,s=n.map(Se),c=s[0].x,a=s[s.length-1].x,p=s.map(l=>(l.x-c)/(a-c));fi(t),Ae(t,r,p,0,-u,.25)}var uo=F((t,e)=>e[1],{note:(t,e)=>(e[2]=D(e[2])+t,e),chord:(t,e)=>(e[2]=A(A(e[2])+t),e[5]!==void 0&&(e[5]=A(A(e[2])+t)),e),key:(t,e)=>(e[2]=A(A(e[2])+t),e),default:q});var hi={displace:(t,e,o)=>(o[0]-=t[++e],e),rate:(t,e,o)=>(o[0]/=t[++e],e),quantize:(t,e,o)=>{},transpose:(t,e,o)=>(uo(t[e+1],o),e+1)};function pt(t,e){let o=-1,n;for(;n=t[++o];)o=hi[n](t,o,e);return e}var lo=Object.assign,po=[],di={done:!0,value:void 0},fo={key:2,meter:1,default:0},mi={};function ho(t){return fo[t[1]]||fo.default}function xi(t,e){return e[0]<t[0]?1:e[0]>t[0]?-1:ho(e)-ho(t)}function gi(t,e){return t.find(o=>o.id===e)}var ft=class t{constructor(e,o=po,n=po){e.sort(xi),this.events=e,this.sequences=o,this.transforms=n;let r=-1,i;for(;(i=e[++r])&&pt(n,lo(mi,i))[0]<0;);this.n=r-1}next(){let{events:e,sequences:o,transforms:n,n:r}=this,i=e[r+1],u=i&&pt(n,tt.from(i,e,r+1)),s,c=-1,a=0,p=u?u[0]:1/0,l;for(;s=this[++c];){let h=s.value;h||((h=s.next().value)&&(pt(this.transforms,h),h[0]+=s.startBeat,h.target=(h.target||0)+s.target),(s.done||h[0]>=s.stopBeat)&&++a),h&&h[0]<s.stopBeat&&h[0]<p&&(l=s,p=h[0]),a&&(this[c]=this[c+a])}if(l)return this.value=l.value,l.value=void 0,this;if(!u)return lo(this,di);if(this.n+=1,this.value=u,tt.isSequenceEvent(i)){let h=this.sequences,d=gi(h,i[2]);if(!d)throw new Error('Sequence id "'+i[2]+'" not found');let m=new t(d.events,d.sequences?d.sequences.concat(h):h,i.slice(5));m.startBeat=u[0],m.stopBeat=u[0]+u[4],m.target=u[3];let f=-1;for(;this[++f];);this[f]=m}return this}static from(e){return new t(e.events,e.sequences)}[Symbol.iterator](){return this}};function wi(t,e,o){let n=t(e),r=t(o);return r===n?0:n>r?1:-1}var mo=Y(wi,!0);var Ei=[2,3,4,5,6,7,9],yi=1/12,xo=.25,go=.2,ve={},et=0;function wo(t,e){return Math.cos(2*Math.PI*e/t)}function Eo(t,e,o,n,r){let i=t/e,u=0,s=0,c=0,a,p;for(n[r-1]&&C(n[r-1])>o+.125&&(c=1),--r;n[++r]!==void 0&&n[r][0]-o<i/4;)c=1;for(--r;n[++r]!==void 0&&n[r][0]-o<t-i/4;){if(a=Math.round((n[r][0]-o)/i),p=1<<a,a<e&&p>c){if(e>4&&p>c<<1)return;c+=p}u+=wo(i,n[r][0]-o),s+=1,!(n[r][0]+n[r][4]-o>t)&&(u+=go*wo(i,n[r][0]+n[r][4]-o),s+=go)}if(!(e>4&&a!==e-1)&&s)return ve.score=u/(s+1),ve.rhythm=c,ve}function Di(t,e,o,n,r,i,u){let s=o[n-1]&&C(o[n-1])>r+.125?r:e*Math.floor((o[n][0]-r)/e)+r,c=i.length;for(;e/i[--c]<yi;);++c;let a,p;for(;a=i[--c];)p=Eo(e,a,s,o,n),p&&p.score>=et&&p.score&&(et=p.score,t.beat=s,t.duration=e,t.divisor=a,t.rhythm=p.rhythm),o[n][0]>=s+.5*e&&s+1.5*e<u&&(p=Eo(e,a,s+.5*e,o,n),p&&p.score>=et&&(et=p.score,t.beat=s+.5*e,t.duration=e,t.divisor=a,t.rhythm=p.rhythm));return t}function Fe(t,e,o){let n=-1;for(;t[++n]!==void 0&&t[n][0]<e;);if(!t[n])return;let r={};et=xo;let i=1/8;for(;(i*=2)&&i<=o;)Di(r,i,t,n,e,Ei,e+o);return et>xo&&r}var{abs:Ri,EPSILON:Bi}=Math;function Gt(t,e){return Math.round(e/t)*t}function H(t,e,o=Bi){return t!==void 0&&(t===e||Ri(t-e)<o)}function Z(t,e,o){return H(t,e,o)||t<e}function Ne(t,e,o){return H(t,e,o)||t>e}function Mt(t,e,o){return t!==void 0&&e!==void 0&&!Z(t,e,o)}function be(t,e,o){return t!==void 0&&e!==void 0&&!Ne(t,e,o)}function Pe(t){return 2**Math.ceil(Math.log2(t))}function yo(t){return 2**Math.floor(Math.log2(t))}function Do(t){return t>0&&(t&t-1)===0}function Te(t,e,o){if(H(0,o,t/2))return e;let n=e*2;for(;(n/=2)>t;)if(H(0,j(n,o),t/2))return n;return n}function ht(t,e){let o=-1,n=0;for(;t[++o]!==void 0;);for(;arguments[++n]!==void 0;)t[o++]=arguments[n];return t}function ot(t){let e=-1;for(;t[++e]!==void 0;);return e}function $e(t){return t[ot(t)-1]}function dt(t,e){let o=[],n=-1;for(;e[++n]!==void 0;)o.push(t(e[n],n));return o}var Le=Object.assign,{abs:Ya,ceil:Ci,floor:ke,min:Co,max:So,sqrt:Ro,round:_a}=Math,$=1/16,mt=1/24,ja=mo(V("row"));function Bo(t,e,o,n){return t+e/n.length}function Ao(t,e){return So(t,C(e))}function Si(t,e){return D(t[2])<D(e[2])?1:-1}function vo(t,e,o){let n={},r=-1,i;for(;i=o[++r];){let u=i.scribeEvents,s=i.scribeIndex,c=Pt(u,s,e),a=Tt(c);n[r]=t.getSpelling(a,i)}return n}function Ai(t,e,o){let n={},r=-1;for(;o[++r];)n[r]=t.getRow(e,o[r]);return n}function vi(t){let e={},o=-1,n=0;for(;t[++o]!==void 0;)e[o]={},t[o]-t[o-1]===1?e[o].clusterdown=++n:n=0;for(n=0;t[--o]!==void 0;)t[o+1]-t[o]===1?e[o].clusterup=++n:n=0;return e}function Lt(t,e,o){let n=-1,r=0,i,u;for(;o[++n];)u=t.getRow(e,o[n]),u!==void 0&&u>r&&(r=u,i=o[n]);return{row:r,pitch:i}}function kt(t,e,o){let n=-1,r=128,i,u;for(;o[++n];)u=t.getRow(e,o[n]),u!==void 0&&u<r&&(r=u,i=o[n]);return{row:r,pitch:i}}function Oe(t,e,o,n){let r=e.centerRow||t.centerRow,i=o-r;return n-r+i>0}function Fo(t,e,o){let{row:n}=Lt(t,e,o),{row:r}=kt(t,e,o);return Oe(t,e,n,r)}function Fi(t,e,o){let n=[],r=-1,i;for(;i=o[++r];)i.type==="note"&&n.push(i.pitch);return Fo(t,e,n)}function z(t,e,o,n){let r=-1;for(;n[++r]&&n[r].beat===n.beat;);if(!n[r])return t;let i=n[0].beat,s=$e(n).beat-i,c=o.stemup===void 0?Fo(e,o,dt(V("pitch"),n)):o.stemup;if(o.beam){let w;for(r=-1;w=n[++r];)w.stemup=c,w.beam=n;return t.push(Le(n,{duration:s,stemup:c,range:0})),t}let a=[],p;for(r=-1;p=n[++r];){let w=e.getRow(o,p.pitch);if(w===void 0)continue;let b;for(;n[++r]&&H(n[r].beat,p.beat,mt);)b=e.getRow(o,n[r].pitch),b!==void 0&&(c?b<w&&(w=b):b>w&&(w=b));--r,a.push(w)}let l=a.length-1,h=a.slice(0,ke(.5*a.length)).reduce(Bo,0),d=a.slice(Ci(.5*a.length)).reduce(Bo,0),m=Array.from(a,(w,b)=>(.2+.1*l)*b*(d-h)/l),f=m[m.length-1]-m[0],x=c?-50:50,y;for(r=a.length;r--;)y=m[r]-a[r],x=c?y>x?y:x:y<x?y:x;for(r=a.length;r--;)m[r]-=x+a[0];let g=-1;for(r=-1;p=n[++r];){for(++g,p.stemup=c,p.beam=n,p.stemHeight=c?1-.125*(m[r]-a[r]+a[0]):1+.125*(m[r]-a[r]+a[0]);n[++r]&&H(n[r].beat,p.beat,$);)n[r].stemup=c,n[r].beam=n,n[r].stemHeight=p.stemHeight;--r}return t.push(Le(n,{pitch:n[0].pitch,y:m[0],duration:s,stemup:c,range:f})),t}function Ge(t,e){let o=2*Pe(e);for(;(o/=2)>t/2;){if(1.75*o===e)return 1.75*o;if(1.5*o===e)return 1.5*o;if(o<=e)return o}return t}function Ni(t,e,o){o=o||1/0;let n=4*Pe(e);for(;(n/=2)>t/2;)if(n<=e*2&&n<=o)return n;return t}function No(t,e,o,n,r,i){let s=yo(e.divisor),c=ke(r/e.divisor)*e.divisor,a=Te(.125,s,r-c),p=ke(n/e.divisor)*e.divisor,l=c+e.divisor<n&&c+e.divisor;if(r===c)return t.indexOf(n-r)!==-1?n-r:t.indexOf(p-r)!==-1?p-r:l?l-r:Ni(.125,n-r,i-r);if(H(n,p,$))return t.indexOf(n-r)!==-1?n-r:l&&t.indexOf(l-r)!==-1?l-r:a;{let h=4*a;return(r-c)%h/a===1?r+2*a===i?2*a:(r+3*a>=i&&console.log("Next event beat is inside quaduplet"),a<1?n>=r+a*3/2?3*a:n>=r+a?a:Ge(.125,n-r):n>=r+a*3?a*3:n>=r+a*2?a*2:n>r+a?a:Ge(.125,n-r)):n>r+a?a:Ge(.125,n-r)}}function bi(t,e,o,n,r,i){return{type:"rest",beat:i,duration:No(t,e,i,r,i,r),stave:o,part:n}}function Me(t,e,o,n,r,i,u){for(;Mt(u,i,$);){let s=bi(e,o,n,r,u,i);t.push(s),i+=s.duration}return u}function Pi(t,e,o,n,r,i,u,s,c){let a=at.test(s)?1:st.test(s)?-1:void 0,p=s[0]+s.slice(-1);Ne(u[0],e.beat,$)&&a!==r[p]&&(r[p]=a,t.push(Le({},{type:"acci",beat:i,pitch:s,part:n,distance:c,stave:o,event:u,value:a||0})))}function bo(t,e,o,n,r,i,u,s,c){let a=-1;for(;s[++a];)Pi(t,e,o,n,r,i,u[a],s[a],c[a]-c[a-1]);return i}function Po(t,e,o,n,r){let{row:i,pitch:u}=kt(e,o,r),s=i-(o.topRow||e.topRow)+1;s<0&&t.push({type:"ledge",beat:n,pitch:u,part:o,rows:s});let{row:c,pitch:a}=Lt(e,o,r);s=c-(o.bottomRow||e.bottomRow),s>0&&t.push({type:"ledge",beat:n,pitch:a,part:o,rows:s})}function Ti(t,e,o){let{beat:n,duration:r,divisor:i}=o,u=e.stemup===void 0?Fi(t,e,o):e.stemup,s=-1,c;for(;c=o[++s];)c.type==="note"&&!c.beam&&(c.stemup=u);let a=n+.5*r,p=D(t.topPitch)-12,l,h=ot(o);for(;(c=o[--h])&&c.beat>a;);for(++h;(c=o[--h])&&c.beat+c.duration>a;){let g=D(c.pitch);(!l||g>l)&&(l=g)}let d=p;for(h=-1;(c=o[++h])&&c.beat<n+$;){let g=D(c.pitch);(!d||g>d)&&(d=g)}let m=p;for(h=ot(o);(c=o[--h])&&c.beat>n+r-r/i-$;){let g=D(c.pitch);(!m||g>m)&&(m=g)}let f=Math.ceil((d+m)/2),x=rt(f);f>l&&(l=f),o.pitch=rt(l),o.stemup=u;let y=m-d;o.angle=y<0?4*Ro(-y):-4*Ro(y)}function $i(t,e,o,n,r,i,u,s,c,a,p,l,h,d){(u.swingAsStraight8ths&&c===1||u.swingAsStraight16ths&&c===.5)&&a===3&&(p===4||p===5)&&(a=2);let m=c/a,f=s+c,x={type:"tuplet",beat:s,duration:c,divisor:a,rhythm:p,part:i,stave:o},y,g;for(Do(a)||t.push(x);be(s,f,mt);){for(;(y=h[++d])&&Z(y[0]-e.beat,s+.5*m,mt);)l.push(y);if(--d,!l.length){t.push({type:"rest",beat:s,duration:m,stave:o,part:i}),s+=m;continue}let w=vo(o,n,l),{row:b,pitch:Wt}=Lt(o,i,w),{row:gt,pitch:It}=kt(o,i,w),wt=i.stemup===void 0?Oe(o,i,b,gt):i.stemup,Xt=Co(l.reduce(Ao,0)-e.beat,y?y[0]-e.beat:e.duration,x.beat+x.duration),T=So(m,Gt(m,Xt-s));Mt(T,.5,mt)?g&&(z(t,o,i,g),g=void 0):g||(g={type:"beam",beat:s,part:i}),Po(t,o,i,s,w),bo(t,e,o,i,r,s,l,w,rows);let E=-1;for(;l[++E];)t.push({type:"note",beat:s,pitch:w[E],duration:T,part:i,stemup:wt,top:w[E]===It,bottom:w[E]===Wt,stave:o,event:l[E]});for(ht(x,...t.slice(-1*l.length)),g&&ht(g,...t.slice(-1*l.length)),E=l.length;E--;){let P=C(l[E])-e.beat;Z(P,s+T+.5*m,mt)?l.splice(E,1):t.push({type:"tie",beat:s,pitch:w[E],duration:T,stemup:wt,part:i,event:l[E]})}s+=T}return g&&z(t,o,i,g),Ti(o,i,x),d}function He(t,e,o,n=0,r={},i,u,s=I){let c=[],{headDurations:a,restDurations:p}=s,l=0,h=-1,d,m,f;for(;(d=u[++h])&&Z(d[0]+d[4]-e.beat,l,$););for(--h;be(l,e.duration,$);){f&&e.divisions.find(P=>H(l,P,$))&&(z(t,o,i,f),f=void 0);let x=Fe(u,e.beat+l,e.duration-l);if(x&&x.divisor!==2&&x.divisor!==4){Mt(x.beat-e.beat,l,$)&&Me(t,s.restDurations,e,o,i,l,x.beat-e.beat),f&&(z(t,o,i,f),f=void 0),h=$i(t,e,o,n,r,i,s,x.beat-e.beat,x.duration,x.divisor,x.rhythm,c,u,h),l=x.beat-e.beat+x.duration;continue}for(;(d=u[++h])&&Z(d[0]-e.beat,l,$);)c.push(d);if(--h,o.pitched&&c.sort(Si),!c.length){if(!d){f&&(z(t,o,i,f),f=void 0),Me(t,s.restDurations,e,o,i,l,e.duration);break}let P=Gt(.125,d[0]-e.beat);if(P<=l){console.log(`Problem at bar ${e.count}, moving to next bar ${l} ${P}`),e.error="Stop beat has ended up less than beat";break}f&&(To(e.divisions,l,P)||P-l>=.5)&&(z(t,o,i,f),f=void 0),Me(t,p,e,o,i,l,P),l=P;continue}let y=vo(o,n,c),g=Ai(o,i,y),w=vi(g),{row:b}=Lt(o,i,y),{row:Wt}=kt(o,i,y),gt=i.stemup===void 0?Oe(o,i,b,Wt):i.stemup;Po(t,o,i,l,y),bo(t,e,o,i,r,l,c,y,g);let It=c[0][0]-e.beat,wt=Co(e.duration,c.reduce(Ao,0)-e.beat),Xt=d&&Gt(.125,d[0])-e.beat,T=No(a,e,It,wt,l,Xt);T>=1?f&&(z(t,o,i,f),f=void 0):f||(f={type:"beam",beat:l,part:i});let E=-1;for(;c[++E];)t.push({type:"note",beat:l,pitch:y[E],duration:T,part:i,stemup:gt,top:E===0,bottom:E===c.length-1,clusterup:(console.log(E,w[E]),w[E].clusterup),clusterdown:w[E].clusterdown,stave:o,event:c[E]});for(f&&ht(f,...t.slice(-1*c.length)),E=c.length;E--;){let P=C(c[E])-e.beat;Z(P,l+T,$)||P-(l+T)<.125+1/16*(C(c[E])-c[E][0])?c.splice(E,1):t.push({type:"tie",beat:l,pitch:y[E],duration:T,stemup:gt,part:i,event:c[E]})}l+=T}return f&&(z(t,o,i,f),f=void 0),t}var Gi={"2,2":[2],"3,2":[2,4],"2,1":[1],"3,1":[1,2],"4,1":[2],"3,0.5":[1.5],"3,1.5":[1.5],"12,0.5":[1.5,3,4.5]};function Mi(t,e){return Gi[t+","+e]||At}function To(t,e,o){let n=-1;for(;t[++n]&&t[n]<=e;);return o>t[n]?t[n]:void 0}var Li=[],ki={"-2":"𝄫","-1":"♭",0:"",1:"♯",2:"𝄪"},$o=["F♯","C♯","G♯","D♯","A♯","E♯","B♯","B♭","E♭","A♭","D♭","G♭","C♭","F♭"];function Oi(t,e){let o=$o.indexOf(t.pitch),n=$o.indexOf(e.pitch);return o>n?1:o<n?-1:0}function Go(t,e){return Ee(e).reduce((n,r,i)=>{let u=r-W[i];if(u!==0){let s=_(W[i]),c=10;for(;c--;)n[s+c]=u}return n},t),t}function Hi(t,e,o,n,r,i,u){let s=-1,c;for(;c=i[++s];)switch(c[1]){case"key":{let a=A(c[2]),p=Ee(a);Go(r,a),t.push.apply(t,p.map((l,h)=>l-W[h]&&{type:"acci",pitch:_(W[h])+ki[l-W[h]],value:l-W[h],stave:o}).filter(l=>!!l).sort(Oi)),e.key=a;break}case"meter":{t.push({type:"timesig",beat:0,numerator:c[3]===1.5?c[2]/.5:c[2]/c[3],denominator:c[3]===1.5?8:4/c[3],stave:o,event:c});break}case"symbol":{t.push({type:"symbol"+c[2],stave:o});break}case"chord":{let a=c[0]-e.beat,p=Pt(i,s,n),l=Tt(p),h=o.getSpelling(l,c);h==="C♭"&&u.spellChordRootCFlatAsB&&(h="B"),h==="E♯"&&u.spellChordRootESharpAsF&&(h="F"),h==="B♯"&&u.spellChordRootBSharpAsC&&(h="C"),h==="F♭"&&u.spellChordRootFFlatAsE&&(h="E"),t.push({type:"chord",beat:a,duration:c[0]+c[4]>e.beat+e.duration?e.duration-a:c[4],root:h,extension:c[3],event:c,stave:o});break}case"lyric":{let a=c[0]-e.beat;t.push({type:"lyric",beat:a,duration:c[0]+c[3]>e.beat+e.duration?e.duration-a:c[3],value:c[2],event:c,stave:o});break}case"sequence":{e.doubleBarLine=!0;break}default:{if(Li.includes(c[1]))return;console.log('Scribe: ignoring event type "'+c[1]+'"')}}return t}function xt(t,e,o,n,r,i,u,s,c,a=I){let p=[];if(c){let f=C(c);f>e&&f<=e+o&&u.push(c)}let l=Go({},i),h={type:"bar",beat:e,duration:o,key:i,divisor:n||4,divisions:Mi(o,n),stave:r,count:t,symbols:p};Hi(p,h,r,i,l,u,I);let d,m=0;for(d in r.parts){let f=r.parts[d],x=s[f.name]||[];!f.DEFAULT&&!x.length||(He(p,h,r,i,l,f,x,a),++m)}return m||(console.log("Stave has no parts defined SHOULD NOT BE"),He(p,h,r,i,l,r.parts[0],[],a)),h}function qi(t,e){if(!(t==="stave"||t==="event"||t==="sequence"||t==="beam"))return e}function Ui(t){let e=t.symbols.filter(o=>o.type==="chord"||o.type==="note");return JSON.stringify(e,qi)}function Q(t,e){t.symbols=t.symbols.filter(o=>o.type==="doublebarline"||o.type==="clef").concat([{type:"BARREPEAT",count:e,duration:t.duration}])}function Ot(t,e,o){let n=Ui(o);switch(e.length){case 1:break;case 2:break;case 3:{n==="[]"&&e[0]==="[]"?e.length=0:n===e[0]&&n===e[1]&&n===e[2]&&o.symbols.filter(r=>r.type!=="clef"&&r.type!=="timesig").find(r=>r.type!=="rest")?(Q(t[t.length-2],1),Q(t[t.length-1],1),Q(o,1)):(n!==e[1]||e[0]!==e[2])&&(e.length=2);break}case 4:{n===e[0]&&n===e[1]&&n===e[2]&&n===e[3]?(Q(o,1),e.length=3):(n!==e[1]||e[0]!==e[2]||n!==e[3])&&(e.length=2);break}case 5:{n===e[1]&&n===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=2,Q(t[t.length-1],2),Q(o,2)):e.length=4;break}case 6:break;case 7:{n===e[1]&&n===e[3]&&e[0]===e[2]&&e[0]===e[4]?(t.length-=1,Q(o,2),e.length=5):e.length=1;break}}for(e.unshift(n);e.length>8;)e.pop()}function qe(t,e,o){let n=o.target?t.parts[o.target]:t.getPart(o[2]),r=e[n.name]||(e[n.name]=[]);e[n.name].push(o)}function Ue(t,e,o,n=I){let r=[],i=[],u=[],s=[],c=0,a=[],p={},l=0,h=0,d,m,f,x;for(f of t)if(f.scribeIndex=r.length,f.scribeEvents=r,r.push(f),!e.includes(f[1])){for(;f[0]>=c+d;){let g=xt(i.length+1,c,d,m,o,l,a,p,x,n);Ot(i,s,g),i.push(g),l=g.key,c=c+d,a=[],p={};let w=-1;for(;u[++w];)qe(o,p,u[w]),C(u[w])<c+d&&u.splice(w--,1)}switch(f[1]){case"note":{qe(o,p,f),C(f)>c+d&&u.push(f),h<C(f)&&(h=C(f));break}case"sequence":{f.events===t.events&&(x=f),h<C(f)&&(h=C(f));break}case"meter":d=f[2],m=f[3],f[0]!==c&&console.log("TODO");default:a.push(f)}}for(;u.length;){let g=xt(i.length+1,c,d,m,o,l,a,p,x,n);Ot(i,s,g),i.push(g),c=c+d,a=[],p={};let w=-1;for(;f=u[++w];)qe(o,p,f),C(f)<c+d&&u.splice(w--,1)}for(;c<h-d;){let g=xt(i.length+1,c,d,m,o,l,a,p,x,n);Ot(i,s,g),i.push(g),c=c+d,a=[],p={}}d||(d=C(r[r.length-1]));let y=xt(i.length+1,c,d,m,o,l,a,p,x,n);return Ot(i,s,y),i.push(y),i}var Ht=Symbol("scribe-id"),Wi=0;function X(t){return t[Ht]||(t[Ht]=++Wi+""),t[Ht]}var qt=Math.abs,Ut={flat:`<span class="chord-flat">${Bt}</span>`,sharp:`<span class="chord-sharp">${St}</span>`},Ii={2:"acci acci-doublesharp",1:"acci acci-sharp",0:"acci acci-natural","-1":"acci acci-flat","-2":"acci acci-doubleflat"},Xi={2:ne,1:St,0:Ct,"-1":Bt,"-2":oe},zi={"1.33":le,"0.67":ue,"0.33":ae,"0.17":se,"0.08":ce},Ki=/^(∆|-|ø|7|\+)?(alt|sus|maj|min|dim|aug)?(.*)$/;function v(t){return t.toFixed(4).replace(/\.?0+$/,"")}var We=F(V("type"),{BARREPEAT:t=>R("span",{class:"BARREPEAT",html:S["barRepeat"+t.count],data:{duration:t.duration}}),clef:t=>t.stave.getClefHTML?R("fragment",t.stave.getClefHTML()):R("span",{class:`${t.stave.type}-clef clef`,html:t.stave.clef}),chord:t=>{let e=Ki.exec(t.extension);return R("abbr",{class:"chord chord-abbr",title:"",html:'<span class="chord-root">'+t.root.replace(at,Ut.sharp).replace(st,Ut.flat)+'</span><span class="chord-ext">'+(e[1]?'<span class="chord-ext-'+e[1]+'">'+e[1]+"</span>":"")+(e[2]?"<sub>"+e[2]+"</sub>":"")+(e[3]?"<sup>"+e[3].replace(at,Ut.sharp).replace(st,Ut.flat)+"</sup>":"")+"</span>"+(t.bass?fe+'<span class="chord-bass">'+t.bass+"</span>":""),data:{beat:v(t.beat),duration:v(t.duration),event:X(t.event)}})},timesig:t=>t.stave.getTimeSigHTML?R("fragment",t.stave.getTimeSigHTML(t.numerator,t.denominator,X(t.event))):R("span",{class:"timesig",html:`<sup>${S["timeSig"+t.numerator]}</sup>
                <sub>${S["timeSig"+t.denominator]}</sub>`,data:{event:X(t.event)}}),symbolcoda:t=>R("p",{html:pe,class:"coda"}),barcount:t=>R("span",{html:t.text,class:"barcount"}),lyric:t=>R("span",{class:"lyric",part:"lyric",html:t.value,data:{beat:v(t.beat),duration:v(t.duration),event:X(t.event)}}),acci:t=>R("span",{class:(Ii[t.value]||"acci")+(t.distance<6?" cluster-acci":""),html:Xi[t.value]||Ct,data:t.beat===void 0?{pitch:t.pitch}:{beat:v(t.beat),pitch:t.pitch,part:t.part.name,event:X(t.event)}}),ledge:t=>R("svg",{class:`${t.rows<0?"up":"down"}-ledge ledge`,viewBox:t.rows<0?`0 ${9+t.rows-.5} 5 ${qt(t.rows)}`:`0 -0.5 5 ${qt(t.rows)}`,preserveAspectRatio:"xMidYMin",html:`
            <line x1="0" x2="5" y1="0" y2="0"></line>
            <line x1="0" x2="5" y1="2" y2="2"></line>
            <line x1="0" x2="5" y1="4" y2="4"></line>
            <line x1="0" x2="5" y1="6" y2="6"></line>
            <line x1="0" x2="5" y1="8" y2="8"></line>
        `,data:{beat:v(t.beat),pitch:t.pitch,part:t.part.name}}),note:t=>R("data",{class:`${t.stemup?"up-note ":"down-note "}${t.top?"top-note ":""}${t.bottom?"bottom-note ":""}${t.stemup?t.clusterup%2===1?"cluster-note ":"":t.clusterdown%2===1?"cluster-note ":""}${t.beam?"beam-note ":""}note`,style:t.stemHeight?`--stem-height: ${t.stemHeight};`:void 0,html:t.stave.getNoteHTML(t.pitch,t.dynamic,t.duration),title:`${t.pitch} (${D(t.pitch)})`,data:{beat:v(t.beat),pitch:t.pitch,duration:v(t.duration),part:t.part.name,beam:t.beam&&X(t.beam),event:X(t.event)}}),beam:(t,e)=>R("svg",{class:`${t.stemup?"up":"down"}-beam beam`,viewBox:`0 ${(t.range<0?t.range:0)-.5} 1 ${qt(t.range)+1}`,preserveAspectRatio:"none",style:`${t.y?"--translate-y:"+t.y*.125+";":""} height: ${(qt(t.range)+O)*.125}em; align-self: ${t.range<0?"end":"start"};`,html:`<path class="beam-path" d="M0,${-.5*O} L1,${t.range-.5*O} L1,${t.range+.5*O} L0,${.5*O} Z"></path>`,data:{beat:v(t.beat),pitch:t.pitch,duration:v(t.duration),part:t.part.name,events:dt(o=>X(o.event),t).join(" ")}}),tie:t=>R("svg",{class:`${t.stemup?"down":"up"}-tie tie`,viewBox:"0 0 1 1",preserveAspectRatio:"none",html:'<path class="tie-path" transform="translate(0, 0.14) scale(1 0.6)" d="M0.979174733,0.0124875307 C0.650597814,1.1195554 0.135029714,1.00095361 0.0165376402,0.026468657 C0.0113570514,0.0135475362 0.00253387291,0.00218807553 0,0 C0.0977526897,1.29523004 0.656681642,1.37089992 1,2.43111793e-08 C0.991901367,2.43111797e-08 0.987703936,0.01248753 0.979174733,0.0124875307 Z M0.979174733,0.0124875307"></path>',data:{beat:v(t.beat),pitch:t.pitch,duration:v(t.duration),part:t.part.name}}),tuplet:t=>R("span",{class:`${t.stemup?"up":"down"}-tuplet tuplet`,html:S["tuplet"+t.divisor],data:{beat:v(t.beat),pitch:t.pitch,duration:v(t.duration),divisor:t.divisor,rhythm:t.rhythm.toString(2).split("").reverse().join(""),part:t.part.name},style:`--angle: ${t.angle}deg;`}),rest:t=>R("span",{class:"rest",html:zi[t.duration.toFixed(2)]||S["rest"+(t.duration+"").replace(".","")]||"",data:{beat:v(t.beat),pitch:t.pitch,duration:v(t.duration),part:t.part.name},"aria-hidden":"true"}),default:function(t){return function(e){t[e.type]||(t[e.type]=!0,console.log(e),console.error('Scribe: symbol type "'+e.type+'" not rendered'))}}({})});function Vi(t){return t[0]<=0&&t[1]==="meter"}function Ji(t){return t[0]<=0&&t[1]==="key"}function Zi(t,e){let o=We(e);return o&&t.push(o),t}function Qi(t,e){return t.push(R("div",{class:`${e.stave.type}-stave stave ${e.doubleBarLine?"end-bar ":""}bar${e.error?" error ":""}`,data:{beat:e.beat,duration:e.duration,count:e.count,key:_(e.key)},children:e.symbols.reduce(Zi,[])})),t}function Yi(t,e,o,n,r,i=1/0,u=0,s=0,c=I){let a=t.events;!a.find(Vi)&&r&&a.unshift([0,"meter",r[2],r[3]]),!a.find(Ji)&&n&&a.unshift([0,"key",n]);let h=so.create(o||"treble"),d=[];u&&d.push("transpose",u),s&&d.push("displace",s);let m=new ft(a,t.sequences,d),f=Ue(m,e,h,c).reduce(Qi,[]),x=f[0],y=x.querySelectorAll(".acci:not([data-beat])"),g=R("div",{class:`${h.type}-stave signature-stave stave`,children:[We({type:"clef",stave:h}),...y],data:{key:x.dataset.key}}),w=R("div",{id:"side",class:"side",data:{key:x.dataset.key}}),b=24;for(;b--;)w.appendChild(g.cloneNode(!0));return f.unshift(w),f}export{q as a,F as b,Et as c,Y as d,k as e,R as f,so as g,I as h,Vs as i,Yi as j};
//# sourceMappingURL=chunk-OUF5A7HZ.js.map
